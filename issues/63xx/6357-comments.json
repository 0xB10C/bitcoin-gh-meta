[
   {
      "body" : "FWIW a decent chunk of the hashing power has disabled the priority space, and more are likely to follow. Further priority work is probably a wasted effort.",
      "created_at" : "2015-06-30T21:37:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-117352788",
      "id" : 117352788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-06-30T21:37:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/117352788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "@petertodd Majority still accepts free transactions (at least BitFury, Antpool and BTCChina). But I agree this will change soon (reaching 1mb cap).",
      "created_at" : "2015-07-01T00:09:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-117376192",
      "id" : 117376192,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-01T00:09:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/117376192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9091633?v=3",
         "events_url" : "https://api.github.com/users/coinx-ltc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/coinx-ltc/followers",
         "following_url" : "https://api.github.com/users/coinx-ltc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/coinx-ltc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/coinx-ltc",
         "id" : 9091633,
         "login" : "coinx-ltc",
         "organizations_url" : "https://api.github.com/users/coinx-ltc/orgs",
         "received_events_url" : "https://api.github.com/users/coinx-ltc/received_events",
         "repos_url" : "https://api.github.com/users/coinx-ltc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/coinx-ltc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/coinx-ltc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/coinx-ltc"
      }
   },
   {
      "body" : "(pushed and squashed a bug fix)\r\n\r\n@petertodd I completely agree.  However I would really like to see #6331 merged, and I don't want that to be held up debating whether priority should be removed, so in the meantime, if we want priority to be calculated correctly, I think this does it.",
      "created_at" : "2015-07-01T20:06:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-117810296",
      "id" : 117810296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-01T20:06:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/117810296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r34272784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34272784"
         }
      },
      "body" : "If a block contains transactions that depend on other transactions in the same block, won't this cause recalcPriority to be called multiple times for them?\r\n",
      "commit_id" : "13d22c66c389f315bd1256c84b3a2828fdeddce4",
      "created_at" : "2015-07-09T16:17:01Z",
      "diff_hunk" : "@@ -212,6 +244,7 @@ void CTxMemPool::removeForBlock(const std::vector<CTransaction>& vtx, unsigned i\n     BOOST_FOREACH(const CTransaction& tx, vtx)\n     {\n         std::list<CTransaction> dummy;\n+        updateDependentPriorities(tx, nBlockHeight, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r34272784",
      "id" : 34272784,
      "original_commit_id" : "13d22c66c389f315bd1256c84b3a2828fdeddce4",
      "original_position" : 85,
      "path" : "src/txmempool.cpp",
      "position" : 85,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357",
      "updated_at" : "2015-07-09T16:17:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34272784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r34272849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34272849"
         }
      },
      "body" : "I think you need to pass in a queue of transactions to update, and call this function once for the whole block.",
      "commit_id" : "13d22c66c389f315bd1256c84b3a2828fdeddce4",
      "created_at" : "2015-07-09T16:17:42Z",
      "diff_hunk" : "@@ -212,6 +244,7 @@ void CTxMemPool::removeForBlock(const std::vector<CTransaction>& vtx, unsigned i\n     BOOST_FOREACH(const CTransaction& tx, vtx)\n     {\n         std::list<CTransaction> dummy;\n+        updateDependentPriorities(tx, nBlockHeight, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r34272849",
      "id" : 34272849,
      "original_commit_id" : "13d22c66c389f315bd1256c84b3a2828fdeddce4",
      "original_position" : 85,
      "path" : "src/txmempool.cpp",
      "position" : 85,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357",
      "updated_at" : "2015-07-09T16:17:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34272849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Can you add a consistency check for verifying that the (re)computed priorities match freshly computed ones, in CTxMempool::check()?",
      "created_at" : "2015-07-09T16:18:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-120055691",
      "id" : 120055691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-09T16:18:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120055691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Thanks for the review @sipa.  I commented on IRC, but I think the updateDependentPriorities is correct, I don't think its doing any redundant work.  \r\nHowever in trying to implement your consistency check I definitely uncovered several bugs.  Will push a fix hopefully tomorrow.\r\n",
      "created_at" : "2015-07-09T21:41:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-120151366",
      "id" : 120151366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-09T21:41:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120151366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "OK, fixed some bugs brought out by the consistency check and added said check.\r\n",
      "created_at" : "2015-07-10T16:14:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-120448782",
      "id" : 120448782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-10T16:14:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120448782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "So, let's assume that all blocks contain 30KB of priority txs. At 1cent/KB we'd be looking at $16k/year of tx fees avoided due to priority.\r\n\r\nMeanwhile, if we screw this we just need to lose 2.2 blocks to wipe out all these savings, which comes out of miners' pockets anyway.\r\n\r\nI'm with @jgarzik here: better to remove priority and simplify the codebase, particularly when other than Bitcoin Core nearly no wallets use it anyway. (Electrum is apparently an exception)\r\n\r\nIt's also notable how this patch will make \"priority camping\" easier: broadcast a broadcast a lowish priority tx, and wait until it gets confirmed, over and over again to waste priority on useless txs. I've seen people do this before when we had that bug where the same tx would be included multiple times; I don't doubt it'll happen again.",
      "created_at" : "2015-07-11T13:34:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-120618330",
      "id" : 120618330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-11T13:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120618330",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   }
]
