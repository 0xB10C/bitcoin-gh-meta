[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34038636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34038636"
         }
      },
      "body" : "Not convinced that this code actually belongs in `rpcprotocol`, it is here because that file is shared between bitcoin-cli and bitcoind server, but conceptually it exists on a higher level than the protocol. Feel free to suggest a better place.",
      "commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "created_at" : "2015-07-07T13:29:16Z",
      "diff_hunk" : "@@ -287,3 +289,68 @@ UniValue JSONRPCError(int code, const string& message)\n     error.push_back(Pair(\"message\", message));\n     return error;\n }\n+\n+/** Username used when cookie authentication is in use (arbitrary, only for",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34038636",
      "id" : 34038636,
      "original_commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "original_position" : 21,
      "path" : "src/rpcprotocol.cpp",
      "position" : 21,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388",
      "updated_at" : "2015-07-07T13:29:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34038636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34055509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34055509"
         }
      },
      "body" : "This error should be changed. It will be shown if bitcoin-cli is used while bitcoind is not running, so it's confusing to tell the user to just set a password (which will indeed make this message go away, but just enough to get to `connection refused` :-).",
      "commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "created_at" : "2015-07-07T15:49:01Z",
      "diff_hunk" : "@@ -97,11 +97,19 @@ static bool AppInitRPC(int argc, char* argv[])\n \n UniValue CallRPC(const string& strMethod, const UniValue& params)\n {\n-    if (mapArgs[\"-rpcuser\"] == \"\" && mapArgs[\"-rpcpassword\"] == \"\")\n-        throw runtime_error(strprintf(\n-            _(\"You must set rpcpassword=<password> in the configuration file:\\n%s\\n\"\n-              \"If the file does not exist, create it with owner-readable-only file permissions.\"),\n-                GetConfigFile().string().c_str()));\n+    std::string strRPCUserColonPass;\n+    if (mapArgs[\"-rpcpassword\"] == \"\") {\n+        /* Try fall back to cookie-based authentication if no password is provided */\n+        if (!GetAuthCookie(&strRPCUserColonPass)) {\n+            throw runtime_error(strprintf(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34055509",
      "id" : 34055509,
      "original_commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "original_position" : 13,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 13,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388",
      "updated_at" : "2015-07-07T15:49:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34055509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Nice!  Reviewing this...",
      "created_at" : "2015-07-07T17:22:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6388#issuecomment-119274621",
      "id" : 119274621,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6388",
      "updated_at" : "2015-07-07T17:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119274621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/430315?v=3",
         "events_url" : "https://api.github.com/users/ajweiss/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajweiss/followers",
         "following_url" : "https://api.github.com/users/ajweiss/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajweiss/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajweiss",
         "id" : 430315,
         "login" : "ajweiss",
         "organizations_url" : "https://api.github.com/users/ajweiss/orgs",
         "received_events_url" : "https://api.github.com/users/ajweiss/received_events",
         "repos_url" : "https://api.github.com/users/ajweiss/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajweiss/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajweiss/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajweiss"
      }
   },
   {
      "body" : "I spent some time trying to break this, and was unable to do so.  This grinds off one of bitcoind's most annoying burrs, very nice!  One thing to note is that some of the init scripts in the contrib directory have checks for a set rpcpassword, so when this goes in those should be removed.    \r\n\r\n",
      "created_at" : "2015-07-07T18:01:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6388#issuecomment-119285103",
      "id" : 119285103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6388",
      "updated_at" : "2015-07-07T18:01:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119285103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/430315?v=3",
         "events_url" : "https://api.github.com/users/ajweiss/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajweiss/followers",
         "following_url" : "https://api.github.com/users/ajweiss/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajweiss/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajweiss",
         "id" : 430315,
         "login" : "ajweiss",
         "organizations_url" : "https://api.github.com/users/ajweiss/orgs",
         "received_events_url" : "https://api.github.com/users/ajweiss/received_events",
         "repos_url" : "https://api.github.com/users/ajweiss/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajweiss/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajweiss/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajweiss"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34074675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34074675"
         }
      },
      "body" : "I think this if needs to be rewritten because at the moment the cookie system does not work in regtest.",
      "commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "created_at" : "2015-07-07T18:39:55Z",
      "diff_hunk" : "@@ -597,28 +597,16 @@ void StartRPCThreads()\n         strAllowed += subnet.ToString() + \" \";\n     LogPrint(\"rpc\", \"Allowing RPC connections from: %s\\n\", strAllowed);\n \n-    strRPCUserColonPass = mapArgs[\"-rpcuser\"] + \":\" + mapArgs[\"-rpcpassword\"];\n     if (((mapArgs[\"-rpcpassword\"] == \"\") ||\n          (mapArgs[\"-rpcuser\"] == mapArgs[\"-rpcpassword\"])) && Params().RequireRPCPassword())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34074675",
      "id" : 34074675,
      "original_commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "original_position" : 6,
      "path" : "src/rpcserver.cpp",
      "position" : 6,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388",
      "updated_at" : "2015-07-07T18:39:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34074675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34075046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34075046"
         }
      },
      "body" : "I think `rpcprotocol.h/.cpp` is a good place for this extension. A new `cookieauth.h/cpp` file would be possible but i think is more compact and neatly arranged if it stays in `rpcprotocol.h/cpp`",
      "commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "created_at" : "2015-07-07T18:42:50Z",
      "diff_hunk" : "@@ -287,3 +289,68 @@ UniValue JSONRPCError(int code, const string& message)\n     error.push_back(Pair(\"message\", message));\n     return error;\n }\n+\n+/** Username used when cookie authentication is in use (arbitrary, only for",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34075046",
      "id" : 34075046,
      "original_commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "original_position" : 21,
      "path" : "src/rpcprotocol.cpp",
      "position" : 21,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388",
      "updated_at" : "2015-07-07T18:42:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34075046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34075442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34075442"
         }
      },
      "body" : "I think this if block from L100-L112 should go down to L126 (after the connection has been set up).\r\nIt would make more sense to first check if we can connect to bitcoind, then check if we have some credentials available.",
      "commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "created_at" : "2015-07-07T18:46:00Z",
      "diff_hunk" : "@@ -97,11 +97,19 @@ static bool AppInitRPC(int argc, char* argv[])\n \n UniValue CallRPC(const string& strMethod, const UniValue& params)\n {\n-    if (mapArgs[\"-rpcuser\"] == \"\" && mapArgs[\"-rpcpassword\"] == \"\")\n-        throw runtime_error(strprintf(\n-            _(\"You must set rpcpassword=<password> in the configuration file:\\n%s\\n\"\n-              \"If the file does not exist, create it with owner-readable-only file permissions.\"),\n-                GetConfigFile().string().c_str()));\n+    std::string strRPCUserColonPass;\n+    if (mapArgs[\"-rpcpassword\"] == \"\") {\n+        /* Try fall back to cookie-based authentication if no password is provided */\n+        if (!GetAuthCookie(&strRPCUserColonPass)) {\n+            throw runtime_error(strprintf(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34075442",
      "id" : 34075442,
      "original_commit_id" : "492ee66d296067a6ed6f0bcf8809b40018400147",
      "original_position" : 13,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 13,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6388",
      "updated_at" : "2015-07-07T18:46:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34075442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Nice work!\r\nTested ACK (nit: doesn't work in regtest atm).",
      "created_at" : "2015-07-07T18:46:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6388#issuecomment-119300165",
      "id" : 119300165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6388",
      "updated_at" : "2015-07-07T18:46:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/119300165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
