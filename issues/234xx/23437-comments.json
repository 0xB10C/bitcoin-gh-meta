[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23381](https://github.com/bitcoin/bitcoin/pull/23381) (validation/refactor: refactoring for package submission by glozow)\n* [#22674](https://github.com/bitcoin/bitcoin/pull/22674) (validation: mempool validation and submission for packages of 1 child + parents by glozow)\n* [#21527](https://github.com/bitcoin/bitcoin/pull/21527) (net_processing: lock clean up by ajtowns)\n* [#21515](https://github.com/bitcoin/bitcoin/pull/21515) (Erlay: bandwidth-efficient transaction relay protocol by naumenkogs)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-11-04T08:23:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#issuecomment-960544686",
      "id" : 960544686,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23437",
      "node_id" : "IC_kwDOABII5845QL-u",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/960544686/reactions"
      },
      "updated_at" : "2021-11-05T20:20:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/960544686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r742621253"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/742621253"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this description \"Tweakable parameters of this instance.\" is very illuminating. Tweakable suggests to me that the user can modify these parameters, but that isn't the case here.",
      "commit_id" : "20867dc1526487390f27f3f9c04d5222731bd018",
      "created_at" : "2021-11-04T08:27:27Z",
      "diff_hunk" : "@@ -206,19 +206,23 @@ struct PackageMempoolAcceptResult\n };\n \n /**\n- * Try to add a transaction to the mempool. This is an internal function and is\n- * exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n+ * Try to add a transaction to the mempool with a specified acceptance time. This is an internal\n+ * function and is exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n  *\n- * @param[in]  active_chainstate  Reference to the active chainstate.\n+ * @param[in]  chainparams        Tweakable parameters of this instance.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r742621253",
      "id" : 742621253,
      "line" : 212,
      "node_id" : "PRRC_kwDOABII584sQ4BF",
      "original_commit_id" : "20867dc1526487390f27f3f9c04d5222731bd018",
      "original_line" : 212,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 10,
      "pull_request_review_id" : 797454841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/742621253/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-04T08:28:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/742621253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r742908559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/742908559"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "prefer snake case `accept_time`. Doxygen comment should be more descriptice, e.g. that this is the time that the mempool entry will record and will be used to determine when the entry expires.",
      "commit_id" : "20867dc1526487390f27f3f9c04d5222731bd018",
      "created_at" : "2021-11-04T14:46:43Z",
      "diff_hunk" : "@@ -206,19 +206,23 @@ struct PackageMempoolAcceptResult\n };\n \n /**\n- * Try to add a transaction to the mempool. This is an internal function and is\n- * exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n+ * Try to add a transaction to the mempool with a specified acceptance time. This is an internal\n+ * function and is exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n  *\n- * @param[in]  active_chainstate  Reference to the active chainstate.\n+ * @param[in]  chainparams        Tweakable parameters of this instance.\n  * @param[in]  pool               Reference to the node's mempool.\n+ * @param[in]  active_chainstate  Reference to the active chainstate.\n  * @param[in]  tx                 The transaction to submit for mempool acceptance.\n+ * @param[in]  nAcceptTime        The acceptance time.\n  * @param[in]  bypass_limits      When true, don't enforce mempool fee and capacity limits.\n  * @param[in]  test_accept        When true, run validation checks but don't submit to mempool.\n  *\n  * @returns a MempoolAcceptResult indicating whether the transaction was accepted/rejected with reason.\n  */\n-MempoolAcceptResult AcceptToMemoryPool(CChainState& active_chainstate, CTxMemPool& pool, const CTransactionRef& tx,\n-                                       bool bypass_limits, bool test_accept=false) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+MempoolAcceptResult AcceptToMemoryPool(const CChainParams& chainparams, CTxMemPool& pool,\n+                                                        CChainState& active_chainstate, const CTransactionRef &tx,\n+                                                        int64_t nAcceptTime, bool bypass_limits, bool test_accept)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r742908559",
      "id" : 742908559,
      "line" : 224,
      "node_id" : "PRRC_kwDOABII584sR-KP",
      "original_commit_id" : "20867dc1526487390f27f3f9c04d5222731bd018",
      "original_line" : 224,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 24,
      "pull_request_review_id" : 797841769,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/742908559/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-04T14:49:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/742908559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743375240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743375240"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed the description in 034e827 .",
      "commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "created_at" : "2021-11-05T03:55:27Z",
      "diff_hunk" : "@@ -206,19 +206,23 @@ struct PackageMempoolAcceptResult\n };\n \n /**\n- * Try to add a transaction to the mempool. This is an internal function and is\n- * exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n+ * Try to add a transaction to the mempool with a specified acceptance time. This is an internal\n+ * function and is exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n  *\n- * @param[in]  active_chainstate  Reference to the active chainstate.\n+ * @param[in]  chainparams        Tweakable parameters of this instance.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743375240",
      "id" : 743375240,
      "in_reply_to_id" : 742621253,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sTwGI",
      "original_commit_id" : "20867dc1526487390f27f3f9c04d5222731bd018",
      "original_line" : 212,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 798480851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743375240/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T03:55:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743375240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743375527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743375527"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed `nAcceptTime` to `accept_time` and improved the field description in 034e827",
      "commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "created_at" : "2021-11-05T03:56:36Z",
      "diff_hunk" : "@@ -206,19 +206,23 @@ struct PackageMempoolAcceptResult\n };\n \n /**\n- * Try to add a transaction to the mempool. This is an internal function and is\n- * exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n+ * Try to add a transaction to the mempool with a specified acceptance time. This is an internal\n+ * function and is exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n  *\n- * @param[in]  active_chainstate  Reference to the active chainstate.\n+ * @param[in]  chainparams        Tweakable parameters of this instance.\n  * @param[in]  pool               Reference to the node's mempool.\n+ * @param[in]  active_chainstate  Reference to the active chainstate.\n  * @param[in]  tx                 The transaction to submit for mempool acceptance.\n+ * @param[in]  nAcceptTime        The acceptance time.\n  * @param[in]  bypass_limits      When true, don't enforce mempool fee and capacity limits.\n  * @param[in]  test_accept        When true, run validation checks but don't submit to mempool.\n  *\n  * @returns a MempoolAcceptResult indicating whether the transaction was accepted/rejected with reason.\n  */\n-MempoolAcceptResult AcceptToMemoryPool(CChainState& active_chainstate, CTxMemPool& pool, const CTransactionRef& tx,\n-                                       bool bypass_limits, bool test_accept=false) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+MempoolAcceptResult AcceptToMemoryPool(const CChainParams& chainparams, CTxMemPool& pool,\n+                                                        CChainState& active_chainstate, const CTransactionRef &tx,\n+                                                        int64_t nAcceptTime, bool bypass_limits, bool test_accept)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743375527",
      "id" : 743375527,
      "in_reply_to_id" : 742908559,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sTwKn",
      "original_commit_id" : "20867dc1526487390f27f3f9c04d5222731bd018",
      "original_line" : 224,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 798481204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743375527/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T03:56:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743375527",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jnewbery and @glozow  thanks for reviews.\r\nI addressed your suggestions in 034e827.\r\n\r\nAs these changes are already implemented in another branch, with more other commits, I can close this PR if it's better. ",
      "created_at" : "2021-11-05T04:01:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#issuecomment-961610204",
      "id" : 961610204,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23437",
      "node_id" : "IC_kwDOABII5845UQHc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/961610204/reactions"
      },
      "updated_at" : "2021-11-05T04:01:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/961610204",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743437227"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743437227"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"with a specified acceptance time\" is redundant with the parameter documentation below.",
      "commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "created_at" : "2021-11-05T07:32:06Z",
      "diff_hunk" : "@@ -206,12 +206,26 @@ struct PackageMempoolAcceptResult\n };\n \n /**\n- * (Try to) add a transaction to the memory pool.\n- * @param[in]  bypass_limits   When true, don't enforce mempool fee limits.\n- * @param[in]  test_accept     When true, run validation checks but don't submit to mempool.\n+ * Try to add a transaction to the mempool with a specified acceptance time. This is an internal",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743437227",
      "id" : 743437227,
      "line" : 209,
      "node_id" : "PRRC_kwDOABII584sT_Or",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 209,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 7,
      "pull_request_review_id" : 798557290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743437227/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T07:48:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743437227",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743438207"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743438207"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please align arguments on new lines after the opening parens:\r\n\r\n```suggestion\r\nMempoolAcceptResult AcceptToMemoryPool(const CChainParams& chainparams, CTxMemPool& pool,\r\n                                       CChainState& active_chainstate, const CTransactionRef &tx,\r\n                                       int64_t accept_time, bool bypass_limits, bool test_accept)\r\n```\r\n\r\n(We use clang-style `AlignAfterOpenBracket: true`)",
      "commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "created_at" : "2021-11-05T07:34:27Z",
      "diff_hunk" : "@@ -206,12 +206,26 @@ struct PackageMempoolAcceptResult\n };\n \n /**\n- * (Try to) add a transaction to the memory pool.\n- * @param[in]  bypass_limits   When true, don't enforce mempool fee limits.\n- * @param[in]  test_accept     When true, run validation checks but don't submit to mempool.\n+ * Try to add a transaction to the mempool with a specified acceptance time. This is an internal\n+ * function and is exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n+ *\n+ * @param[in]  chainparams        Chain paramenters.\n+ * @param[in]  pool               Reference to the node's mempool.\n+ * @param[in]  active_chainstate  Reference to the active chainstate.\n+ * @param[in]  tx                 The transaction to submit for mempool acceptance.\n+ * @param[in]  accept_time        The timestamp for adding the transaction to the mempool. Usually\n+ *                                the current system time, but may be different (eg when loading\n+ *                                mempool txs from disk on startup).\n+ *                                It is also used to determine when the entry expires.\n+ * @param[in]  bypass_limits      When true, don't enforce mempool fee and capacity limits.\n+ * @param[in]  test_accept        When true, run validation checks but don't submit to mempool.\n+ *\n+ * @returns a MempoolAcceptResult indicating whether the transaction was accepted/rejected with reason.\n  */\n-MempoolAcceptResult AcceptToMemoryPool(CChainState& active_chainstate, CTxMemPool& pool, const CTransactionRef& tx,\n-                                       bool bypass_limits, bool test_accept=false) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+MempoolAcceptResult AcceptToMemoryPool(const CChainParams& chainparams, CTxMemPool& pool,\n+                                                        CChainState& active_chainstate, const CTransactionRef &tx,\n+                                                        int64_t accept_time, bool bypass_limits, bool test_accept)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743438207",
      "id" : 743438207,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII584sT_d_",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 227,
      "original_position" : 27,
      "original_start_line" : 225,
      "path" : "src/validation.h",
      "position" : 27,
      "pull_request_review_id" : 798557290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743438207/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 225,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-05T07:48:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743438207",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743438724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743438724"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please use clang-tidy style [bugprone-argument-comment](https://clang.llvm.org/extra/clang-tidy/checks/bugprone-argument-comment.html):\r\n\r\n```suggestion\r\n        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(Params(), tx_pool, chainstate, tx, GetTime(), bypass_limits, /*test_accept=*/false));\r\n```\r\n\r\nSee also https://github.com/bitcoin/bitcoin/pull/22981\r\n\r\n(same comment below)",
      "commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "created_at" : "2021-11-05T07:35:32Z",
      "diff_hunk" : "@@ -230,7 +230,7 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         Assert(it->second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n                it->second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n \n-        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx_pool, tx, bypass_limits));\n+        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(Params(), tx_pool, chainstate, tx, GetTime(), bypass_limits, false /* test_accept */));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743438724",
      "id" : 743438724,
      "line" : 233,
      "node_id" : "PRRC_kwDOABII584sT_mE",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 233,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : 5,
      "pull_request_review_id" : 798557290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743438724/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T07:48:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743438724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743439230"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743439230"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Again, please align new lines with the opening parens.",
      "commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "created_at" : "2021-11-05T07:36:43Z",
      "diff_hunk" : "@@ -1011,15 +1012,13 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n \n } // anon namespace\n \n-/** (try to) add transaction to memory pool with a specified acceptance time **/\n-static MempoolAcceptResult AcceptToMemoryPoolWithTime(const CChainParams& chainparams, CTxMemPool& pool,\n-                                                      CChainState& active_chainstate,\n-                                                      const CTransactionRef &tx, int64_t nAcceptTime,\n-                                                      bool bypass_limits, bool test_accept)\n+MempoolAcceptResult AcceptToMemoryPool(const CChainParams& chainparams, CTxMemPool& pool,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743439230",
      "id" : 743439230,
      "line" : 1015,
      "node_id" : "PRRC_kwDOABII584sT_t-",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 1015,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 21,
      "pull_request_review_id" : 798557290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743439230/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T07:48:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743439230",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743444205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743444205"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Consider using the global namespace operator `::Params()` to explicitly show that you're calling a global function. I think the long-term goal is to remove these global calls to make it easier to unit test.\r\n\r\nSame comment for the ATMP calls below.",
      "commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "created_at" : "2021-11-05T07:47:13Z",
      "diff_hunk" : "@@ -349,8 +349,9 @@ void CChainState::MaybeUpdateMempoolForReorg(\n     while (it != disconnectpool.queuedTx.get<insertion_order>().rend()) {\n         // ignore validation errors in resurrected transactions\n         if (!fAddToMempool || (*it)->IsCoinBase() ||\n-            AcceptToMemoryPool(\n-                *this, *m_mempool, *it, true /* bypass_limits */).m_result_type !=\n+            AcceptToMemoryPool(Params(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743444205",
      "id" : 743444205,
      "line" : 352,
      "node_id" : "PRRC_kwDOABII584sUA7t",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 352,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 6,
      "pull_request_review_id" : 798557290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743444205/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T07:48:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743444205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-11-05T14:48:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#issuecomment-961955952",
      "id" : 961955952,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23437",
      "node_id" : "IC_kwDOABII5845Vkhw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/961955952/reactions"
      },
      "updated_at" : "2021-11-05T14:48:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/961955952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743957358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743957358"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed in 9a0b0fc",
      "commit_id" : "aac65480b9d438224860a69ffbdee70c453bac4a",
      "created_at" : "2021-11-05T20:25:21Z",
      "diff_hunk" : "@@ -206,12 +206,26 @@ struct PackageMempoolAcceptResult\n };\n \n /**\n- * (Try to) add a transaction to the memory pool.\n- * @param[in]  bypass_limits   When true, don't enforce mempool fee limits.\n- * @param[in]  test_accept     When true, run validation checks but don't submit to mempool.\n+ * Try to add a transaction to the mempool with a specified acceptance time. This is an internal",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743957358",
      "id" : 743957358,
      "in_reply_to_id" : 743437227,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sV-Nu",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 209,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 799297595,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743957358/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T20:25:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743957358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743957460"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743957460"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in 9a0b0fc",
      "commit_id" : "aac65480b9d438224860a69ffbdee70c453bac4a",
      "created_at" : "2021-11-05T20:25:34Z",
      "diff_hunk" : "@@ -206,12 +206,26 @@ struct PackageMempoolAcceptResult\n };\n \n /**\n- * (Try to) add a transaction to the memory pool.\n- * @param[in]  bypass_limits   When true, don't enforce mempool fee limits.\n- * @param[in]  test_accept     When true, run validation checks but don't submit to mempool.\n+ * Try to add a transaction to the mempool with a specified acceptance time. This is an internal\n+ * function and is exposed only for testing. Client code should use ChainstateManager::ProcessTransaction()\n+ *\n+ * @param[in]  chainparams        Chain paramenters.\n+ * @param[in]  pool               Reference to the node's mempool.\n+ * @param[in]  active_chainstate  Reference to the active chainstate.\n+ * @param[in]  tx                 The transaction to submit for mempool acceptance.\n+ * @param[in]  accept_time        The timestamp for adding the transaction to the mempool. Usually\n+ *                                the current system time, but may be different (eg when loading\n+ *                                mempool txs from disk on startup).\n+ *                                It is also used to determine when the entry expires.\n+ * @param[in]  bypass_limits      When true, don't enforce mempool fee and capacity limits.\n+ * @param[in]  test_accept        When true, run validation checks but don't submit to mempool.\n+ *\n+ * @returns a MempoolAcceptResult indicating whether the transaction was accepted/rejected with reason.\n  */\n-MempoolAcceptResult AcceptToMemoryPool(CChainState& active_chainstate, CTxMemPool& pool, const CTransactionRef& tx,\n-                                       bool bypass_limits, bool test_accept=false) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+MempoolAcceptResult AcceptToMemoryPool(const CChainParams& chainparams, CTxMemPool& pool,\n+                                                        CChainState& active_chainstate, const CTransactionRef &tx,\n+                                                        int64_t accept_time, bool bypass_limits, bool test_accept)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743957460",
      "id" : 743957460,
      "in_reply_to_id" : 743438207,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sV-PU",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 227,
      "original_position" : 27,
      "original_start_line" : 225,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 799297750,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743957460/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-11-05T20:25:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743957460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743957613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743957613"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in 9a0b0fc",
      "commit_id" : "aac65480b9d438224860a69ffbdee70c453bac4a",
      "created_at" : "2021-11-05T20:25:53Z",
      "diff_hunk" : "@@ -230,7 +230,7 @@ FUZZ_TARGET_INIT(tx_pool_standard, initialize_tx_pool)\n         Assert(it->second.m_result_type == MempoolAcceptResult::ResultType::VALID ||\n                it->second.m_result_type == MempoolAcceptResult::ResultType::INVALID);\n \n-        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(chainstate, tx_pool, tx, bypass_limits));\n+        const auto res = WITH_LOCK(::cs_main, return AcceptToMemoryPool(Params(), tx_pool, chainstate, tx, GetTime(), bypass_limits, false /* test_accept */));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743957613",
      "id" : 743957613,
      "in_reply_to_id" : 743438724,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sV-Rt",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 233,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : null,
      "pull_request_review_id" : 799297988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743957613/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T20:25:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743957613",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743958323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743958323"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed calls to global Params() in ATMP and in the tx_pool test file ( aac6548 )",
      "commit_id" : "aac65480b9d438224860a69ffbdee70c453bac4a",
      "created_at" : "2021-11-05T20:27:21Z",
      "diff_hunk" : "@@ -349,8 +349,9 @@ void CChainState::MaybeUpdateMempoolForReorg(\n     while (it != disconnectpool.queuedTx.get<insertion_order>().rend()) {\n         // ignore validation errors in resurrected transactions\n         if (!fAddToMempool || (*it)->IsCoinBase() ||\n-            AcceptToMemoryPool(\n-                *this, *m_mempool, *it, true /* bypass_limits */).m_result_type !=\n+            AcceptToMemoryPool(Params(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743958323",
      "id" : 743958323,
      "in_reply_to_id" : 743444205,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584sV-cz",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 352,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 799298980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743958323/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T20:27:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743958323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743958602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743958602"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in 9a0b0fc",
      "commit_id" : "aac65480b9d438224860a69ffbdee70c453bac4a",
      "created_at" : "2021-11-05T20:27:50Z",
      "diff_hunk" : "@@ -1011,15 +1012,13 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n \n } // anon namespace\n \n-/** (try to) add transaction to memory pool with a specified acceptance time **/\n-static MempoolAcceptResult AcceptToMemoryPoolWithTime(const CChainParams& chainparams, CTxMemPool& pool,\n-                                                      CChainState& active_chainstate,\n-                                                      const CTransactionRef &tx, int64_t nAcceptTime,\n-                                                      bool bypass_limits, bool test_accept)\n+MempoolAcceptResult AcceptToMemoryPool(const CChainParams& chainparams, CTxMemPool& pool,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#discussion_r743958602",
      "id" : 743958602,
      "in_reply_to_id" : 743439230,
      "line" : 1014,
      "node_id" : "PRRC_kwDOABII584sV-hK",
      "original_commit_id" : "034e827efce594bf398553313d07ea4b55696710",
      "original_line" : 1014,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 21,
      "pull_request_review_id" : 799299345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23437",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743958602/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-05T20:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/743958602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/84432093?v=4",
         "events_url" : "https://api.github.com/users/lsilva01/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lsilva01/followers",
         "following_url" : "https://api.github.com/users/lsilva01/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lsilva01/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lsilva01",
         "id" : 84432093,
         "login" : "lsilva01",
         "node_id" : "MDQ6VXNlcjg0NDMyMDkz",
         "organizations_url" : "https://api.github.com/users/lsilva01/orgs",
         "received_events_url" : "https://api.github.com/users/lsilva01/received_events",
         "repos_url" : "https://api.github.com/users/lsilva01/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lsilva01/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lsilva01/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lsilva01"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Possible follow-up idea that came to my mind while reviewing this PR: couldn't we simplify the interface of `AcceptToMemoryPool` by getting rid of both the `CChainParams` and `CTxMemPool` parameters, since those can be deduced from the chainstate anyway? The change would look something like\r\n```diff\r\n-MempoolAcceptResult AcceptToMemoryPool(const CChainParams& chainparams, CTxMemPool& pool,\r\n-                                       CChainState& active_chainstate, const CTransactionRef& tx,\r\n+MempoolAcceptResult AcceptToMemoryPool(CChainState& active_chainstate, const CTransactionRef& tx,\r\n                                        int64_t accept_time, bool bypass_limits, bool test_accept)\r\n     EXCLUSIVE_LOCKS_REQUIRED(cs_main)\r\n {\r\n+    const CChainParams& chainparams{active_chainstate.m_params};\r\n+    assert(active_chainstate.m_mempool != nullptr);\r\n+    CTxMemPool& pool{*active_chainstate.m_mempool};\r\n     std::vector<COutPoint> coins_to_uncache;\r\n     MemPoolAccept::ATMPArgs args { chainparams, accept_time, bypass_limits, coins_to_uncache,\r\n                                    test_accept, /* m_allow_bip125_replacement */ true };\r\n```\r\nI couldn't think of a case where passing chainparams or a mempool instance that _doesn't_ belong to the active chainstate makes much sense. Drawback though: currently the member `m_mempool` is `protected` and thus not accessible from outside, that one would need to move to the `public` section, like it was done for `m_params` in the last commit of this PR.",
      "created_at" : "2021-11-07T01:31:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23437#issuecomment-962536149",
      "id" : 962536149,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23437",
      "node_id" : "IC_kwDOABII5845XyLV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/962536149/reactions"
      },
      "updated_at" : "2021-11-07T01:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/962536149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   }
]
