[
   {
      "author_association" : "MEMBER",
      "body" : "Possibly related to https://github.com/bitcoin/bitcoin/pull/12495?\r\n\r\n@RQ732P thanks for the report. Can you rerun this and watch the open file descriptor count and tell us how high it gets? E.g.\r\n```\r\n$ watch \"lsof -w -p $(pidof bitcoind) | awk 'BEGIN { fd=0; mem=0; } /ldb$/ { if (\\$4 == \\\"mem\\\") mem++; else fd++ } END { printf \\\"mem = %s, fd = %s\\n\\\", mem, fd}'\"\r\n```",
      "created_at" : "2018-12-04T17:25:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14870#issuecomment-444184224",
      "id" : 444184224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDE4NDIyNA==",
      "updated_at" : "2018-12-04T17:25:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444184224",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@RQ732P can you also post what file descriptors bitcoind has open after you see the error? E.g.\r\n```sh\r\nlsof -w -a -d ^mem -p $(pidof bitcoind)\r\n```",
      "created_at" : "2018-12-04T17:29:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14870#issuecomment-444185688",
      "id" : 444185688,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDE4NTY4OA==",
      "updated_at" : "2018-12-04T17:29:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444185688",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "are we sure is it a bug? try to remove the option `-debug=leveldb`. I am asking, because I run bitcoind (mainnet, testnet and regtest) on macOS from years, and I never had a similar problem. But ok I have to try in `testnet` with `-debug=leveldb`. And while is synching is normal it's not accepting RPC calls.\r\n\r\nSo, is it crashing, like it is written in the title of this issue \"Bitcoind crashes with Too Many Files error\", or is it \"Stops accepting RCP calls\"?\r\n\r\n\"Crashing\" is not the same of \"Stops accepting RCP calls\"\r\n",
      "created_at" : "2018-12-04T23:28:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14870#issuecomment-444299340",
      "id" : 444299340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDI5OTM0MA==",
      "updated_at" : "2018-12-04T23:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444299340",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1006078?v=4",
         "events_url" : "https://api.github.com/users/isghe/events{/privacy}",
         "followers_url" : "https://api.github.com/users/isghe/followers",
         "following_url" : "https://api.github.com/users/isghe/following{/other_user}",
         "gists_url" : "https://api.github.com/users/isghe/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/isghe",
         "id" : 1006078,
         "login" : "isghe",
         "node_id" : "MDQ6VXNlcjEwMDYwNzg=",
         "organizations_url" : "https://api.github.com/users/isghe/orgs",
         "received_events_url" : "https://api.github.com/users/isghe/received_events",
         "repos_url" : "https://api.github.com/users/isghe/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/isghe/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/isghe/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/isghe"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-12-04T17:07:26Z init message: Loading block index...\r\n2018-12-04T17:07:26Z LevelDB using max_open_files=1000 (default=1000)\r\n2018-12-04T17:07:26Z Opening LevelDB in /Users/matt/Library/Application Support/Bitcoin/testnet3/blocks/index\r\n2018-12-04T17:07:26Z leveldb: Recovering log #791\r\n2018-12-04T17:07:26Z leveldb: Level-0 table #801: started\r\n2018-12-04T17:07:26Z leveldb: Level-0 table #801: 1101 bytes OK\r\n2018-12-04T17:07:26Z leveldb: Delete type=2 #788\r\n2018-12-04T17:07:26Z leveldb: Delete type=2 #785\r\n2018-12-04T17:07:26Z leveldb: Delete type=2 #784\r\n2018-12-04T17:07:26Z leveldb: Delete type=2 #790\r\n2018-12-04T17:07:26Z leveldb: Delete type=2 #786\r\n2018-12-04T17:07:26Z leveldb: Delete type=2 #787\r\n2018-12-04T17:07:26Z leveldb: Delete type=2 #783\r\n2018-12-04T17:07:26Z leveldb: Delete type=2 #782\r\n2018-12-04T17:07:26Z leveldb: Delete type=2 #781\r\n2018-12-04T17:07:26Z leveldb: Delete type=0 #791\r\n2018-12-04T17:07:26Z leveldb: Delete type=3 #789\r\n2018-12-04T17:07:26Z Opened LevelDB successfully\r\n2018-12-04T17:07:26Z Using obfuscation key for /Users/matt/Library/Application Support/Bitcoin/testnet3/blocks/index: 0000000000000000\r\n2018-12-04T17:07:27Z leveldb: Compacting 1@0 + 8@1 files\r\n2018-12-04T17:07:27Z leveldb: Generated table #803@0: 14888 keys, 2140910 bytes\r\n2018-12-04T17:07:27Z leveldb: Generated table #804@0: 5178 keys, 744418 bytes\r\n2018-12-04T17:07:28Z leveldb: Generated table #805@0: 7347 keys, 1056062 bytes\r\n2018-12-04T17:07:28Z leveldb: Generated table #806@0: 14938 keys, 2136593 bytes\r\n2018-12-04T17:07:28Z leveldb: Generated table #807@0: 1256 keys, 179294 bytes\r\n2018-12-04T17:07:28Z leveldb: Generated table #808@0: 14970 keys, 2138641 bytes\r\n2018-12-04T17:07:28Z leveldb: Generated table #809@0: 3608 keys, 517536 bytes\r\n2018-12-04T17:07:28Z leveldb: Generated table #810@0: 2 keys, 221 bytes\r\n2018-12-04T17:07:28Z leveldb: Compacted 1@0 + 8@1 files => 8913675 bytes\r\n2018-12-04T17:07:28Z leveldb: compacted to: files[ 0 8 55 91 0 0 0 ]\r\n2018-12-04T17:07:33Z LoadBlockIndexDB: last block file = 154\r\n2018-12-04T17:07:33Z LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=5075, size=108826844, heights=1441407...1446454, time=2018-10-31...2018-12-04)\r\n2018-12-04T17:07:33Z Checking all blk files are present...\r\n2018-12-04T17:07:33Z LevelDB using max_open_files=1000 (default=1000)\r\n2018-12-04T17:07:33Z Opening LevelDB in /Users/matt/Library/Application Support/Bitcoin/testnet3/chainstate\r\n2018-12-04T17:07:33Z leveldb: Recovering log #9327\r\n2018-12-04T17:07:33Z leveldb: Level-0 table #9332: started\r\n2018-12-04T17:07:33Z leveldb: Level-0 table #9332: 308 bytes OK\r\n2018-12-04T17:07:33Z leveldb: Delete type=2 #9326\r\n2018-12-04T17:07:33Z leveldb: Delete type=0 #9327\r\n2018-12-04T17:07:33Z leveldb: Delete type=2 #9311\r\n2018-12-04T17:07:33Z leveldb: Delete type=2 #9310\r\n2018-12-04T17:07:33Z leveldb: Delete type=2 #9312\r\n2018-12-04T17:07:33Z leveldb: Delete type=3 #9325\r\n```\r\n\r\n```\r\n2018-12-04T17:07:34Z Loaded best chain: hashBestChain=00000000000000063df115997921bf6856c08a08318b592df576c2f863b7d7c5 height=1446453 date=2018-12-04T04:45:18Z progress=0.999422\r\n2018-12-04T17:07:34Z init message: Rewinding blocks...\r\n2018-12-04T17:07:41Z WriteBatch memory usage: db=index, before=0.0MiB, after=0.0MiB\r\n2018-12-04T17:07:41Z WriteBatch memory usage: db=chainstate, before=0.0MiB, after=0.0MiB\r\n2018-12-04T17:07:41Z init message: Verifying blocks...\r\n2018-12-04T17:07:41Z Verifying last 6 blocks at level 3\r\n2018-12-04T17:07:41Z [0%]...leveldb: Compacting 1@0 + 3@1 files\r\n2018-12-04T17:07:41Z leveldb: Generated table #9334@0: 1 keys, 207 bytes\r\n2018-12-04T17:07:41Z [16%]...leveldb: Generated table #9335@0: 3162 keys, 181793 bytes\r\n2018-12-04T17:07:41Z [33%]...leveldb: Generated table #9336@0: 2846 keys, 181033 bytes\r\n2018-12-04T17:07:41Z leveldb: Compacted 1@0 + 3@1 files => 363033 bytes\r\n2018-12-04T17:07:41Z leveldb: compacted to: files[ 0 3 78 484 0 0 0 ]\r\n2018-12-04T17:07:41Z [50%]...[66%]...[83%]...[99%]...[DONE].\r\n2018-12-04T17:07:41Z No coin database inconsistencies in last 6 blocks (444 transactions)\r\n2018-12-04T17:07:41Z block index 15119ms\r\n2018-12-04T17:07:41Z LevelDB using max_open_files=1000 (default=1000)\r\n2018-12-04T17:07:41Z Opening LevelDB in /Users/matt/Library/Application Support/Bitcoin/testnet3/indexes/txindex\r\n2018-12-04T17:07:41Z leveldb: Recovering log #12582\r\n2018-12-04T17:07:41Z leveldb: Delete type=3 #12580\r\n2018-12-04T17:07:41Z leveldb: Delete type=0 #12582\r\n```\r\n\r\nThis part is most suspicious",
      "created_at" : "2018-12-05T05:05:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14870#issuecomment-444360156",
      "id" : 444360156,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NDM2MDE1Ng==",
      "updated_at" : "2018-12-05T05:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/444360156",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2287825?v=4",
         "events_url" : "https://api.github.com/users/ch4ot1c/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ch4ot1c/followers",
         "following_url" : "https://api.github.com/users/ch4ot1c/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ch4ot1c/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ch4ot1c",
         "id" : 2287825,
         "login" : "ch4ot1c",
         "node_id" : "MDQ6VXNlcjIyODc4MjU=",
         "organizations_url" : "https://api.github.com/users/ch4ot1c/orgs",
         "received_events_url" : "https://api.github.com/users/ch4ot1c/received_events",
         "repos_url" : "https://api.github.com/users/ch4ot1c/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ch4ot1c/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ch4ot1c/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ch4ot1c"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "~Looks like this is caused by #12495, which raises the levelDB maximum file handles from 64 to ~1024~ 1000, except on Windows. Default is here: https://github.com/bitcoin/bitcoin/blob/master/src/leveldb/include/leveldb/options.h#L89~ \r\n\r\nWhen i run `ulimit -n` on Mac Sierra 10.13, I get `256`. I think this is typical (for Macs).  ~This could cause problems.~\r\n\r\n",
      "created_at" : "2019-05-06T17:50:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14870#issuecomment-489711719",
      "id" : 489711719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4OTcxMTcxOQ==",
      "updated_at" : "2019-05-06T23:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/489711719",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/8435003?v=4",
         "events_url" : "https://api.github.com/users/tryphe/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tryphe/followers",
         "following_url" : "https://api.github.com/users/tryphe/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tryphe/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tryphe",
         "id" : 8435003,
         "login" : "tryphe",
         "node_id" : "MDQ6VXNlcjg0MzUwMDM=",
         "organizations_url" : "https://api.github.com/users/tryphe/orgs",
         "received_events_url" : "https://api.github.com/users/tryphe/received_events",
         "repos_url" : "https://api.github.com/users/tryphe/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tryphe/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tryphe/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tryphe"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@tryphe  I'm pretty sure your comment is confused.  ",
      "created_at" : "2019-05-06T19:40:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14870#issuecomment-489748777",
      "id" : 489748777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14870",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4OTc0ODc3Nw==",
      "updated_at" : "2019-05-06T19:40:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/489748777",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   }
]
