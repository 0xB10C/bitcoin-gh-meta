[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5834#discussion_r25519267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/25519267"
         }
      },
      "body" : "please use `strCommand.c_str()` (if you need zero-terminated) or `strCommand.data()` (if no zero terminator is necessary) i.s.o `&strCommand[0]`",
      "commit_id" : "e1b25744c766fdea2980ec1fbe50e77dc48e086f",
      "created_at" : "2015-02-27T16:43:44Z",
      "diff_hunk" : "@@ -682,7 +682,36 @@ boost::filesystem::path GetTempPath() {\n \n void runCommand(std::string strCommand)\n {\n-    int nErr = ::system(strCommand.c_str());\n+    int nErr = 0;\n+#ifdef WIN32\n+    // If we're in Windows, try using CreateProcess first.\n+    ULONG nExitCode;\n+    STARTUPINFO info={sizeof(info)};\n+    ZeroMemory(&info, sizeof(STARTUPINFO));\n+    info.cb = sizeof(STARTUPINFO);\n+    info.dwFlags = STARTF_USESHOWWINDOW;\n+    info.wShowWindow = SW_HIDE;\n+    PROCESS_INFORMATION processInfo;\n+    ZeroMemory(&processInfo, sizeof(PROCESS_INFORMATION));\n+    if (CreateProcess(NULL, &strCommand[0], NULL, NULL, false, 0, NULL, NULL, &info, &processInfo))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5834#discussion_r25519267",
      "id" : 25519267,
      "original_commit_id" : "e1b25744c766fdea2980ec1fbe50e77dc48e086f",
      "original_position" : 16,
      "path" : "src/util.cpp",
      "position" : 16,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5834",
      "updated_at" : "2015-02-27T16:44:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/25519267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/5834#discussion_r25519762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5834"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/25519762"
         }
      },
      "body" : "Are you sure that this fallback is needed? I'm not sure what the implementation of mingw's system() does internally, but I'd assume it also makes use of CreateProcess or another win32 call.",
      "commit_id" : "e1b25744c766fdea2980ec1fbe50e77dc48e086f",
      "created_at" : "2015-02-27T16:50:12Z",
      "diff_hunk" : "@@ -682,7 +682,36 @@ boost::filesystem::path GetTempPath() {\n \n void runCommand(std::string strCommand)\n {\n-    int nErr = ::system(strCommand.c_str());\n+    int nErr = 0;\n+#ifdef WIN32\n+    // If we're in Windows, try using CreateProcess first.\n+    ULONG nExitCode;\n+    STARTUPINFO info={sizeof(info)};\n+    ZeroMemory(&info, sizeof(STARTUPINFO));\n+    info.cb = sizeof(STARTUPINFO);\n+    info.dwFlags = STARTF_USESHOWWINDOW;\n+    info.wShowWindow = SW_HIDE;\n+    PROCESS_INFORMATION processInfo;\n+    ZeroMemory(&processInfo, sizeof(PROCESS_INFORMATION));\n+    if (CreateProcess(NULL, &strCommand[0], NULL, NULL, false, 0, NULL, NULL, &info, &processInfo))\n+    {\n+        // CreateProcess succeeded so wait, check exit code and clean up.\n+        WaitForSingleObject(processInfo.hProcess, INFINITE);\n+        if(!GetExitCodeProcess(processInfo.hProcess, &nExitCode))\n+          nExitCode = 1;\n+        CloseHandle(processInfo.hThread);\n+        CloseHandle(processInfo.hProcess);\n+        nErr = (int)nExitCode; // Had to pass a ULONG to GetExitCodeProcess().\n+    }\n+    else\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5834#discussion_r25519762",
      "id" : 25519762,
      "original_commit_id" : "e1b25744c766fdea2980ec1fbe50e77dc48e086f",
      "original_position" : 27,
      "path" : "src/util.cpp",
      "position" : 27,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5834",
      "updated_at" : "2015-02-27T16:50:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/25519762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Laanwj thanks for the feedback. Not quite sure why I did that &strCommand[0], I'll fix and reroll today. Regarding the second item, I believe system() handles more types of files, e.g. .bat files and document opening. I could be wrong about this. I will do some experimenting with both calls under MinGW and also possibly reroll that today.",
      "created_at" : "2015-02-27T17:58:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-76440859",
      "id" : 76440859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5834",
      "updated_at" : "2015-02-27T17:58:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/76440859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/189317?v=3",
         "events_url" : "https://api.github.com/users/dfletcher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dfletcher/followers",
         "following_url" : "https://api.github.com/users/dfletcher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dfletcher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dfletcher",
         "id" : 189317,
         "login" : "dfletcher",
         "organizations_url" : "https://api.github.com/users/dfletcher/orgs",
         "received_events_url" : "https://api.github.com/users/dfletcher/received_events",
         "repos_url" : "https://api.github.com/users/dfletcher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dfletcher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dfletcher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dfletcher"
      }
   },
   {
      "body" : "Perhaps you can call ShellExecute, instead of CreateProcess?",
      "created_at" : "2015-03-01T10:58:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-76592012",
      "id" : 76592012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5834",
      "updated_at" : "2015-03-01T10:58:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/76592012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Yes, at least bat files would need to be supported. Document opening isn't that terribly important here, if one really wants to do that they could provide the program to launch it with in the command line.",
      "created_at" : "2015-03-09T12:04:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-77841651",
      "id" : 77841651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5834",
      "updated_at" : "2015-03-09T12:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/77841651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Looks like a good start.  Needs more testing.\r\n",
      "created_at" : "2015-03-11T13:58:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-78267442",
      "id" : 78267442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5834",
      "updated_at" : "2015-03-11T13:58:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/78267442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Okay finally had some time to research this a little better. Thanks everyone here for the suggestions.\r\n\r\nI am not quite sure how to proceed, so here is what I have discovered, perhaps everyone here can make suggestions about the best route forward.\r\n\r\n[Here's the gist of the program I used for testing](https://gist.github.com/dfletcher/e7ee74166ce9bd6bdd58). Edit: oh, right. don't forget to build using mingw with -mwindows flag.\r\n\r\nEdit2: Whoops my bad, Sleep takes milliseconds arg not seconds. Gist and table below updated, self exe is not always async. Thought that seemed funky. And really the \"s\" of the whole CreateProcess() column is because my code waits. We could change that behavior and be always async there.\r\n\r\n|                          | CreateProcess() | ShellExecute() | ::system() |\r\n| -------------------- |:--------------------:|:------------------:|:------------:|\r\n| **.bat script**      | n s                     | n a                   | p s           |\r\n| **self exe**         | n s                     | n a                   | p s           |\r\n| **pythonw.exe**  | n s                     | n a                   | p s            |\r\n| **python.exe**    | n s                     | n a                   | p s            |\r\n<sup>**Key**: p = popup, n = no popup, s = synchronous, a = asynchronous</sup>\r\n\r\nEach method has own strengths and weaknesses.\r\n\r\n### CreateProcess()\r\n\r\n**Pros**\r\n* No popups.\r\n* Straightforward command implementation, pass whole command string to windows.\r\n\r\n**Cons**\r\n* As laanwj pointed out it is using &strCommand[0]. Reason is that CreateProcessW might change that data, so we can't pass a const. \"[The Unicode version of this function, CreateProcessW, can modify the contents of this string](https://msdn.microsoft.com/en-us/library/windows/desktop/ms682425%28v=vs.85%29.aspx)\". Why this affects the non \"W\" version I have no idea. Is the fix to copy the string? Or to just cast c_str() to (char*)? Unsure.\r\n\r\n### ShellExecute()\r\n\r\n**Pros**\r\n* Very consistent results while using SW_HIDE in the sixth argument of ShellExecute().\r\n* (Possible pro) users can change the SW_HIDE to SW_SHOW to change this behavior in a local build.\r\n\r\n**Cons**\r\n* Command must be parsed. The gist above only breaks on first whitespace, this would need to be smarter (accept a quoted string).\r\n\r\n### ::system()\r\n**Pros**\r\n* Simple.\r\n\r\n**Cons**\r\n* Popups everywhere!\r\n\r\nThoughts and opinions? Thanks again for the feedback!\r\n",
      "created_at" : "2015-03-12T21:24:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5834#issuecomment-78624721",
      "id" : 78624721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5834",
      "updated_at" : "2015-03-12T21:51:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/78624721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/189317?v=3",
         "events_url" : "https://api.github.com/users/dfletcher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dfletcher/followers",
         "following_url" : "https://api.github.com/users/dfletcher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dfletcher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dfletcher",
         "id" : 189317,
         "login" : "dfletcher",
         "organizations_url" : "https://api.github.com/users/dfletcher/orgs",
         "received_events_url" : "https://api.github.com/users/dfletcher/received_events",
         "repos_url" : "https://api.github.com/users/dfletcher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dfletcher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dfletcher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dfletcher"
      }
   }
]
