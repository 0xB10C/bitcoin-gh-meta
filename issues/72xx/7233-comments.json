[
   {
      "body" : "The first step to reporting any bug, is to see if it's already fixed. Do you still have this problem with 0.10.4 or 0.11.2?",
      "created_at" : "2015-12-19T17:14:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-166004841",
      "id" : 166004841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2015-12-19T17:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/166004841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "I'll test that and report back.",
      "created_at" : "2015-12-19T17:17:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-166004982",
      "id" : 166004982,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2015-12-19T17:17:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/166004982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/12032350?v=3",
         "events_url" : "https://api.github.com/users/GSPP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GSPP/followers",
         "following_url" : "https://api.github.com/users/GSPP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GSPP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GSPP",
         "id" : 12032350,
         "login" : "GSPP",
         "organizations_url" : "https://api.github.com/users/GSPP/orgs",
         "received_events_url" : "https://api.github.com/users/GSPP/received_events",
         "repos_url" : "https://api.github.com/users/GSPP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GSPP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GSPP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GSPP"
      }
   },
   {
      "body" : "Yeah, I do not understand why reindex was slower. This is on magnetic disks. Maybe I hit fragmentation or otherwise unfortunate IO patterns.",
      "created_at" : "2015-12-19T17:40:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-166009183",
      "id" : 166009183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2015-12-19T17:40:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/166009183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/12032350?v=3",
         "events_url" : "https://api.github.com/users/GSPP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GSPP/followers",
         "following_url" : "https://api.github.com/users/GSPP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GSPP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GSPP",
         "id" : 12032350,
         "login" : "GSPP",
         "organizations_url" : "https://api.github.com/users/GSPP/orgs",
         "received_events_url" : "https://api.github.com/users/GSPP/received_events",
         "repos_url" : "https://api.github.com/users/GSPP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GSPP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GSPP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GSPP"
      }
   },
   {
      "body" : "@jonasschnelli Dis some tests in a windows VM: https://github.com/bitcoin/bitcoin/pull/6917#issuecomment-153701710",
      "created_at" : "2015-12-19T19:23:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-166017385",
      "id" : 166017385,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2015-12-19T19:23:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/166017385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "I just performed the simplest possible test: Kill the VMWare VM while syncing from the network:\r\n\r\n![eruheiruhgaer](https://cloud.githubusercontent.com/assets/12032350/11963639/a55e5dc6-a8e8-11e5-96e1-4a4b63d424f7.PNG)\r\n\r\nSo I would propose that automated tests for crash scenarios are added. Note, that killing the bitcoin process might not be enough to detect such problems because killing a process does not discard OS-level write back data. Killing a VM should be a much better test.\r\n",
      "created_at" : "2015-12-22T19:16:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-166707144",
      "id" : 166707144,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2015-12-22T19:16:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/166707144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/12032350?v=3",
         "events_url" : "https://api.github.com/users/GSPP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GSPP/followers",
         "following_url" : "https://api.github.com/users/GSPP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GSPP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GSPP",
         "id" : 12032350,
         "login" : "GSPP",
         "organizations_url" : "https://api.github.com/users/GSPP/orgs",
         "received_events_url" : "https://api.github.com/users/GSPP/received_events",
         "repos_url" : "https://api.github.com/users/GSPP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GSPP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GSPP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GSPP"
      }
   },
   {
      "body" : "hey i get the same problems on linux its so annoying! It doesn't even happen from os crash, it happens when i kill the bitcoin-qt process abruptly.",
      "created_at" : "2016-01-02T07:57:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-168372534",
      "id" : 168372534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2016-01-02T08:04:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/168372534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6427921?v=3",
         "events_url" : "https://api.github.com/users/hamiltino/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hamiltino/followers",
         "following_url" : "https://api.github.com/users/hamiltino/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hamiltino/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hamiltino",
         "id" : 6427921,
         "login" : "hamiltino",
         "organizations_url" : "https://api.github.com/users/hamiltino/orgs",
         "received_events_url" : "https://api.github.com/users/hamiltino/received_events",
         "repos_url" : "https://api.github.com/users/hamiltino/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hamiltino/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hamiltino/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hamiltino"
      }
   },
   {
      "body" : "I'm surprised, on my side did not have this problem for a while, @GSPP can you wait for the sync to be complete, and they shutdown the VM as you have done and see if the block database fail ?",
      "created_at" : "2016-01-03T06:43:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-168469038",
      "id" : 168469038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2016-01-03T06:43:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/168469038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "I have tried this on Windows 8/10 and have experienced the same bug. \r\nWhen my block database is completely synchronized and caught up it doesn't seem to occur. \r\n\r\nHowever, when my QT client is \"catching up\", or synchronizing (Whether it's from scratch, or just updating since a reboot) it gives me the message that it is corrupted and needs to be re-built. \r\n\r\nSo it seems to only occur during synchronization, but not when completely sync'd.",
      "created_at" : "2016-01-21T17:09:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-173639426",
      "id" : 173639426,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2016-01-21T17:09:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/173639426",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16822078?v=3",
         "events_url" : "https://api.github.com/users/EthanBianchi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanBianchi/followers",
         "following_url" : "https://api.github.com/users/EthanBianchi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanBianchi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanBianchi",
         "id" : 16822078,
         "login" : "EthanBianchi",
         "organizations_url" : "https://api.github.com/users/EthanBianchi/orgs",
         "received_events_url" : "https://api.github.com/users/EthanBianchi/received_events",
         "repos_url" : "https://api.github.com/users/EthanBianchi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanBianchi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanBianchi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanBianchi"
      }
   },
   {
      "body" : "I just caught Bitcoin Core in the act:\r\n\r\n![dnrtjrtj](https://cloud.githubusercontent.com/assets/12032350/12518333/4dd26c60-c138-11e5-9c5d-357ba1a9b332.PNG)\r\n\r\nData is not flushed and exposed to OS crashes and power losses.\r\n\r\nRepro steps:\r\n\r\n1. Put the software into a syncing state\r\n2. Exit cleanly\r\n3. Confirm program is terminated using task manager\r\n4. Use RAMMap to see the unflushed data\r\n\r\nI would expect Bitcoin to always flush files to disk to obtain crash consistency.\r\n\r\nAlso, I wonder what happens in case of power loss *during* flushing. The software must tolerate partial writes as well.\r\n\r\nThis was done using the latest version as of today.\r\n\r\n@sipa ",
      "created_at" : "2016-01-22T17:47:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-173990497",
      "id" : 173990497,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2016-01-22T17:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/173990497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/12032350?v=3",
         "events_url" : "https://api.github.com/users/GSPP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GSPP/followers",
         "following_url" : "https://api.github.com/users/GSPP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GSPP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GSPP",
         "id" : 12032350,
         "login" : "GSPP",
         "organizations_url" : "https://api.github.com/users/GSPP/orgs",
         "received_events_url" : "https://api.github.com/users/GSPP/received_events",
         "repos_url" : "https://api.github.com/users/GSPP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GSPP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GSPP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GSPP"
      }
   },
   {
      "body" : "Turns out after cleanly shutting down the VM Bitcoin Core wants to verify the blocks on the next startup. I see no reason this is necessary. I suspect there's at least one more issue here besides the missing flushing because this time I did ensure flushing.\r\n\r\nTo summarize the scenario:\r\n\r\n- Latest Core version, upgraded from 0.10\r\n- VMWare Workstation 11.1.3\r\n- Windows 7 x64 SP1\r\n- 6GB RAM, 8 of 8 CPU cores\r\n\r\nAlso during syncing, without shutting down I found this particular state:\r\n\r\n![a](https://cloud.githubusercontent.com/assets/12032350/12519125/2cbb43e4-c13d-11e5-88d0-5afb468882e1.PNG)\r\n\r\nDoesn't this mean that in case of power loss the blocks and the chainstate index might become out-of-sync? Maybe the block makes it to disk but the index does not. Or, the other way around. Or, only some of the disk blocks of each make it and the other ones are zeroes.\r\n\r\nMaybe, the wallet is also not properly flushed: https://github.com/bitcoin/bitcoin/issues/7249#issuecomment-166962314",
      "created_at" : "2016-01-22T18:22:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7233#issuecomment-173999502",
      "id" : 173999502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7233",
      "updated_at" : "2016-01-22T18:22:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/173999502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/12032350?v=3",
         "events_url" : "https://api.github.com/users/GSPP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GSPP/followers",
         "following_url" : "https://api.github.com/users/GSPP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GSPP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GSPP",
         "id" : 12032350,
         "login" : "GSPP",
         "organizations_url" : "https://api.github.com/users/GSPP/orgs",
         "received_events_url" : "https://api.github.com/users/GSPP/received_events",
         "repos_url" : "https://api.github.com/users/GSPP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GSPP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GSPP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GSPP"
      }
   }
]
