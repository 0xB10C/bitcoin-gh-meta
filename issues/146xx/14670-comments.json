[
   {
      "author_association" : "MEMBER",
      "body" : "@promag can you explain how this is different from #13501 and what the reasoning was for closing that PR?",
      "created_at" : "2018-11-06T15:07:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436285128",
      "id" : 436285128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjI4NTEyOA==",
      "updated_at" : "2018-11-06T15:07:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436285128",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is now the trillionth attempt in fixing the issue. Could you provide some rationale how this is different from the other approaches and why it should be preferred over the other ones?",
      "created_at" : "2018-11-06T15:08:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436285740",
      "id" : 436285740,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjI4NTc0MA==",
      "updated_at" : "2018-11-06T15:08:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436285740",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is simpler than #13501, and if it works I think it is preferable. Instead of trying to wait for all reply data to be sent before stopping the event loop and calling `evhttp_free`, it lets `evhttp_free` worry about this and stop the event loop itself. Assuming `http_free` does the right thing, this is a cleaner and less invasive.\r\n\r\nI am curious what exactly the behavior of `evhttp_free` is. For example if we are in the middle of sending a huge reply to a slow client, and the server is shut down, how long does this wait (if it waits at all) to send all the data before shutting down? IIUC #13501 would wait as long as it took, and currently we wait for 2 seconds.",
      "created_at" : "2018-11-06T15:38:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436296906",
      "id" : 436296906,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjI5NjkwNg==",
      "updated_at" : "2018-11-06T15:38:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436296906",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems like `evhttp_free` just immediately calls `shutdown` and `close` on all open connections, so I would expect this change not to always fix #11777. \r\n\r\nhttps://github.com/libevent/libevent/blob/9afe7a6c12c112a6cbc49cf1bd684781275b2579/http.c#L1243\r\nhttps://github.com/libevent/libevent/blob/9afe7a6c12c112a6cbc49cf1bd684781275b2579/http.c#L3721\r\n\r\nBut maybe the `WriteHeader(\"Connection\", \"close\")` call added to `HTTPRequest::WriteReply` improves things in some way, so even if there is a race condition, it won't trigger in practice?",
      "created_at" : "2018-11-06T16:07:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436308425",
      "id" : 436308425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjMwODQyNQ==",
      "updated_at" : "2018-11-06T16:07:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436308425",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14726](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14726.html) (Use RPCHelpMan for all RPCs by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2018-11-06T17:57:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436347520",
      "id" : 436347520,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjM0NzUyMA==",
      "updated_at" : "2018-11-20T22:07:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436347520",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky right, can't call `evhttp_free` with ongoing requests.\r\n\r\nUpdated code and PR description, should be more clear of the current problem and the approach used.",
      "created_at" : "2018-11-07T03:19:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436490876",
      "id" : 436490876,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjQ5MDg3Ng==",
      "updated_at" : "2018-11-07T03:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436490876",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Split in multiple commits for easy review.\r\n\r\nIt can be arguable to remove the timeout but IMO it's safe because:\r\n - if an HTTP worker is with a long task then calling `event_base_loopbreak` is no good\r\n - active connections will timeout and close if no request/response happens (30 seconds by default).\r\n\r\nThis can be observed by:\r\n```\r\nbitcoind -regtest\r\ntime nc localhost 18443\r\nbitcoin-cli -regtest stop\r\nnc localhost 18443  0.00s user 0.01s system 0% cpu 30.025 total\r\n                                                   ^^^^^^\r\n```\r\nThe only way to improve this in a correct way is to lower the connection timeout (that I know of)",
      "created_at" : "2018-11-07T09:33:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436561767",
      "id" : 436561767,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjU2MTc2Nw==",
      "updated_at" : "2018-11-07T09:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436561767",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231499618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231499618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you could have a flag and set it in `InterruptHTTPServer()`. Then you can detect the flag here.",
      "commit_id" : "92a81adbe857b18537ad7d309c444dc818b1d2e8",
      "created_at" : "2018-11-07T13:19:06Z",
      "diff_hunk" : "@@ -579,6 +566,9 @@ void HTTPRequest::WriteHeader(const std::string& hdr, const std::string& value)\n void HTTPRequest::WriteReply(int nStatus, const std::string& strReply)\n {\n     assert(!replySent && req);\n+    if (ShutdownRequested()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231499618",
      "id" : 231499618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTQ5OTYxOA==",
      "original_commit_id" : "4155634870973adfffe7173f9581ea27c79545ee",
      "original_position" : 77,
      "path" : "src/httpserver.cpp",
      "position" : 77,
      "pull_request_review_id" : 172482579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670",
      "updated_at" : "2018-11-21T09:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231499618",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231501113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231501113"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why create redundancy?",
      "commit_id" : "92a81adbe857b18537ad7d309c444dc818b1d2e8",
      "created_at" : "2018-11-07T13:23:56Z",
      "diff_hunk" : "@@ -579,6 +566,9 @@ void HTTPRequest::WriteHeader(const std::string& hdr, const std::string& value)\n void HTTPRequest::WriteReply(int nStatus, const std::string& strReply)\n {\n     assert(!replySent && req);\n+    if (ShutdownRequested()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231501113",
      "id" : 231501113,
      "in_reply_to_id" : 231499618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTUwMTExMw==",
      "original_commit_id" : "4155634870973adfffe7173f9581ea27c79545ee",
      "original_position" : 77,
      "path" : "src/httpserver.cpp",
      "position" : 77,
      "pull_request_review_id" : 172484480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670",
      "updated_at" : "2018-11-21T09:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231501113",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231509894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231509894"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To keep consistency and have lesser dependencies. Logically this should happen after http server interrupted.",
      "commit_id" : "92a81adbe857b18537ad7d309c444dc818b1d2e8",
      "created_at" : "2018-11-07T13:51:06Z",
      "diff_hunk" : "@@ -579,6 +566,9 @@ void HTTPRequest::WriteHeader(const std::string& hdr, const std::string& value)\n void HTTPRequest::WriteReply(int nStatus, const std::string& strReply)\n {\n     assert(!replySent && req);\n+    if (ShutdownRequested()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231509894",
      "id" : 231509894,
      "in_reply_to_id" : 231499618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTUwOTg5NA==",
      "original_commit_id" : "4155634870973adfffe7173f9581ea27c79545ee",
      "original_position" : 77,
      "path" : "src/httpserver.cpp",
      "position" : 77,
      "pull_request_review_id" : 172495652,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670",
      "updated_at" : "2018-11-21T09:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231509894",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Can you update the PR description to describe the change in external *behavior* instead of diving immediately into details of the code?\r\n\r\nIt would also help if each individual commit stated how it changes behavior, and why the change makes sense by itself or in conjunction with other changes.",
      "created_at" : "2018-11-07T15:12:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436656246",
      "id" : 436656246,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjY1NjI0Ng==",
      "updated_at" : "2018-11-07T15:12:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436656246",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231589057"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231589057"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah I see, I'll do it.",
      "commit_id" : "92a81adbe857b18537ad7d309c444dc818b1d2e8",
      "created_at" : "2018-11-07T16:54:27Z",
      "diff_hunk" : "@@ -579,6 +566,9 @@ void HTTPRequest::WriteHeader(const std::string& hdr, const std::string& value)\n void HTTPRequest::WriteReply(int nStatus, const std::string& strReply)\n {\n     assert(!replySent && req);\n+    if (ShutdownRequested()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231589057",
      "id" : 231589057,
      "in_reply_to_id" : 231499618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTU4OTA1Nw==",
      "original_commit_id" : "4155634870973adfffe7173f9581ea27c79545ee",
      "original_position" : 77,
      "path" : "src/httpserver.cpp",
      "position" : 77,
      "pull_request_review_id" : 172591744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670",
      "updated_at" : "2018-11-21T09:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231589057",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> describe the change in external _behavior_\r\n\r\n@ryanofsky sorry I don't understand what you mean with external behavior.\r\n\r\n> and why the change makes sense by itself or in conjunction with other changes\r\n\r\nI think I did?\r\n\r\n> It would also help if each individual commit stated how it changes behavior\r\n\r\nWill do.",
      "created_at" : "2018-11-07T16:56:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436696150",
      "id" : 436696150,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjY5NjE1MA==",
      "updated_at" : "2018-11-07T16:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436696150",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think external behaviour means the behaviour users or json-rpc-wrapper libraries see.",
      "created_at" : "2018-11-07T17:00:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436697708",
      "id" : 436697708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjY5NzcwOA==",
      "updated_at" : "2018-11-07T17:00:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436697708",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "What will happen if bitcoin is in the middle of sending a large response to a slow client and it gets shutdown? Will it try to send as much as of the reply as possible but give up after a timeout? Will it stop sending immediately? Will it wait forever? Previous versions of this PR have done a bunch of different things, so what externally observable changes is this PR is intending to make? I think this would be the most useful information to know and include in the description.",
      "created_at" : "2018-11-07T17:26:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436706974",
      "id" : 436706974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjcwNjk3NA==",
      "updated_at" : "2018-11-07T17:26:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436706974",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky still testing but I believe it waits until HTTP request finishes or timeouts due to inactivity on the connection. In detail this means:\r\n - completes reading the request headers and body\r\n - worker computes full response and adds event to send the response\r\n - the response is sent and then the connection is finally closed\r\n - at this point, if it's the last connection, the event loop has no registered events and exists.\r\n\r\nUpdated commits and PR description. ~~Added @ken2812221 suggestion.~~",
      "created_at" : "2018-11-07T22:52:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-436807513",
      "id" : 436807513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNjgwNzUxMw==",
      "updated_at" : "2018-11-08T00:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/436807513",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231731620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231731620"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually I can't do that because that way the RPC `stop` reply won't get the `Connection: close` header Ã¢ÂÂ between `StartShutdown()` and `InterruptHTTPServer()` can go around 200ms:\r\nhttps://github.com/bitcoin/bitcoin/blob/11e1ac3ae08535cefbd8235a8deb6cd100bcb2b1/src/bitcoind.cpp#L46-L54",
      "commit_id" : "92a81adbe857b18537ad7d309c444dc818b1d2e8",
      "created_at" : "2018-11-08T00:43:25Z",
      "diff_hunk" : "@@ -579,6 +566,9 @@ void HTTPRequest::WriteHeader(const std::string& hdr, const std::string& value)\n void HTTPRequest::WriteReply(int nStatus, const std::string& strReply)\n {\n     assert(!replySent && req);\n+    if (ShutdownRequested()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231731620",
      "id" : 231731620,
      "in_reply_to_id" : 231499618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTczMTYyMA==",
      "original_commit_id" : "4155634870973adfffe7173f9581ea27c79545ee",
      "original_position" : 77,
      "path" : "src/httpserver.cpp",
      "position" : 77,
      "pull_request_review_id" : 172765466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670",
      "updated_at" : "2018-11-21T09:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231731620",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231765943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231765943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok. Let's use ShutdownRequested for now. Then we can switch to the flag if #13211 merged.",
      "commit_id" : "92a81adbe857b18537ad7d309c444dc818b1d2e8",
      "created_at" : "2018-11-08T05:04:15Z",
      "diff_hunk" : "@@ -579,6 +566,9 @@ void HTTPRequest::WriteHeader(const std::string& hdr, const std::string& value)\n void HTTPRequest::WriteReply(int nStatus, const std::string& strReply)\n {\n     assert(!replySent && req);\n+    if (ShutdownRequested()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r231765943",
      "id" : 231765943,
      "in_reply_to_id" : 231499618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMTc2NTk0Mw==",
      "original_commit_id" : "4155634870973adfffe7173f9581ea27c79545ee",
      "original_position" : 77,
      "path" : "src/httpserver.cpp",
      "position" : 77,
      "pull_request_review_id" : 172806862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670",
      "updated_at" : "2018-11-21T09:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/231765943",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK 25bb1c18316446436b6cbf64651b6df35f24e5f1",
      "created_at" : "2018-11-10T21:27:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-437622635",
      "id" : 437622635,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNzYyMjYzNQ==",
      "updated_at" : "2018-11-10T21:41:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/437622635",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r232668544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232668544"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think that helps in this case.",
      "commit_id" : "92a81adbe857b18537ad7d309c444dc818b1d2e8",
      "created_at" : "2018-11-12T14:06:15Z",
      "diff_hunk" : "@@ -579,6 +566,9 @@ void HTTPRequest::WriteHeader(const std::string& hdr, const std::string& value)\n void HTTPRequest::WriteReply(int nStatus, const std::string& strReply)\n {\n     assert(!replySent && req);\n+    if (ShutdownRequested()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r232668544",
      "id" : 232668544,
      "in_reply_to_id" : 231499618,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjY2ODU0NA==",
      "original_commit_id" : "4155634870973adfffe7173f9581ea27c79545ee",
      "original_position" : 77,
      "path" : "src/httpserver.cpp",
      "position" : 77,
      "pull_request_review_id" : 173913707,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670",
      "updated_at" : "2018-11-21T09:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232668544",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Can you update the PR description to describe the change in external behavior instead of diving immediately into details of the code?\r\n\r\nAlso, can we please add a test that fails without this, but passes with it? That's the best way to \"prove\" that this fixes something.",
      "created_at" : "2018-11-20T09:24:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-440202291",
      "id" : 440202291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0MDIwMjI5MQ==",
      "updated_at" : "2018-11-20T09:24:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/440202291",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "- [x] ef7c54c1e - rpc: Add wait argument to stop\r\n- [ ] 8589891ea - http: Send \"Connection: close\" header if shutdown is requested\r\n- [ ] e10898267 - http: Unlisten sockets after all workers quit\r\n- [ ] b1f241a0f - http: Remove unnecessary event_base_loopexit call\r\n- [ ] a72fbc8aa - http: Remove timeout to exit event loop\r\n- [x] c76cde3c9 - qa: Test shutdown\r\n\r\n@laanwj if you build only the marked commits then test `test/functional/feature_shutdown.py` fails.",
      "created_at" : "2018-11-20T18:16:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-440377679",
      "id" : 440377679,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0MDM3NzY3OQ==",
      "updated_at" : "2018-11-20T21:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/440377679",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r235212277"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235212277"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Could explicitly pass a timeout to waitfornewblock and inline as lambda:\r\n\r\n\r\n```py\r\nt = Thread(target=lambda: self.nodes[0].waitfornewblock(timeout=             ))",
      "commit_id" : "92a81adbe857b18537ad7d309c444dc818b1d2e8",
      "created_at" : "2018-11-20T23:55:49Z",
      "diff_hunk" : "@@ -0,0 +1,30 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind shutdown.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal, get_rpc_proxy\n+from threading import Thread\n+\n+def waitfornewblock(node):\n+    block = node.waitfornewblock()\n+    assert_equal(block['height'], 0)\n+\n+class ShutdownTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        node = get_rpc_proxy(self.nodes[0].url, 1, timeout=600, coveragedir=self.nodes[0].coverage_dir)\n+        t = Thread(target=waitfornewblock, args=(node,))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r235212277",
      "id" : 235212277,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNTIxMjI3Nw==",
      "original_commit_id" : "fee25926ebdcb754d3cf74534386b9235b61af1e",
      "original_position" : 23,
      "path" : "test/functional/feature_shutdown.py",
      "position" : null,
      "pull_request_review_id" : 177027316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670",
      "updated_at" : "2018-11-21T09:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235212277",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The test can be fixed by https://github.com/ken2812221/bitcoin/tree/pr.14670",
      "created_at" : "2018-11-21T06:32:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-440552407",
      "id" : 440552407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0MDU1MjQwNw==",
      "updated_at" : "2018-11-21T06:32:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/440552407",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/11154118?v=4",
         "events_url" : "https://api.github.com/users/ken2812221/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ken2812221/followers",
         "following_url" : "https://api.github.com/users/ken2812221/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ken2812221/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ken2812221",
         "id" : 11154118,
         "login" : "ken2812221",
         "node_id" : "MDQ6VXNlcjExMTU0MTE4",
         "organizations_url" : "https://api.github.com/users/ken2812221/orgs",
         "received_events_url" : "https://api.github.com/users/ken2812221/received_events",
         "repos_url" : "https://api.github.com/users/ken2812221/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ken2812221/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ken2812221"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @ken2812221, I was going to try something along that after inspecting `stop_node` implementation.\r\n\r\n@laanwj in order to properly test the fix, and to trigger the \"race to exit the event loop\", I had to add `wait` argument to `stop` RPC as explained in https://github.com/bitcoin/bitcoin/pull/13501#issuecomment-398219913.",
      "created_at" : "2018-11-21T09:40:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#issuecomment-440598767",
      "id" : 440598767,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14670",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0MDU5ODc2Nw==",
      "updated_at" : "2018-11-21T09:40:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/440598767",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r235314007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235314007"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, I've changed a bit the code and now I don't think this applies, please check again.",
      "commit_id" : "92a81adbe857b18537ad7d309c444dc818b1d2e8",
      "created_at" : "2018-11-21T09:41:40Z",
      "diff_hunk" : "@@ -0,0 +1,30 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind shutdown.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal, get_rpc_proxy\n+from threading import Thread\n+\n+def waitfornewblock(node):\n+    block = node.waitfornewblock()\n+    assert_equal(block['height'], 0)\n+\n+class ShutdownTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        node = get_rpc_proxy(self.nodes[0].url, 1, timeout=600, coveragedir=self.nodes[0].coverage_dir)\n+        t = Thread(target=waitfornewblock, args=(node,))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/14670#discussion_r235314007",
      "id" : 235314007,
      "in_reply_to_id" : 235212277,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNTMxNDAwNw==",
      "original_commit_id" : "fee25926ebdcb754d3cf74534386b9235b61af1e",
      "original_position" : 23,
      "path" : "test/functional/feature_shutdown.py",
      "position" : null,
      "pull_request_review_id" : 177148762,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/14670",
      "updated_at" : "2018-11-21T09:41:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235314007",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
