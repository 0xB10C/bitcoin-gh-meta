[
   {
      "body" : "A benchmark of a `-reindex-chainstate` until height 290000, with default dbcache, shows that this is around 1% faster (4 runs on master with times ranging 1370.99-1377.95s, 4 runs on this PR with times ranging 1359.90-1365.74s; measured using -bench=debug).",
      "created_at" : "2016-10-30T06:19:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9039#issuecomment-257134377",
      "id" : 257134377,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9039",
      "updated_at" : "2016-10-30T06:22:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257134377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9039#discussion_r85661858"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85661858"
         }
      },
      "body" : "Can you please also change this into\r\n```C++\r\nLimitedString(std::string& _string) : string(_string) {}\r\n```\r\nThis will remove 204 `-Wshadow` warnings...\r\n",
      "commit_id" : "87d523c7b7baff3d9d763360e8e07e883a61f543",
      "created_at" : "2016-10-30T15:19:45Z",
      "diff_hunk" : "@@ -474,7 +447,7 @@ class LimitedString\n     LimitedString(std::string& string) : string(string) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9039#discussion_r85661858",
      "id" : 85661858,
      "original_commit_id" : "87d523c7b7baff3d9d763360e8e07e883a61f543",
      "original_position" : 198,
      "path" : "src/serialize.h",
      "position" : 198,
      "pull_request_review_id" : 6365529,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039",
      "updated_at" : "2016-10-30T15:19:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85661858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9039#discussion_r85661863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85661863"
         }
      },
      "body" : "`_nSize` please.",
      "commit_id" : "87d523c7b7baff3d9d763360e8e07e883a61f543",
      "created_at" : "2016-10-30T15:20:13Z",
      "diff_hunk" : "@@ -931,33 +806,73 @@ inline void SerReadWrite(Stream& s, T& obj, int nType, int nVersion, CSerActionU\n \n \n \n+/* ::GetSerializeSize implementations\n+ *\n+ * Computing the serialized size of objects is done through a special stream\n+ * object of type CSizeComputer, which only records the number of bytes written\n+ * to it.\n+ *\n+ * If your Serialize or SerializationOp method has non-trivial overhead for\n+ * serialization, it may be worthwhile to implement a specialized version for\n+ * CSizeComputer, which uses the s.increment() method to record bytes that would\n+ * be written instead.\n+ */\n class CSizeComputer\n {\n protected:\n     size_t nSize;\n \n+    const int nType;\n+    const int nVersion;\n public:\n-    int nType;\n-    int nVersion;\n-\n     CSizeComputer(int nTypeIn, int nVersionIn) : nSize(0), nType(nTypeIn), nVersion(nVersionIn) {}\n \n-    CSizeComputer& write(const char *psz, size_t nSize)\n+    void write(const char *psz, size_t nSize)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9039#discussion_r85661863",
      "id" : 85661863,
      "original_commit_id" : "87d523c7b7baff3d9d763360e8e07e883a61f543",
      "original_position" : 700,
      "path" : "src/serialize.h",
      "position" : 700,
      "pull_request_review_id" : 6365535,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039",
      "updated_at" : "2016-10-30T15:20:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85661863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9039#discussion_r85661870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85661870"
         }
      },
      "body" : "ditto, `_nSize` please.",
      "commit_id" : "87d523c7b7baff3d9d763360e8e07e883a61f543",
      "created_at" : "2016-10-30T15:20:30Z",
      "diff_hunk" : "@@ -931,33 +806,73 @@ inline void SerReadWrite(Stream& s, T& obj, int nType, int nVersion, CSerActionU\n \n \n \n+/* ::GetSerializeSize implementations\n+ *\n+ * Computing the serialized size of objects is done through a special stream\n+ * object of type CSizeComputer, which only records the number of bytes written\n+ * to it.\n+ *\n+ * If your Serialize or SerializationOp method has non-trivial overhead for\n+ * serialization, it may be worthwhile to implement a specialized version for\n+ * CSizeComputer, which uses the s.increment() method to record bytes that would\n+ * be written instead.\n+ */\n class CSizeComputer\n {\n protected:\n     size_t nSize;\n \n+    const int nType;\n+    const int nVersion;\n public:\n-    int nType;\n-    int nVersion;\n-\n     CSizeComputer(int nTypeIn, int nVersionIn) : nSize(0), nType(nTypeIn), nVersion(nVersionIn) {}\n \n-    CSizeComputer& write(const char *psz, size_t nSize)\n+    void write(const char *psz, size_t nSize)\n+    {\n+        this->nSize += nSize;\n+    }\n+\n+    void increment(size_t nSize)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9039#discussion_r85661870",
      "id" : 85661870,
      "original_commit_id" : "87d523c7b7baff3d9d763360e8e07e883a61f543",
      "original_position" : 705,
      "path" : "src/serialize.h",
      "position" : 705,
      "pull_request_review_id" : 6365543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9039",
      "updated_at" : "2016-10-30T15:20:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85661870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Concept ACK. I like it!",
      "created_at" : "2016-10-30T15:21:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9039#issuecomment-257157398",
      "id" : 257157398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9039",
      "updated_at" : "2016-10-30T15:21:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257157398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   }
]
