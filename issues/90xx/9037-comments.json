[
   {
      "body" : "This is the test-before-evict feature originally proposed in #6355.",
      "created_at" : "2016-10-28T21:54:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257038295",
      "id" : 257038295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-10-28T21:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257038295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "One issue which needs to be address in my code above is that I read from mapInfo via [ ]. This violates the very sensible coding style guide requirement that [ ] is never used for map reads. I could use an assert as is used in other code in addrman:\r\n\r\n```cpp\r\nassert(mapInfo.count(nId) == 1);\r\n```\r\n\r\nInstead I'd prefer to create a private method for accessing mapInfo elements by nId similar to CAddrMan::Find. As this is a refactor task which touches code outside of test-before-evict, I want to break it out into a separate commit to be included in this pull request.",
      "created_at" : "2016-10-28T22:04:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257040021",
      "id" : 257040021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-10-28T22:04:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257040021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620289"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Lock is held, could use Good_\n",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2016-10-28T22:27:57Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620289",
      "id" : 85620289,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 70,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-07-27T07:10:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620289",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1047859?v=4",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Lock held as above\n",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2016-10-28T22:28:22Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);\n+                eraseCollision = true;\n+            }\n+        } else { // Collision is not actually a collision anymore\n+            Good(infoNew, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620319",
      "id" : 85620319,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 74,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-07-27T07:10:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620319",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1047859?v=4",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: is this cast necessary?\n",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2016-10-28T22:29:00Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620371",
      "id" : 85620371,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 43,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-07-27T07:10:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620371",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1047859?v=4",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85624346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85624346"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: I think std::advance would be clearer than a loop for picking one element\n",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2016-10-28T23:15:27Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);\n+                eraseCollision = true;\n+            }\n+        } else { // Collision is not actually a collision anymore\n+            Good(infoNew, false);\n+            eraseCollision = true;\n+        }\n+\n+        if (eraseCollision){\n+            setTriedCollisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    int nRnd = GetRandInt(setTriedCollisions.size());\n+\n+    int i = 0;\n+    // Selects a random element from setTriedCollisions.\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end(); it++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85624346",
      "id" : 85624346,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 92,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-07-27T07:10:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85624346",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1047859?v=4",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651668"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good call!\n",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2016-10-30T02:00:06Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);\n+                eraseCollision = true;\n+            }\n+        } else { // Collision is not actually a collision anymore\n+            Good(infoNew, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651668",
      "id" : 85651668,
      "in_reply_to_id" : 85620319,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 74,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6357044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-07-27T07:10:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651668",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651671"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nope, removed it.\n",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2016-10-30T02:00:34Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651671",
      "id" : 85651671,
      "in_reply_to_id" : 85620371,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 43,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6357047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-07-27T07:10:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651671",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "I added some extra checks to ensure that if setTriedCollisions points to a key which doesn't exist in mapInfo it just removes that bad key.",
      "created_at" : "2016-11-01T19:38:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257671470",
      "id" : 257671470,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-11-01T19:38:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257671470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Is this good to merge? Any changes I should make?",
      "created_at" : "2016-11-21T23:36:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-262102202",
      "id" : 262102202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-11-21T23:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262102202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Fixed a merge conflict.",
      "created_at" : "2016-12-09T00:38:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-265899420",
      "id" : 265899420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-12-09T00:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265899420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@sipa Any suggestions or improvements I can make to this?",
      "created_at" : "2016-12-18T20:51:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-267845720",
      "id" : 267845720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-12-18T20:51:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267845720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "utACK\r\n\r\n@EthanHeilman Sorry for the delay here. I think we should try to get this in for 0.15. Would you mind rebasing again?",
      "created_at" : "2017-04-09T15:45:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-292793699",
      "id" : 292793699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-04-09T15:45:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/292793699",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Will rebase today or tomorrow.",
      "created_at" : "2017-04-10T17:05:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-293014073",
      "id" : 293014073,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-04-10T17:05:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293014073",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@sipa rebased, also updated some of the log statement to follow the new format.",
      "created_at" : "2017-04-13T13:43:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-293899032",
      "id" : 293899032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-04-13T13:43:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293899032",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Updated to obey new Bitcoin coding style guide",
      "created_at" : "2017-07-27T08:35:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-318296882",
      "id" : 318296882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-07-27T08:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318296882",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "ping @theuni ",
      "created_at" : "2017-08-10T20:48:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-321668922",
      "id" : 321668922,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-08-10T20:48:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321668922",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@EthanHeilman Thanks for adapting the style. I'll review thoroughly soon.",
      "created_at" : "2017-08-16T21:51:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-322909931",
      "id" : 322909931,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-08-16T21:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322909931",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199359"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: The above if case looks misleadingly like a single-no-curling-brace-block (I misread it as such) until you realize the thing below the comment (`// The position...`) is actually ending the block.\r\n\r\nMaybe move the comment inside and indented inside the else block? ",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2018-02-20T01:19:43Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199359",
      "id" : 169199359,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 77,
      "path" : "src/addrman.cpp",
      "position" : 77,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-02-20T01:30:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199359",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199460"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199460"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here, in case you address the above indentation/readability concern.\r\n\r\n",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2018-02-20T01:20:47Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                // Has attempted to connect and failed in last X hours\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199460",
      "id" : 169199460,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 88,
      "path" : "src/addrman.cpp",
      "position" : 88,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-02-20T01:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199460",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199786"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems like you can reduce the lines below by defaulting to `true` here, as several cases simply turn it on. Unless it is too complicated to swap.",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2018-02-20T01:24:31Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199786",
      "id" : 169199786,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 61,
      "path" : "src/addrman.cpp",
      "position" : 61,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-02-20T01:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199786",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment mentions old name (`newId`).",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2018-02-20T01:26:23Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                // Has attempted to connect and failed in last X hours\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    LogPrint(BCLog::ADDRMAN, \"addrman\", \"Swapping %s for %s in tried table\\n\", info_new.ToString(), info_old.ToString());\n+                    // Replaces an existing address already in the tried table with the new address\n+                    Good_(info_new, false, GetAdjustedTime());\n+                    erase_collision = true;\n+                }\n+            } else { // Collision is not actually a collision anymore\n+                Good_(info_new, false, GetAdjustedTime());\n+                erase_collision = true;\n+            }\n+        }\n+\n+        if (erase_collision){\n+            m_tried_collisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    if (m_tried_collisions.size() == 0)\n+        return CAddrInfo();\n+\n+    std::set<int>::iterator it = m_tried_collisions.begin();\n+\n+    // Selects a random element from m_tried_collisions\n+    std::advance(it, GetRandInt(m_tried_collisions.size()));\n+    int id_new = *it;\n+\n+    // If newId not found in mapInfo remove it from m_tried_collisions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199943",
      "id" : 169199943,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 119,
      "path" : "src/addrman.cpp",
      "position" : 119,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-02-20T01:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199943",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199994"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe just `return mapInfo[id_old];`?",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2018-02-20T01:27:00Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                // Has attempted to connect and failed in last X hours\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    LogPrint(BCLog::ADDRMAN, \"addrman\", \"Swapping %s for %s in tried table\\n\", info_new.ToString(), info_old.ToString());\n+                    // Replaces an existing address already in the tried table with the new address\n+                    Good_(info_new, false, GetAdjustedTime());\n+                    erase_collision = true;\n+                }\n+            } else { // Collision is not actually a collision anymore\n+                Good_(info_new, false, GetAdjustedTime());\n+                erase_collision = true;\n+            }\n+        }\n+\n+        if (erase_collision){\n+            m_tried_collisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    if (m_tried_collisions.size() == 0)\n+        return CAddrInfo();\n+\n+    std::set<int>::iterator it = m_tried_collisions.begin();\n+\n+    // Selects a random element from m_tried_collisions\n+    std::advance(it, GetRandInt(m_tried_collisions.size()));\n+    int id_new = *it;\n+\n+    // If newId not found in mapInfo remove it from m_tried_collisions\n+    if (mapInfo.count(id_new) != 1) {\n+        m_tried_collisions.erase(it);\n+        return CAddrInfo();\n+    }\n+\n+    CAddrInfo& newInfo = mapInfo[id_new];\n+\n+    // which tried bucket to move the entry to\n+    int tried_bucket = newInfo.GetTriedBucket(nKey);\n+    int tried_bucket_pos = newInfo.GetBucketPosition(nKey, false, tried_bucket);\n+\n+    int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+    CAddrInfo& info_old = mapInfo[id_old];\n+\n+    return info_old;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199994",
      "id" : 169199994,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 134,
      "path" : "src/addrman.cpp",
      "position" : 134,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-02-20T01:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199994",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169200154"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(Tests so maybe no biggie but) use `std::to_string()` not `boost::to_string()`",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2018-02-20T01:29:01Z",
      "diff_hunk" : "@@ -550,4 +557,158 @@ BOOST_AUTO_TEST_CASE(caddrinfo_get_new_bucket)\n     //  than 64 buckets.\n     BOOST_CHECK(buckets.size() > 64);\n }\n+\n+\n+BOOST_AUTO_TEST_CASE(addrman_selecttriedcollision)\n+{\n+    CAddrManTest addrman;\n+\n+    // Set addrman addr placement to be deterministic.\n+    addrman.MakeDeterministic();\n+\n+    BOOST_CHECK(addrman.size() == 0);\n+\n+    // Empty addrman should return blank addrman info.\n+    BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+\n+    // Add twenty two addresses.\n+    CNetAddr source = ResolveIP(\"252.2.2.2\");\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200154",
      "id" : 169200154,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 35,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 35,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-02-20T01:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169200154",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200207"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169200207"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`std::to_string`",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2018-02-20T01:29:27Z",
      "diff_hunk" : "@@ -550,4 +557,158 @@ BOOST_AUTO_TEST_CASE(caddrinfo_get_new_bucket)\n     //  than 64 buckets.\n     BOOST_CHECK(buckets.size() > 64);\n }\n+\n+\n+BOOST_AUTO_TEST_CASE(addrman_selecttriedcollision)\n+{\n+    CAddrManTest addrman;\n+\n+    // Set addrman addr placement to be deterministic.\n+    addrman.MakeDeterministic();\n+\n+    BOOST_CHECK(addrman.size() == 0);\n+\n+    // Empty addrman should return blank addrman info.\n+    BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+\n+    // Add twenty two addresses.\n+    CNetAddr source = ResolveIP(\"252.2.2.2\");\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));\n+        addrman.Add(CAddress(addr, NODE_NONE), source);\n+        addrman.Good(addr);\n+\n+        // No collisions yet.\n+        BOOST_CHECK(addrman.size() == i);\n+        BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+    }\n+\n+    // Ensure Good handles duplicates well.\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200207",
      "id" : 169200207,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 46,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 46,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-02-20T01:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169200207",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169478260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169478260"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Let me fix these and all push later tonight",
      "commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "created_at" : "2018-02-20T22:16:03Z",
      "diff_hunk" : "@@ -550,4 +557,158 @@ BOOST_AUTO_TEST_CASE(caddrinfo_get_new_bucket)\n     //  than 64 buckets.\n     BOOST_CHECK(buckets.size() > 64);\n }\n+\n+\n+BOOST_AUTO_TEST_CASE(addrman_selecttriedcollision)\n+{\n+    CAddrManTest addrman;\n+\n+    // Set addrman addr placement to be deterministic.\n+    addrman.MakeDeterministic();\n+\n+    BOOST_CHECK(addrman.size() == 0);\n+\n+    // Empty addrman should return blank addrman info.\n+    BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+\n+    // Add twenty two addresses.\n+    CNetAddr source = ResolveIP(\"252.2.2.2\");\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));\n+        addrman.Add(CAddress(addr, NODE_NONE), source);\n+        addrman.Good(addr);\n+\n+        // No collisions yet.\n+        BOOST_CHECK(addrman.size() == i);\n+        BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+    }\n+\n+    // Ensure Good handles duplicates well.\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169478260",
      "id" : 169478260,
      "in_reply_to_id" : 169200207,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 46,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 46,
      "pull_request_review_id" : 98010989,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-02-20T22:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169478260",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   }
]
