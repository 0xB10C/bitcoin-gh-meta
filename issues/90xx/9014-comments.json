[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84932213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84932213"
         }
      },
      "body" : "Don't you need a fallback for when the chainwork is identical?",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T15:35:52Z",
      "diff_hunk" : "@@ -2799,20 +2799,40 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+struct CompareBlockIndexByWork {\n+    bool operator()(const CBlockIndex* a, const CBlockIndex* b) const {\n+        return a->nChainWork < b->nChainWork;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84932213",
      "id" : 84932213,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 6,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5678302,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84932213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84941470"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84941470"
         }
      },
      "body" : "nit: maybe do this as\r\n\r\n    it = blockTrace.mapBlocks.emplace(pindexNew, std::shared_ptr<const CBlock>(new CBlock())).first;\r\n\r\nOr\r\n\r\n    auto pblockNew = std::make_shared<CBlock>();\r\n\r\nand update following code accordingly\r\n\r\n\r\n",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T16:15:57Z",
      "diff_hunk" : "@@ -2799,20 +2799,40 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+struct CompareBlockIndexByWork {\n+    bool operator()(const CBlockIndex* a, const CBlockIndex* b) const {\n+        return a->nChainWork < b->nChainWork;\n+    }\n+};\n+\n+// Used in ActivateBestChain/ConnectBlock to keep track of blocks connected\n+// and notify listeners in the right order.\n+// Note that since mapBlocks is sorted lowest-work to highest-work, iterating\n+// over it will give you the order in which the blocks were connected\n+struct BlockConnectTrace {\n+    std::map<CBlockIndex*, std::shared_ptr<const CBlock>, CompareBlockIndexByWork> mapBlocks;\n+};\n+\n /**\n- * Connect a new block to chainActive. pblock is either NULL or a pointer to a CBlock\n- * corresponding to pindexNew, to bypass loading it again from disk.\n+ * Connect a new block to chainActive.\n+ * If a shared_ptr to the block for pindexNew already exists in blockTrace.mapBlocks,\n+ * we will bypass re-loading the block from disk.\n  */\n-bool static ConnectTip(CValidationState& state, const CChainParams& chainparams, CBlockIndex* pindexNew, const CBlock* pblock, std::vector<std::shared_ptr<const CTransaction>> &txConflicted, std::vector<std::tuple<CTransaction,CBlockIndex*,int>> &txChanged)\n+bool static ConnectTip(CValidationState& state, const CChainParams& chainparams, CBlockIndex* pindexNew, std::vector<std::shared_ptr<const CTransaction>> &txConflicted, BlockConnectTrace& blockTrace)\n {\n     assert(pindexNew->pprev == chainActive.Tip());\n     // Read block from disk.\n     int64_t nTime1 = GetTimeMicros();\n-    CBlock block;\n-    if (!pblock) {\n-        if (!ReadBlockFromDisk(block, pindexNew, chainparams.GetConsensus()))\n+    const CBlock *pblock;\n+    auto it = blockTrace.mapBlocks.find(pindexNew);\n+    if (it == blockTrace.mapBlocks.end()) {\n+        CBlock *pblockNew = new CBlock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84941470",
      "id" : 84941470,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 37,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5686996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84941470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84941702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84941702"
         }
      },
      "body" : "Since its only used in each ActivateBestChainStep call individually, there is only ever one thing per given height/total work, but the map came out of an older version of the code and is now useless...so I'm replacing it with a vector.",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T16:16:57Z",
      "diff_hunk" : "@@ -2799,20 +2799,40 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+struct CompareBlockIndexByWork {\n+    bool operator()(const CBlockIndex* a, const CBlockIndex* b) const {\n+        return a->nChainWork < b->nChainWork;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84941702",
      "id" : 84941702,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 6,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5687211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84941702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948521"
         }
      },
      "body" : "See other comment about using make_shared",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T16:50:35Z",
      "diff_hunk" : "@@ -6023,23 +6050,24 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n \n     else if (strCommand == NetMsgType::BLOCK && !fImporting && !fReindex) // Ignore blocks received while importing\n     {\n-        CBlock block;\n-        vRecv >> block;\n+        CBlock *pblock = new CBlock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948521",
      "id" : 84948521,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 181,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5686996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948692"
         }
      },
      "body" : "make_shared",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T16:51:24Z",
      "diff_hunk" : "@@ -132,7 +132,8 @@ UniValue generateBlocks(boost::shared_ptr<CReserveScript> coinbaseScript, int nG\n             continue;\n         }\n         CValidationState state;\n-        if (!ProcessNewBlock(state, Params(), NULL, pblock, true, NULL))\n+        std::shared_ptr<const CBlock> shared_pblock(new CBlock(*pblock));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948692",
      "id" : 84948692,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 5,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 5686996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948777"
         }
      },
      "body" : "make_shared",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T16:51:53Z",
      "diff_hunk" : "@@ -726,7 +727,9 @@ UniValue submitblock(const JSONRPCRequest& request)\n             + HelpExampleRpc(\"submitblock\", \"\\\"mydata\\\"\")\n         );\n \n-    CBlock block;\n+    CBlock* blockptr = new CBlock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948777",
      "id" : 84948777,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 15,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 5686996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948818"
         }
      },
      "body" : "make_shared",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T16:52:05Z",
      "diff_hunk" : "@@ -223,7 +223,8 @@ BOOST_AUTO_TEST_CASE(CreateNewBlock_validity)\n         pblock->hashMerkleRoot = BlockMerkleRoot(*pblock);\n         pblock->nNonce = blockinfo[i].nonce;\n         CValidationState state;\n-        BOOST_CHECK(ProcessNewBlock(state, chainparams, NULL, pblock, true, NULL));\n+        std::shared_ptr<const CBlock> shared_pblock(new CBlock(*pblock));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948818",
      "id" : 84948818,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 5,
      "path" : "src/test/miner_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 5686996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948843"
         }
      },
      "body" : "make_shared",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T16:52:13Z",
      "diff_hunk" : "@@ -127,7 +127,8 @@ TestChain100Setup::CreateAndProcessBlock(const std::vector<CMutableTransaction>&\n     while (!CheckProofOfWork(block.GetHash(), block.nBits, chainparams.GetConsensus())) ++block.nNonce;\n \n     CValidationState state;\n-    ProcessNewBlock(state, chainparams, NULL, &block, true, NULL);\n+    std::shared_ptr<const CBlock> shared_pblock(new CBlock(block));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84948843",
      "id" : 84948843,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 5,
      "path" : "src/test/test_bitcoin.cpp",
      "position" : null,
      "pull_request_review_id" : 5686996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84948843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84950014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84950014"
         }
      },
      "body" : "Semantics of passing shared_ptr by reference are a bit wonky. I think it is correct in this use case though. Perhaps it would be better for maintainability to eat the performance cost of an atomic increment and pass by value, or pass by const reference (if possible?).",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T16:58:11Z",
      "diff_hunk" : "@@ -3740,7 +3766,7 @@ static bool AcceptBlock(const CBlock& block, CValidationState& state, const CCha\n     return true;\n }\n \n-bool ProcessNewBlock(CValidationState& state, const CChainParams& chainparams, CNode* pfrom, const CBlock* pblock, bool fForceProcessing, const CDiskBlockPos* dbp)\n+bool ProcessNewBlock(CValidationState& state, const CChainParams& chainparams, CNode* pfrom, std::shared_ptr<const CBlock>& pblock, bool fForceProcessing, const CDiskBlockPos* dbp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84950014",
      "id" : 84950014,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 137,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5686996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84950014",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84950114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84950114"
         }
      },
      "body" : "make_shared",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T16:58:38Z",
      "diff_hunk" : "@@ -5829,7 +5855,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         BlockTransactions resp;\n         vRecv >> resp;\n \n-        CBlock block;\n+        CBlock *pblock = new CBlock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84950114",
      "id" : 84950114,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 146,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5686996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84950114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84951636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84951636"
         }
      },
      "body" : "I think it may be worthwhile for you to make this a class and keep the implementation details hidden...",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T17:06:55Z",
      "diff_hunk" : "@@ -2799,20 +2799,40 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+struct CompareBlockIndexByWork {\n+    bool operator()(const CBlockIndex* a, const CBlockIndex* b) const {\n+        return a->nChainWork < b->nChainWork;\n+    }\n+};\n+\n+// Used in ActivateBestChain/ConnectBlock to keep track of blocks connected\n+// and notify listeners in the right order.\n+// Note that since mapBlocks is sorted lowest-work to highest-work, iterating\n+// over it will give you the order in which the blocks were connected\n+struct BlockConnectTrace {\n+    std::map<CBlockIndex*, std::shared_ptr<const CBlock>, CompareBlockIndexByWork> mapBlocks;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84951636",
      "id" : 84951636,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 15,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5686996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84951636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84953007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84953007"
         }
      },
      "body" : "The shared_ptrs are to a const CBlock, and IIRC you cant blindly cast a shared_ptr<CBlock> to a shared_ptr<const CBlock>, but you need to access the block as non-const, and I kinda prefer this over a const_cast.",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T17:13:42Z",
      "diff_hunk" : "@@ -5829,7 +5855,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         BlockTransactions resp;\n         vRecv >> resp;\n \n-        CBlock block;\n+        CBlock *pblock = new CBlock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84953007",
      "id" : 84953007,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 146,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5698055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84953007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84957095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84957095"
         }
      },
      "body" : "implicit copy-cast should work...\r\n\r\n```\r\n#include <memory>\r\nint main() {\r\n    auto a = std::make_shared<int>(10);\r\n    std::shared_ptr<const int> b = a;\r\n}\r\n```",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T17:32:43Z",
      "diff_hunk" : "@@ -5829,7 +5855,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         BlockTransactions resp;\n         vRecv >> resp;\n \n-        CBlock block;\n+        CBlock *pblock = new CBlock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84957095",
      "id" : 84957095,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 146,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5701877,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84957095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84964567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84964567"
         }
      },
      "body" : "Cool, didnt realize that was a thing!",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T18:06:28Z",
      "diff_hunk" : "@@ -5829,7 +5855,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         BlockTransactions resp;\n         vRecv >> resp;\n \n-        CBlock block;\n+        CBlock *pblock = new CBlock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84964567",
      "id" : 84964567,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 146,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5708818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84964567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84969535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84969535"
         }
      },
      "body" : "I added txConflicted here to make diffs of individual commits easier, which now requires a lot of access to the contents directly :/ Not sure its worth it.",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T18:29:28Z",
      "diff_hunk" : "@@ -2799,20 +2799,40 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+struct CompareBlockIndexByWork {\n+    bool operator()(const CBlockIndex* a, const CBlockIndex* b) const {\n+        return a->nChainWork < b->nChainWork;\n+    }\n+};\n+\n+// Used in ActivateBestChain/ConnectBlock to keep track of blocks connected\n+// and notify listeners in the right order.\n+// Note that since mapBlocks is sorted lowest-work to highest-work, iterating\n+// over it will give you the order in which the blocks were connected\n+struct BlockConnectTrace {\n+    std::map<CBlockIndex*, std::shared_ptr<const CBlock>, CompareBlockIndexByWork> mapBlocks;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84969535",
      "id" : 84969535,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 15,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5713582,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84969535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84969627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84969627"
         }
      },
      "body" : "The new version should be cleaner.",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-25T18:29:50Z",
      "diff_hunk" : "@@ -2799,20 +2799,40 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+struct CompareBlockIndexByWork {\n+    bool operator()(const CBlockIndex* a, const CBlockIndex* b) const {\n+        return a->nChainWork < b->nChainWork;\n+    }\n+};\n+\n+// Used in ActivateBestChain/ConnectBlock to keep track of blocks connected\n+// and notify listeners in the right order.\n+// Note that since mapBlocks is sorted lowest-work to highest-work, iterating\n+// over it will give you the order in which the blocks were connected\n+struct BlockConnectTrace {\n+    std::map<CBlockIndex*, std::shared_ptr<const CBlock>, CompareBlockIndexByWork> mapBlocks;\n+};\n+\n /**\n- * Connect a new block to chainActive. pblock is either NULL or a pointer to a CBlock\n- * corresponding to pindexNew, to bypass loading it again from disk.\n+ * Connect a new block to chainActive.\n+ * If a shared_ptr to the block for pindexNew already exists in blockTrace.mapBlocks,\n+ * we will bypass re-loading the block from disk.\n  */\n-bool static ConnectTip(CValidationState& state, const CChainParams& chainparams, CBlockIndex* pindexNew, const CBlock* pblock, std::vector<std::shared_ptr<const CTransaction>> &txConflicted, std::vector<std::tuple<CTransaction,CBlockIndex*,int>> &txChanged)\n+bool static ConnectTip(CValidationState& state, const CChainParams& chainparams, CBlockIndex* pindexNew, std::vector<std::shared_ptr<const CTransaction>> &txConflicted, BlockConnectTrace& blockTrace)\n {\n     assert(pindexNew->pprev == chainActive.Tip());\n     // Read block from disk.\n     int64_t nTime1 = GetTimeMicros();\n-    CBlock block;\n-    if (!pblock) {\n-        if (!ReadBlockFromDisk(block, pindexNew, chainparams.GetConsensus()))\n+    const CBlock *pblock;\n+    auto it = blockTrace.mapBlocks.find(pindexNew);\n+    if (it == blockTrace.mapBlocks.end()) {\n+        CBlock *pblockNew = new CBlock();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r84969627",
      "id" : 84969627,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 37,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5713673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/84969627",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "OK, ended up rewriting the PR quite a bit, cleaning it up and resolving the nits folks had raised - it now no longer has this crazy map thing that can be used as both a paramter and a return value.",
      "created_at" : "2016-10-25T18:30:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#issuecomment-256128799",
      "id" : 256128799,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9014",
      "updated_at" : "2016-10-25T18:30:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/256128799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "re-utack, much cleaner!",
      "created_at" : "2016-10-25T19:26:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#issuecomment-256149859",
      "id" : 256149859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9014",
      "updated_at" : "2016-10-25T19:26:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/256149859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85033430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85033430"
         }
      },
      "body" : "Can you use a doxygen compatible comment here?",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-26T01:06:18Z",
      "diff_hunk" : "@@ -2799,11 +2799,18 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+// Used to track conflicted transactions removed from mempool and transactions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85033430",
      "id" : 85033430,
      "original_commit_id" : "34d0c884d612a3e2519ce3670894a32d668bd052",
      "original_position" : 4,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5773286,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85033430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85034371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85034371"
         }
      },
      "body" : "This logic needs to be duplicated in the disconnect logic above. It's possible that an invalid block is received which triggers a reorg. So we start from chain A-B, and receive A-C-D, with D invalid. We'll first disconnect B, then successfully connect C, but fail when connecting D. We'll loop back then, disconnect C, and reconnect B. Your code will (I believe) report both C and B as newly connected, while it should be nothing at all.\r\n\r\nPerhaps it's easier to do a filtering step in ActivateBestChain that removes the errorneously blocks in the trace.",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-26T01:17:52Z",
      "diff_hunk" : "@@ -2974,6 +2975,8 @@ static bool ActivateBestChainStep(CValidationState& state, const CChainParams& c\n                     state = CValidationState();\n                     fInvalidFound = true;\n                     fContinue = false;\n+                    // If we didn't actually connect the block, don't notify listeners about it",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85034371",
      "id" : 85034371,
      "original_commit_id" : "a0d30f80f31fbdc8e1aaf2bf1ea5f32c0b3e8ec4",
      "original_position" : 42,
      "path" : "src/main.cpp",
      "position" : 84,
      "pull_request_review_id" : 5774127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85034371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85034775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85034775"
         }
      },
      "body" : "Unintentional new lines?",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-26T01:22:46Z",
      "diff_hunk" : "@@ -2806,11 +2806,13 @@ struct ConnectTrace {\n     std::vector<std::pair<CBlockIndex*, std::shared_ptr<const CBlock> > > blocksConnected;\n };\n \n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85034775",
      "id" : 85034775,
      "original_commit_id" : "051b9968cf32dfe7f05cf159b8b515bbdaae845d",
      "original_position" : 4,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5774478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85034775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85035520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85035520"
         }
      },
      "body" : "In my opinion, passing by reference is preferred at any time when you're sure the shared_ptr itself (not the object it points to) is only accessed from a single thread. The cost of the atomic increment is negligable here though, so I don't care in this particular case.",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-26T01:32:54Z",
      "diff_hunk" : "@@ -3740,7 +3766,7 @@ static bool AcceptBlock(const CBlock& block, CValidationState& state, const CCha\n     return true;\n }\n \n-bool ProcessNewBlock(CValidationState& state, const CChainParams& chainparams, CNode* pfrom, const CBlock* pblock, bool fForceProcessing, const CDiskBlockPos* dbp)\n+bool ProcessNewBlock(CValidationState& state, const CChainParams& chainparams, CNode* pfrom, std::shared_ptr<const CBlock>& pblock, bool fForceProcessing, const CDiskBlockPos* dbp)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85035520",
      "id" : 85035520,
      "original_commit_id" : "d0f3b607859dd9e46869aa2639d733dc129fabc4",
      "original_position" : 137,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5775179,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85035520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85042624"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85042624"
         }
      },
      "body" : "Typo: deleted",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-26T03:07:25Z",
      "diff_hunk" : "@@ -5846,7 +5841,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         BlockTransactions resp;\n         vRecv >> resp;\n \n-        CBlock block;\n+        CBlock *pblock = new CBlock();\n+        std::shared_ptr<const CBlock> shared_pblock(pblock); // pblock will be delted by the shared_ptr",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85042624",
      "id" : 85042624,
      "original_commit_id" : "5095970c9703bdb23459839b4aade2ad56b792d5",
      "original_position" : 29,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 5781432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85042624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85043630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85043630"
         }
      },
      "body" : "Hmm? I dont believe so? Note that the callbacks in question are called from ABC after each ABCS call, and might happen for blocks which will be reorged out in the next ABCS call (this is the existing behavior).",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-26T03:22:20Z",
      "diff_hunk" : "@@ -2974,6 +2975,8 @@ static bool ActivateBestChainStep(CValidationState& state, const CChainParams& c\n                     state = CValidationState();\n                     fInvalidFound = true;\n                     fContinue = false;\n+                    // If we didn't actually connect the block, don't notify listeners about it",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85043630",
      "id" : 85043630,
      "original_commit_id" : "a0d30f80f31fbdc8e1aaf2bf1ea5f32c0b3e8ec4",
      "original_position" : 42,
      "path" : "src/main.cpp",
      "position" : 84,
      "pull_request_review_id" : 5782379,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T03:32:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85043630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85047825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85047825"
         }
      },
      "body" : "No, cs_main is held during the entirety of the attempted reorg here, and the callbacks only fire after the whole thing (I think).",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-26T04:27:58Z",
      "diff_hunk" : "@@ -2959,14 +2968,16 @@ static bool ActivateBestChainStep(CValidationState& state, const CChainParams& c\n \n         // Connect new blocks.\n         BOOST_REVERSE_FOREACH(CBlockIndex *pindexConnect, vpindexToConnect) {\n-            if (!ConnectTip(state, chainparams, pindexConnect, pindexConnect == pindexMostWork ? pblock : NULL, txConflicted, txChanged)) {\n+            if (!ConnectTip(state, chainparams, pindexConnect, pindexConnect == pindexMostWork ? pblock : std::shared_ptr<const CBlock>(), connectTrace)) {\n                 if (state.IsInvalid()) {\n                     // The block violates a consensus rule.\n                     if (!state.CorruptionPossible())\n                         InvalidChainFound(vpindexToConnect.back());\n                     state = CValidationState();\n                     fInvalidFound = true;\n                     fContinue = false;\n+                    // If we didn't actually connect the block, don't notify listeners about it",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85047825",
      "id" : 85047825,
      "original_commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "original_position" : 84,
      "path" : "src/main.cpp",
      "position" : 84,
      "pull_request_review_id" : 5786012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T04:27:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85047825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85133796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85133796"
         }
      },
      "body" : "I'm very confused. ActivateBestChain has always locked cs_main, called ActivateBestChainStep once, and then unlocked cs_main and made callbacks before repeating. In the old code we pushed transactions to update onto the callback queue at the end of ConnectTip and never removed them (since there will never be a DisconnectTip call within the same cs_main in ActivateBestChainStep since all DisconnectTips happen before ConnectTip).",
      "commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "created_at" : "2016-10-26T14:24:01Z",
      "diff_hunk" : "@@ -2959,14 +2968,16 @@ static bool ActivateBestChainStep(CValidationState& state, const CChainParams& c\n \n         // Connect new blocks.\n         BOOST_REVERSE_FOREACH(CBlockIndex *pindexConnect, vpindexToConnect) {\n-            if (!ConnectTip(state, chainparams, pindexConnect, pindexConnect == pindexMostWork ? pblock : NULL, txConflicted, txChanged)) {\n+            if (!ConnectTip(state, chainparams, pindexConnect, pindexConnect == pindexMostWork ? pblock : std::shared_ptr<const CBlock>(), connectTrace)) {\n                 if (state.IsInvalid()) {\n                     // The block violates a consensus rule.\n                     if (!state.CorruptionPossible())\n                         InvalidChainFound(vpindexToConnect.back());\n                     state = CValidationState();\n                     fInvalidFound = true;\n                     fContinue = false;\n+                    // If we didn't actually connect the block, don't notify listeners about it",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9014#discussion_r85133796",
      "id" : 85133796,
      "original_commit_id" : "3f78bc176a3c612f320bce4516aadcd6234c0850",
      "original_position" : 84,
      "path" : "src/main.cpp",
      "position" : 84,
      "pull_request_review_id" : 5866264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9014",
      "updated_at" : "2016-10-26T14:24:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85133796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
