[
   {
      "body" : "I believe that with this change if a whitelisted peer gives us a transaction with internally duplicated inputs, we will relay it (CheckTransaction will pass, conflict with the mempool will not set DoS.) and then our peers running without this change will ban us (Their CheckTransaction will fail). Less critically, this change results in txn with internal doublespends getting a misleading log entry of mempool-conflict.\r\n\r\nEdit: I suggest creating a CheckTransactionHarder that ATMP uses which will check for transaction internal duplication and still nDoS.  This way block processing can still avoid the redundant test.",
      "created_at" : "2016-11-01T06:01:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-257495287",
      "id" : 257495287,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9049",
      "updated_at" : "2016-11-01T06:11:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257495287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Simplified diff and fixed.",
      "created_at" : "2016-11-01T17:35:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-257634590",
      "id" : 257634590,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9049",
      "updated_at" : "2016-11-01T17:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257634590",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9049#discussion_r86071279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9049"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86071279"
         }
      },
      "body" : "point out that it's also redundant there please!",
      "commit_id" : "1019c03ad3d25572e4a5b8416aa3228d914287cc",
      "created_at" : "2016-11-02T04:20:53Z",
      "diff_hunk" : "@@ -1090,13 +1090,15 @@ bool CheckTransaction(const CTransaction& tx, CValidationState &state)\n             return state.DoS(100, false, REJECT_INVALID, \"bad-txns-txouttotal-toolarge\");\n     }\n \n-    // Check for duplicate inputs\n-    set<COutPoint> vInOutPoints;\n-    for (const auto& txin : tx.vin)\n-    {\n-        if (vInOutPoints.count(txin.prevout))\n-            return state.DoS(100, false, REJECT_INVALID, \"bad-txns-inputs-duplicate\");\n-        vInOutPoints.insert(txin.prevout);\n+    // Check for duplicate inputs - note that this check is slow so we skip it in CheckBlock",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9049#discussion_r86071279",
      "id" : 86071279,
      "original_commit_id" : "1019c03ad3d25572e4a5b8416aa3228d914287cc",
      "original_position" : 20,
      "path" : "src/main.cpp",
      "position" : 20,
      "pull_request_review_id" : 6747676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9049",
      "updated_at" : "2016-11-02T04:20:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86071279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "utACK +/- comment nit.",
      "created_at" : "2016-11-02T04:21:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-257768800",
      "id" : 257768800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9049",
      "updated_at" : "2016-11-02T04:21:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257768800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   }
]
