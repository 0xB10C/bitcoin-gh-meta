[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-12-19T13:22:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-748474312",
      "id" : 748474312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODQ3NDMxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-19T13:22:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748474312",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hello John,Is this regarding the request I made yesterday.?\n\nOn Sat, Dec 19, 2020 at 6:26 AM John Newbery <notifications@github.com>\nwrote:\n\n> This continues the work of moving application layer data into\n> net_processing, by moving all ping data into the new Peer object added in\n> #19607 <https://github.com/bitcoin/bitcoin/pull/19607>.\n>\n> For motivation, see #19398\n> <https://github.com/bitcoin/bitcoin/issues/19398>.\n>\n> The first three commits are review suggestions from #19829\n> <https://github.com/bitcoin/bitcoin/pull/19829>.\n> ------------------------------\n> You can view, comment on, or merge this pull request online at:\n>\n>   https://github.com/bitcoin/bitcoin/pull/20721\n> Commit Summary\n>\n>    - [net processing] Add comment about destructing Peer objects\n>    - [net processing] Move nStartingHeight to Peer\n>    - [net processing] Rename nStartingHeight to m_starting_height\n>    - [net processing] Move block inventory data to Peer\n>    - scripted-diff: rename vBlockHashesToAnnounce and\n>    vInventoryBlockToSend\n>    - [net processing] Move hashContinue to net processing\n>    - [net processing] Fix/improve comments for Peer\n>    - [rpc] Fix ordering of fields in getpeerinfo help text\n>    - [net processing] Guard m_hash_continue with m_block_inv_mutex\n>    - [net processing] Move send ping message logic into function\n>    - [net processing] Move ping timeout logic to net processing\n>    - [net processing] Move ping data fields to net processing\n>    - scripted-diff: rename ping members\n>\n> File Changes\n>\n>    - *M* src/net.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-00021eed586a482abdb09d6cdada1d90115abe988a91421851960e26658bed02>\n>    (29)\n>    - *M* src/net.h\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-422879cc8bfac56d4380c865f381b58afeb344bc355bbc7f47c581e4491b6b4b>\n>    (27)\n>    - *M* src/net_processing.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3>\n>    (203)\n>    - *M* src/net_processing.h\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-2a4e846ad2d76a4e7a6f6c46a68b3603de372f435a93b7c0fcabadccc0ed86a5>\n>    (49)\n>    - *M* src/qt/rpcconsole.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-cec3a0a10196329610d46fbd0e01ce6496e5ae9e23c057d8012d48c2f0d3b5c9>\n>    (7)\n>    - *M* src/rpc/net.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-2ae094f9329ce9498e1b4a9cb7767945b54a33b4ee9fed4f0ba401a98e1683c1>\n>    (23)\n>    - *M* src/test/denialofservice_tests.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-a4c9875091483bafb92d8ccaa035dff408a7a5c44e5b4eb55ff51fb0e5112ed2>\n>    (18)\n>\n> Patch Links:\n>\n>    - https://github.com/bitcoin/bitcoin/pull/20721.patch\n>    - https://github.com/bitcoin/bitcoin/pull/20721.diff\n>\n> â\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/20721>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AJ3ZHMLNHNH6WYDANXUXQOLSVSEWZANCNFSM4VCHGLWQ>\n> .\n>\n",
      "created_at" : "2020-12-19T14:16:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-748480409",
      "id" : 748480409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODQ4MDQwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-19T14:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748480409",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/41391025?v=4",
         "events_url" : "https://api.github.com/users/sheffine/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sheffine/followers",
         "following_url" : "https://api.github.com/users/sheffine/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sheffine/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sheffine",
         "id" : 41391025,
         "login" : "sheffine",
         "node_id" : "MDQ6VXNlcjQxMzkxMDI1",
         "organizations_url" : "https://api.github.com/users/sheffine/orgs",
         "received_events_url" : "https://api.github.com/users/sheffine/received_events",
         "repos_url" : "https://api.github.com/users/sheffine/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sheffine/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sheffine/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sheffine"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Is it okay for me to go ahead and pull this file. I have no idea with\nregards to whatâs going on and if my request has been completed .\nCan some one give me some answer please\n\nSheffine\n\nOn Sat, Dec 19, 2020 at 6:26 AM John Newbery <notifications@github.com>\nwrote:\n\n> This continues the work of moving application layer data into\n> net_processing, by moving all ping data into the new Peer object added in\n> #19607 <https://github.com/bitcoin/bitcoin/pull/19607>.\n>\n> For motivation, see #19398\n> <https://github.com/bitcoin/bitcoin/issues/19398>.\n>\n> The first three commits are review suggestions from #19829\n> <https://github.com/bitcoin/bitcoin/pull/19829>.\n> ------------------------------\n> You can view, comment on, or merge this pull request online at:\n>\n>   https://github.com/bitcoin/bitcoin/pull/20721\n> Commit Summary\n>\n>    - [net processing] Add comment about destructing Peer objects\n>    - [net processing] Move nStartingHeight to Peer\n>    - [net processing] Rename nStartingHeight to m_starting_height\n>    - [net processing] Move block inventory data to Peer\n>    - scripted-diff: rename vBlockHashesToAnnounce and\n>    vInventoryBlockToSend\n>    - [net processing] Move hashContinue to net processing\n>    - [net processing] Fix/improve comments for Peer\n>    - [rpc] Fix ordering of fields in getpeerinfo help text\n>    - [net processing] Guard m_hash_continue with m_block_inv_mutex\n>    - [net processing] Move send ping message logic into function\n>    - [net processing] Move ping timeout logic to net processing\n>    - [net processing] Move ping data fields to net processing\n>    - scripted-diff: rename ping members\n>\n> File Changes\n>\n>    - *M* src/net.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-00021eed586a482abdb09d6cdada1d90115abe988a91421851960e26658bed02>\n>    (29)\n>    - *M* src/net.h\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-422879cc8bfac56d4380c865f381b58afeb344bc355bbc7f47c581e4491b6b4b>\n>    (27)\n>    - *M* src/net_processing.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3>\n>    (203)\n>    - *M* src/net_processing.h\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-2a4e846ad2d76a4e7a6f6c46a68b3603de372f435a93b7c0fcabadccc0ed86a5>\n>    (49)\n>    - *M* src/qt/rpcconsole.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-cec3a0a10196329610d46fbd0e01ce6496e5ae9e23c057d8012d48c2f0d3b5c9>\n>    (7)\n>    - *M* src/rpc/net.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-2ae094f9329ce9498e1b4a9cb7767945b54a33b4ee9fed4f0ba401a98e1683c1>\n>    (23)\n>    - *M* src/test/denialofservice_tests.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-a4c9875091483bafb92d8ccaa035dff408a7a5c44e5b4eb55ff51fb0e5112ed2>\n>    (18)\n>\n> Patch Links:\n>\n>    - https://github.com/bitcoin/bitcoin/pull/20721.patch\n>    - https://github.com/bitcoin/bitcoin/pull/20721.diff\n>\n> â\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/20721>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AJ3ZHMLNHNH6WYDANXUXQOLSVSEWZANCNFSM4VCHGLWQ>\n> .\n>\n",
      "created_at" : "2020-12-20T23:27:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-748686574",
      "id" : 748686574,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODY4NjU3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-20T23:27:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748686574",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/41391025?v=4",
         "events_url" : "https://api.github.com/users/sheffine/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sheffine/followers",
         "following_url" : "https://api.github.com/users/sheffine/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sheffine/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sheffine",
         "id" : 41391025,
         "login" : "sheffine",
         "node_id" : "MDQ6VXNlcjQxMzkxMDI1",
         "organizations_url" : "https://api.github.com/users/sheffine/orgs",
         "received_events_url" : "https://api.github.com/users/sheffine/received_events",
         "repos_url" : "https://api.github.com/users/sheffine/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sheffine/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sheffine/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sheffine"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sheffine You seem pretty confused, and I have no idea what you're trying to do. This is the discussion page for a proposed change to the Bitcoin Core software project, and your comments seem unrelated. Please stop.",
      "created_at" : "2020-12-21T03:31:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-748737513",
      "id" : 748737513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODczNzUxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-21T03:31:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748737513",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master. This is now ready for review.",
      "created_at" : "2020-12-22T13:46:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-749547642",
      "id" : 749547642,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0OTU0NzY0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-22T13:46:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749547642",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548265029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548265029"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you're changing every reference to `pto` anyway because it's now a reference not a pointer, maybe also call it `node_to` or similar, since it's not a \"p\" anymore?",
      "commit_id" : "7f736c7df9b83cb3ed94a42678fe4344508d3e73",
      "created_at" : "2020-12-23T21:43:57Z",
      "diff_hunk" : "@@ -4076,31 +4076,15 @@ class CompareInvMempoolOrder\n };\n }\n \n-bool PeerManager::SendMessages(CNode* pto)\n+void PeerManager::MaybeSendPing(CNode& pto)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548265029",
      "id" : 548265029,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI2NTAyOQ==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 4079,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 558241240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-23T21:52:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548265029",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548266275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548266275"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think exposing more implementation details in net_processing.h is a good idea. Fortunately it's fixable: #20758 ",
      "commit_id" : "7f736c7df9b83cb3ed94a42678fe4344508d3e73",
      "created_at" : "2020-12-23T21:45:34Z",
      "diff_hunk" : "@@ -217,6 +217,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message on a regular schedule or if requested manually */\n+    void MaybeSendPing(CNode& pto);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548266275",
      "id" : 548266275,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI2NjI3NQ==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 558241240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-23T21:52:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548266275",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548268168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548268168"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Move the test change to its own commit so it's easy to verify behaviour doesn't change with the move logic to net_processing commit? I don't follow why the test change is necessary/desirable though.",
      "commit_id" : "7f736c7df9b83cb3ed94a42678fe4344508d3e73",
      "created_at" : "2020-12-23T21:48:14Z",
      "diff_hunk" : "@@ -109,9 +109,17 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n         dummyNode1.vSendMsg.clear();\n     }\n \n-    int64_t nStartTime = GetTime();\n-    // Wait 21 minutes\n-    SetMockTime(nStartTime+21*60);\n+    int64_t time{GetTime()};\n+    // Wait 10 minutes\n+    time += 10 * 60;\n+    SetMockTime(time);\n+\n+    // Clear nPingNonceSent so we don't disconnect for a ping timeout\n+    dummyNode1.nPingNonceSent = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548268168",
      "id" : 548268168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI2ODE2OA==",
      "original_commit_id" : "a54ba871666ccab23400894832e05a1bb9c53c32",
      "original_line" : 118,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 558241240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-23T21:52:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548268168",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20758 (net-processing refactoring -- lose globals, move implementation details from .h to .cpp by ajtowns)\n* #20755 ([rpc] Remove deprecated fields from getpeerinfo by amitiuttarwar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-12-23T21:54:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-750488019",
      "id" : 750488019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDQ4ODAxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-23T21:54:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750488019",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> \"jnewbery deleted a comment from sipa 3 days ago\" ?\r\n\r\nha. There were two comments from sheffine saying \"why are you emailing me?\" and one from sipa saying \"sheffine, you're confused\", so I deleted them all to reduce noise.",
      "created_at" : "2020-12-23T22:19:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-750494700",
      "id" : 750494700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDQ5NDcwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-23T22:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750494700",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Censorship!!!\n\n(yes, that's indeed what happened)",
      "created_at" : "2020-12-23T22:20:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-750495167",
      "id" : 750495167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDQ5NTE2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-23T22:20:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750495167",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317053"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Move the test change to its own commit so it's easy to verify behaviour doesn't change\r\n\r\ngood idea. Will do.\r\n\r\n> I don't follow why the test change is necessary/desirable though.\r\n\r\nThe change is required because previously ping timeouts happened in in CConnman, so it was fine to bump the time in this test because there's no CConnman to time out the connection. When the ping data and timout logic is moved to PeerManager, then the connection times out in this test if you bump the time forwards by 21 minutes without resetting the ping nonce.",
      "commit_id" : "7f736c7df9b83cb3ed94a42678fe4344508d3e73",
      "created_at" : "2020-12-23T23:22:51Z",
      "diff_hunk" : "@@ -109,9 +109,17 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n         dummyNode1.vSendMsg.clear();\n     }\n \n-    int64_t nStartTime = GetTime();\n-    // Wait 21 minutes\n-    SetMockTime(nStartTime+21*60);\n+    int64_t time{GetTime()};\n+    // Wait 10 minutes\n+    time += 10 * 60;\n+    SetMockTime(time);\n+\n+    // Clear nPingNonceSent so we don't disconnect for a ping timeout\n+    dummyNode1.nPingNonceSent = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317053",
      "id" : 548317053,
      "in_reply_to_id" : 548268168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMxNzA1Mw==",
      "original_commit_id" : "a54ba871666ccab23400894832e05a1bb9c53c32",
      "original_line" : 118,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 558270431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-23T23:23:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317053",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317225"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Totally agree! I think #20758 can happen before or after this PR.",
      "commit_id" : "7f736c7df9b83cb3ed94a42678fe4344508d3e73",
      "created_at" : "2020-12-23T23:23:38Z",
      "diff_hunk" : "@@ -217,6 +217,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message on a regular schedule or if requested manually */\n+    void MaybeSendPing(CNode& pto);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317225",
      "id" : 548317225,
      "in_reply_to_id" : 548266275,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMxNzIyNQ==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 558270594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-23T23:23:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317225",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317373"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure. I'll split the commit into a move and a rename/change to reference to make it easier to review.",
      "commit_id" : "7f736c7df9b83cb3ed94a42678fe4344508d3e73",
      "created_at" : "2020-12-23T23:24:14Z",
      "diff_hunk" : "@@ -4076,31 +4076,15 @@ class CompareInvMempoolOrder\n };\n }\n \n-bool PeerManager::SendMessages(CNode* pto)\n+void PeerManager::MaybeSendPing(CNode& pto)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317373",
      "id" : 548317373,
      "in_reply_to_id" : 548265029,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMxNzM3Mw==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 4079,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 558270749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-23T23:24:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317373",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @ajtowns. I'll move the commits around a bit to address your comments.",
      "created_at" : "2020-12-23T23:27:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-750559337",
      "id" : 750559337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDU1OTMzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-23T23:27:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750559337",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
