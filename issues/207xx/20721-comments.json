[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-12-19T13:22:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-748474312",
      "id" : 748474312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODQ3NDMxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-19T13:22:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748474312",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hello John,Is this regarding the request I made yesterday.?\n\nOn Sat, Dec 19, 2020 at 6:26 AM John Newbery <notifications@github.com>\nwrote:\n\n> This continues the work of moving application layer data into\n> net_processing, by moving all ping data into the new Peer object added in\n> #19607 <https://github.com/bitcoin/bitcoin/pull/19607>.\n>\n> For motivation, see #19398\n> <https://github.com/bitcoin/bitcoin/issues/19398>.\n>\n> The first three commits are review suggestions from #19829\n> <https://github.com/bitcoin/bitcoin/pull/19829>.\n> ------------------------------\n> You can view, comment on, or merge this pull request online at:\n>\n>   https://github.com/bitcoin/bitcoin/pull/20721\n> Commit Summary\n>\n>    - [net processing] Add comment about destructing Peer objects\n>    - [net processing] Move nStartingHeight to Peer\n>    - [net processing] Rename nStartingHeight to m_starting_height\n>    - [net processing] Move block inventory data to Peer\n>    - scripted-diff: rename vBlockHashesToAnnounce and\n>    vInventoryBlockToSend\n>    - [net processing] Move hashContinue to net processing\n>    - [net processing] Fix/improve comments for Peer\n>    - [rpc] Fix ordering of fields in getpeerinfo help text\n>    - [net processing] Guard m_hash_continue with m_block_inv_mutex\n>    - [net processing] Move send ping message logic into function\n>    - [net processing] Move ping timeout logic to net processing\n>    - [net processing] Move ping data fields to net processing\n>    - scripted-diff: rename ping members\n>\n> File Changes\n>\n>    - *M* src/net.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-00021eed586a482abdb09d6cdada1d90115abe988a91421851960e26658bed02>\n>    (29)\n>    - *M* src/net.h\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-422879cc8bfac56d4380c865f381b58afeb344bc355bbc7f47c581e4491b6b4b>\n>    (27)\n>    - *M* src/net_processing.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3>\n>    (203)\n>    - *M* src/net_processing.h\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-2a4e846ad2d76a4e7a6f6c46a68b3603de372f435a93b7c0fcabadccc0ed86a5>\n>    (49)\n>    - *M* src/qt/rpcconsole.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-cec3a0a10196329610d46fbd0e01ce6496e5ae9e23c057d8012d48c2f0d3b5c9>\n>    (7)\n>    - *M* src/rpc/net.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-2ae094f9329ce9498e1b4a9cb7767945b54a33b4ee9fed4f0ba401a98e1683c1>\n>    (23)\n>    - *M* src/test/denialofservice_tests.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-a4c9875091483bafb92d8ccaa035dff408a7a5c44e5b4eb55ff51fb0e5112ed2>\n>    (18)\n>\n> Patch Links:\n>\n>    - https://github.com/bitcoin/bitcoin/pull/20721.patch\n>    - https://github.com/bitcoin/bitcoin/pull/20721.diff\n>\n> â\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/20721>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AJ3ZHMLNHNH6WYDANXUXQOLSVSEWZANCNFSM4VCHGLWQ>\n> .\n>\n",
      "created_at" : "2020-12-19T14:16:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-748480409",
      "id" : 748480409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODQ4MDQwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-19T14:16:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748480409",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/41391025?v=4",
         "events_url" : "https://api.github.com/users/sheffine/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sheffine/followers",
         "following_url" : "https://api.github.com/users/sheffine/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sheffine/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sheffine",
         "id" : 41391025,
         "login" : "sheffine",
         "node_id" : "MDQ6VXNlcjQxMzkxMDI1",
         "organizations_url" : "https://api.github.com/users/sheffine/orgs",
         "received_events_url" : "https://api.github.com/users/sheffine/received_events",
         "repos_url" : "https://api.github.com/users/sheffine/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sheffine/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sheffine/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sheffine"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Is it okay for me to go ahead and pull this file. I have no idea with\nregards to whatâs going on and if my request has been completed .\nCan some one give me some answer please\n\nSheffine\n\nOn Sat, Dec 19, 2020 at 6:26 AM John Newbery <notifications@github.com>\nwrote:\n\n> This continues the work of moving application layer data into\n> net_processing, by moving all ping data into the new Peer object added in\n> #19607 <https://github.com/bitcoin/bitcoin/pull/19607>.\n>\n> For motivation, see #19398\n> <https://github.com/bitcoin/bitcoin/issues/19398>.\n>\n> The first three commits are review suggestions from #19829\n> <https://github.com/bitcoin/bitcoin/pull/19829>.\n> ------------------------------\n> You can view, comment on, or merge this pull request online at:\n>\n>   https://github.com/bitcoin/bitcoin/pull/20721\n> Commit Summary\n>\n>    - [net processing] Add comment about destructing Peer objects\n>    - [net processing] Move nStartingHeight to Peer\n>    - [net processing] Rename nStartingHeight to m_starting_height\n>    - [net processing] Move block inventory data to Peer\n>    - scripted-diff: rename vBlockHashesToAnnounce and\n>    vInventoryBlockToSend\n>    - [net processing] Move hashContinue to net processing\n>    - [net processing] Fix/improve comments for Peer\n>    - [rpc] Fix ordering of fields in getpeerinfo help text\n>    - [net processing] Guard m_hash_continue with m_block_inv_mutex\n>    - [net processing] Move send ping message logic into function\n>    - [net processing] Move ping timeout logic to net processing\n>    - [net processing] Move ping data fields to net processing\n>    - scripted-diff: rename ping members\n>\n> File Changes\n>\n>    - *M* src/net.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-00021eed586a482abdb09d6cdada1d90115abe988a91421851960e26658bed02>\n>    (29)\n>    - *M* src/net.h\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-422879cc8bfac56d4380c865f381b58afeb344bc355bbc7f47c581e4491b6b4b>\n>    (27)\n>    - *M* src/net_processing.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3>\n>    (203)\n>    - *M* src/net_processing.h\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-2a4e846ad2d76a4e7a6f6c46a68b3603de372f435a93b7c0fcabadccc0ed86a5>\n>    (49)\n>    - *M* src/qt/rpcconsole.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-cec3a0a10196329610d46fbd0e01ce6496e5ae9e23c057d8012d48c2f0d3b5c9>\n>    (7)\n>    - *M* src/rpc/net.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-2ae094f9329ce9498e1b4a9cb7767945b54a33b4ee9fed4f0ba401a98e1683c1>\n>    (23)\n>    - *M* src/test/denialofservice_tests.cpp\n>    <https://github.com/bitcoin/bitcoin/pull/20721/files#diff-a4c9875091483bafb92d8ccaa035dff408a7a5c44e5b4eb55ff51fb0e5112ed2>\n>    (18)\n>\n> Patch Links:\n>\n>    - https://github.com/bitcoin/bitcoin/pull/20721.patch\n>    - https://github.com/bitcoin/bitcoin/pull/20721.diff\n>\n> â\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/20721>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AJ3ZHMLNHNH6WYDANXUXQOLSVSEWZANCNFSM4VCHGLWQ>\n> .\n>\n",
      "created_at" : "2020-12-20T23:27:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-748686574",
      "id" : 748686574,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODY4NjU3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-20T23:27:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748686574",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/41391025?v=4",
         "events_url" : "https://api.github.com/users/sheffine/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sheffine/followers",
         "following_url" : "https://api.github.com/users/sheffine/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sheffine/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sheffine",
         "id" : 41391025,
         "login" : "sheffine",
         "node_id" : "MDQ6VXNlcjQxMzkxMDI1",
         "organizations_url" : "https://api.github.com/users/sheffine/orgs",
         "received_events_url" : "https://api.github.com/users/sheffine/received_events",
         "repos_url" : "https://api.github.com/users/sheffine/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sheffine/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sheffine/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sheffine"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sheffine You seem pretty confused, and I have no idea what you're trying to do. This is the discussion page for a proposed change to the Bitcoin Core software project, and your comments seem unrelated. Please stop.",
      "created_at" : "2020-12-21T03:31:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-748737513",
      "id" : 748737513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODczNzUxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-21T03:31:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748737513",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master. This is now ready for review.",
      "created_at" : "2020-12-22T13:46:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-749547642",
      "id" : 749547642,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0OTU0NzY0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-22T13:46:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/749547642",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548265029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548265029"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you're changing every reference to `pto` anyway because it's now a reference not a pointer, maybe also call it `node_to` or similar, since it's not a \"p\" anymore?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-23T21:43:57Z",
      "diff_hunk" : "@@ -4076,31 +4076,15 @@ class CompareInvMempoolOrder\n };\n }\n \n-bool PeerManager::SendMessages(CNode* pto)\n+void PeerManager::MaybeSendPing(CNode& pto)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548265029",
      "id" : 548265029,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI2NTAyOQ==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 4079,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 558241240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548265029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548266275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548266275"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think exposing more implementation details in net_processing.h is a good idea. Fortunately it's fixable: #20758 ",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-23T21:45:34Z",
      "diff_hunk" : "@@ -217,6 +217,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message on a regular schedule or if requested manually */\n+    void MaybeSendPing(CNode& pto);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548266275",
      "id" : 548266275,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI2NjI3NQ==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 558241240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548266275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548268168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548268168"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Move the test change to its own commit so it's easy to verify behaviour doesn't change with the move logic to net_processing commit? I don't follow why the test change is necessary/desirable though.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-23T21:48:14Z",
      "diff_hunk" : "@@ -109,9 +109,17 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n         dummyNode1.vSendMsg.clear();\n     }\n \n-    int64_t nStartTime = GetTime();\n-    // Wait 21 minutes\n-    SetMockTime(nStartTime+21*60);\n+    int64_t time{GetTime()};\n+    // Wait 10 minutes\n+    time += 10 * 60;\n+    SetMockTime(time);\n+\n+    // Clear nPingNonceSent so we don't disconnect for a ping timeout\n+    dummyNode1.nPingNonceSent = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548268168",
      "id" : 548268168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI2ODE2OA==",
      "original_commit_id" : "a54ba871666ccab23400894832e05a1bb9c53c32",
      "original_line" : 118,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 558241240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548268168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21015 (Make all of net_processing (and some of net) use std::chrono types by dhruv)\n* #20925 (RFC: Move Peer and PeerManagerImpl declarations to separate header by jnewbery)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-12-23T21:54:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-750488019",
      "id" : 750488019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDQ4ODAxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-05T18:28:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750488019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> \"jnewbery deleted a comment from sipa 3 days ago\" ?\r\n\r\nha. There were two comments from sheffine saying \"why are you emailing me?\" and one from sipa saying \"sheffine, you're confused\", so I deleted them all to reduce noise.",
      "created_at" : "2020-12-23T22:19:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-750494700",
      "id" : 750494700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDQ5NDcwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-23T22:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750494700",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Censorship!!!\n\n(yes, that's indeed what happened)",
      "created_at" : "2020-12-23T22:20:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-750495167",
      "id" : 750495167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDQ5NTE2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-23T22:20:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750495167",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317053"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Move the test change to its own commit so it's easy to verify behaviour doesn't change\r\n\r\ngood idea. Will do.\r\n\r\n> I don't follow why the test change is necessary/desirable though.\r\n\r\nThe change is required because previously ping timeouts happened in in CConnman, so it was fine to bump the time in this test because there's no CConnman to time out the connection. When the ping data and timout logic is moved to PeerManager, then the connection times out in this test if you bump the time forwards by 21 minutes without resetting the ping nonce.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-23T23:22:51Z",
      "diff_hunk" : "@@ -109,9 +109,17 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n         dummyNode1.vSendMsg.clear();\n     }\n \n-    int64_t nStartTime = GetTime();\n-    // Wait 21 minutes\n-    SetMockTime(nStartTime+21*60);\n+    int64_t time{GetTime()};\n+    // Wait 10 minutes\n+    time += 10 * 60;\n+    SetMockTime(time);\n+\n+    // Clear nPingNonceSent so we don't disconnect for a ping timeout\n+    dummyNode1.nPingNonceSent = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317053",
      "id" : 548317053,
      "in_reply_to_id" : 548268168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMxNzA1Mw==",
      "original_commit_id" : "a54ba871666ccab23400894832e05a1bb9c53c32",
      "original_line" : 118,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 558270431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317225"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Totally agree! I think #20758 can happen before or after this PR.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-23T23:23:38Z",
      "diff_hunk" : "@@ -217,6 +217,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message on a regular schedule or if requested manually */\n+    void MaybeSendPing(CNode& pto);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317225",
      "id" : 548317225,
      "in_reply_to_id" : 548266275,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMxNzIyNQ==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 558270594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317373"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure. I'll split the commit into a move and a rename/change to reference to make it easier to review.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-23T23:24:14Z",
      "diff_hunk" : "@@ -4076,31 +4076,15 @@ class CompareInvMempoolOrder\n };\n }\n \n-bool PeerManager::SendMessages(CNode* pto)\n+void PeerManager::MaybeSendPing(CNode& pto)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548317373",
      "id" : 548317373,
      "in_reply_to_id" : 548265029,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMxNzM3Mw==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 4079,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 558270749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548317373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @ajtowns. I'll move the commits around a bit to address your comments.",
      "created_at" : "2020-12-23T23:27:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-750559337",
      "id" : 750559337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MDU1OTMzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-23T23:27:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/750559337",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548357896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548357896"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I don't think either need gate the other, the above was literally my thought process in getting to that PR -- sipa may not have nerd sniped me with twitter maths, but that doesn't mean I didn't get nerd sniped anyway...",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-24T02:47:29Z",
      "diff_hunk" : "@@ -217,6 +217,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message on a regular schedule or if requested manually */\n+    void MaybeSendPing(CNode& pto);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548357896",
      "id" : 548357896,
      "in_reply_to_id" : 548266275,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM1Nzg5Ng==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 558311099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548357896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548362767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548362767"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Makes sense; might be a useful commit message for the test change?\r\n\r\nSeems kind-of annoying to have to remember to constrain your mocktime bumps by random ping timeout limits. Shouldn't this also (already) cause problems in functional tests?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-24T03:11:43Z",
      "diff_hunk" : "@@ -109,9 +109,17 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n         dummyNode1.vSendMsg.clear();\n     }\n \n-    int64_t nStartTime = GetTime();\n-    // Wait 21 minutes\n-    SetMockTime(nStartTime+21*60);\n+    int64_t time{GetTime()};\n+    // Wait 10 minutes\n+    time += 10 * 60;\n+    SetMockTime(time);\n+\n+    // Clear nPingNonceSent so we don't disconnect for a ping timeout\n+    dummyNode1.nPingNonceSent = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548362767",
      "id" : 548362767,
      "in_reply_to_id" : 548268168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM2Mjc2Nw==",
      "original_commit_id" : "a54ba871666ccab23400894832e05a1bb9c53c32",
      "original_line" : 118,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 558316103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548362767",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548363032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548363032"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This seems like a more productive form of aj-sniping.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-24T03:13:14Z",
      "diff_hunk" : "@@ -217,6 +217,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message on a regular schedule or if requested manually */\n+    void MaybeSendPing(CNode& pto);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548363032",
      "id" : 548363032,
      "in_reply_to_id" : 548266275,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM2MzAzMg==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 558316396,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548363032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548586608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548586608"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The functional tests have an asyncio event loop thread that will automatically respond to ping messages:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/f656165e9c0d09e654efabd56e6581638e35c26c/test/functional/test_framework/p2p.py#L392-L393\r\n\r\nThe unit tests are single threaded, so any logic to handle messages needs to be done in the main test logic.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-24T16:10:02Z",
      "diff_hunk" : "@@ -109,9 +109,17 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n         dummyNode1.vSendMsg.clear();\n     }\n \n-    int64_t nStartTime = GetTime();\n-    // Wait 21 minutes\n-    SetMockTime(nStartTime+21*60);\n+    int64_t time{GetTime()};\n+    // Wait 10 minutes\n+    time += 10 * 60;\n+    SetMockTime(time);\n+\n+    // Clear nPingNonceSent so we don't disconnect for a ping timeout\n+    dummyNode1.nPingNonceSent = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548586608",
      "id" : 548586608,
      "in_reply_to_id" : 548268168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODU4NjYwOA==",
      "original_commit_id" : "a54ba871666ccab23400894832e05a1bb9c53c32",
      "original_line" : 118,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 558675860,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548586608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548593918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548593918"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-24T16:20:47Z",
      "diff_hunk" : "@@ -4076,31 +4076,15 @@ class CompareInvMempoolOrder\n };\n }\n \n-bool PeerManager::SendMessages(CNode* pto)\n+void PeerManager::MaybeSendPing(CNode& pto)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548593918",
      "id" : 548593918,
      "in_reply_to_id" : 548265029,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODU5MzkxOA==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 4079,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 558678259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548593918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548596150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548596150"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I like this kind of aj-sniping.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-24T16:24:04Z",
      "diff_hunk" : "@@ -217,6 +217,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message on a regular schedule or if requested manually */\n+    void MaybeSendPing(CNode& pto);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548596150",
      "id" : 548596150,
      "in_reply_to_id" : 548266275,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODU5NjE1MA==",
      "original_commit_id" : "cc0e0fc8d054d3a331256dd65a794174ad39fe3d",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 558678955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548596150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548596374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548596374"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok, split this into its own commit.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-24T16:24:19Z",
      "diff_hunk" : "@@ -109,9 +109,17 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n         dummyNode1.vSendMsg.clear();\n     }\n \n-    int64_t nStartTime = GetTime();\n-    // Wait 21 minutes\n-    SetMockTime(nStartTime+21*60);\n+    int64_t time{GetTime()};\n+    // Wait 10 minutes\n+    time += 10 * 60;\n+    SetMockTime(time);\n+\n+    // Clear nPingNonceSent so we don't disconnect for a ping timeout\n+    dummyNode1.nPingNonceSent = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r548596374",
      "id" : 548596374,
      "in_reply_to_id" : 548268168,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODU5NjM3NA==",
      "original_commit_id" : "a54ba871666ccab23400894832e05a1bb9c53c32",
      "original_line" : 118,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 558679026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/548596374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549455568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549455568"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Noob / practices question: why not just create this with a `bool` return type, since you change it 3 commits later? I don't have an opinion, but why is it better to do it this way?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-28T19:06:12Z",
      "diff_hunk" : "@@ -217,6 +217,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message on a regular schedule or if requested manually */\n+    void MaybeSendPing(CNode* pto);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549455568",
      "id" : 549455568,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ1NTU2OA==",
      "original_commit_id" : "9466feef40aec209c2a3975fa04e75e0f90f42b5",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 559267216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549455568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549486291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549486291"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Genuine question, why should best ping time be in `CNode` but all the others in `Peer`? We use best ping time for eviction logic which seems like an application-layer thing...",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-28T21:04:07Z",
      "diff_hunk" : "@@ -1048,17 +1046,7 @@ class CNode\n      * in CConnman::AttemptToEvictConnection. */\n     std::atomic<int64_t> nLastTXTime{0};\n \n-    // Ping time measurement:\n-    // The pong reply we're expecting, or 0 if no pong expected.\n-    std::atomic<uint64_t> nPingNonceSent{0};\n-    /** When the last ping was sent, or 0 if no ping was ever sent */\n-    std::atomic<std::chrono::microseconds> m_ping_start{0us};\n-    // Last measured round-trip time.\n-    std::atomic<int64_t> nPingUsecTime{0};\n-    // Best measured round-trip time.\n     std::atomic<int64_t> nMinPingUsecTime{std::numeric_limits<int64_t>::max()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549486291",
      "id" : 549486291,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ4NjI5MQ==",
      "original_commit_id" : "2c1c3ec6e4e55c53157ec80f192331044e19d73d",
      "original_line" : 1049,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 559267216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549486291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549492180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549492180"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since you removed this, `CNodeStats` doesn't know min ping time anymore. The p2p_eviction and p2p_ping functional tests fail since `getpeerinfo()` always returns 0 for minping :(\r\n\r\nAdding it back fixed the tests for me:\r\n```c\r\nstats.m_min_ping_usec  = m_best_ping_time;\r\n```",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-28T21:28:04Z",
      "diff_hunk" : "@@ -609,22 +609,6 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n         stats.minFeeFilter = 0;\n     }\n \n-    // It is common for nodes with good ping times to suddenly become lagged,\n-    // due to a new block arriving or other large transfer.\n-    // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n-    // since pingtime does not update until the ping is complete, which might take a while.\n-    // So, if a ping is taking an unusually long time in flight,\n-    // the caller can immediately detect that this is happening.\n-    std::chrono::microseconds ping_wait{0};\n-    if ((0 != nPingNonceSent) && (0 != m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - m_ping_start.load();\n-    }\n-\n-    // Raw ping time is in microseconds, but show it to user as whole seconds (Bitcoin users should be well used to small numbers with many decimal places by now :)\n-    stats.m_ping_usec = nPingUsecTime;\n-    stats.m_min_ping_usec  = nMinPingUsecTime;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549492180",
      "id" : 549492180,
      "line" : 614,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ5MjE4MA==",
      "original_commit_id" : "2c1c3ec6e4e55c53157ec80f192331044e19d73d",
      "original_line" : 614,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 17,
      "pull_request_review_id" : 559267216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549492180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549497650"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549497650"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh hey, if s/m_min_ping_usec/m_best_ping_time then\r\n```\r\nX(m_best_ping_time);\r\n```\r\n(wow so clean)",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-28T21:50:35Z",
      "diff_hunk" : "@@ -609,22 +609,6 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n         stats.minFeeFilter = 0;\n     }\n \n-    // It is common for nodes with good ping times to suddenly become lagged,\n-    // due to a new block arriving or other large transfer.\n-    // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n-    // since pingtime does not update until the ping is complete, which might take a while.\n-    // So, if a ping is taking an unusually long time in flight,\n-    // the caller can immediately detect that this is happening.\n-    std::chrono::microseconds ping_wait{0};\n-    if ((0 != nPingNonceSent) && (0 != m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - m_ping_start.load();\n-    }\n-\n-    // Raw ping time is in microseconds, but show it to user as whole seconds (Bitcoin users should be well used to small numbers with many decimal places by now :)\n-    stats.m_ping_usec = nPingUsecTime;\n-    stats.m_min_ping_usec  = nMinPingUsecTime;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549497650",
      "id" : 549497650,
      "in_reply_to_id" : 549492180,
      "line" : 614,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ5NzY1MA==",
      "original_commit_id" : "2c1c3ec6e4e55c53157ec80f192331044e19d73d",
      "original_line" : 614,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 17,
      "pull_request_review_id" : 559313840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549497650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549501774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549501774"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    std::atomic<int64_t> m_min_ping_time{std::numeric_limits<int64_t>::max()};\r\n```\r\nI think renaming from \"min\" to \"best\" needlessly sows confusion or more needed code churn for no gain:\r\n\r\n- \"min\" is more precise than \"best\" (best how?)\r\n- getpeerinfo and its help, -netinfo and its new help (#20764), and the GUI refer to \"min ping\", \"Min Ping\", \"mping\", \"minimum observed ping time\". Updating all of them would create unneeded churn; not updating them would create unnecessary confusion.\r\n",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-28T22:07:34Z",
      "diff_hunk" : "@@ -1048,17 +1046,7 @@ class CNode\n      * in CConnman::AttemptToEvictConnection. */\n     std::atomic<int64_t> nLastTXTime{0};\n \n-    // Ping time measurement:\n-    // The pong reply we're expecting, or 0 if no pong expected.\n-    std::atomic<uint64_t> nPingNonceSent{0};\n-    /** When the last ping was sent, or 0 if no ping was ever sent */\n-    std::atomic<std::chrono::microseconds> m_ping_start{0us};\n-    // Last measured round-trip time.\n-    std::atomic<int64_t> nPingUsecTime{0};\n-    // Best measured round-trip time.\n-    std::atomic<int64_t> nMinPingUsecTime{std::numeric_limits<int64_t>::max()};\n-    // Whether a ping is requested.\n-    std::atomic<bool> fPingQueued{false};\n+    std::atomic<int64_t> m_best_ping_time{std::numeric_limits<int64_t>::max()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549501774",
      "id" : 549501774,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTUwMTc3NA==",
      "original_commit_id" : "6f0309b4743d05c512fc86d2d206f72d512c5c93",
      "original_line" : 1049,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 559317841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549501774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549502248"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549502248"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you use named casts in lines 234 and 237 while touching this code?\r\n\r\nhttps://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines.html#Res-casts-named\r\n",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-28T22:09:48Z",
      "diff_hunk" : "@@ -237,6 +230,12 @@ static RPCHelpMan getpeerinfo()\n                 heights.push_back(height);\n             }\n             obj.pushKV(\"inflight\", heights);\n+            if (statestats.m_ping_usec > 0) {\n+                obj.pushKV(\"pingtime\", ((double)statestats.m_ping_usec) / 1e6);\n+            }\n+            if (statestats.m_ping_wait_usec > 0) {\n+                obj.pushKV(\"pingwait\", ((double)statestats.m_ping_wait_usec) / 1e6);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549502248",
      "id" : 549502248,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTUwMjI0OA==",
      "original_commit_id" : "6f0309b4743d05c512fc86d2d206f72d512c5c93",
      "original_line" : 228,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 559317841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549502248",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-12-28T23:05:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-751890762",
      "id" : 751890762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MTg5MDc2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-28T23:05:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/751890762",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549648962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549648962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just so that the commits are hygienic. For people reviewing commit by commit, it wouldn't make sense to have a function that returns a bool which is just ignored. Changing the return type in a subsequent commit is as easy as changing void to bool in the declaration and definition.\r\n\r\nI was considering not returning a bool here, since it's a bit of a strange interface (the function sets `pto.fDisconnect` _and_ returns false. Perhaps it should stay as returning `void`, and have `SendMessages()` check for `fDisconnect` after calling this function?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-29T10:16:40Z",
      "diff_hunk" : "@@ -217,6 +217,9 @@ class PeerManager final : public CValidationInterface, public NetEventsInterface\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message on a regular schedule or if requested manually */\n+    void MaybeSendPing(CNode* pto);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549648962",
      "id" : 549648962,
      "in_reply_to_id" : 549455568,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0ODk2Mg==",
      "original_commit_id" : "9466feef40aec209c2a3975fa04e75e0f90f42b5",
      "original_line" : 221,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 559465988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549648962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549656149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549656149"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch! I lost this in a rebase. I've now restored it.\r\n\r\nI'm going to leave the `m_min_ping_usec` name to avoid increasing the diff further.\r\n",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-29T10:39:21Z",
      "diff_hunk" : "@@ -609,22 +609,6 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n         stats.minFeeFilter = 0;\n     }\n \n-    // It is common for nodes with good ping times to suddenly become lagged,\n-    // due to a new block arriving or other large transfer.\n-    // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n-    // since pingtime does not update until the ping is complete, which might take a while.\n-    // So, if a ping is taking an unusually long time in flight,\n-    // the caller can immediately detect that this is happening.\n-    std::chrono::microseconds ping_wait{0};\n-    if ((0 != nPingNonceSent) && (0 != m_ping_start.load().count())) {\n-        ping_wait = GetTime<std::chrono::microseconds>() - m_ping_start.load();\n-    }\n-\n-    // Raw ping time is in microseconds, but show it to user as whole seconds (Bitcoin users should be well used to small numbers with many decimal places by now :)\n-    stats.m_ping_usec = nPingUsecTime;\n-    stats.m_min_ping_usec  = nMinPingUsecTime;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549656149",
      "id" : 549656149,
      "in_reply_to_id" : 549492180,
      "line" : 614,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1NjE0OQ==",
      "original_commit_id" : "2c1c3ec6e4e55c53157ec80f192331044e19d73d",
      "original_line" : 614,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 17,
      "pull_request_review_id" : 559474533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549656149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549656532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549656532"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree. I've changed it to `m_min_ping_time` (it's still code churn since it was previously named `nMinPingUsecTime`, but I agree with you about the consistent naming).",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-29T10:40:47Z",
      "diff_hunk" : "@@ -1048,17 +1046,7 @@ class CNode\n      * in CConnman::AttemptToEvictConnection. */\n     std::atomic<int64_t> nLastTXTime{0};\n \n-    // Ping time measurement:\n-    // The pong reply we're expecting, or 0 if no pong expected.\n-    std::atomic<uint64_t> nPingNonceSent{0};\n-    /** When the last ping was sent, or 0 if no ping was ever sent */\n-    std::atomic<std::chrono::microseconds> m_ping_start{0us};\n-    // Last measured round-trip time.\n-    std::atomic<int64_t> nPingUsecTime{0};\n-    // Best measured round-trip time.\n-    std::atomic<int64_t> nMinPingUsecTime{std::numeric_limits<int64_t>::max()};\n-    // Whether a ping is requested.\n-    std::atomic<bool> fPingQueued{false};\n+    std::atomic<int64_t> m_best_ping_time{std::numeric_limits<int64_t>::max()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549656532",
      "id" : 549656532,
      "in_reply_to_id" : 549501774,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1NjUzMg==",
      "original_commit_id" : "6f0309b4743d05c512fc86d2d206f72d512c5c93",
      "original_line" : 1049,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 559474998,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549656532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549660285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549660285"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd rather not change this while moving it. There's another C-style cast from int64_t to double on line 206. Let's fix them all at the same time.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-29T10:53:31Z",
      "diff_hunk" : "@@ -237,6 +230,12 @@ static RPCHelpMan getpeerinfo()\n                 heights.push_back(height);\n             }\n             obj.pushKV(\"inflight\", heights);\n+            if (statestats.m_ping_usec > 0) {\n+                obj.pushKV(\"pingtime\", ((double)statestats.m_ping_usec) / 1e6);\n+            }\n+            if (statestats.m_ping_wait_usec > 0) {\n+                obj.pushKV(\"pingwait\", ((double)statestats.m_ping_wait_usec) / 1e6);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549660285",
      "id" : 549660285,
      "in_reply_to_id" : 549502248,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY2MDI4NQ==",
      "original_commit_id" : "6f0309b4743d05c512fc86d2d206f72d512c5c93",
      "original_line" : 228,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 559479548,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549660285",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the reviews, @glozow and @jonatack. I've addressed your comments: https://github.com/bitcoin/bitcoin/compare/6f0309b4743d05c512fc86d2d206f72d512c5c93..d666804b7b2d5006c37b86f5f88e344216ad0862.",
      "created_at" : "2020-12-29T10:56:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-752034748",
      "id" : 752034748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MjAzNDc0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-29T10:56:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752034748",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2020-12-29T11:01:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-752036122",
      "id" : 752036122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MjAzNjEyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-29T11:01:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752036122",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Genuine question, why should best ping time be in CNode but all the others in Peer? We use best ping time for eviction logic which seems like an application-layer thing...\r\n\r\nThis is a very good question. I haven't specified the difference between connection-layer and application-layer well enough with respect to ping times.\r\n\r\nFunctionally, ping times are used in two places: timeout logic and eviction logic (they're also presented to the user through the RPC and GUI, but that doesn't affect what follows). \r\n\r\n##### Timeout logic\r\n\r\nThere's timeout logic in the connection layer (in `InactivityCheck()`), which should detect when there's a problem with the connection, such as:\r\n\r\n- no bytes being sent or received on the connection\r\n- a connection is opened, but no application data received.\r\n\r\nThere's also timeout logic in the application layer, such as here:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/f1f26b8d5baec4a45a3a9ba0440cd4eff7af8407/src/net_processing.cpp#L4527-L4528\r\n\r\nwhere we detect if block download has timed out. Ping timeouts belong in the application layer, since failing to respond to a ping message with a pong message is a P2P protocol violation. However, that ping timeout logic has previously existed in net.cpp because the ping data existed in CNode. In this PR, we move the ping timout logic to the application layer, where it logically belongs. This logic requires the `nPingNonceSent`, `m_ping_start` and `fPingQueued` data to be in the net_processing layer.\r\n\r\n(You may be asking the question: \"isn't the connection layer timeout logic somewhat redundant with the ping timeout logic?\" and you'd be right - if pings are not timing out, then we must be sending/receiving data from the peer, so the connection cannot time out. However, a bit of redundancy here is fine - the net layer is responsible for maintaining the data connection, and the net_processing layer is responsible for maintaining the p2p protocol peering.)\r\n\r\n##### Inbound eviction logic\r\n\r\nThis exists entirely in the connection layer, in `CConnman::AttemptToEvictConnection()`. It requires data from both the connection layer (e.g. connection time, connection type, whether the connection is local, etc) and from the application layer (e.g. last block received time, last tx received time, etc). For that to work, the application layer must inform the connection layer of events, such as a valid tx received, a valid block received, and (now) a valid pong received, and the connection layer must store that data (as `nLastBlockTime`, `nLastTXTime` and `m_min_ping_time`) for use in the eviction logic. We could group those members in a structure called `EvictionCriteria` or similar to make it clearer what they're used for. For now, I've just expanded the comment for `m_min_ping_time`.\r\n\r\nWriting this has made me realize that `nPingUsecTime` should probably stay in `CNode`, since it doesn't need to be used for any application logic. I've done that in the latest force-push.",
      "created_at" : "2020-12-29T12:05:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-752052378",
      "id" : 752052378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MjA1MjM3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-29T12:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752052378",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549679809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549679809"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Answered here: https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-752052378",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2020-12-29T12:05:25Z",
      "diff_hunk" : "@@ -1048,17 +1046,7 @@ class CNode\n      * in CConnman::AttemptToEvictConnection. */\n     std::atomic<int64_t> nLastTXTime{0};\n \n-    // Ping time measurement:\n-    // The pong reply we're expecting, or 0 if no pong expected.\n-    std::atomic<uint64_t> nPingNonceSent{0};\n-    /** When the last ping was sent, or 0 if no ping was ever sent */\n-    std::atomic<std::chrono::microseconds> m_ping_start{0us};\n-    // Last measured round-trip time.\n-    std::atomic<int64_t> nPingUsecTime{0};\n-    // Best measured round-trip time.\n     std::atomic<int64_t> nMinPingUsecTime{std::numeric_limits<int64_t>::max()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r549679809",
      "id" : 549679809,
      "in_reply_to_id" : 549486291,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY3OTgwOQ==",
      "original_commit_id" : "2c1c3ec6e4e55c53157ec80f192331044e19d73d",
      "original_line" : 1049,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 559503127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549679809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ping timeouts are being triggered on feature_bip68_sequence.py test when run on cirrus. That test uses lots of mocktime jumps, so it's not surprising. I'll see if there's a way to make sure that pings don't timeout when using mocktime.",
      "created_at" : "2020-12-29T19:58:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-752222792",
      "id" : 752222792,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MjIyMjc5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-29T19:58:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752222792",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This exists entirely in the connection layer, in `CConnman::AttemptToEvictConnection()`. It requires data from both the connection layer (e.g. connection time, connection type, whether the connection is local, etc)\r\n\r\nNot convinced that makes sense -- \"connection type\" and \"how many local connections to evict\" both seem like application logic to me. I was certainly expecting `m_conn_type` to eventually make its way into net_processing, given it deals with message types (block/tx relay/addrfetch/feeler) and trust issues (inbound/outbound/manual) which are all application level concepts.",
      "created_at" : "2020-12-30T03:11:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-752311889",
      "id" : 752311889,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MjMxMTg4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-30T03:11:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/752311889",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-01-02T09:09:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-753450336",
      "id" : 753450336,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MzQ1MDMzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-02T09:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/753450336",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm going to hold off rebasing this until https://github.com/bitcoin/bitcoin/pull/20811 lands. Once #20811 is merged, we'll be able to continue this series of PRs with much less churn in the header files. Marking as draft for now.",
      "created_at" : "2021-01-02T09:46:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-753453152",
      "id" : 753453152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MzQ1MzE1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-07T19:48:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/753453152",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've rebased on master now that #20811 is merge and added a (hidden) `-pingtimeout` option which avoids having to expose `Peer` to the tests.\r\n\r\nThere are still a couple of tests timing out, which I'll fix up next.",
      "created_at" : "2021-01-13T14:30:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-759485838",
      "id" : 759485838,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1OTQ4NTgzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-13T14:30:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759485838",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm going to leave this as WIP for now. I think #20927 should go in before this to make review of this PR easier. Please review that PR first.",
      "created_at" : "2021-01-13T16:40:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-759572472",
      "id" : 759572472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1OTU3MjQ3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-13T16:40:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/759572472",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r557610974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557610974"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: docs specify minimum is 1, but it seems here min is 0?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-01-14T18:42:13Z",
      "diff_hunk" : "@@ -1143,6 +1144,10 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n         return InitError(Untranslated(\"peertimeout cannot be configured with a negative value.\"));\n     }\n \n+    if (args.GetArg(\"-pingtimeout\", TIMEOUT_INTERVAL) <= 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r557610974",
      "id" : 557610974,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzYxMDk3NA==",
      "original_commit_id" : "eddbcc18b4fc81c0092f7a167e8b5677b683213f",
      "original_line" : 1148,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 568519172,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557610974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7217256?v=4",
         "events_url" : "https://api.github.com/users/mjdietzx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mjdietzx/followers",
         "following_url" : "https://api.github.com/users/mjdietzx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mjdietzx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mjdietzx",
         "id" : 7217256,
         "login" : "mjdietzx",
         "node_id" : "MDQ6VXNlcjcyMTcyNTY=",
         "organizations_url" : "https://api.github.com/users/mjdietzx/orgs",
         "received_events_url" : "https://api.github.com/users/mjdietzx/received_events",
         "repos_url" : "https://api.github.com/users/mjdietzx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mjdietzx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mjdietzx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r558839703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558839703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This error condition is hit if `pingtimeout` is set to 0.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-01-16T10:56:34Z",
      "diff_hunk" : "@@ -1143,6 +1144,10 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n         return InitError(Untranslated(\"peertimeout cannot be configured with a negative value.\"));\n     }\n \n+    if (args.GetArg(\"-pingtimeout\", TIMEOUT_INTERVAL) <= 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r558839703",
      "id" : 558839703,
      "in_reply_to_id" : 557610974,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODgzOTcwMw==",
      "original_commit_id" : "eddbcc18b4fc81c0092f7a167e8b5677b683213f",
      "original_line" : 1148,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 569900170,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/558839703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed a fix for the intermittent ping timeout in wallet_resendwallettransactions.py",
      "created_at" : "2021-01-16T11:04:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-761544843",
      "id" : 761544843,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MTU0NDg0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-16T11:04:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/761544843",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master. All tests are now passing for me locally. Marking this as ready for review.",
      "created_at" : "2021-01-23T11:14:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-765907224",
      "id" : 765907224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NTkwNzIyNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-23T11:14:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/765907224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-01-29T08:11:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-769649943",
      "id" : 769649943,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTY0OTk0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-29T08:11:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769649943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-01-29T09:25:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-769687320",
      "id" : 769687320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTY4NzMyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-29T09:25:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769687320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r567464686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567464686"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Are cases where the response is malformed (e.g. user inputs a string instead of a number) handled elsewhere?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-01-31T18:26:50Z",
      "diff_hunk" : "@@ -1144,6 +1145,10 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n         return InitError(Untranslated(\"peertimeout cannot be configured with a negative value.\"));\n     }\n \n+    if (args.GetArg(\"-pingtimeout\", TIMEOUT_INTERVAL) <= 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r567464686",
      "id" : 567464686,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzQ2NDY4Ng==",
      "original_commit_id" : "2cfa278c355f22d9396b58d346f2c485e8763bfb",
      "original_line" : 1148,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 579920941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567464686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/708562?v=4",
         "events_url" : "https://api.github.com/users/murtyjones/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murtyjones/followers",
         "following_url" : "https://api.github.com/users/murtyjones/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murtyjones/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murtyjones",
         "id" : 708562,
         "login" : "murtyjones",
         "node_id" : "MDQ6VXNlcjcwODU2Mg==",
         "organizations_url" : "https://api.github.com/users/murtyjones/orgs",
         "received_events_url" : "https://api.github.com/users/murtyjones/received_events",
         "repos_url" : "https://api.github.com/users/murtyjones/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murtyjones/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murtyjones/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murtyjones"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r567465455"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567465455"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Are the inner sets of parenthesis required or is this a code-style thing?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-01-31T18:33:03Z",
      "diff_hunk" : "@@ -1060,6 +1072,18 @@ bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats)\n     PeerRef peer = GetPeerRef(nodeid);\n     if (peer == nullptr) return false;\n     stats.m_starting_height = peer->m_starting_height;\n+    // It is common for nodes with good ping times to suddenly become lagged,\n+    // due to a new block arriving or other large transfer.\n+    // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n+    // since pingtime does not update until the ping is complete, which might take a while.\n+    // So, if a ping is taking an unusually long time in flight,\n+    // the caller can immediately detect that this is happening.\n+    std::chrono::microseconds ping_wait{0};\n+    if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r567465455",
      "id" : 567465455,
      "line" : 1082,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzQ2NTQ1NQ==",
      "original_commit_id" : "2cfa278c355f22d9396b58d346f2c485e8763bfb",
      "original_line" : 1082,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 44,
      "pull_request_review_id" : 579921461,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567465455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/708562?v=4",
         "events_url" : "https://api.github.com/users/murtyjones/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murtyjones/followers",
         "following_url" : "https://api.github.com/users/murtyjones/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murtyjones/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murtyjones",
         "id" : 708562,
         "login" : "murtyjones",
         "node_id" : "MDQ6VXNlcjcwODU2Mg==",
         "organizations_url" : "https://api.github.com/users/murtyjones/orgs",
         "received_events_url" : "https://api.github.com/users/murtyjones/received_events",
         "repos_url" : "https://api.github.com/users/murtyjones/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murtyjones/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murtyjones/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murtyjones"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r567520925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567520925"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    // Don't let pings time out due to mocktime\r\n```",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-01T01:34:46Z",
      "diff_hunk" : "@@ -83,6 +83,9 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n     auto peerLogic = PeerManager::make(chainparams, *connman, nullptr, *m_node.scheduler,\n                                        *m_node.chainman, *m_node.mempool, false);\n \n+    // Don't let pings time out",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r567520925",
      "id" : 567520925,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUyMDkyNQ==",
      "original_commit_id" : "9099ee6f6b5102a5cb71f3b6f0c8322ed3003286",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 579965301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567520925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r567521625"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567521625"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "(Rookie question) Would the previous commit(9ad48f3965a32a6eba67ba49da19499fbe9b89e3) change anything with respect to mocktime unless `-pingtimeout` is used?  If not, why did some tests start to fail due to ping timeouts?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-01T01:38:00Z",
      "diff_hunk" : "@@ -33,6 +33,7 @@ def set_test_params(self):\n             [\n                 \"-acceptnonstdtxn=1\",\n                 \"-peertimeout=9999\",  # bump because mocktime might cause a disconnect otherwise\n+                \"-pingtimeout=9999\",  # bump because mocktime might cause a disconnect otherwise",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r567521625",
      "id" : 567521625,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUyMTYyNQ==",
      "original_commit_id" : "9099ee6f6b5102a5cb71f3b6f0c8322ed3003286",
      "original_line" : 36,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/feature_bip68_sequence.py",
      "position" : null,
      "pull_request_review_id" : 579965301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567521625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568013403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568013403"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    /** Send a ping message every PING_INTERVAL or if requested via rpc. Disconnect\r\n     * the peer if a ping has timed out. Return true upon disconnection. */\r\n    [[nodiscard]] bool ManagePing(CNode& node_to);\r\n```",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-01T17:38:52Z",
      "diff_hunk" : "@@ -315,7 +315,8 @@ class PeerManagerImpl final : public PeerManager\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n-    /** Send a ping message on a regular schedule or if requested manually */\n+    /** Send a ping message on a regular schedule or if requested manually. May\n+     *  disconnect the peer if a ping has timed out. */\n     void MaybeSendPing(CNode& node_to);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568013403",
      "id" : 568013403,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODAxMzQwMw==",
      "original_commit_id" : "f53ee86f489ba3f6e3c12edea1d869135c2c2dcf",
      "original_line" : 320,
      "original_position" : 7,
      "original_start_line" : 318,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579965301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568013403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568643037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568643037"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, these aren't required. In C++ `&&` has a lower precedence than `!=` so the parens aren't changing the order of operations (https://en.cppreference.com/w/cpp/language/operator_precedence). They're not doing any harm either.\r\n\r\nThis code is moved unaltered in this PR. I think it's fine to keep it as it is.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-02T14:27:15Z",
      "diff_hunk" : "@@ -1060,6 +1072,18 @@ bool PeerManagerImpl::GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats)\n     PeerRef peer = GetPeerRef(nodeid);\n     if (peer == nullptr) return false;\n     stats.m_starting_height = peer->m_starting_height;\n+    // It is common for nodes with good ping times to suddenly become lagged,\n+    // due to a new block arriving or other large transfer.\n+    // Merely reporting pingtime might fool the caller into thinking the node was still responsive,\n+    // since pingtime does not update until the ping is complete, which might take a while.\n+    // So, if a ping is taking an unusually long time in flight,\n+    // the caller can immediately detect that this is happening.\n+    std::chrono::microseconds ping_wait{0};\n+    if ((0 != peer->m_ping_nonce_sent) && (0 != peer->m_ping_start.load().count())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568643037",
      "id" : 568643037,
      "in_reply_to_id" : 567465455,
      "line" : 1082,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY0MzAzNw==",
      "original_commit_id" : "2cfa278c355f22d9396b58d346f2c485e8763bfb",
      "original_line" : 1082,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 44,
      "pull_request_review_id" : 581397957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568643037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568648896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568648896"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Argument handling is in `ArgsManager::GetArg()`. Since the second argument here is an int, the `GetArg(string, int)` version is called:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/1e69800d5e60c7805931f2c5b978720c6aee180b/src/util/system.cpp#L473-L477\r\n\r\nwhich will try to convert the string into an int.\r\n\r\nThis might result in a slightly inaccurate error message, but I think it's fine. It's the same behaviour as for `-peertimeout`:\r\n\r\n```\r\nâ ./src/bitcoind --pingtimeout=abc\r\nError: pingtimeout cannot be configured with a negative value.\r\n```",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-02T14:34:22Z",
      "diff_hunk" : "@@ -1144,6 +1145,10 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n         return InitError(Untranslated(\"peertimeout cannot be configured with a negative value.\"));\n     }\n \n+    if (args.GetArg(\"-pingtimeout\", TIMEOUT_INTERVAL) <= 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568648896",
      "id" : 568648896,
      "in_reply_to_id" : 567464686,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY0ODg5Ng==",
      "original_commit_id" : "2cfa278c355f22d9396b58d346f2c485e8763bfb",
      "original_line" : 1148,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 581405777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568648896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568649911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568649911"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sounds good. Added!",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-02T14:35:40Z",
      "diff_hunk" : "@@ -83,6 +83,9 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n     auto peerLogic = PeerManager::make(chainparams, *connman, nullptr, *m_node.scheduler,\n                                        *m_node.chainman, *m_node.mempool, false);\n \n+    // Don't let pings time out",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568649911",
      "id" : 568649911,
      "in_reply_to_id" : 567520925,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY0OTkxMQ==",
      "original_commit_id" : "9099ee6f6b5102a5cb71f3b6f0c8322ed3003286",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 581407187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568649911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568651714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568651714"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Previously, when ping timeouts were handled in `CConnman::InactivityCheck()`, the whole logic was gated on the following guard:\r\n\r\n```\r\n    if (now <= node.nTimeConnected + m_peer_connect_timeout) {\r\n        // Only run inactivity checks if the peer has been connected longer\r\n        // than m_peer_connect_timeout.\r\n        return false;\r\n    }\r\n```\r\n\r\nBecause tests generally run for less than m_peer_connect_timeout, the ping timeout logic was not hit at all. Once the logic moves to net_processing, that guard no longer exists, so we start testing for ping timeouts as soon as the peer is connected.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-02T14:37:47Z",
      "diff_hunk" : "@@ -33,6 +33,7 @@ def set_test_params(self):\n             [\n                 \"-acceptnonstdtxn=1\",\n                 \"-peertimeout=9999\",  # bump because mocktime might cause a disconnect otherwise\n+                \"-pingtimeout=9999\",  # bump because mocktime might cause a disconnect otherwise",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568651714",
      "id" : 568651714,
      "in_reply_to_id" : 567521625,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY1MTcxNA==",
      "original_commit_id" : "9099ee6f6b5102a5cb71f3b6f0c8322ed3003286",
      "original_line" : 36,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/feature_bip68_sequence.py",
      "position" : null,
      "pull_request_review_id" : 581409506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568651714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568655894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568655894"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've changed the signature to return a void, so the nodiscard tag is no longer required (good suggestion though!)\r\n\r\nI've taken the suggested comment changes.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-02T14:42:43Z",
      "diff_hunk" : "@@ -315,7 +315,8 @@ class PeerManagerImpl final : public PeerManager\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n-    /** Send a ping message on a regular schedule or if requested manually */\n+    /** Send a ping message on a regular schedule or if requested manually. May\n+     *  disconnect the peer if a ping has timed out. */\n     void MaybeSendPing(CNode& node_to);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r568655894",
      "id" : 568655894,
      "in_reply_to_id" : 568013403,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY1NTg5NA==",
      "original_commit_id" : "f53ee86f489ba3f6e3c12edea1d869135c2c2dcf",
      "original_line" : 320,
      "original_position" : 7,
      "original_start_line" : 318,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 581414782,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568655894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I see around ~20 functional tests that use `setmocktime`... but you only added `-pingtimeout=9999` to two of them. Are you not worried about ping timeouts due to mocktime in any of the other tests?\r\n\r\n",
      "created_at" : "2021-02-03T15:52:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-772612030",
      "id" : 772612030,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MjYxMjAzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-03T15:52:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/772612030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "concept ACK, tests pass locally, scripted diff verified in 4180381f683fad8755b30a3a8e65edc26c1ce5e2\r\nMakes sense to me, moves ping properties from `CNode` in net to `Peer` in net_processing.\r\nTesting also by running `src/bitcoind -pingtimeout=1 -signet` (didn't want to disrupt mainnet peers) and got some expected log messages:\r\n`2021-02-03T15:34:23Z ping timeout: 1.018515s peer=5`",
      "created_at" : "2021-02-03T16:47:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-772653640",
      "id" : 772653640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MjY1MzY0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-03T16:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/772653640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r569596508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/569596508"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: Is it a bit pedantic to call it a `nonpositive value` here to include zero? \r\n\r\nAlthough I see it's consistent with `-peertimeout` error so that's probably why :)",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-03T17:19:04Z",
      "diff_hunk" : "@@ -1144,6 +1145,10 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n         return InitError(Untranslated(\"peertimeout cannot be configured with a negative value.\"));\n     }\n \n+    if (args.GetArg(\"-pingtimeout\", TIMEOUT_INTERVAL) <= 0) {\n+        return InitError(Untranslated(\"pingtimeout cannot be configured with a negative value.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r569596508",
      "id" : 569596508,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTU5NjUwOA==",
      "original_commit_id" : "4180381f683fad8755b30a3a8e65edc26c1ce5e2",
      "original_line" : 1149,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 582606411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/569596508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3072149?v=4",
         "events_url" : "https://api.github.com/users/duncandean/events{/privacy}",
         "followers_url" : "https://api.github.com/users/duncandean/followers",
         "following_url" : "https://api.github.com/users/duncandean/following{/other_user}",
         "gists_url" : "https://api.github.com/users/duncandean/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/duncandean",
         "id" : 3072149,
         "login" : "duncandean",
         "node_id" : "MDQ6VXNlcjMwNzIxNDk=",
         "organizations_url" : "https://api.github.com/users/duncandean/orgs",
         "received_events_url" : "https://api.github.com/users/duncandean/received_events",
         "repos_url" : "https://api.github.com/users/duncandean/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/duncandean/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/duncandean/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/duncandean"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I see around ~20 functional tests that use setmocktime... but you only added -pingtimeout=9999 to two of them. Are you not worried about ping timeouts due to mocktime in any of the other tests?\r\n\r\n@pinheadmz I imagine it's only necessary where `setmocktime` does an increase of more than the default ping timeout.\r\n\r\nDug into this a little bit looking for `setmocktime` calls with big jumps - @jnewbery do you think [p2p_addr_relay.py](https://github.com/bitcoin/bitcoin/blob/ea96e17e1f2c2b0a949366260906ef02e560a425/test/functional/p2p_addr_relay.py#L75), [p2p_addrv2_relay.py](https://github.com/bitcoin/bitcoin/blob/ea96e17e1f2c2b0a949366260906ef02e560a425/test/functional/p2p_addrv2_relay.py#L72), and/or [p2p_getaddr_caching.py](https://github.com/bitcoin/bitcoin/blob/ea96e17e1f2c2b0a949366260906ef02e560a425/test/functional/p2p_getaddr_caching.py#L75-L76) need a `-pingtimeout`?\r\n\r\nAlso a question that may or may not be relevant - how do the inactivity timers handle when `setmocktime` goes backwards in time?",
      "created_at" : "2021-02-03T20:19:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-772795602",
      "id" : 772795602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3Mjc5NTYwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-03T20:38:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/772795602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570127729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570127729"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've changed to option to be a binary true/false, so this check is no longer required.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-04T10:51:43Z",
      "diff_hunk" : "@@ -1144,6 +1145,10 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n         return InitError(Untranslated(\"peertimeout cannot be configured with a negative value.\"));\n     }\n \n+    if (args.GetArg(\"-pingtimeout\", TIMEOUT_INTERVAL) <= 0) {\n+        return InitError(Untranslated(\"pingtimeout cannot be configured with a negative value.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570127729",
      "id" : 570127729,
      "in_reply_to_id" : 569596508,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDEyNzcyOQ==",
      "original_commit_id" : "4180381f683fad8755b30a3a8e65edc26c1ce5e2",
      "original_line" : 1149,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 583265090,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570127729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've updated the `-pingtimeout` option to be a binary enable/disable. We don't need fine control over it in the tests, and it was essentially being used to disable ping timeouts entirely.\r\n\r\n> Dug into this a little bit looking for setmocktime calls with big jumps - @jnewbery do you think p2p_addr_relay.py, p2p_addrv2_relay.py, and/or p2p_getaddr_caching.py need a -pingtimeout?\r\n\r\nVery nice. Thanks @glozow. I've updated those tests to disable ping timeouts.\r\n\r\n> Also a question that may or may not be relevant - how do the inactivity timers handle when setmocktime goes backwards in time?\r\n\r\nThat's not a problem for the ping timeout. The ping timeout condition is `now > peer.m_ping_start.load() + std::chrono::seconds{TIMEOUT_INTERVAL}` i.e. \"(the time now) is after (when the ping was sent) plus (the timeout interval)\". If time goes backwards, then (the time now) is decreased and we won't hit this condition.",
      "created_at" : "2021-02-04T11:09:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-773227475",
      "id" : 773227475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MzIyNzQ3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-04T11:09:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/773227475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks everyone for the reviews. All comments have now been addressed.",
      "created_at" : "2021-02-04T11:10:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-773227934",
      "id" : 773227934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MzIyNzkzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-04T11:10:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/773227934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570598796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570598796"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "So would `-pingtimeout` means timeout=true? And `-nopingtimeout` is the same thing as `-pingtimeout=0`? I couldn't find where the implicit \"no\" logic was :( ",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-04T22:51:07Z",
      "diff_hunk" : "@@ -48,6 +48,7 @@ class AddrTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = False\n         self.num_nodes = 1\n+        self.extra_args = [[\"-nopingtimeout\"]]  # mocktime might cause a disconnect otherwise",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570598796",
      "id" : 570598796,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDU5ODc5Ng==",
      "original_commit_id" : "17029adf43cb399f462d1550ac4e148bd7f6c0e7",
      "original_line" : 50,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addr_relay.py",
      "position" : 4,
      "pull_request_review_id" : 583882358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570598796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570606043"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570606043"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I appreciate the added documentation ð \r\n\r\nnit\r\n```suggestion\r\n    /** We have completed a successful ping-pong keepalive. Update latest and best ping times. */\r\n```",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-04T23:06:56Z",
      "diff_hunk" : "@@ -713,6 +707,12 @@ class CNode\n \n     std::string ConnectionTypeAsString() const { return ::ConnectionTypeAsString(m_conn_type); }\n \n+    //* We have completed a successful ping-pong keepalive. Update latest and best ping times. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570606043",
      "id" : 570606043,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDYwNjA0Mw==",
      "original_commit_id" : "17029adf43cb399f462d1550ac4e148bd7f6c0e7",
      "original_line" : 710,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 583882358,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570606043",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570686167"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570686167"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it's done in [InterpretOption()](https://github.com/bitcoin/bitcoin/blob/ea5a50f92a6ff81b1d2dd67cdc3663e0e66733ac/src/util/system.cpp#L209) invoked from [ArgsManager::ParseParameters()](https://github.com/bitcoin/bitcoin/blob/ea5a50f92a6ff81b1d2dd67cdc3663e0e66733ac/src/util/system.cpp#L338) which is invoked in [AppInit()](https://github.com/bitcoin/bitcoin/blob/ea5a50f92a6ff81b1d2dd67cdc3663e0e66733ac/src/bitcoind.cpp#L43).",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-05T02:53:03Z",
      "diff_hunk" : "@@ -48,6 +48,7 @@ class AddrTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = False\n         self.num_nodes = 1\n+        self.extra_args = [[\"-nopingtimeout\"]]  # mocktime might cause a disconnect otherwise",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570686167",
      "id" : 570686167,
      "in_reply_to_id" : 570598796,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDY4NjE2Nw==",
      "original_commit_id" : "17029adf43cb399f462d1550ac4e148bd7f6c0e7",
      "original_line" : 50,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addr_relay.py",
      "position" : 4,
      "pull_request_review_id" : 583984378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570686167",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570826114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570826114"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks @dhruv!",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-05T09:18:13Z",
      "diff_hunk" : "@@ -48,6 +48,7 @@ class AddrTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = False\n         self.num_nodes = 1\n+        self.extra_args = [[\"-nopingtimeout\"]]  # mocktime might cause a disconnect otherwise",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570826114",
      "id" : 570826114,
      "in_reply_to_id" : 570598796,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDgyNjExNA==",
      "original_commit_id" : "17029adf43cb399f462d1550ac4e148bd7f6c0e7",
      "original_line" : 50,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addr_relay.py",
      "position" : 4,
      "pull_request_review_id" : 584152431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570826114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570828055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570828055"
         }
      },
      "author_association" : "MEMBER",
      "body" : ":facepalm: I've fixed the doxygen style and also tweaked the comment wording a bit.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-05T09:20:49Z",
      "diff_hunk" : "@@ -713,6 +707,12 @@ class CNode\n \n     std::string ConnectionTypeAsString() const { return ::ConnectionTypeAsString(m_conn_type); }\n \n+    //* We have completed a successful ping-pong keepalive. Update latest and best ping times. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r570828055",
      "id" : 570828055,
      "in_reply_to_id" : 570606043,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDgyODA1NQ==",
      "original_commit_id" : "17029adf43cb399f462d1550ac4e148bd7f6c0e7",
      "original_line" : 710,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 584154581,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T09:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570828055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the reviews!\r\n\r\n> I feel like the interface would be more intuitive if it was just called -disablepingtimeout since it's an optional flag, but perhaps just personal preference?\r\n\r\nI think it's best to avoid negative configuration names. `-disablepingtimeout=0` would mean \"do not disable ping timeout\", which is a double negative and slightly harder to parse than \"enable ping timeout\". See other options like `-listen`, `-persistmempool`, etc, where the default is true, and `-nolisten`, `-nopersistmempool` is used to disable.\r\n\r\n> my suggestions still make sense to me and I remember lightlike mentioning wallet_resendwallettransactions.py failing so maybe it was a race, no pings in flight?\r\n\r\nRight, these are all races, so they won't fail consistently. I think it's just safer to disable pings timeouts on any test which makes large mocktime leaps.",
      "created_at" : "2021-02-05T09:24:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-773908504",
      "id" : 773908504,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MzkwODUwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-05T09:24:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/773908504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-02-05T09:41:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-773918182",
      "id" : 773918182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MzkxODE4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-05T09:41:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/773918182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r571087717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571087717"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ahhhh thank you @dhruv!",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-05T16:23:14Z",
      "diff_hunk" : "@@ -48,6 +48,7 @@ class AddrTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = False\n         self.num_nodes = 1\n+        self.extra_args = [[\"-nopingtimeout\"]]  # mocktime might cause a disconnect otherwise",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r571087717",
      "id" : 571087717,
      "in_reply_to_id" : 570598796,
      "line" : 50,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTA4NzcxNw==",
      "original_commit_id" : "17029adf43cb399f462d1550ac4e148bd7f6c0e7",
      "original_line" : 50,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/p2p_addr_relay.py",
      "position" : 4,
      "pull_request_review_id" : 584496267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-05T16:23:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571087717",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/20721/commits/bbd970a2123aec5071dd3dd901e478844c6e0fea ð¿ \r\n\r\nThe negative config option stuff makes more sense to me now, thanks for explaining!",
      "created_at" : "2021-02-05T16:36:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-774143603",
      "id" : 774143603,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NDE0MzYwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-05T16:36:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/774143603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Light Code-Review ACK bbd970a2123aec5071dd3dd901e478844c6e0fea\r\n\r\nThis may have been answered before but could someone tell me the exact sequence of events in the test framework involving `setmocktime` that would make `-nopingtimeout` necessary? My naive reading is that `send_and_ping` blocks until it receives the `pong` and is therefore not going to timeout if the next call is a `setmocktime`.\r\n\r\nI'll also do a deeper read into `[net processing] Move ping timeout logic to net processing` later this week to make sure that this move is indeed safe and doesn't cause us to miss any opportunities to disconnect a peer.",
      "created_at" : "2021-02-08T21:17:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#issuecomment-775468156",
      "id" : 775468156,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20721",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NTQ2ODE1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-08T21:17:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/775468156",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572489932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572489932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "just noting that this changed from `>=` to `>`. makes sense to call it a \"timing mishap\" if the pong was received in the same microsecond as we recorded for the ping going out, so seems fine. just highlighting the change since it's easy to miss. ",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-09T01:01:24Z",
      "diff_hunk" : "@@ -3811,15 +3837,14 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             vRecv >> nonce;\n \n             // Only process pong message if there is an outstanding ping (old ping without nonce should never pong)\n-            if (pfrom.nPingNonceSent != 0) {\n-                if (nonce == pfrom.nPingNonceSent) {\n+            if (peer->nPingNonceSent != 0) {\n+                if (nonce == peer->nPingNonceSent) {\n                     // Matching pong received, this ping is no longer outstanding\n                     bPingFinished = true;\n-                    const auto ping_time = ping_end - pfrom.m_ping_start.load();\n-                    if (ping_time.count() >= 0) {\n-                        // Successful ping time measurement, replace previous\n-                        pfrom.nPingUsecTime = count_microseconds(ping_time);\n-                        pfrom.nMinPingUsecTime = std::min(pfrom.nMinPingUsecTime.load(), count_microseconds(ping_time));\n+                    const auto ping_time = ping_end - peer->m_ping_start.load();\n+                    if (ping_time.count() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572489932",
      "id" : 572489932,
      "line" : 3845,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQ4OTkzMg==",
      "original_commit_id" : "831f8c36e2f7e8f4af136a306b428a30072e5fcf",
      "original_line" : 3845,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 81,
      "pull_request_review_id" : 586061906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T01:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572489932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572493215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572493215"
         }
      },
      "author_association" : "MEMBER",
      "body" : "tangential because you didn't change this logic, but what's the point of sending a ping message to peers who are too old to support / respond with a pong?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-09T01:10:38Z",
      "diff_hunk" : "@@ -4286,50 +4289,56 @@ class CompareInvMempoolOrder\n };\n }\n \n-bool PeerManagerImpl::SendMessages(CNode* pto)\n+void PeerManagerImpl::MaybeSendPing(CNode& node_to)\n {\n-    PeerRef peer = GetPeerRef(pto->GetId());\n-    const Consensus::Params& consensusParams = m_chainparams.GetConsensus();\n-\n-    // We must call MaybeDiscourageAndDisconnect first, to ensure that we'll\n-    // disconnect misbehaving peers even before the version handshake is complete.\n-    if (MaybeDiscourageAndDisconnect(*pto)) return true;\n-\n-    // Don't send anything until the version handshake is complete\n-    if (!pto->fSuccessfullyConnected || pto->fDisconnect)\n-        return true;\n-\n-    // If we get here, the outgoing message serialization version is set and can't change.\n-    const CNetMsgMaker msgMaker(pto->GetCommonVersion());\n-\n-    //\n-    // Message: ping\n-    //\n+    const CNetMsgMaker msgMaker(node_to.GetCommonVersion());\n     bool pingSend = false;\n-    if (pto->fPingQueued) {\n+\n+    if (node_to.fPingQueued) {\n         // RPC ping request by user\n         pingSend = true;\n     }\n-    if (pto->nPingNonceSent == 0 && pto->m_ping_start.load() + PING_INTERVAL < GetTime<std::chrono::microseconds>()) {\n+\n+    if (node_to.nPingNonceSent == 0 && node_to.m_ping_start.load() + PING_INTERVAL < GetTime<std::chrono::microseconds>()) {\n         // Ping automatically sent as a latency probe & keepalive.\n         pingSend = true;\n     }\n+\n     if (pingSend) {\n         uint64_t nonce = 0;\n         while (nonce == 0) {\n             GetRandBytes((unsigned char*)&nonce, sizeof(nonce));\n         }\n-        pto->fPingQueued = false;\n-        pto->m_ping_start = GetTime<std::chrono::microseconds>();\n-        if (pto->GetCommonVersion() > BIP0031_VERSION) {\n-            pto->nPingNonceSent = nonce;\n-            m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::PING, nonce));\n+        node_to.fPingQueued = false;\n+        node_to.m_ping_start = GetTime<std::chrono::microseconds>();\n+        if (node_to.GetCommonVersion() > BIP0031_VERSION) {\n+            node_to.nPingNonceSent = nonce;\n+            m_connman.PushMessage(&node_to, msgMaker.Make(NetMsgType::PING, nonce));\n         } else {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572493215",
      "id" : 572493215,
      "line" : 4355,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQ5MzIxNQ==",
      "original_commit_id" : "f6e13955d46c6d5fdca08607cf781ea7ebd3a41d",
      "original_line" : 4317,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 167,
      "pull_request_review_id" : 586061906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T01:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572493215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572493715"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572493715"
         }
      },
      "author_association" : "MEMBER",
      "body" : "isn't this more of a `PongReceived`?",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-09T01:12:14Z",
      "diff_hunk" : "@@ -716,6 +710,12 @@ class CNode\n \n     std::string ConnectionTypeAsString() const { return ::ConnectionTypeAsString(m_conn_type); }\n \n+    /** A ping-pong keepalive has completed successfully. Update latest and minimum ping times. */\n+    void PingReceived(std::chrono::microseconds ping_time) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572493715",
      "id" : 572493715,
      "line" : 714,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQ5MzcxNQ==",
      "original_commit_id" : "831f8c36e2f7e8f4af136a306b428a30072e5fcf",
      "original_line" : 714,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 37,
      "pull_request_review_id" : 586061906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T01:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572493715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572499884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572499884"
         }
      },
      "author_association" : "MEMBER",
      "body" : "this comment previously followed the `fSuccesfullyConnected` check, which I think(?) was the intent -> `fSuccesfullyConnected` is set when processing the `VERACK` message, and `m_greatest_common_version` gets set when processing the `VERSION` message.\r\n\r\nbut now this comment is below `MaybeSendPing`, which also might retrieve `m_greatest_common_version` to construct the ping message. I find the intent of this comment to be less clear after these changes.",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-09T01:24:49Z",
      "diff_hunk" : "@@ -4286,50 +4315,72 @@ class CompareInvMempoolOrder\n };\n }\n \n-bool PeerManagerImpl::SendMessages(CNode* pto)\n+void PeerManagerImpl::MaybeSendPing(CNode& node_to, Peer& peer)\n {\n-    PeerRef peer = GetPeerRef(pto->GetId());\n-    const Consensus::Params& consensusParams = m_chainparams.GetConsensus();\n-\n-    // We must call MaybeDiscourageAndDisconnect first, to ensure that we'll\n-    // disconnect misbehaving peers even before the version handshake is complete.\n-    if (MaybeDiscourageAndDisconnect(*pto)) return true;\n-\n-    // Don't send anything until the version handshake is complete\n-    if (!pto->fSuccessfullyConnected || pto->fDisconnect)\n-        return true;\n-\n-    // If we get here, the outgoing message serialization version is set and can't change.\n-    const CNetMsgMaker msgMaker(pto->GetCommonVersion());\n+    // Use mockable time for ping timeouts.\n+    // This means that setmocktime may cause pings to time out.\n+    auto now = GetTime<std::chrono::microseconds>();\n+\n+    if (gArgs.GetArg(\"-pingtimeout\", DEFAULT_PING_TIMEOUT) &&\n+        peer.m_ping_nonce_sent &&\n+        now > peer.m_ping_start.load() + std::chrono::seconds{TIMEOUT_INTERVAL}) {\n+        LogPrint(BCLog::NET, \"ping timeout: %fs peer=%d\\n\", 0.000001 * count_microseconds(now - peer.m_ping_start.load()), peer.m_id);\n+        node_to.fDisconnect = true;\n+        return;\n+    }\n \n-    //\n-    // Message: ping\n-    //\n+    const CNetMsgMaker msgMaker(node_to.GetCommonVersion());\n     bool pingSend = false;\n-    if (pto->fPingQueued) {\n+\n+    if (peer.m_ping_queued) {\n         // RPC ping request by user\n         pingSend = true;\n     }\n-    if (pto->nPingNonceSent == 0 && pto->m_ping_start.load() + PING_INTERVAL < GetTime<std::chrono::microseconds>()) {\n+\n+    if (peer.m_ping_nonce_sent == 0 && now > peer.m_ping_start.load() + PING_INTERVAL) {\n         // Ping automatically sent as a latency probe & keepalive.\n         pingSend = true;\n     }\n+\n     if (pingSend) {\n         uint64_t nonce = 0;\n         while (nonce == 0) {\n             GetRandBytes((unsigned char*)&nonce, sizeof(nonce));\n         }\n-        pto->fPingQueued = false;\n-        pto->m_ping_start = GetTime<std::chrono::microseconds>();\n-        if (pto->GetCommonVersion() > BIP0031_VERSION) {\n-            pto->nPingNonceSent = nonce;\n-            m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::PING, nonce));\n+        peer.m_ping_queued = false;\n+        peer.m_ping_start = GetTime<std::chrono::microseconds>();\n+        if (node_to.GetCommonVersion() > BIP0031_VERSION) {\n+            peer.m_ping_nonce_sent = nonce;\n+            m_connman.PushMessage(&node_to, msgMaker.Make(NetMsgType::PING, nonce));\n         } else {\n             // Peer is too old to support ping command with nonce, pong will never arrive.\n-            pto->nPingNonceSent = 0;\n-            m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::PING));\n+            peer.m_ping_nonce_sent = 0;\n+            m_connman.PushMessage(&node_to, msgMaker.Make(NetMsgType::PING));\n         }\n     }\n+}\n+\n+bool PeerManagerImpl::SendMessages(CNode* pto)\n+{\n+    // We must call MaybeDiscourageAndDisconnect first, to ensure that we'll\n+    // disconnect misbehaving peers even before the version handshake is complete.\n+    if (MaybeDiscourageAndDisconnect(*pto)) return true;\n+\n+    // Don't send anything until the version handshake is complete\n+    if (!pto->fSuccessfullyConnected || pto->fDisconnect)\n+        return true;\n+\n+    PeerRef peer = GetPeerRef(pto->GetId());\n+\n+    MaybeSendPing(*pto, *peer);\n+\n+    // MaybeSendPing may have marked peer for disconnection\n+    if (pto->fDisconnect) return true;\n+\n+    // If we get here, the outgoing message serialization version is set and can't change.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572499884",
      "id" : 572499884,
      "line" : 4380,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQ5OTg4NA==",
      "original_commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "original_line" : 4380,
      "original_position" : 194,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 194,
      "pull_request_review_id" : 586061906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T01:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572499884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572501852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572501852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I know you only moved this code, but I think we could handle `fDisconnect` better. \r\n\r\nThis comment seems misleading since I think it only refers to `fSuccesfullyConnected`. Then, we might set `fDisconnect` to true in `MaybeSendPing`, so we check this bool again a couple lines down to also return early.\r\n\r\nA simpler logic flow might be removing this check here, starting `MaybeSendPing` with `return if node_to.fDisconnect`, and then removing this first early return from `SendMessages`. And the comment on 4377 could be updated to something along the lines of `Don't send messages to peers that are marked for disconnection`",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-09T01:29:54Z",
      "diff_hunk" : "@@ -4286,50 +4315,72 @@ class CompareInvMempoolOrder\n };\n }\n \n-bool PeerManagerImpl::SendMessages(CNode* pto)\n+void PeerManagerImpl::MaybeSendPing(CNode& node_to, Peer& peer)\n {\n-    PeerRef peer = GetPeerRef(pto->GetId());\n-    const Consensus::Params& consensusParams = m_chainparams.GetConsensus();\n-\n-    // We must call MaybeDiscourageAndDisconnect first, to ensure that we'll\n-    // disconnect misbehaving peers even before the version handshake is complete.\n-    if (MaybeDiscourageAndDisconnect(*pto)) return true;\n-\n-    // Don't send anything until the version handshake is complete\n-    if (!pto->fSuccessfullyConnected || pto->fDisconnect)\n-        return true;\n-\n-    // If we get here, the outgoing message serialization version is set and can't change.\n-    const CNetMsgMaker msgMaker(pto->GetCommonVersion());\n+    // Use mockable time for ping timeouts.\n+    // This means that setmocktime may cause pings to time out.\n+    auto now = GetTime<std::chrono::microseconds>();\n+\n+    if (gArgs.GetArg(\"-pingtimeout\", DEFAULT_PING_TIMEOUT) &&\n+        peer.m_ping_nonce_sent &&\n+        now > peer.m_ping_start.load() + std::chrono::seconds{TIMEOUT_INTERVAL}) {\n+        LogPrint(BCLog::NET, \"ping timeout: %fs peer=%d\\n\", 0.000001 * count_microseconds(now - peer.m_ping_start.load()), peer.m_id);\n+        node_to.fDisconnect = true;\n+        return;\n+    }\n \n-    //\n-    // Message: ping\n-    //\n+    const CNetMsgMaker msgMaker(node_to.GetCommonVersion());\n     bool pingSend = false;\n-    if (pto->fPingQueued) {\n+\n+    if (peer.m_ping_queued) {\n         // RPC ping request by user\n         pingSend = true;\n     }\n-    if (pto->nPingNonceSent == 0 && pto->m_ping_start.load() + PING_INTERVAL < GetTime<std::chrono::microseconds>()) {\n+\n+    if (peer.m_ping_nonce_sent == 0 && now > peer.m_ping_start.load() + PING_INTERVAL) {\n         // Ping automatically sent as a latency probe & keepalive.\n         pingSend = true;\n     }\n+\n     if (pingSend) {\n         uint64_t nonce = 0;\n         while (nonce == 0) {\n             GetRandBytes((unsigned char*)&nonce, sizeof(nonce));\n         }\n-        pto->fPingQueued = false;\n-        pto->m_ping_start = GetTime<std::chrono::microseconds>();\n-        if (pto->GetCommonVersion() > BIP0031_VERSION) {\n-            pto->nPingNonceSent = nonce;\n-            m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::PING, nonce));\n+        peer.m_ping_queued = false;\n+        peer.m_ping_start = GetTime<std::chrono::microseconds>();\n+        if (node_to.GetCommonVersion() > BIP0031_VERSION) {\n+            peer.m_ping_nonce_sent = nonce;\n+            m_connman.PushMessage(&node_to, msgMaker.Make(NetMsgType::PING, nonce));\n         } else {\n             // Peer is too old to support ping command with nonce, pong will never arrive.\n-            pto->nPingNonceSent = 0;\n-            m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::PING));\n+            peer.m_ping_nonce_sent = 0;\n+            m_connman.PushMessage(&node_to, msgMaker.Make(NetMsgType::PING));\n         }\n     }\n+}\n+\n+bool PeerManagerImpl::SendMessages(CNode* pto)\n+{\n+    // We must call MaybeDiscourageAndDisconnect first, to ensure that we'll\n+    // disconnect misbehaving peers even before the version handshake is complete.\n+    if (MaybeDiscourageAndDisconnect(*pto)) return true;\n+\n+    // Don't send anything until the version handshake is complete",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572501852",
      "id" : 572501852,
      "line" : 4369,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjUwMTg1Mg==",
      "original_commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "original_line" : 4369,
      "original_position" : 183,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 183,
      "pull_request_review_id" : 586061906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T01:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572501852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572502484"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572502484"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    /** Send a ping message every PING_INTERVAL or if requested via RPC. May  \r\n     *  mark the peer to be disconnected if a ping has timed out. */\r\n```",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-09T01:31:45Z",
      "diff_hunk" : "@@ -315,6 +323,10 @@ class PeerManagerImpl final : public PeerManager\n     /** Send a version message to a peer */\n     void PushNodeVersion(CNode& pnode, int64_t nTime);\n \n+    /** Send a ping message every PING_INTERVAL or if requested via RPC. May\n+     *  disconnect the peer if a ping has timed out. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572502484",
      "id" : 572502484,
      "line" : 327,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjUwMjQ4NA==",
      "original_commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "original_line" : 327,
      "original_position" : 27,
      "original_start_line" : 326,
      "path" : "src/net_processing.cpp",
      "position" : 27,
      "pull_request_review_id" : 586061906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : 326,
      "start_side" : "RIGHT",
      "updated_at" : "2021-02-09T01:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572502484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572503697"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572503697"
         }
      },
      "author_association" : "MEMBER",
      "body" : "another comment on code that you simply moved-\r\n\r\nI found this definition odd. Why is it defined as an int but set as a boolean? Also, why is it an `int64_t`, that seems like more space needed than for a simple bool value? \r\n\r\nalso note that this could be constexpr, but I don't know if that actually impacts anything. I tried it out in [godbolt explorer](https://godbolt.org/z/61anP3) and looks like for such simple  logic, it compiled down to the same assembly regardless ð¤·ð½ââï¸",
      "commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "created_at" : "2021-02-09T01:35:21Z",
      "diff_hunk" : "@@ -25,11 +25,14 @@ static const bool DEFAULT_PEERBLOOMFILTERS = false;\n static const bool DEFAULT_PEERBLOCKFILTERS = false;\n /** Threshold for marking a node to be discouraged, e.g. disconnected and added to the discouragement filter. */\n static const int DISCOURAGEMENT_THRESHOLD{100};\n+/** -pingtimeout default */\n+static const int64_t DEFAULT_PING_TIMEOUT = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20721#discussion_r572503697",
      "id" : 572503697,
      "line" : 29,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjUwMzY5Nw==",
      "original_commit_id" : "bbd970a2123aec5071dd3dd901e478844c6e0fea",
      "original_line" : 29,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.h",
      "position" : 5,
      "pull_request_review_id" : 586061906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20721",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T01:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572503697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   }
]
