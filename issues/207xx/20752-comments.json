[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20752#discussion_r547756550"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20752"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547756550"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It was nice to be able to put the `while true` outside the script. The benefit was that the outside could update this script, the code repo, as well as the seeds repo. This allows continuous fuzzing of the master branch with the latest code and seeds while atomically updating the build system and this script.",
      "commit_id" : "ff804c0392e7f8bc10cf4740f6d06ab4bd204f77",
      "created_at" : "2020-12-23T07:35:10Z",
      "diff_hunk" : "@@ -178,21 +178,32 @@ def generate_corpus_seeds(*, max_jobs, build_dir, seed_dir, targets):\n     \"\"\"\n     logging.info(\"Generating corpus seeds to {}\".format(seed_dir))\n \n-    jobs = []\n-    for target in targets:\n+    def generate_job():\n+        target = random.choice(targets)\n+        mutate_depth = random.randint(1, 15)\n+        use_value_profile = 0\n+        if random.randint(1, 10) == 1:\n+            use_value_profile = 1\n+        max_len = 2**random.randint(6, 12)\n+        if random.randint(1, 20) == 1:\n+            max_len = 0\n         target_seed_dir = os.path.join(seed_dir, target)\n         os.makedirs(target_seed_dir, exist_ok=True)\n         args = [\n             os.path.join(build_dir, 'src', 'test', 'fuzz', 'fuzz'),\n-            \"-runs=100000\",\n+            \"-max_total_time=1800\",\n+            \"-reload=0\",\n+            \"-mutate_depth={}\".format(mutate_depth),\n+            \"-use_value_profile={}\".format(use_value_profile),\n+            \"-max_len={}\".format(max_len),\n             target_seed_dir,\n         ]\n-        jobs.append([target, args])\n+        return [target, args]\n \n     running_jobs = set()\n-    while len(jobs) > 0 or len(running_jobs) > 0:\n-        if len(running_jobs) < max_jobs and len(jobs) > 0:\n-            target, args = jobs.pop()\n+    while True:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20752#discussion_r547756550",
      "id" : 547756550,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc1NjU1MA==",
      "original_commit_id" : "ff804c0392e7f8bc10cf4740f6d06ab4bd204f77",
      "original_line" : 204,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "test/fuzz/test_runner.py",
      "position" : 126,
      "pull_request_review_id" : 557690298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20752",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-23T07:35:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/547756550",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
