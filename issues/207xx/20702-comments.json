[
   {
      "author_association" : "MEMBER",
      "body" : "I expect this to be a difficult sell because we generally don't treat any of the data files as a stable external interface. Pointers to the file system can be considered implementation details subject to change.\r\n\r\nBut on the other hand, the format of the block files *specifically* hasn't ever significantly changed, and is (I think) unlikely to change. \r\n\r\nTo be clear I definitely see when this can be useful. For example the size of our own `contrib/linearize` tool could be cut in half by using this.\r\n",
      "created_at" : "2020-12-18T13:26:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#issuecomment-748083364",
      "id" : 748083364,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20702",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODA4MzM2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-18T13:26:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748083364",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20012 (rpc: Remove duplicate name and argNames from CRPCCommand by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-12-18T16:58:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#issuecomment-748204434",
      "id" : 748204434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20702",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODIwNDQzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-18T16:58:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748204434",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Perhaps there are ways to mitigate this issue? I could see two situations in which block data move around:\r\n\r\n* arbitrarily during run time - this seems incredibly unlikely outside of reorgs (reindexing needs to be done in case of reorgs anyway)\r\n* on upgrade - upgrade may take longer time because of this; similar things already happened to indexes\r\n\r\nA simple way to deal with these is to have some kind of \"block layout version\" that can be obtained over RPC. If the layout is ever changed, the version is bumped and indexers will need to reindex. As described above, this is most likely in case of a long upgrade needs to be done anyway, so it wouldn't be too annoying.\r\n\r\nTo make it a bit more future-proof we could have two version numbers: one for the format of blocks already on disk, another for format in general. If bitcoind is updated, the existing blocks are not changed, but future blocks may have some differences then the former version number doesn't change the latter does - avoids reindex when not actually needed and also avoids indexers that don't support a new version blindly attempting to process a layout they don't understand.\r\n\r\nI believe it'd be best to introduce this versioning right from the start. (Just return constant zeroes for now.)\r\n\r\nIf it ever happens that a single block (or a few blocks) is moved around, then doing full reindexing would be inefficient but I assume it'd be sensible to not try to solve it right now. That means let's not do something excessive like adding a layout version to each block now.",
      "created_at" : "2020-12-18T19:08:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#issuecomment-748267420",
      "id" : 748267420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20702",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODI2NzQyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-18T19:08:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748267420",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1178779?v=4",
         "events_url" : "https://api.github.com/users/Kixunil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Kixunil/followers",
         "following_url" : "https://api.github.com/users/Kixunil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Kixunil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Kixunil",
         "id" : 1178779,
         "login" : "Kixunil",
         "node_id" : "MDQ6VXNlcjExNzg3Nzk=",
         "organizations_url" : "https://api.github.com/users/Kixunil/orgs",
         "received_events_url" : "https://api.github.com/users/Kixunil/received_events",
         "repos_url" : "https://api.github.com/users/Kixunil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Kixunil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Kixunil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Kixunil"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546035310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546035310"
         }
      },
      "author_association" : "NONE",
      "body" : "@romanz do you have any plan for what to do with `electrs` if this is removed in the future?",
      "commit_id" : "9d5c2bb85c2601ad54fa9df49b4f13e0490fb421",
      "created_at" : "2020-12-18T19:09:56Z",
      "diff_hunk" : "@@ -2470,6 +2470,60 @@ static RPCHelpMan dumptxoutset()\n     };\n }\n \n+static RPCHelpMan getblocklocations()\n+{\n+    return RPCHelpMan{\"getblocklocations\",\n+                \"\\nEXPERIMENTAL warning: this call may be removed or changed in future releases.\\n\"\n+                \"\\nReturns a JSON for the location of 'blockhash' and its previous 'nblocks' block and undo data.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546035310",
      "id" : 546035310,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzNTMxMA==",
      "original_commit_id" : "6e61171710ac34c06e213db33ff9d07b170f22c2",
      "original_line" : 2477,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 555747009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-19T10:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546035310",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1178779?v=4",
         "events_url" : "https://api.github.com/users/Kixunil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Kixunil/followers",
         "following_url" : "https://api.github.com/users/Kixunil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Kixunil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Kixunil",
         "id" : 1178779,
         "login" : "Kixunil",
         "node_id" : "MDQ6VXNlcjExNzg3Nzk=",
         "organizations_url" : "https://api.github.com/users/Kixunil/orgs",
         "received_events_url" : "https://api.github.com/users/Kixunil/received_events",
         "repos_url" : "https://api.github.com/users/Kixunil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Kixunil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Kixunil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Kixunil"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546043984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546043984"
         }
      },
      "author_association" : "NONE",
      "body" : "Perhaps it'd make more sense to test that the blocks stored on the returned offsets contain the same data as when using `getblock` call?",
      "commit_id" : "9d5c2bb85c2601ad54fa9df49b4f13e0490fb421",
      "created_at" : "2020-12-18T19:21:55Z",
      "diff_hunk" : "@@ -0,0 +1,47 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblocklocations rpc call.\"\"\"\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+class GetblocklocationsTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"Test a trivial usage of the getblocklocations RPC command.\"\"\"\n+        node = self.nodes[0]\n+        mocktime = node.getblockheader(node.getblockhash(0))['time'] + 1\n+        node.setmocktime(mocktime)\n+        node.generate(7)\n+\n+        EXPECTED_LOCATIONS = [\n+            {'file': 0, 'data': 1861, 'undo': 254, 'prev': '1893864d81638cae904357907559248964050547ddcd0dbe3f72e65b5a31bf1f'},\n+            {'file': 0, 'data': 1601, 'undo': 213, 'prev': '1b086a63a5d5c320c747fee32cdb819c6f4f9eb78c24b7c5a33ae794218dc639'},\n+            {'file': 0, 'data': 1341, 'undo': 172, 'prev': '448640031d1418c70a109ea4f88f497804f3336c7309ff7e535894beb80b26e4'},\n+            {'file': 0, 'data': 1081, 'undo': 131, 'prev': '602403f82060e224423a9f22062fad3f5333beeee3c30313f6ea808e37b7e0b2'},\n+            {'file': 0, 'data': 821, 'undo': 90, 'prev': '334ab00aba5d213c8f67161ddff346c4643d0709c3bdafa4b4b05fe6f7e4ed48'},\n+            {'file': 0, 'data': 561, 'undo': 49, 'prev': '43f10598f19eced9c514f5ae40dbce0ab101362a22e18820901c6e03d7babe0b'},\n+            {'file': 0, 'data': 301, 'undo': 8, 'prev': '0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206'},\n+            {'file': 0, 'data': 8, 'prev': '0000000000000000000000000000000000000000000000000000000000000000'},  # genesis block\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546043984",
      "id" : 546043984,
      "line" : 34,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0Mzk4NA==",
      "original_commit_id" : "6e61171710ac34c06e213db33ff9d07b170f22c2",
      "original_line" : 34,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "test/functional/rpc_getblocklocations.py",
      "position" : 34,
      "pull_request_review_id" : 555747009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-19T10:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546043984",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1178779?v=4",
         "events_url" : "https://api.github.com/users/Kixunil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Kixunil/followers",
         "following_url" : "https://api.github.com/users/Kixunil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Kixunil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Kixunil",
         "id" : 1178779,
         "login" : "Kixunil",
         "node_id" : "MDQ6VXNlcjExNzg3Nzk=",
         "organizations_url" : "https://api.github.com/users/Kixunil/orgs",
         "received_events_url" : "https://api.github.com/users/Kixunil/received_events",
         "repos_url" : "https://api.github.com/users/Kixunil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Kixunil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Kixunil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Kixunil"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546044099"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546044099"
         }
      },
      "author_association" : "NONE",
      "body" : "I'd like to see this description clarified. Something like: \"The number of blocks to process, including the block with given blockhash. The blocks following the given block will be returned if bigger than one.\"\r\n\r\nI'm not entirely satisfied with my wording either, so will be happy for clearer version. The idea is to communicate what exactly is in the result.",
      "commit_id" : "9d5c2bb85c2601ad54fa9df49b4f13e0490fb421",
      "created_at" : "2020-12-18T19:22:13Z",
      "diff_hunk" : "@@ -2470,6 +2470,60 @@ static RPCHelpMan dumptxoutset()\n     };\n }\n \n+static RPCHelpMan getblocklocations()\n+{\n+    return RPCHelpMan{\"getblocklocations\",\n+                \"\\nEXPERIMENTAL warning: this call may be removed or changed in future releases.\\n\"\n+                \"\\nReturns a JSON for the location of 'blockhash' and its previous 'nblocks' block and undo data.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nblocks\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"Number of block locations to return\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546044099",
      "id" : 546044099,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0NDA5OQ==",
      "original_commit_id" : "6e61171710ac34c06e213db33ff9d07b170f22c2",
      "original_line" : 2480,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 555747009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-19T10:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546044099",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1178779?v=4",
         "events_url" : "https://api.github.com/users/Kixunil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Kixunil/followers",
         "following_url" : "https://api.github.com/users/Kixunil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Kixunil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Kixunil",
         "id" : 1178779,
         "login" : "Kixunil",
         "node_id" : "MDQ6VXNlcjExNzg3Nzk=",
         "organizations_url" : "https://api.github.com/users/Kixunil/orgs",
         "received_events_url" : "https://api.github.com/users/Kixunil/received_events",
         "repos_url" : "https://api.github.com/users/Kixunil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Kixunil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Kixunil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Kixunil"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546046367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546046367"
         }
      },
      "author_association" : "NONE",
      "body" : "I suppose this is hit (also) when the block is pruned? Perhaps document it?",
      "commit_id" : "9d5c2bb85c2601ad54fa9df49b4f13e0490fb421",
      "created_at" : "2020-12-18T19:25:04Z",
      "diff_hunk" : "@@ -2470,6 +2470,60 @@ static RPCHelpMan dumptxoutset()\n     };\n }\n \n+static RPCHelpMan getblocklocations()\n+{\n+    return RPCHelpMan{\"getblocklocations\",\n+                \"\\nEXPERIMENTAL warning: this call may be removed or changed in future releases.\\n\"\n+                \"\\nReturns a JSON for the location of 'blockhash' and its previous 'nblocks' block and undo data.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nblocks\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"Number of block locations to return\"},\n+                },\n+                {\n+                    RPCResult{\n+                        RPCResult::Type::ARR, \"\", \"\",\n+                        {\n+                            {RPCResult::Type::NUM, \"file\", \"blk*.dat/rev*.dat file index\"},\n+                            {RPCResult::Type::NUM, \"data\", \"block data file offset\"},\n+                            {RPCResult::Type::NUM, \"undo\", \"undo data file offset (if exists)\"},\n+                            {RPCResult::Type::STR_HEX, \"prev\", \"previous block hash\"},\n+                        }\n+                    },\n+                },\n+                RPCExamples{\n+                    HelpExampleCli(\"getblocklocation\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 10\")\n+                },\n+                [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue {\n+\n+    uint256 hash(ParseHashV(request.params[0], \"blockhash\"));\n+    size_t nblocks = request.params[1].get_int();\n+\n+    const CBlockIndex* pblockindex = WITH_LOCK(cs_main, return LookupBlockIndex(hash));\n+    if (!pblockindex) {\n+        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546046367",
      "id" : 546046367,
      "line" : 2504,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0NjM2Nw==",
      "original_commit_id" : "6e61171710ac34c06e213db33ff9d07b170f22c2",
      "original_line" : 2504,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 35,
      "pull_request_review_id" : 555758011,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-19T10:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546046367",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1178779?v=4",
         "events_url" : "https://api.github.com/users/Kixunil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Kixunil/followers",
         "following_url" : "https://api.github.com/users/Kixunil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Kixunil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Kixunil",
         "id" : 1178779,
         "login" : "Kixunil",
         "node_id" : "MDQ6VXNlcjExNzg3Nzk=",
         "organizations_url" : "https://api.github.com/users/Kixunil/orgs",
         "received_events_url" : "https://api.github.com/users/Kixunil/received_events",
         "repos_url" : "https://api.github.com/users/Kixunil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Kixunil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Kixunil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Kixunil"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Supporting efficient indexes outside of Bitcoin Core is a critical privacy improvement. The Bitcoin Core wallet must keep the wallet's public keys unencrypted in order to track them, meaning that a compromise of the node is a complete compromise of the wallet privacy. \r\n\r\nA full index of the kind that electrs provides allows such knowledge of the public keys to be restricted to the period that the wallet is being accessed, and then in memory only. This reduces the attack surface considerably and greatly improves potential privacy. This is not a slight on the Bitcoin Core wallet, but a consequence of the architecture, in which privacy competes with the need for nodes to ideally be always-on and always-connected.\r\n\r\nSupporting efficient creation of these indexes means that more users will be able to host them, improving Bitcoin's privacy in general. Currently, with this RPC my electrs testnet full index is 2.6G in size which is reasonable in comparison to the 32G of the testnet3 blockchain, and the initial indexing time has been greatly reduced as well. \r\n",
      "created_at" : "2020-12-19T07:12:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#issuecomment-748432555",
      "id" : 748432555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20702",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODQzMjU1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-19T07:12:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748432555",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/862166?v=4",
         "events_url" : "https://api.github.com/users/craigraw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/craigraw/followers",
         "following_url" : "https://api.github.com/users/craigraw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/craigraw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/craigraw",
         "id" : 862166,
         "login" : "craigraw",
         "node_id" : "MDQ6VXNlcjg2MjE2Ng==",
         "organizations_url" : "https://api.github.com/users/craigraw/orgs",
         "received_events_url" : "https://api.github.com/users/craigraw/received_events",
         "repos_url" : "https://api.github.com/users/craigraw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/craigraw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/craigraw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/craigraw"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm all-in for adding APIs for more efficient external indexing. I share @laanwj concern about the stableness of file pointers.\r\n\r\nHowever, I disagree with @craigraw:\r\n\r\n> Supporting efficient indexes outside of Bitcoin Core is a critical privacy improvement. The Bitcoin Core wallet must keep the wallet's public keys unencrypted in order to track them, meaning that a compromise of the node is a complete compromise of the wallet privacy.\r\n\r\nI don't actually follow the exact use case here. But it looks like you want to reduce the wallet-privacy-exposure time (the time publickeys/scripts are exposed to the memory). Which I think is a valid point. Though indexing \"all\" addresses for this seems an inefficient trade-off.\r\n\r\nOne seeking limited exposure time for their public-keys/scripts could and maybe should use blockfiters. It seems much better to scale and the filters are of value for the entire network.\r\n\r\n**Just scan the filters (timespan from `last-wallet-sync` to `now`) and scan the relevant blocks. Should be fairly quick for a couple of days or weeks (seconds).**\r\n\r\nIn general, I discourage building full indexes for personal wallet backends. It is not efficient IMO and leads to development focus on the wrong end.\r\n\r\nA full address index can be of value for pure exploring, inspecting, developing, etc.\r\n\r\n\r\nConcept ~0 on this.",
      "created_at" : "2020-12-19T09:29:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#issuecomment-748448367",
      "id" : 748448367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20702",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODQ0ODM2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-19T09:29:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748448367",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546220308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546220308"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If Electrum protocol will allow using the actual `scriptPubKey` for querying the historical transactions, it would be possible to use `blockfilterindex`-based RPC, such as https://github.com/bitcoin/bitcoin/pull/20664 (as suggested [here](https://github.com/bitcoin/bitcoin/pull/14053#issuecomment-747661798)).\r\nMaybe it can be supported with [bwt](https://github.com/shesek/bwt) if the full node has blockfilters?\r\nCC: @SomberNight @shesek",
      "commit_id" : "9d5c2bb85c2601ad54fa9df49b4f13e0490fb421",
      "created_at" : "2020-12-19T10:11:58Z",
      "diff_hunk" : "@@ -2470,6 +2470,60 @@ static RPCHelpMan dumptxoutset()\n     };\n }\n \n+static RPCHelpMan getblocklocations()\n+{\n+    return RPCHelpMan{\"getblocklocations\",\n+                \"\\nEXPERIMENTAL warning: this call may be removed or changed in future releases.\\n\"\n+                \"\\nReturns a JSON for the location of 'blockhash' and its previous 'nblocks' block and undo data.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546220308",
      "id" : 546220308,
      "in_reply_to_id" : 546035310,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyMDMwOA==",
      "original_commit_id" : "6e61171710ac34c06e213db33ff9d07b170f22c2",
      "original_line" : 2477,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 555931783,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-19T10:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546220308",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/9900?v=4",
         "events_url" : "https://api.github.com/users/romanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/romanz/followers",
         "following_url" : "https://api.github.com/users/romanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/romanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/romanz",
         "id" : 9900,
         "login" : "romanz",
         "node_id" : "MDQ6VXNlcjk5MDA=",
         "organizations_url" : "https://api.github.com/users/romanz/orgs",
         "received_events_url" : "https://api.github.com/users/romanz/received_events",
         "repos_url" : "https://api.github.com/users/romanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/romanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/romanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/romanz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546220361"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546220361"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sounds good, will do.",
      "commit_id" : "9d5c2bb85c2601ad54fa9df49b4f13e0490fb421",
      "created_at" : "2020-12-19T10:12:28Z",
      "diff_hunk" : "@@ -0,0 +1,47 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblocklocations rpc call.\"\"\"\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+class GetblocklocationsTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"Test a trivial usage of the getblocklocations RPC command.\"\"\"\n+        node = self.nodes[0]\n+        mocktime = node.getblockheader(node.getblockhash(0))['time'] + 1\n+        node.setmocktime(mocktime)\n+        node.generate(7)\n+\n+        EXPECTED_LOCATIONS = [\n+            {'file': 0, 'data': 1861, 'undo': 254, 'prev': '1893864d81638cae904357907559248964050547ddcd0dbe3f72e65b5a31bf1f'},\n+            {'file': 0, 'data': 1601, 'undo': 213, 'prev': '1b086a63a5d5c320c747fee32cdb819c6f4f9eb78c24b7c5a33ae794218dc639'},\n+            {'file': 0, 'data': 1341, 'undo': 172, 'prev': '448640031d1418c70a109ea4f88f497804f3336c7309ff7e535894beb80b26e4'},\n+            {'file': 0, 'data': 1081, 'undo': 131, 'prev': '602403f82060e224423a9f22062fad3f5333beeee3c30313f6ea808e37b7e0b2'},\n+            {'file': 0, 'data': 821, 'undo': 90, 'prev': '334ab00aba5d213c8f67161ddff346c4643d0709c3bdafa4b4b05fe6f7e4ed48'},\n+            {'file': 0, 'data': 561, 'undo': 49, 'prev': '43f10598f19eced9c514f5ae40dbce0ab101362a22e18820901c6e03d7babe0b'},\n+            {'file': 0, 'data': 301, 'undo': 8, 'prev': '0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206'},\n+            {'file': 0, 'data': 8, 'prev': '0000000000000000000000000000000000000000000000000000000000000000'},  # genesis block\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546220361",
      "id" : 546220361,
      "in_reply_to_id" : 546043984,
      "line" : 34,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyMDM2MQ==",
      "original_commit_id" : "6e61171710ac34c06e213db33ff9d07b170f22c2",
      "original_line" : 34,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "test/functional/rpc_getblocklocations.py",
      "position" : 34,
      "pull_request_review_id" : 555931808,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-19T10:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546220361",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/9900?v=4",
         "events_url" : "https://api.github.com/users/romanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/romanz/followers",
         "following_url" : "https://api.github.com/users/romanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/romanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/romanz",
         "id" : 9900,
         "login" : "romanz",
         "node_id" : "MDQ6VXNlcjk5MDA=",
         "organizations_url" : "https://api.github.com/users/romanz/orgs",
         "received_events_url" : "https://api.github.com/users/romanz/received_events",
         "repos_url" : "https://api.github.com/users/romanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/romanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/romanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/romanz"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@jonasschnelli block filters would be a great argument if some benchmarks were provided and wallets actually supported them. Currently, one of the most reasonable wallets - Electrum requires a specific protocol which is not block filters. The server could perhaps use block filters in the background, the question is is it still possible/reasonable? My understanding is that block filters still have O(block_count) complexity, which seems high for each request.",
      "created_at" : "2020-12-19T10:19:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#issuecomment-748453572",
      "id" : 748453572,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20702",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODQ1MzU3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-19T10:19:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748453572",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1178779?v=4",
         "events_url" : "https://api.github.com/users/Kixunil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Kixunil/followers",
         "following_url" : "https://api.github.com/users/Kixunil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Kixunil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Kixunil",
         "id" : 1178779,
         "login" : "Kixunil",
         "node_id" : "MDQ6VXNlcjExNzg3Nzk=",
         "organizations_url" : "https://api.github.com/users/Kixunil/orgs",
         "received_events_url" : "https://api.github.com/users/Kixunil/received_events",
         "repos_url" : "https://api.github.com/users/Kixunil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Kixunil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Kixunil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Kixunil"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546223638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546223638"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point - added a check in https://github.com/bitcoin/bitcoin/pull/20702/commits/9d5c2bb85c2601ad54fa9df49b4f13e0490fb421#diff-decae4be02fb8a47ab4557fe74a9cb853bdfa3ec0fa1b515c0a1e5de91f4ad0bR2506.",
      "commit_id" : "9d5c2bb85c2601ad54fa9df49b4f13e0490fb421",
      "created_at" : "2020-12-19T10:48:18Z",
      "diff_hunk" : "@@ -2470,6 +2470,60 @@ static RPCHelpMan dumptxoutset()\n     };\n }\n \n+static RPCHelpMan getblocklocations()\n+{\n+    return RPCHelpMan{\"getblocklocations\",\n+                \"\\nEXPERIMENTAL warning: this call may be removed or changed in future releases.\\n\"\n+                \"\\nReturns a JSON for the location of 'blockhash' and its previous 'nblocks' block and undo data.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nblocks\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"Number of block locations to return\"},\n+                },\n+                {\n+                    RPCResult{\n+                        RPCResult::Type::ARR, \"\", \"\",\n+                        {\n+                            {RPCResult::Type::NUM, \"file\", \"blk*.dat/rev*.dat file index\"},\n+                            {RPCResult::Type::NUM, \"data\", \"block data file offset\"},\n+                            {RPCResult::Type::NUM, \"undo\", \"undo data file offset (if exists)\"},\n+                            {RPCResult::Type::STR_HEX, \"prev\", \"previous block hash\"},\n+                        }\n+                    },\n+                },\n+                RPCExamples{\n+                    HelpExampleCli(\"getblocklocation\", \"\\\"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\\\" 10\")\n+                },\n+                [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue {\n+\n+    uint256 hash(ParseHashV(request.params[0], \"blockhash\"));\n+    size_t nblocks = request.params[1].get_int();\n+\n+    const CBlockIndex* pblockindex = WITH_LOCK(cs_main, return LookupBlockIndex(hash));\n+    if (!pblockindex) {\n+        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546223638",
      "id" : 546223638,
      "in_reply_to_id" : 546046367,
      "line" : 2504,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyMzYzOA==",
      "original_commit_id" : "6e61171710ac34c06e213db33ff9d07b170f22c2",
      "original_line" : 2504,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 35,
      "pull_request_review_id" : 555933504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-19T10:48:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546223638",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/9900?v=4",
         "events_url" : "https://api.github.com/users/romanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/romanz/followers",
         "following_url" : "https://api.github.com/users/romanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/romanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/romanz",
         "id" : 9900,
         "login" : "romanz",
         "node_id" : "MDQ6VXNlcjk5MDA=",
         "organizations_url" : "https://api.github.com/users/romanz/orgs",
         "received_events_url" : "https://api.github.com/users/romanz/received_events",
         "repos_url" : "https://api.github.com/users/romanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/romanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/romanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/romanz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546223714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546223714"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated the documentation:\r\n```\r\ngetblocklocations \"blockhash\" nblocks\r\n\r\nEXPERIMENTAL warning: this call may be removed or changed in future releases.\r\n\r\nReturns a JSON for the file system location of 'blockhash' block and undo data.\r\n\r\nIt is possible to return also the locations of previous blocks, by specifying 'nblocks' > 1.\r\n\r\nArguments:\r\n1. blockhash    (string, required) The block hash\r\n2. nblocks      (numeric, required) Maximum number locations to return (up to genesis block)\r\n\r\nResult:\r\n[           (json array)\r\n  n,        (numeric) blk*.dat/rev*.dat file index\r\n  n,        (numeric) block data file offset\r\n  n,        (numeric) undo data file offset (if exists)\r\n  \"hex\",    (string) previous block hash\r\n  ...\r\n]\r\n\r\nExamples:\r\n> bitcoin-cli getblocklocation \"00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\" 10\r\n```\r\nWDYT?",
      "commit_id" : "9d5c2bb85c2601ad54fa9df49b4f13e0490fb421",
      "created_at" : "2020-12-19T10:49:01Z",
      "diff_hunk" : "@@ -2470,6 +2470,60 @@ static RPCHelpMan dumptxoutset()\n     };\n }\n \n+static RPCHelpMan getblocklocations()\n+{\n+    return RPCHelpMan{\"getblocklocations\",\n+                \"\\nEXPERIMENTAL warning: this call may be removed or changed in future releases.\\n\"\n+                \"\\nReturns a JSON for the location of 'blockhash' and its previous 'nblocks' block and undo data.\\n\",\n+                {\n+                    {\"blockhash\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The block hash\"},\n+                    {\"nblocks\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"Number of block locations to return\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546223714",
      "id" : 546223714,
      "in_reply_to_id" : 546044099,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyMzcxNA==",
      "original_commit_id" : "6e61171710ac34c06e213db33ff9d07b170f22c2",
      "original_line" : 2480,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 555933548,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-19T10:49:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546223714",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/9900?v=4",
         "events_url" : "https://api.github.com/users/romanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/romanz/followers",
         "following_url" : "https://api.github.com/users/romanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/romanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/romanz",
         "id" : 9900,
         "login" : "romanz",
         "node_id" : "MDQ6VXNlcjk5MDA=",
         "organizations_url" : "https://api.github.com/users/romanz/orgs",
         "received_events_url" : "https://api.github.com/users/romanz/received_events",
         "repos_url" : "https://api.github.com/users/romanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/romanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/romanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/romanz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546223805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546223805"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done at https://github.com/bitcoin/bitcoin/pull/20702/commits/9d5c2bb85c2601ad54fa9df49b4f13e0490fb421.",
      "commit_id" : "9d5c2bb85c2601ad54fa9df49b4f13e0490fb421",
      "created_at" : "2020-12-19T10:50:01Z",
      "diff_hunk" : "@@ -0,0 +1,47 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test the getblocklocations rpc call.\"\"\"\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+class GetblocklocationsTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        \"\"\"Test a trivial usage of the getblocklocations RPC command.\"\"\"\n+        node = self.nodes[0]\n+        mocktime = node.getblockheader(node.getblockhash(0))['time'] + 1\n+        node.setmocktime(mocktime)\n+        node.generate(7)\n+\n+        EXPECTED_LOCATIONS = [\n+            {'file': 0, 'data': 1861, 'undo': 254, 'prev': '1893864d81638cae904357907559248964050547ddcd0dbe3f72e65b5a31bf1f'},\n+            {'file': 0, 'data': 1601, 'undo': 213, 'prev': '1b086a63a5d5c320c747fee32cdb819c6f4f9eb78c24b7c5a33ae794218dc639'},\n+            {'file': 0, 'data': 1341, 'undo': 172, 'prev': '448640031d1418c70a109ea4f88f497804f3336c7309ff7e535894beb80b26e4'},\n+            {'file': 0, 'data': 1081, 'undo': 131, 'prev': '602403f82060e224423a9f22062fad3f5333beeee3c30313f6ea808e37b7e0b2'},\n+            {'file': 0, 'data': 821, 'undo': 90, 'prev': '334ab00aba5d213c8f67161ddff346c4643d0709c3bdafa4b4b05fe6f7e4ed48'},\n+            {'file': 0, 'data': 561, 'undo': 49, 'prev': '43f10598f19eced9c514f5ae40dbce0ab101362a22e18820901c6e03d7babe0b'},\n+            {'file': 0, 'data': 301, 'undo': 8, 'prev': '0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206'},\n+            {'file': 0, 'data': 8, 'prev': '0000000000000000000000000000000000000000000000000000000000000000'},  # genesis block\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#discussion_r546223805",
      "id" : 546223805,
      "in_reply_to_id" : 546043984,
      "line" : 34,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyMzgwNQ==",
      "original_commit_id" : "6e61171710ac34c06e213db33ff9d07b170f22c2",
      "original_line" : 34,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "test/functional/rpc_getblocklocations.py",
      "position" : 34,
      "pull_request_review_id" : 555933600,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20702",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-19T10:50:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/546223805",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/9900?v=4",
         "events_url" : "https://api.github.com/users/romanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/romanz/followers",
         "following_url" : "https://api.github.com/users/romanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/romanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/romanz",
         "id" : 9900,
         "login" : "romanz",
         "node_id" : "MDQ6VXNlcjk5MDA=",
         "organizations_url" : "https://api.github.com/users/romanz/orgs",
         "received_events_url" : "https://api.github.com/users/romanz/received_events",
         "repos_url" : "https://api.github.com/users/romanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/romanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/romanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/romanz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> arbitrarily during run time - this seems incredibly unlikely outside of reorgs (reindexing needs to be done in case of reorgs anyway)\r\n\r\nBlocks don't move around on disk ever. A re-org keeps the old blocks, it only changes connections in the block database.\r\n(It might make the same block height point to a different block, of course, but this is not a different issue from when the RPC is used to retrieve the block data)\r\nThe only conflict  that can really happen right now is that the block file is deleted by pruning. But this can be avoided by making the client manage pruning through `pruneblockchain`.\r\n",
      "created_at" : "2020-12-19T11:02:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20702#issuecomment-748458329",
      "id" : 748458329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20702",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0ODQ1ODMyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-19T11:02:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/748458329",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
