[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21836 (scripted-diff: Replace three dots with ellipsis in the UI strings by hebasto)\n* #21206 (refactor: Make CWalletTx sync state type-safe by ryanofsky)\n* #20640 (wallet, refactor: return out-params of CreateTransaction() as optional struct by theStack)\n* #19101 (refactor: remove ::vpwallets and related global variables by ryanofsky)\n* #15719 (Wallet passive startup by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-12-26T18:04:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-751381033",
      "id" : 751381033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MTM4MTAzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-03T02:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/751381033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555413735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555413735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Track first run state in CWallet\" (b528485dc7701dcd8fafcf2da996160c52546f07)\r\n\r\nCould this be initialized with `bool m_first_run = true` or `bool m_first_run = false` here? It would be nice to avoid possibility of non-determinism since it is technically possible to create a `CWallet` object without loading it",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-11T23:54:20Z",
      "diff_hunk" : "@@ -720,6 +720,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     // ScriptPubKeyMan::GetID. In many cases it will be the hash of an internal structure\n     std::map<uint256, std::unique_ptr<ScriptPubKeyMan>> m_spk_managers;\n \n+    /** True if this wallet is loaded for the first time. */\n+    bool m_first_run;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555413735",
      "id" : 555413735,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQxMzczNQ==",
      "original_commit_id" : "b528485dc7701dcd8fafcf2da996160c52546f07",
      "original_line" : 724,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555413735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555436448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555436448"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Move chain checks into CWallet::AttachChain\" (eabcd952d1c664cd964eb3376bc2865a49b33f16)\r\n\r\nI think this commit is not an improvement and that it would be better to drop. Safer and clearer to check these values for errors early as they are initialized, than to initialize one place and do checking later.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T00:52:12Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555436448",
      "id" : 555436448,
      "line" : 4008,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQzNjQ0OA==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4008,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 89,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555436448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555437036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555437036"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Update CWallet::AttachChain signature\" (847588a4b8e0dcc9975a675c46eca095c7cce4eb)\r\n\r\nCompile error this line (should say `CWallet`)",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T00:54:04Z",
      "diff_hunk" : "@@ -2,13 +2,16 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <util/translation.h>\n #include <wallet/test/wallet_test_fixture.h>\n \n WalletTestingSetup::WalletTestingSetup(const std::string& chainName)\n     : TestingSetup(chainName),\n       m_wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase())\n {\n     m_wallet.LoadWallet();\n-    CWallet::AttachChain({ &m_wallet, [](CWallet*) {} });\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    CWalle::AttachChain({&m_wallet, [](CWallet*) {}}, *m_node.chain.get(), error, warnings);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555437036",
      "id" : 555437036,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQzNzAzNg==",
      "original_commit_id" : "847588a4b8e0dcc9975a675c46eca095c7cce4eb",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : null,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555437036",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555438988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555438988"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Update CWallet::AttachChain signature\" (847588a4b8e0dcc9975a675c46eca095c7cce4eb)\r\n\r\nThis change seems good but it would be nice to squash this commit into the first commit 4398236619aa1f70886a0e9ae7093b413ec172c6 to make the PR simpler and avoid defining an enum in an an earlier change that gets deleted later",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T01:00:09Z",
      "diff_hunk" : "@@ -791,15 +791,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     /** Registered interfaces::Chain::Notifications handler. */\n     std::unique_ptr<interfaces::Handler> m_chain_notifications_handler;\n \n-    /** Result of scanning a chain for new transactions */\n-    enum class ScanStatus { SUCCESS, FAILED, MISSING_BLOCKS, SKIPPED };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555438988",
      "id" : 555438988,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQzODk4OA==",
      "original_commit_id" : "847588a4b8e0dcc9975a675c46eca095c7cce4eb",
      "original_line" : 795,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555438988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555441172"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555441172"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"CWallet::Create move CWallet::AttachChain up into calling code\" (9b575783f0f075d66350def60a842aee9ee05267)\r\n\r\nI don't think it's safe to reorder loading sequence and call AttachChain after g_load_wallet_fns callbacks. It also adds extra code to give callers responsibility to call AttachChain. If the point is to allow wallets to be created without syncing, would suggest just changing `Create` methods's `Chain&` argument to `Chain*` and `if (!walletInstance->AttachChain(chain))` to `if (chain && !walletInstance->AttachChain(*chain))`",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T01:07:29Z",
      "diff_hunk" : "@@ -3980,10 +3990,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n \n     LOCK(walletInstance->cs_wallet);\n \n-    if (!walletInstance->AttachChain(chain, error, warnings)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555441172",
      "id" : 555441172,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQ0MTE3Mg==",
      "original_commit_id" : "9b575783f0f075d66350def60a842aee9ee05267",
      "original_line" : 3983,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555441172",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555828788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555828788"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"refactor: Handle first run in CWallet::AttachChain\" (b20c1e516d5bfc87e8d75a34799a91d71475ee8b)\r\n\r\nI think it's good that this PR adds `m_first_run`, to be able to freely move code around without changing behavior. In the future, though I think it would be good to eliminate `m_first_run`. This `chainStateFlushed` call seems to be the main place it is used, and it would seem better if this code updated the best block in a smarter way less awkwardly tied to the presence of keys and descriptors.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-12T14:50:20Z",
      "diff_hunk" : "@@ -4036,6 +4034,10 @@ CWallet::ScanStatus CWallet::AttachChain(std::shared_ptr<CWallet> wallet, bool s\n     auto& walletInstance = wallet;\n     LOCK(walletInstance->cs_wallet);\n \n+    if (walletInstance->m_first_run) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r555828788",
      "id" : 555828788,
      "line" : 4071,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTgyODc4OA==",
      "original_commit_id" : "b20c1e516d5bfc87e8d75a34799a91d71475ee8b",
      "original_line" : 4071,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 163,
      "pull_request_review_id" : 565829082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555828788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557242356"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557242356"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks. I initialised it to `false` so it wouldn't call `chainStateFlushed` by default. I think this is a safer option.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:10:19Z",
      "diff_hunk" : "@@ -720,6 +720,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     // ScriptPubKeyMan::GetID. In many cases it will be the hash of an internal structure\n     std::map<uint256, std::unique_ptr<ScriptPubKeyMan>> m_spk_managers;\n \n+    /** True if this wallet is loaded for the first time. */\n+    bool m_first_run;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557242356",
      "id" : 557242356,
      "in_reply_to_id" : 555413735,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI0MjM1Ng==",
      "original_commit_id" : "b528485dc7701dcd8fafcf2da996160c52546f07",
      "original_line" : 724,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 568038150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557242356",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557243331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557243331"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Squashed.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:11:53Z",
      "diff_hunk" : "@@ -791,15 +791,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     /** Registered interfaces::Chain::Notifications handler. */\n     std::unique_ptr<interfaces::Handler> m_chain_notifications_handler;\n \n-    /** Result of scanning a chain for new transactions */\n-    enum class ScanStatus { SUCCESS, FAILED, MISSING_BLOCKS, SKIPPED };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557243331",
      "id" : 557243331,
      "in_reply_to_id" : 555438988,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI0MzMzMQ==",
      "original_commit_id" : "847588a4b8e0dcc9975a675c46eca095c7cce4eb",
      "original_line" : 795,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 568039455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557243331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557243550"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557243550"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ð¤¦ ",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:12:14Z",
      "diff_hunk" : "@@ -2,13 +2,16 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <util/translation.h>\n #include <wallet/test/wallet_test_fixture.h>\n \n WalletTestingSetup::WalletTestingSetup(const std::string& chainName)\n     : TestingSetup(chainName),\n       m_wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase())\n {\n     m_wallet.LoadWallet();\n-    CWallet::AttachChain({ &m_wallet, [](CWallet*) {} });\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    CWalle::AttachChain({&m_wallet, [](CWallet*) {}}, *m_node.chain.get(), error, warnings);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557243550",
      "id" : 557243550,
      "in_reply_to_id" : 555437036,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI0MzU1MA==",
      "original_commit_id" : "847588a4b8e0dcc9975a675c46eca095c7cce4eb",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : null,
      "pull_request_review_id" : 568039743,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557243550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557244933"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557244933"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Totally! I started to look at how the best block record is used and maintained but it sent me down the rabbit hole as I'm not familiar with the codebase yet. I'll look at it as a follow up.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:14:13Z",
      "diff_hunk" : "@@ -4036,6 +4034,10 @@ CWallet::ScanStatus CWallet::AttachChain(std::shared_ptr<CWallet> wallet, bool s\n     auto& walletInstance = wallet;\n     LOCK(walletInstance->cs_wallet);\n \n+    if (walletInstance->m_first_run) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557244933",
      "id" : 557244933,
      "in_reply_to_id" : 555828788,
      "line" : 4071,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI0NDkzMw==",
      "original_commit_id" : "b20c1e516d5bfc87e8d75a34799a91d71475ee8b",
      "original_line" : 4071,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 163,
      "pull_request_review_id" : 568041513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557244933",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557265784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557265784"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed in a general comment below",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:45:36Z",
      "diff_hunk" : "@@ -3955,11 +3955,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n                                _(\"This is the transaction fee you will pay if you send a transaction.\"));\n         }\n         walletInstance->m_pay_tx_fee = CFeeRate(nFeePerK, 1000);\n-        if (walletInstance->m_pay_tx_fee < chain.relayMinFee()) {\n-            error = strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s' (must be at least %s)\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557265784",
      "id" : 557265784,
      "in_reply_to_id" : 555436448,
      "line" : 4008,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI2NTc4NA==",
      "original_commit_id" : "eabcd952d1c664cd964eb3376bc2865a49b33f16",
      "original_line" : 4008,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 89,
      "pull_request_review_id" : 568067702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557265784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557270303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557270303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for bringing it up. I looked at `g_load_wallet_fns` and there are two use-cases for it both in UI:\r\n * register handler for show progress messages\r\n * create and connect wallet model for UI controller\r\n\r\nI have almost zero understanding of GUI code and QT, but it looks like a safe change to me. Can we ask someone with better understanding of GUI to comment on that?\r\n\r\nAlso see my general comment below regarding the responsibility to call `AttachChain`.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-01-14T09:52:28Z",
      "diff_hunk" : "@@ -3980,10 +3990,6 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n \n     LOCK(walletInstance->cs_wallet);\n \n-    if (!walletInstance->AttachChain(chain, error, warnings)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r557270303",
      "id" : 557270303,
      "in_reply_to_id" : 555441172,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzI3MDMwMw==",
      "original_commit_id" : "9b575783f0f075d66350def60a842aee9ee05267",
      "original_line" : 3983,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 568073389,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-14T07:53:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557270303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky greatly appreciate your review.\r\n\r\n> * It would be good to squash 5th commit into 1st commit. No need to add a method and enum in one commit and then change the signature and drop the enum right after.\r\n\r\nI squashed handling first run and changing signature commits into adding `AttachChain`. There are less changing back and forth and overall it looks a bit simpler now.\r\n\r\n> * I think 4th and 7th commits should probably be dropped, but see specific comments below.\r\n\r\nI believe it's good to discuss a bit the design and future of `CWallet` before moving forward. I made those changes based on the following assumptions:\r\n A)Â a wallet instance is not dependent on a chain object and could exist without a chain\r\n B) a wallet instance could be later attached to a chain if required\r\nThose assumption are based on my observation of the `wallet tool` which operates completely \"offline\". In my opinion this provides nice and clear wallet lifecycle and delineation of concerns. Thus we would remove `chain` argument from `CWallet` ctr and `Create` methods in the future. It would require changing how tx are loaded, but I think it's doable and would simplify the code.\r\n\r\nI'd like to know what do you think.",
      "created_at" : "2021-01-14T09:52:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-760086132",
      "id" : 760086132,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDA4NjEzMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-14T09:52:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760086132",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ISTM there are 5 main components of `CWallet::Create`: Loading/creating the wallet file, initializing new wallets, processing all of the wallet CLI args, setting up the chain, and setting up wallet client interfaces.\r\n\r\nWhat I had envisioned for splitting up `CWallet::Create` was to have separate functions for each of those components but still having `CWallet::Create` call all of them. This would allow for the typical use case to have a convenience function that does everything. But for the wallet tool where we don't need to do some of those parts, we could just call the underlying functions directly. For example, for `bitcoin-wallet create`, we would just call the load/create wallet file function, and then the setup new wallet function.\r\n\r\nI agree with @ryanofsky that the assumption that changing the attached chain later is incorrect. I don't think it makes sense that the wallet would want to be able to change to a new chain after being initialized. However it does make sense that we would want to create a wallet with no chain for the offline mode stuff.",
      "created_at" : "2021-01-15T20:31:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-761182042",
      "id" : 761182042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MTE4MjA0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-15T20:31:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/761182042",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks ryanofsky and achow101, I have a better understanding now and adjusted my PR accordingly:\r\n\r\n1) I removed the last commit and  restored `AttachChain` call within `CWallet::Create`\r\n2) I made `chain` arg of `CWallet::Create` optional to accommodate wallet tool use-case\r\n\r\nI kept the 3rd commit which moves chain related checks to `AttachChain`. This way we can have all chain related code in `AttachChain` method in alignment with what achow101 said. As a benefit we need to check if `chain` is passed into `CWallet::Create` only once.\r\n\r\nThanks for your reviews, I'm more satisfied with how this PR looks right now.",
      "created_at" : "2021-01-18T08:51:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-762091567",
      "id" : 762091567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MjA5MTU2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-18T08:51:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/762091567",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-12T07:41:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-797300676",
      "id" : 797300676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzMwMDY3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T07:41:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797300676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@meshcollider did you want to have a look here?",
      "created_at" : "2021-04-01T09:18:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-811775801",
      "id" : 811775801,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMTc3NTgwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-01T09:18:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/811775801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yep I will review this sometime in the next couple of days ð \r\n\r\nConcept ACK",
      "created_at" : "2021-04-06T04:54:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-813820506",
      "id" : 813820506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzgyMDUwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T04:54:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813820506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-13T16:30:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-818873866",
      "id" : 818873866,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODg3Mzg2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T16:30:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818873866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased to fix conflict in `src/wallet/test/wallet_tests.cpp`",
      "created_at" : "2021-04-14T07:53:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-819311990",
      "id" : 819311990,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxOTMxMTk5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-14T07:53:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819311990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r628893976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628893976"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Question: How does one distinguish whether accessing a wallet field (in this case `walletInstance->m_first_run`) requires `cs_wallet` lock or not? I'm asking because `cs_wallet` is described like this:\r\n\r\n```cpp\r\n/*\r\n * Main wallet lock.\r\n * This lock protects all the fields added by CWallet.  */\r\nmutable RecursiveMutex cs_wallet;\r\n```\r\n\r\nCan anybody shed light on this for my information?\r\n",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-05-09T13:55:09Z",
      "diff_hunk" : "@@ -3879,7 +3877,7 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n-    if (fFirstRun)\n+    if (walletInstance->m_first_run)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r628893976",
      "id" : 628893976,
      "line" : 3880,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODg5Mzk3Ng==",
      "original_commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "original_line" : 3880,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 655081122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-09T13:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/628893976",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-10T12:13:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#issuecomment-836622316",
      "id" : 836622316,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20773",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzNjYyMjMxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-10T12:13:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/836622316",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629334016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629334016"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Question: How does one distinguish whether accessing a wallet field (in this case `walletInstance->m_first_run`) requires `cs_wallet` lock or not?\r\n\r\nPeople may have different ideas about what \"requires\" means, but I would say a variable is required to be locked if not locking it would cause bugs. I.e. if it can be read and written at the same time from multiple threads. So a lock is not required for this because parts of wallet loading code which use this are single threaded.\r\n\r\nBut I do think it would be a small improvement to write `bool m_first_run GUARDED_BY(cs_wallet) = false;` and lock during init to avoid questions and doubts about races during loading.",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-05-10T12:54:23Z",
      "diff_hunk" : "@@ -3879,7 +3877,7 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n-    if (fFirstRun)\n+    if (walletInstance->m_first_run)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629334016",
      "id" : 629334016,
      "in_reply_to_id" : 628893976,
      "line" : 3880,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyOTMzNDAxNg==",
      "original_commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "original_line" : 3880,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 655608573,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-10T12:54:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629334016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629602249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629602249"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review. Since I need to rebase the branch anyway I'm going to incorporate the suggestion",
      "commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "created_at" : "2021-05-10T18:48:42Z",
      "diff_hunk" : "@@ -3879,7 +3877,7 @@ std::shared_ptr<CWallet> CWallet::Create(interfaces::Chain& chain, const std::st\n         }\n     }\n \n-    if (fFirstRun)\n+    if (walletInstance->m_first_run)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20773#discussion_r629602249",
      "id" : 629602249,
      "in_reply_to_id" : 628893976,
      "line" : 3880,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyOTYwMjI0OQ==",
      "original_commit_id" : "84980ae4deb828f0675478fad2f7e0b6dec69520",
      "original_line" : 3880,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 71,
      "pull_request_review_id" : 655980749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20773",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-05-10T18:48:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/629602249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   }
]
