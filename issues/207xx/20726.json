{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "When we initiate a block-relay-only connection today, our peer doesn't know that we don't want addr relay on the link, and they don't even know that we won't turn on transaction relay at some later point during the connection's lifetime.\r\n\r\nThis PR adds a new p2p message, ~~BLOCKRELAY~~ DISABLETX, to be sent between VERSION and VERACK so that peers can signal to each other that they only want blocks/compactblocks/headers to be sent on the link, and not transaction-relay traffic or addr messages.\r\n\r\nIn this PR, we immediately use this information to stop relaying ADDR messages to inbound block-relay-only peers.  In the future, we can also save a bit of memory by not allocating (or deallocating) the peer data structures we maintain for transaction and address relay.\r\n\r\nThis change needs a BIP as well; a draft is located here: https://github.com/sdaftuar/bips/blob/2020-09-negotiate-block-relay/bip-disable-tx.mediawiki\r\n\r\nI'm looking for concept ACKs and feedback on the BIP for now, as well as any thoughts on whether this PR is essentially feature complete to justify inclusion, or if anything seems to be missing?  I've intentionally held off on the memory savings from deallocating `m_tx_relay` and `m_addr_known` for inbound block-relay-only peers, because that would conflict with the work to refactor `net`/`net_processing` and move those data structures out of `CNode` (and also because I think we need to fix the synchronization on these objects to make it work).\r\n\r\n I'm marking this PR as a draft until I at least publish the BIP proposal to the mailing list.\r\n\r\nNOTE: This has been edited to reflect some changes to the draft BIP.",
   "closed_at" : null,
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
      "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sdaftuar/followers",
      "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sdaftuar",
      "id" : 7463573,
      "login" : "sdaftuar",
      "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
      "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
      "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
      "repos_url" : "https://api.github.com/users/sdaftuar/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sdaftuar"
   },
   "comments" : 26,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20726/comments",
   "created_at" : "2020-12-19T20:55:36Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20726/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/20726",
   "id" : 771452944,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20726/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NTQyOTc3MTM4",
   "number" : 20726,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/20726.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20726",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/20726.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20726"
   },
   "reactions" : {
      "+1" : 2,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 1,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 3,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20726/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20726/timeline",
   "title" : "p2p: Add DISABLETX message for negotiating block-relay-only connections",
   "updated_at" : "2022-01-04T16:47:32Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20726",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
      "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sdaftuar/followers",
      "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sdaftuar",
      "id" : 7463573,
      "login" : "sdaftuar",
      "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
      "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
      "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
      "repos_url" : "https://api.github.com/users/sdaftuar/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sdaftuar"
   }
}
