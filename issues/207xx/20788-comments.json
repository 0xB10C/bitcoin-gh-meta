[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The following two PRs would benefit from this:\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/19203 would only need to add the fuzzing test and the mocked/fuzzed `Sock` implementation (last commit from that PR).\r\n* https://github.com/bitcoin/bitcoin/pull/20685 would become smaller. `Sock` originated there and that PR contains a copy of it. So if this PR gets merged, then the size of #20685 will be reduced.",
      "created_at" : "2020-12-28T16:18:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20788#issuecomment-751770419",
      "id" : 751770419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20788",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MTc3MDQxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-28T16:18:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/751770419",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20788#discussion_r549406398"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20788"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549406398"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n#include <netbase.h> // For CloseSocket\r\n```\r\n\r\nIt seems this is the only Bitcoin Core related dependency. Are the other includes needed at all? If not, it would be good to move this module to `util`, which is the place for general utility stuff (not bitcoin related).",
      "commit_id" : "99b8e88a15cb12483f28079d0f91fe8cf361da56",
      "created_at" : "2020-12-28T16:26:39Z",
      "diff_hunk" : "@@ -0,0 +1,134 @@\n+// Copyright (c) 2012-2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat.h>\n+#include <netaddress.h>\n+#include <netbase.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20788#discussion_r549406398",
      "id" : 549406398,
      "line" : 7,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQwNjM5OA==",
      "original_commit_id" : "99b8e88a15cb12483f28079d0f91fe8cf361da56",
      "original_line" : 7,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/sock.cpp",
      "position" : 7,
      "pull_request_review_id" : 559212963,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20788",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-28T16:28:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549406398",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20685 (Add I2P support using I2P SAM by vasild)\n* #20649 (refactor: Remove nMyStartingHeight from CNode/Connman by MarcoFalke)\n* #19415 (net: Make DNS lookup mockable, add fuzzing harness by practicalswift)\n* #19203 (net: Add regression fuzz harness for CVE-2017-18350. Add FuzzedSocket. Add thin SOCKET wrapper. by practicalswift)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-12-28T17:07:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20788#issuecomment-751790123",
      "id" : 751790123,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20788",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc1MTc5MDEyMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-28T17:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/751790123",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20788#discussion_r549461016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20788"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549461016"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Q: would it make sense to have this method as part of the `Sock`? (Something similar to `Sock::recv` but with a timeout parameter)",
      "commit_id" : "99b8e88a15cb12483f28079d0f91fe8cf361da56",
      "created_at" : "2020-12-28T19:26:26Z",
      "diff_hunk" : "@@ -347,15 +349,15 @@ enum class IntrRecvError {\n  *      Sockets can be made non-blocking with SetSocketNonBlocking(const\n  *      SOCKET&, bool).\n  */\n-static IntrRecvError InterruptibleRecv(uint8_t* data, size_t len, int timeout, const SOCKET& hSocket)\n+static IntrRecvError InterruptibleRecv(uint8_t* data, size_t len, int timeout, const Sock& sock)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20788#discussion_r549461016",
      "id" : 549461016,
      "line" : 352,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ2MTAxNg==",
      "original_commit_id" : "99b8e88a15cb12483f28079d0f91fe8cf361da56",
      "original_line" : 352,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 33,
      "pull_request_review_id" : 559273398,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20788",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-28T19:26:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549461016",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/127973?v=4",
         "events_url" : "https://api.github.com/users/lontivero/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lontivero/followers",
         "following_url" : "https://api.github.com/users/lontivero/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lontivero/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lontivero",
         "id" : 127973,
         "login" : "lontivero",
         "node_id" : "MDQ6VXNlcjEyNzk3Mw==",
         "organizations_url" : "https://api.github.com/users/lontivero/orgs",
         "received_events_url" : "https://api.github.com/users/lontivero/received_events",
         "repos_url" : "https://api.github.com/users/lontivero/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lontivero/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lontivero/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lontivero"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20788#discussion_r549718454"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20788"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549718454"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, indeed. That would be convenient together with a `send` method that retries upon temporary failures (see below).\r\n\r\nI did not include such methods in this PR because it is self-sufficient as it is and achieves the initial purpose to introduce a mockable socket that can be used for fuzzing in https://github.com/bitcoin/bitcoin/pull/19203.\r\n\r\nPossible future improvements (which I resisted adding in this PR):\r\n* Add robust receiving method, like `InterruptibleRecv()` (or change that function to a method of the `Sock` class)\r\n* Add robust sending method, like [`SendComplete()`](https://github.com/bitcoin/bitcoin/blob/2ae504c4b96013c87cc97909bdb00866fc4ab8a0/src/netbase.cpp#L1085) from https://github.com/bitcoin/bitcoin/pull/20685\r\n* Use `Sock` in more places instead of the bare `SOCKET` - chase all places where `Sock::Release()` or `Sock::Get()` is called and see if the consumer can be changed to use `Sock` instead. E.g. in `CNode` constructor.",
      "commit_id" : "99b8e88a15cb12483f28079d0f91fe8cf361da56",
      "created_at" : "2020-12-29T14:10:40Z",
      "diff_hunk" : "@@ -347,15 +349,15 @@ enum class IntrRecvError {\n  *      Sockets can be made non-blocking with SetSocketNonBlocking(const\n  *      SOCKET&, bool).\n  */\n-static IntrRecvError InterruptibleRecv(uint8_t* data, size_t len, int timeout, const SOCKET& hSocket)\n+static IntrRecvError InterruptibleRecv(uint8_t* data, size_t len, int timeout, const Sock& sock)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20788#discussion_r549718454",
      "id" : 549718454,
      "in_reply_to_id" : 549461016,
      "line" : 352,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcxODQ1NA==",
      "original_commit_id" : "99b8e88a15cb12483f28079d0f91fe8cf361da56",
      "original_line" : 352,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 33,
      "pull_request_review_id" : 559548844,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20788",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-12-29T14:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/549718454",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
