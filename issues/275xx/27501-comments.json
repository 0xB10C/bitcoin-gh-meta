[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [MarcoFalke](https://github.com/bitcoin/bitcoin/pull/27501#pullrequestreview-1394327087) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-04-20T15:01:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#issuecomment-1516488500",
      "id" : 1516488500,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27501",
      "node_id" : "IC_kwDOABII585aY8c0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516488500/reactions"
      },
      "updated_at" : "2023-04-20T16:12:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516488500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172733241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172733241"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",\r\n```\r\n\r\nnit",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:05:17Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172733241",
      "id" : 1172733241,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5n05",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 916,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394217946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172733241/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172733241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172737216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172737216"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Won't this need mempool.cs to ensure an atomic result? Otherwise you may get nonsense back on a data race, like a parent missing from the mempool, when the child is in the mempool, no?",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:08:21Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta));\n+            result_inner.pushKV(\"in-mempool\", mempool.exists(GenTxid::Txid(txid)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172737216",
      "id" : 1172737216,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5ozA",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 940,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394217946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172737216/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172737216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172747649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172747649"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes good point. Will add a lock-already-held `exists` and put this all under `LOCK(mempool.cs)`",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:16:29Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta));\n+            result_inner.pushKV(\"in-mempool\", mempool.exists(GenTxid::Txid(txid)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172747649",
      "id" : 1172747649,
      "in_reply_to_id" : 1172737216,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5rWB",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 940,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394239870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172747649/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:16:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172747649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172748986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172748986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, or would it be better to have `CTxMemPool::GetPrioritisationMap` take the lock and create a map from txid to pair<fee, bool>?\r\nedit: doing this one",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:17:36Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta));\n+            result_inner.pushKV(\"in-mempool\", mempool.exists(GenTxid::Txid(txid)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172748986",
      "id" : 1172748986,
      "in_reply_to_id" : 1172737216,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5rq6",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 940,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394242045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172748986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:41:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172748986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172792521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172792521"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:52:04Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172792521",
      "id" : 1172792521,
      "in_reply_to_id" : 1172733241,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F52TJ",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 916,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394306674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172792521/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:52:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172792521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172799613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172799613"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T15:57:53Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"\\nReturns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta));\n+            result_inner.pushKV(\"in-mempool\", mempool.exists(GenTxid::Txid(txid)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172799613",
      "id" : 1172799613,
      "in_reply_to_id" : 1172737216,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F54B9",
      "original_commit_id" : "2c0eee60c5e3804f33194f7a8f707c0983c7eecf",
      "original_line" : 940,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1394317134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172799613/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:57:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172799613",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172806194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172806194"
         }
      },
      "author_association" : "MEMBER",
      "body" : "clang-format new code (only if you retouch)",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T16:03:26Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",\n+            {\n+                {RPCResult::Type::OBJ, \"txid\", \"transaction txid\", {\n+                    {RPCResult::Type::STR_AMOUNT, \"fee-delta\", \"transaction fee delta in \" + CURRENCY_UNIT},\n+                    {RPCResult::Type::BOOL, \"in-mempool\", \"whether this transaction is currently in mempool\"},\n+                }}\n+            },\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getprioritisationmap\", \"\")\n+            + HelpExampleRpc(\"getprioritisationmap\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+        NodeContext& node = EnsureAnyNodeContext(request.context);\n+        CTxMemPool& mempool = EnsureMemPool(node);\n+        UniValue rpc_result{UniValue::VOBJ};\n+        const auto prioritisation_map{mempool.GetPrioritisationMap()};\n+        for (const auto& [txid, delta_exists_pair] : prioritisation_map) {\n+            UniValue result_inner{UniValue::VOBJ};\n+            result_inner.pushKV(\"fee-delta\", ValueFromAmount(delta_exists_pair.first));\n+            result_inner.pushKV(\"in-mempool\", delta_exists_pair.second);\n+            rpc_result.pushKV(txid.GetHex(), result_inner);\n+        }\n+        return rpc_result;\n+},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172806194",
      "id" : 1172806194,
      "line" : 944,
      "node_id" : "PRRC_kwDOABII585F55oy",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 944,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 35,
      "pull_request_review_id" : 1394327087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172806194/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T16:12:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172806194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172814908"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172814908"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        result.try_emplace(txid, delta, in_mempool);\r\n```\r\n\r\nnit: `try_emplace` should avoid duplicate and unneeded (move) constructor calls? Also, it is shorter.",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-20T16:11:16Z",
      "diff_hunk" : "@@ -889,6 +894,18 @@ void CTxMemPool::ClearPrioritisation(const uint256& hash)\n     mapDeltas.erase(hash);\n }\n \n+std::map<uint256, std::pair<CAmount, bool>> CTxMemPool::GetPrioritisationMap() const\n+{\n+    AssertLockNotHeld(cs);\n+    LOCK(cs);\n+    std::map<uint256, std::pair<CAmount, bool>> result;\n+    for (const auto& [txid, delta] : mapDeltas) {\n+        const bool in_mempool{mapTx.count(txid) != 0};\n+        result.emplace(std::make_pair(txid, std::make_pair(delta, in_mempool)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1172814908",
      "id" : 1172814908,
      "line" : 904,
      "node_id" : "PRRC_kwDOABII585F57w8",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 904,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 26,
      "pull_request_review_id" : 1394327087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172814908/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T16:12:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172814908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe add a short description for what  `mapDeltas` is to the PR description under \"motivation / background\"? afaict `mapDeltas` also doesn't have any code documentation.",
      "created_at" : "2023-04-20T16:11:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#issuecomment-1516600484",
      "id" : 1516600484,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27501",
      "node_id" : "IC_kwDOABII585aZXyk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516600484/reactions"
      },
      "updated_at" : "2023-04-20T16:11:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516600484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1173574801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173574801"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by txid\",\r\n```",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-21T09:48:16Z",
      "diff_hunk" : "@@ -910,6 +910,41 @@ static RPCHelpMan submitpackage()\n     };\n }\n \n+static RPCHelpMan getprioritisationmap()\n+{\n+    return RPCHelpMan{\"getprioritisationmap\",\n+        \"Returns a map of all fee deltas in memory pool by txid, and whether the tx is present in mempool.\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::OBJ_DYN, \"prioritisation-map\", \"prioritisation keyed by wtxid\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1173574801",
      "id" : 1173574801,
      "line" : 919,
      "node_id" : "PRRC_kwDOABII585F81SR",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 919,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 10,
      "pull_request_review_id" : 1395462615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173574801/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-21T10:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173574801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1173597419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173597419"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Slight rephrasing suggestion:\r\n```suggestion\r\n    /** Return a map of all entries in mapDeltas with as value their fee delta and whether the transaction is present in the mempoool. */\r\n```",
      "commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "created_at" : "2023-04-21T10:12:45Z",
      "diff_hunk" : "@@ -515,6 +515,8 @@ class CTxMemPool\n     void PrioritiseTransaction(const uint256& hash, const CAmount& nFeeDelta);\n     void ApplyDelta(const uint256& hash, CAmount &nFeeDelta) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     void ClearPrioritisation(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    /** Return a copy of mapDeltas in which values include fee delta and whether the transaction is present in the mempoool. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27501#discussion_r1173597419",
      "id" : 1173597419,
      "line" : 518,
      "node_id" : "PRRC_kwDOABII585F86zr",
      "original_commit_id" : "d5069a4f0e2aa186448669d6216986ba152e7839",
      "original_line" : 518,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 4,
      "pull_request_review_id" : 1395462615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27501",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173597419/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-21T10:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173597419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   }
]
