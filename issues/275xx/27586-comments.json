[
   {
      "author_association" : "MEMBER",
      "body" : "I experienced this as well.",
      "created_at" : "2023-05-07T09:14:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537366596",
      "id" : 1537366596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bolpE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537366596/reactions"
      },
      "updated_at" : "2023-05-07T09:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537366596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Been seeing this on my 24.0.1 public nodes as well, it's not 100% CPU usage as such, but a single CPU core is spinning at 100%. One 24.0.1 node with listen=0 did not seem affected.\r\n\r\nI noticed that after a node restart, the CPU usage went back to normal (and is still normal after a day) even though the mempool was loaded from disk - though it might be because it's no longer entirely full due to mempoolminfee.\r\n\r\nPS: These nodes do **not** run in debug mode.",
      "created_at" : "2023-05-07T18:39:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537513884",
      "id" : 1537513884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpJmc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537513884/reactions"
      },
      "updated_at" : "2023-05-07T18:50:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537513884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73581993?v=4",
         "events_url" : "https://api.github.com/users/ArmchairCryptologist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ArmchairCryptologist/followers",
         "following_url" : "https://api.github.com/users/ArmchairCryptologist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ArmchairCryptologist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ArmchairCryptologist",
         "id" : 73581993,
         "login" : "ArmchairCryptologist",
         "node_id" : "MDQ6VXNlcjczNTgxOTkz",
         "organizations_url" : "https://api.github.com/users/ArmchairCryptologist/orgs",
         "received_events_url" : "https://api.github.com/users/ArmchairCryptologist/received_events",
         "repos_url" : "https://api.github.com/users/ArmchairCryptologist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ArmchairCryptologist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ArmchairCryptologist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ArmchairCryptologist"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just to confirm, yours was in debug mode as well? Otherwise it'd be concerning.\n\n-------- Original Message --------\nOn May 7, 2023, 8:39 PM, ArmchairCryptologist wrote:\n\n> Been seeing this on my 24.0.1 public nodes as well, it's not 100% CPU usage as such, but a single CPU core is spinning at 100%. One 24.0.1 node with listen=0 did not seem affected.\n>\n> I noticed that after a node restart, the CPU usage went back to normal (and is still normal after a day) even though the mempool was loaded from disk - though it might be because it's not entirely full.\n>\n> â\n> Reply to this email directly, [view it on GitHub](https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537513884), or [unsubscribe](https://github.com/notifications/unsubscribe-auth/AFLK3F7KEP44Z6OFB25VRUDXE7T6FANCNFSM6AAAAAAXXYXUTA).\n> You are receiving this because you commented.Message ID: ***@***.***>",
      "created_at" : "2023-05-07T20:17:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537531968",
      "id" : 1537531968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpOBA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537531968/reactions"
      },
      "updated_at" : "2023-05-07T20:17:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537531968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Just to confirm, yours was in debug mode as well? Otherwise it'd be concerning.\r\n\r\nMy nodes are NOT in debug mode, no. I run four public nodes (24.0.1) with different server hosts, and all four of them were spinning a CPU core at 100% and experiencing slowness with block/transaction handling when I checked them yesterday, two to the point where they started occasionally dropping connectivity to my private nodes. Like I mentioned, one 24.0.1 node which does not accept incoming connections (but is connected to untrusted nodes) did not have this issue. The other private nodes still run 23.0.0 and also do not have any issues, though these only connect through my own public nodes so they aren't directly exposed to untrusted nodes.",
      "created_at" : "2023-05-07T20:29:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537534014",
      "id" : 1537534014,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpOg-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537534014/reactions"
      },
      "updated_at" : "2023-05-07T20:29:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537534014",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73581993?v=4",
         "events_url" : "https://api.github.com/users/ArmchairCryptologist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ArmchairCryptologist/followers",
         "following_url" : "https://api.github.com/users/ArmchairCryptologist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ArmchairCryptologist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ArmchairCryptologist",
         "id" : 73581993,
         "login" : "ArmchairCryptologist",
         "node_id" : "MDQ6VXNlcjczNTgxOTkz",
         "organizations_url" : "https://api.github.com/users/ArmchairCryptologist/orgs",
         "received_events_url" : "https://api.github.com/users/ArmchairCryptologist/received_events",
         "repos_url" : "https://api.github.com/users/ArmchairCryptologist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ArmchairCryptologist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ArmchairCryptologist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ArmchairCryptologist"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> PS: These nodes do **not** run in debug mode.\r\n\r\nWith the issue I described here patched around, I see a different problem that also results in b-msghand using ~100% of a single cpu. It seems to be spent in `make_heap` in `net_processing.cpp` which in turn seems to be due to the internal queues for which txs need to be INVed to which peers growing much too large (I've observed >60,000 entries in each of 6 peers, eg). It seems to be exacerbated by a combination of inbound peers that aren't really relaying transactions (so the queue is only being cleared when we send things, so effectively half or a third of the rate compared to if they were sending INVs as well) and other peers sending txs to us at a rate much faster than the network can actually support.\r\n\r\nThat's a different bug though, so I'll open it up as a different issue after getting some better data...",
      "created_at" : "2023-05-07T21:31:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537544963",
      "id" : 1537544963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpRMD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537544963/reactions"
      },
      "updated_at" : "2023-05-07T21:31:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537544963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, if anyone wants to mitigate the `make_heap` thing; I think something like:\r\n\r\n```sh\r\n$ bitcoin-cli getpeerinfo | jq -j '.[] | (.bytessent_per_msg.inv, \" \", .bytesrecv_per_msg.inv, \" \", .addr, \"\\n\")' | grep ' null ' | sort -n\r\n```\r\n\r\nshould list the nodes where you're sending lots of inv data, without receiving anything in return. Doing a temporary \"setban\" on those to disconnect them will clear their inv queue and should speed things up temporarily.",
      "created_at" : "2023-05-07T21:37:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537545897",
      "id" : 1537545897,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bpRap",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537545897/reactions"
      },
      "updated_at" : "2023-05-07T21:37:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537545897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Of the four nodes, the one that was restarted on May 6th is now back to spinning 100% of a CPU core (60% average CPU usage on a two-core VM the last hour) while the three that were restarted yesterday are also seeing high CPU usage but not 100% all the time (between 30% and 38% average CPU usage on a two-core VM), so it's building back up relatively quickly. I also verified that the mempool is not fully committed (usage is at 251217552).\r\n\r\nThere were around 15 peers with bytessent_per_msg.inv over 100000 without any received ones, but even after doing setban on them and verifying that they have been disconnected, the CPU usage did not drop noticeably if at all. This is probably because the node has 180 connected peers, and 140+ of those have both bytessent_per_msg.inv and bytesrecv_per_msg.inv over 100000, so disconnecting 15 of them for not sending any probably doesn't do much..\r\n\r\nBased on what you say about it being a different bug I assume that it is not an issue introduced with 24.0, but I reverted one of the nodes to 23.0 just to verify.",
      "created_at" : "2023-05-08T05:43:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27586#issuecomment-1537784340",
      "id" : 1537784340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27586",
      "node_id" : "IC_kwDOABII585bqLoU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537784340/reactions"
      },
      "updated_at" : "2023-05-08T05:44:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1537784340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73581993?v=4",
         "events_url" : "https://api.github.com/users/ArmchairCryptologist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ArmchairCryptologist/followers",
         "following_url" : "https://api.github.com/users/ArmchairCryptologist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ArmchairCryptologist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ArmchairCryptologist",
         "id" : 73581993,
         "login" : "ArmchairCryptologist",
         "node_id" : "MDQ6VXNlcjczNTgxOTkz",
         "organizations_url" : "https://api.github.com/users/ArmchairCryptologist/orgs",
         "received_events_url" : "https://api.github.com/users/ArmchairCryptologist/received_events",
         "repos_url" : "https://api.github.com/users/ArmchairCryptologist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ArmchairCryptologist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ArmchairCryptologist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ArmchairCryptologist"
      }
   }
]
