[
   {
      "author_association" : "MEMBER",
      "body" : "Naming discussion welcome. Previous naming thread at https://github.com/bitcoin/bitcoin/pull/24697#discussion_r846898856",
      "created_at" : "2022-05-10T11:12:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#issuecomment-1122251124",
      "id" : 1122251124,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25101",
      "node_id" : "IC_kwDOABII585C5DF0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122251124/reactions"
      },
      "updated_at" : "2022-05-10T11:12:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122251124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24697](https://github.com/bitcoin/bitcoin/pull/24697) (refactor address relay time by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-05-10T19:18:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#issuecomment-1122771611",
      "id" : 1122771611,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25101",
      "node_id" : "IC_kwDOABII585C7CKb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122771611/reactions"
      },
      "updated_at" : "2022-05-10T19:18:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122771611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r869721210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869721210"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Doesn't `Now<>()` want a timepoint type, rather than a clock? Should be `Now<NodeSeconds>()` or `Now<SteadyMilliseconds>()`, no?",
      "commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "created_at" : "2022-05-10T22:17:48Z",
      "diff_hunk" : "@@ -43,7 +58,10 @@ inline double CountSecondsDouble(SecondsDouble t) { return t.count(); }\n \n /**\n  * DEPRECATED\n- * Use either GetTimeSeconds (not mockable) or GetTime<T> (mockable)\n+ * Use either:\n+ * - std::chrono::sytem_clock::now()  or Now<std::chrono::system_clock>() for system time\n+ * - std::chrono::steady_clock::now() or Now<std::chrono::steady_clock>() for steady time\n+ * - NodeClock::now()                 or Now<NodeClock>()                 for mockable system time",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r869721210",
      "id" : 869721210,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1uR6",
      "original_commit_id" : "fa66cf13a5cdd8b911ad56167dc20b79196a39be",
      "original_line" : 64,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 968467491,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869721210/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-11T16:15:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869721210",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r869722231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869722231"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`return Now<std::chrono::time_point<NodeClock, T>>().time_since_epoch()` ?",
      "commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "created_at" : "2022-05-10T22:19:55Z",
      "diff_hunk" : "@@ -70,7 +88,10 @@ std::chrono::seconds GetMockTime();\n \n /** Return system time (or mocked time, if set) */\n template <typename T>\n-T GetTime();\n+T GetTime()\n+{\n+    return std::chrono::duration_cast<T>(NodeClock::now().time_since_epoch());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r869722231",
      "id" : 869722231,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z1uh3",
      "original_commit_id" : "fa66cf13a5cdd8b911ad56167dc20b79196a39be",
      "original_line" : 93,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 968467491,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869722231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-11T16:15:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869722231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870605393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870605393"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch, reworked doxygen string",
      "commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "created_at" : "2022-05-11T18:04:05Z",
      "diff_hunk" : "@@ -43,7 +58,10 @@ inline double CountSecondsDouble(SecondsDouble t) { return t.count(); }\n \n /**\n  * DEPRECATED\n- * Use either GetTimeSeconds (not mockable) or GetTime<T> (mockable)\n+ * Use either:\n+ * - std::chrono::sytem_clock::now()  or Now<std::chrono::system_clock>() for system time\n+ * - std::chrono::steady_clock::now() or Now<std::chrono::steady_clock>() for steady time\n+ * - NodeClock::now()                 or Now<NodeClock>()                 for mockable system time",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870605393",
      "id" : 870605393,
      "in_reply_to_id" : 869721210,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z5GJR",
      "original_commit_id" : "fa66cf13a5cdd8b911ad56167dc20b79196a39be",
      "original_line" : 64,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 969793726,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870605393/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-11T18:04:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870605393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870605935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870605935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, makes sense to use the casting feature of `Now`.",
      "commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "created_at" : "2022-05-11T18:04:51Z",
      "diff_hunk" : "@@ -70,7 +88,10 @@ std::chrono::seconds GetMockTime();\n \n /** Return system time (or mocked time, if set) */\n template <typename T>\n-T GetTime();\n+T GetTime()\n+{\n+    return std::chrono::duration_cast<T>(NodeClock::now().time_since_epoch());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870605935",
      "id" : 870605935,
      "in_reply_to_id" : 869722231,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z5GRv",
      "original_commit_id" : "fa66cf13a5cdd8b911ad56167dc20b79196a39be",
      "original_line" : 93,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 969794518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870605935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-11T18:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870605935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870625577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870625577"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should this be called `seconds_since_epoch` (or the camelcase equivalent) perhaps? Looking back through #24697 it doesn't seem like it's just a temporary that will go away, so might be worth clearly distinguishing something that's working with a timepoint vs a duration.\r\n\r\nAt least as far as #24697 is concerned, this is effectively implementing  the behaviour of `NodeClock::to_time_t` so it's a bit funny that you explicitly deleted it above then reimplemented it here :)",
      "commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "created_at" : "2022-05-11T18:26:09Z",
      "diff_hunk" : "@@ -14,22 +14,37 @@\n \n using namespace std::chrono_literals;\n \n+/** Mockable clock in the context of tests, otherwise the system clock */\n+struct NodeClock : std::chrono::system_clock {\n+    using time_point = std::chrono::time_point<NodeClock>;\n+    /** Return current system time or mocked time, if set */\n+    static time_point now() noexcept;\n+    static std::time_t to_time_t(const time_point&) = delete; // unused\n+    static time_point from_time_t(std::time_t) = delete;      // unused\n+};\n+using NodeSeconds = std::chrono::time_point<NodeClock, std::chrono::seconds>;\n+\n using SteadySeconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::seconds>;\n using SteadyMilliseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::milliseconds>;\n using SteadyMicroseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::microseconds>;\n \n void UninterruptibleSleep(const std::chrono::microseconds& n);\n \n /**\n- * Helper to count the seconds of a duration.\n+ * Helper to count the seconds of a duration/time_point.\n  *\n- * All durations should be using std::chrono and calling this should generally\n+ * All durations/time_points should be using std::chrono and calling this should generally\n  * be avoided in code. Though, it is still preferred to an inline t.count() to\n  * protect against a reliance on the exact type of t.\n  *\n- * This helper is used to convert durations before passing them over an\n+ * This helper is used to convert durations/time_points before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n+template <typename Clock>\n+constexpr int64_t count_seconds(std::chrono::time_point<Clock, std::chrono::seconds> t)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870625577",
      "id" : 870625577,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z5LEp",
      "original_commit_id" : "fa201cc1b84793d0463650f43a7fd6705c7754de",
      "original_line" : 44,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 969822110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870625577/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-11T18:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870625577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870638314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870638314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is `time_t` using more than 32-bits on all platforms? Also rounding/truncation is implementation defined. So it seems best to avoid.\r\n\r\nAlso, I expect count_milliseconds to be added in the future, which `to_time_t` can't handle either.\r\n\r\n`seconds_since_epoch` sounds good, will change.",
      "commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "created_at" : "2022-05-11T18:41:59Z",
      "diff_hunk" : "@@ -14,22 +14,37 @@\n \n using namespace std::chrono_literals;\n \n+/** Mockable clock in the context of tests, otherwise the system clock */\n+struct NodeClock : std::chrono::system_clock {\n+    using time_point = std::chrono::time_point<NodeClock>;\n+    /** Return current system time or mocked time, if set */\n+    static time_point now() noexcept;\n+    static std::time_t to_time_t(const time_point&) = delete; // unused\n+    static time_point from_time_t(std::time_t) = delete;      // unused\n+};\n+using NodeSeconds = std::chrono::time_point<NodeClock, std::chrono::seconds>;\n+\n using SteadySeconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::seconds>;\n using SteadyMilliseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::milliseconds>;\n using SteadyMicroseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::microseconds>;\n \n void UninterruptibleSleep(const std::chrono::microseconds& n);\n \n /**\n- * Helper to count the seconds of a duration.\n+ * Helper to count the seconds of a duration/time_point.\n  *\n- * All durations should be using std::chrono and calling this should generally\n+ * All durations/time_points should be using std::chrono and calling this should generally\n  * be avoided in code. Though, it is still preferred to an inline t.count() to\n  * protect against a reliance on the exact type of t.\n  *\n- * This helper is used to convert durations before passing them over an\n+ * This helper is used to convert durations/time_points before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n+template <typename Clock>\n+constexpr int64_t count_seconds(std::chrono::time_point<Clock, std::chrono::seconds> t)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870638314",
      "id" : 870638314,
      "in_reply_to_id" : 870625577,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z5OLq",
      "original_commit_id" : "fa201cc1b84793d0463650f43a7fd6705c7754de",
      "original_line" : 44,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 969840289,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870638314/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-11T18:42:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870638314",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870668481"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870668481"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually I think it is fine to silently do a cast inside the function. Similar to how it is fine to do a silent cast in `Now`.\r\n\r\nSo I'll be pushing a version of this that takes the duration as a template parameter.",
      "commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "created_at" : "2022-05-11T19:23:03Z",
      "diff_hunk" : "@@ -14,22 +14,37 @@\n \n using namespace std::chrono_literals;\n \n+/** Mockable clock in the context of tests, otherwise the system clock */\n+struct NodeClock : std::chrono::system_clock {\n+    using time_point = std::chrono::time_point<NodeClock>;\n+    /** Return current system time or mocked time, if set */\n+    static time_point now() noexcept;\n+    static std::time_t to_time_t(const time_point&) = delete; // unused\n+    static time_point from_time_t(std::time_t) = delete;      // unused\n+};\n+using NodeSeconds = std::chrono::time_point<NodeClock, std::chrono::seconds>;\n+\n using SteadySeconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::seconds>;\n using SteadyMilliseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::milliseconds>;\n using SteadyMicroseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::microseconds>;\n \n void UninterruptibleSleep(const std::chrono::microseconds& n);\n \n /**\n- * Helper to count the seconds of a duration.\n+ * Helper to count the seconds of a duration/time_point.\n  *\n- * All durations should be using std::chrono and calling this should generally\n+ * All durations/time_points should be using std::chrono and calling this should generally\n  * be avoided in code. Though, it is still preferred to an inline t.count() to\n  * protect against a reliance on the exact type of t.\n  *\n- * This helper is used to convert durations before passing them over an\n+ * This helper is used to convert durations/time_points before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n+template <typename Clock>\n+constexpr int64_t count_seconds(std::chrono::time_point<Clock, std::chrono::seconds> t)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870668481",
      "id" : 870668481,
      "in_reply_to_id" : 870625577,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584z5VjB",
      "original_commit_id" : "fa201cc1b84793d0463650f43a7fd6705c7754de",
      "original_line" : 44,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 969884660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870668481/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-11T19:23:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870668481",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870705049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870705049"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Add a `static_assert(std::is_integral_v<typename Duration::rep>)` or have the return type be `typename Duration::rep` ?",
      "commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "created_at" : "2022-05-11T20:09:11Z",
      "diff_hunk" : "@@ -14,22 +14,37 @@\n \n using namespace std::chrono_literals;\n \n+/** Mockable clock in the context of tests, otherwise the system clock */\n+struct NodeClock : std::chrono::system_clock {\n+    using time_point = std::chrono::time_point<NodeClock>;\n+    /** Return current system time or mocked time, if set */\n+    static time_point now() noexcept;\n+    static std::time_t to_time_t(const time_point&) = delete; // unused\n+    static time_point from_time_t(std::time_t) = delete;      // unused\n+};\n+using NodeSeconds = std::chrono::time_point<NodeClock, std::chrono::seconds>;\n+\n using SteadySeconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::seconds>;\n using SteadyMilliseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::milliseconds>;\n using SteadyMicroseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::microseconds>;\n \n void UninterruptibleSleep(const std::chrono::microseconds& n);\n \n /**\n- * Helper to count the seconds of a duration.\n+ * Helper to count the seconds of a duration/time_point.\n  *\n- * All durations should be using std::chrono and calling this should generally\n+ * All durations/time_points should be using std::chrono and calling this should generally\n  * be avoided in code. Though, it is still preferred to an inline t.count() to\n  * protect against a reliance on the exact type of t.\n  *\n- * This helper is used to convert durations before passing them over an\n+ * This helper is used to convert durations/time_points before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n+template <typename Duration, typename Timepoint>\n+constexpr int64_t TicksSinceEpoch(Timepoint t)\n+{\n+    return std::chrono::time_point_cast<Duration>(t).time_since_epoch().count();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870705049",
      "id" : 870705049,
      "line" : 46,
      "node_id" : "PRRC_kwDOABII584z5eeZ",
      "original_commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "original_line" : 46,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : 36,
      "pull_request_review_id" : 969933406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870705049/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-11T20:09:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870705049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870969662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870969662"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch. Used `auto` return type",
      "commit_id" : "facb2f2d53c734a9215acdbd8057699b27ee3b33",
      "created_at" : "2022-05-12T05:45:42Z",
      "diff_hunk" : "@@ -14,22 +14,37 @@\n \n using namespace std::chrono_literals;\n \n+/** Mockable clock in the context of tests, otherwise the system clock */\n+struct NodeClock : std::chrono::system_clock {\n+    using time_point = std::chrono::time_point<NodeClock>;\n+    /** Return current system time or mocked time, if set */\n+    static time_point now() noexcept;\n+    static std::time_t to_time_t(const time_point&) = delete; // unused\n+    static time_point from_time_t(std::time_t) = delete;      // unused\n+};\n+using NodeSeconds = std::chrono::time_point<NodeClock, std::chrono::seconds>;\n+\n using SteadySeconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::seconds>;\n using SteadyMilliseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::milliseconds>;\n using SteadyMicroseconds = std::chrono::time_point<std::chrono::steady_clock, std::chrono::microseconds>;\n \n void UninterruptibleSleep(const std::chrono::microseconds& n);\n \n /**\n- * Helper to count the seconds of a duration.\n+ * Helper to count the seconds of a duration/time_point.\n  *\n- * All durations should be using std::chrono and calling this should generally\n+ * All durations/time_points should be using std::chrono and calling this should generally\n  * be avoided in code. Though, it is still preferred to an inline t.count() to\n  * protect against a reliance on the exact type of t.\n  *\n- * This helper is used to convert durations before passing them over an\n+ * This helper is used to convert durations/time_points before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n+template <typename Duration, typename Timepoint>\n+constexpr int64_t TicksSinceEpoch(Timepoint t)\n+{\n+    return std::chrono::time_point_cast<Duration>(t).time_since_epoch().count();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25101#discussion_r870969662",
      "id" : 870969662,
      "in_reply_to_id" : 870705049,
      "line" : 46,
      "node_id" : "PRRC_kwDOABII584z6fE-",
      "original_commit_id" : "fa0f3ffd31638e326c4ee122887a827ce1813ec7",
      "original_line" : 46,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : 36,
      "pull_request_review_id" : 970280939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25101",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870969662/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-12T05:45:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870969662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
