[
   {
      "body" : "Don't worry about it, the orphan blocks in  dynamic memory, the size change by the orphan blocks counts, and the count is very low, you can see orphaned blocks count chart in https://blockchain.info/zh-cn/charts/n-orphaned-blocks",
      "created_at" : "2014-05-30T09:41:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4253#issuecomment-44633389",
      "id" : 44633389,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4253",
      "updated_at" : "2014-05-30T09:41:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/44633389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/541066?v=3",
         "events_url" : "https://api.github.com/users/arowser/events{/privacy}",
         "followers_url" : "https://api.github.com/users/arowser/followers",
         "following_url" : "https://api.github.com/users/arowser/following{/other_user}",
         "gists_url" : "https://api.github.com/users/arowser/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/arowser",
         "id" : 541066,
         "login" : "arowser",
         "organizations_url" : "https://api.github.com/users/arowser/orgs",
         "received_events_url" : "https://api.github.com/users/arowser/received_events",
         "repos_url" : "https://api.github.com/users/arowser/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/arowser/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/arowser/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/arowser"
      }
   },
   {
      "body" : "If I understand it right, the problem occurs in some network environments when the node is catching up (e.g. doing an initial blockchain download) and is receiving new blocks that it can't connect yet (this will be fixed by headers-first sync when it's implemented). In that situation, the pseudo-orphaned blocks will quickly eat up all the memory of low RAM machines. Conversely, I've now read that for high RAM machines, you may want to use an even higher maximum, to avoid the following inefficiency:\r\n\r\n...\r\ndownload orphan\r\ndownload orphan\r\ndownload orphan\r\nmax reached => drop random orphan block from memory\r\ndownload orphan\r\nmax reached => drop random orphan block from memory\r\ndownload orphan\r\nmax reached => drop random orphan block from memory\r\ndownload connectable block (HURRAY!)\r\ndownload orphan\r\nmax reached => drop random orphan block from memory\r\n....\r\n\r\nI'm submitting a pull request:",
      "created_at" : "2014-05-30T10:20:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4253#issuecomment-44636293",
      "id" : 44636293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4253",
      "updated_at" : "2014-05-30T10:26:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/44636293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7548960?v=3",
         "events_url" : "https://api.github.com/users/shshshsh/events{/privacy}",
         "followers_url" : "https://api.github.com/users/shshshsh/followers",
         "following_url" : "https://api.github.com/users/shshshsh/following{/other_user}",
         "gists_url" : "https://api.github.com/users/shshshsh/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/shshshsh",
         "id" : 7548960,
         "login" : "shshshsh",
         "organizations_url" : "https://api.github.com/users/shshshsh/orgs",
         "received_events_url" : "https://api.github.com/users/shshshsh/received_events",
         "repos_url" : "https://api.github.com/users/shshshsh/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/shshshsh/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/shshshsh/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/shshshsh"
      }
   },
   {
      "body" : "@arowser Confusion in terminology here.\r\n\r\nWhat the world has come to call orphaned blocks are blocks that are reorganized away. They're not invalid, they're just side branches of the chain that ended up winning.\r\n\r\nOrphan blocks (as they are called in the source code) are blocks without parents. This is either because of an attack, or because we simply didn't download the parent yet. In the current implementation, those are held temporarily in memory while their parents are requested.",
      "created_at" : "2014-05-30T10:47:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4253#issuecomment-44638141",
      "id" : 44638141,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4253",
      "updated_at" : "2014-05-30T10:47:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/44638141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rephrased the usage message to make it more clear what this options does.",
      "created_at" : "2014-05-30T11:30:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4253#issuecomment-44641094",
      "id" : 44641094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4253",
      "updated_at" : "2014-05-30T11:30:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/44641094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7548960?v=3",
         "events_url" : "https://api.github.com/users/shshshsh/events{/privacy}",
         "followers_url" : "https://api.github.com/users/shshshsh/followers",
         "following_url" : "https://api.github.com/users/shshshsh/following{/other_user}",
         "gists_url" : "https://api.github.com/users/shshshsh/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/shshshsh",
         "id" : 7548960,
         "login" : "shshshsh",
         "organizations_url" : "https://api.github.com/users/shshshsh/orgs",
         "received_events_url" : "https://api.github.com/users/shshshsh/received_events",
         "repos_url" : "https://api.github.com/users/shshshsh/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/shshshsh/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/shshshsh/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/shshshsh"
      }
   },
   {
      "body" : "Rather than forget about a random orphan block, how about it gets written to disk instead? This is what would happen anyway when physical memory limit is reached and virtual memory is used. \r\n\r\nIf this were done it might not even be necessary to store any blocks in memory. Why are they stored in memory anyway? We don't store parented blocks in memory. ",
      "created_at" : "2014-06-02T01:10:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4253#issuecomment-44795057",
      "id" : 44795057,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4253",
      "updated_at" : "2014-06-02T01:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/44795057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@rebroad They're only temporarily stored on purpose. Persistent storage would allow filling up a node's disk with infinite number of orphan blocks in a DoS attack. It would be better to just not download and store orphan blocks at all, which would be possible with headers-first download.\r\n",
      "created_at" : "2014-06-02T06:37:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4253#issuecomment-44805762",
      "id" : 44805762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4253",
      "updated_at" : "2014-06-02T06:37:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/44805762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "To be honest I don't understand why so many orphan blocks are being\r\nrequested. Assuming a node is downloading blocks in parallel from eight\r\npeers then about sixteen orphan blocks stored in memory should be\r\nsufficient or else there's something going wrong. If a peer is sending\r\norphan blocks that haven't been requested and they don't look like the\r\nlatest mined blocks (I.e. children of the preceeding block sent with\r\nsufficient work, etc) then the node should be disconnected and the blocks\r\ndiscarded, IMHO.\r\nOn Jun 2, 2014 1:38 PM, \"Wladimir J. van der Laan\" <notifications@github.com>\r\nwrote:\r\n\r\n> @rebroad <https://github.com/rebroad> They're only temporarily stored on\r\n> purpose. Persistent storage would allow filling up a node's disk with\r\n> infinite number of orphan blocks in a DoS attack. It would be better to\r\n> just not download and store orphan blocks at all, which would be possible\r\n> with headers-first download.\r\n>\r\n> Ã¢ÂÂ\r\n> Reply to this email directly or view it on GitHub\r\n> <https://github.com/bitcoin/bitcoin/issues/4253#issuecomment-44805762>.\r\n>",
      "created_at" : "2014-06-02T15:38:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4253#issuecomment-44853071",
      "id" : 44853071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4253",
      "updated_at" : "2014-06-02T15:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/44853071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
