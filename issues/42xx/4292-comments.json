[
   {
      "body" : ">  and that there are no two threads asking for a hash simultaneously for the same time (or otherwise don't destructively overwrite each other's data)\r\n\r\nI'm not sure that this is a safe assumption, the GetHash() is called all over the place. That's hard to control.\r\n\r\nThinking about it, as you have an explicit MarkDirty() (in contrast to one that is called with high frequency on every change), we could make that compute the hash. That'd make race issues more controllable -- you'd just have to make sure no two threads are updating a transaction (and calling subsequent MarkDirty) at the same time.\r\n(i also don't think it would give extra overhead - one of the things that gets called for sure on a transaction is GetHash, if only to put it in a map of some kind)\r\n\r\n",
      "created_at" : "2014-06-05T06:49:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4292#issuecomment-45186254",
      "id" : 45186254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4292",
      "updated_at" : "2014-06-05T07:17:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45186254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Automatic sanity-testing: FAILED BUILD/TEST, see http://jenkins.bluematt.me/pull-tester/d78428a9c1ae848eab1c193f6ef3ce3edbd76c3f for binaries and test log.\n\nThis could happen for one of several reasons:\n1. It chanages paths in makefile.linux-mingw or otherwise changes build scripts in a way that made them incompatible with the automated testing scripts (please tweak those patches in qa/pull-tester)\n2. It adds/modifies tests which test network rules (thanks for doing that), which conflicts with a patch applied at test time\n3. It does not build on either Linux i386 or Win32 (via MinGW cross compile)\n4. The test suite fails on either Linux i386 or Win32\n5. The block test-cases failed (lookup the first bNN identifier which failed in https://github.com/TheBlueMatt/test-scripts/blob/master/FullBlockTestGenerator.java)\n\nIf you believe this to be in error, please ping BlueMatt on freenode or TheBlueMatt here.\n\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-06-05T08:30:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4292#issuecomment-45193888",
      "id" : 45193888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4292",
      "updated_at" : "2014-06-05T08:30:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45193888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "@sipa FWIW, this style of caching is what I did in python and C libs, and others have copied also.  It is useful.",
      "created_at" : "2014-06-05T12:20:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4292#issuecomment-45212367",
      "id" : 45212367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4292",
      "updated_at" : "2014-06-05T12:20:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45212367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Another, and much cleaner, solution is adding a CMutableTransaction and CMutableBlock, which have the same fields, but mutable, and do not provide a GetHash. You can convert them to their immutable versions (which can be very efficient by just swapping the vin/vout/vtx vectors) once they are finished.",
      "created_at" : "2014-06-05T12:29:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4292#issuecomment-45213069",
      "id" : 45213069,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4292",
      "updated_at" : "2014-06-05T12:29:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45213069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa I like that solution a lot. It has self-enforcing correctness. No chance to forget MarkDirty, and thread problems are avoided by never sharing the mutable structure between threads.",
      "created_at" : "2014-06-05T12:49:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4292#issuecomment-45214781",
      "id" : 45214781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4292",
      "updated_at" : "2014-06-05T12:55:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45214781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@sipa +1\r\n\r\nI was thinking of something like a CMutableTransaction myself for my python-bitcoinlib for use in conjunction with Cython support. I've already made CScript's immutable (they're bytes subclasses) and would have made CMutableTxIn and CMutableTxOut as well. COutPoint can probably be conveniently made immutable always - not often you want to change one of its two members without changing the other.",
      "created_at" : "2014-06-05T13:45:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4292#issuecomment-45220490",
      "id" : 45220490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4292",
      "updated_at" : "2014-06-05T13:45:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45220490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "Closing in favor of #4309.",
      "created_at" : "2014-06-09T09:27:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4292#issuecomment-45474291",
      "id" : 45474291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4292",
      "updated_at" : "2014-06-09T09:27:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45474291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
