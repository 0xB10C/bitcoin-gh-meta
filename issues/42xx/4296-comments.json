[
   {
      "body" : "My code is not holding both locks at the same time.  It should be releasing cs_vNodes and then acquiring cs_main, so my understanding is that there shouldn't be a potential for deadlock?\r\n\r\nTo prevent that warning I could lock cs_main and *then* acquire cs_vNodes, but I'd need to hold both at the same time to do it in that order, because the cs_main lock is needed only once the node information is retrieved with cs_vNodes.",
      "created_at" : "2014-06-06T06:08:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4296#issuecomment-45305846",
      "id" : 45305846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4296",
      "updated_at" : "2014-06-06T06:08:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45305846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/549484?v=3",
         "events_url" : "https://api.github.com/users/ashleyholman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ashleyholman/followers",
         "following_url" : "https://api.github.com/users/ashleyholman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ashleyholman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ashleyholman",
         "id" : 549484,
         "login" : "ashleyholman",
         "organizations_url" : "https://api.github.com/users/ashleyholman/orgs",
         "received_events_url" : "https://api.github.com/users/ashleyholman/received_events",
         "repos_url" : "https://api.github.com/users/ashleyholman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ashleyholman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ashleyholman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ashleyholman"
      }
   },
   {
      "body" : "Holding only one at a time is great.\r\nBut something is going wrong, somehow it's holding both cs_main and cs_vNodes at some point. This could be due to `GetNodeStateStats` aquiring the cs_main lock, as well.\r\n\r\nAlso: in https://github.com/bitcoin/bitcoin/blob/master/src/qt/peertablemodel.cpp#L52 you should have the TRY_LOCK *inside* the braces instead of outside it if you want it to be released when execution flow leaves them.\r\n",
      "created_at" : "2014-06-06T06:16:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4296#issuecomment-45306177",
      "id" : 45306177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4296",
      "updated_at" : "2014-06-06T06:16:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45306177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> you should have the TRY_LOCK inside the braces instead of outside it if you want it to be released when execution flow leaves them\r\n\r\nAhh, that would explain why it's holding both.  I'll fix that.  Should the fix go to the old pull request, or a new one?",
      "created_at" : "2014-06-06T06:24:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4296#issuecomment-45306542",
      "id" : 45306542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4296",
      "updated_at" : "2014-06-06T06:24:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45306542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/549484?v=3",
         "events_url" : "https://api.github.com/users/ashleyholman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ashleyholman/followers",
         "following_url" : "https://api.github.com/users/ashleyholman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ashleyholman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ashleyholman",
         "id" : 549484,
         "login" : "ashleyholman",
         "organizations_url" : "https://api.github.com/users/ashleyholman/orgs",
         "received_events_url" : "https://api.github.com/users/ashleyholman/received_events",
         "repos_url" : "https://api.github.com/users/ashleyholman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ashleyholman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ashleyholman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ashleyholman"
      }
   },
   {
      "body" : "A new one; the old one has been merged, so cannot be changed anymore.",
      "created_at" : "2014-06-06T06:27:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4296#issuecomment-45306653",
      "id" : 45306653,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4296",
      "updated_at" : "2014-06-06T06:27:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45306653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "How do I make with DEBUG_LOCKORDER?",
      "created_at" : "2014-06-06T06:29:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4296#issuecomment-45306764",
      "id" : 45306764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4296",
      "updated_at" : "2014-06-06T06:29:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45306764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/549484?v=3",
         "events_url" : "https://api.github.com/users/ashleyholman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ashleyholman/followers",
         "following_url" : "https://api.github.com/users/ashleyholman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ashleyholman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ashleyholman",
         "id" : 549484,
         "login" : "ashleyholman",
         "organizations_url" : "https://api.github.com/users/ashleyholman/orgs",
         "received_events_url" : "https://api.github.com/users/ashleyholman/received_events",
         "repos_url" : "https://api.github.com/users/ashleyholman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ashleyholman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ashleyholman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ashleyholman"
      }
   },
   {
      "body" : "```bash\r\n./configure ... CPPFLAGS=\"-DDEBUG_LOCKORDER\" \r\n```\r\n",
      "created_at" : "2014-06-06T06:33:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/4296#issuecomment-45306974",
      "id" : 45306974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4296",
      "updated_at" : "2014-06-06T06:33:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/45306974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
