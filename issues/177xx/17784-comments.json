[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I call `gettransaction` and `getaddressinfo` in the script. here's an example script that sends and encrypted email on new transactions. Although if you use multi-wallet, you'll need #13339 \r\n\r\n```bash\r\n#!/usr/bin/env bash\r\nset -e\r\n\r\ntxid=\"$1\"\r\nwallet=\"$2\"\r\n\r\nfrom=\"Bitcoin Wallet <bitcoind@monad>\"\r\nto=\"William Casarin <jb55@jb55.com>\"\r\nsubject=\"Wallet notification\"\r\nkeys=\"-r 0x8860420C3C135662EABEADF96342E010C44A6337 -r 0x5B2B1E4F62216BC74362AC61D4FBA2FC4535A2A9 -r 0xE02D3FD4EB4585A63531C1D0E1BFCB90A1FF7A1C\"\r\n\r\ntx=\"$(bitcoin-cli -rpcwallet=$wallet gettransaction \"$txid\" true)\"\r\naddress=\"$(jq -r '.details[0].address' <<<\"$tx\")\"\r\ndetails=\"$(jq -r '.details[] | [.address, .category, .amount, .label] | @csv' <<<\"$tx\")\"\r\nkeypath=\"$(bitcoin-cli -rpcwallet=$wallet getaddressinfo \"$address\" | jq -r .hdkeypath)\"\r\n\r\namount=\"$(jq -r '.amount' <<<\"$tx\")\"\r\nconfs=\"$(jq -r '.confirmations' <<<\"$tx\")\"\r\n\r\ntime=\"$(date -d @$(jq -r '.time' <<<\"$tx\"))\"\r\nreceived=\"$(date -d @$(jq -r '.timereceived' <<<\"$tx\"))\"\r\n\r\nexport GNUPGHOME=/zbig/bitcoin/gpg\r\n\r\nmsg=\"$(printf \"txid: %s\\n\\naddress: %s\\n\\namount: %s\\n\\nconfirmations: %d\\n\\nwallet: %s\\n\\ntime: %s\\n\\nreceived: %s\\n\\nkeypath: %s\\n\\n%s\\n\\n\\n%s\" \\\r\n              \"$txid\" \"$address\" \"$amount\" \"$confs\" \"$wallet\" \"$time\" \"$received\" \"$keypath\" \"$details\" \"$tx\" )\"\r\n\r\nenctx=\"$(printf \"Content-Type: text/plain\\n\\n%s\\n\" \"$msg\" | gpg --yes --always-trust --encrypt --armor $keys)\"\r\n\r\n{\r\ncat <<EOF\r\nFrom: $from\r\nTo: $to\r\nSubject: $subject\r\nMIME-Version: 1.0\r\nContent-Type: multipart/encrypted; boundary=\"=-=-=\";\r\n  protocol=\"application/pgp-encrypted\"\r\n\r\n--=-=-=\r\nContent-Type: application/pgp-encrypted\r\n\r\nVersion: 1\r\n\r\n--=-=-=\r\nContent-Type: application/octet-stream\r\n\r\n$enctx\r\n--=-=-=--\r\nEOF\r\n} | sendmail --file /zbig/bitcoin/gpg/.msmtprc -oi -t\r\n\r\nprintf \"sent walletnotify email for %s\\n\" \"$txid\"\r\n\r\n```",
      "created_at" : "2019-12-20T19:17:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17784#issuecomment-568052152",
      "id" : 568052152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17784",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2ODA1MjE1Mg==",
      "updated_at" : "2019-12-20T19:19:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/568052152",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   }
]
