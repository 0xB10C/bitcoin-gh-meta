[
   {
      "author_association" : "MEMBER",
      "body" : "Yeah, I wanted to do the same, but there was no rationale on why no_witness is tried first, so I didn't touch the code. Concept ACK.",
      "created_at" : "2019-12-19T16:10:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17775#issuecomment-567554319",
      "id" : 567554319,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17775",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NzU1NDMxOQ==",
      "updated_at" : "2019-12-19T16:10:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/567554319",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is incorrect I think. If you swap the order, the \"!try_witness\" needs to turn into a \"!try_no_witness\" on the other side.",
      "created_at" : "2019-12-19T16:29:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17775#issuecomment-567562309",
      "id" : 567562309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17775",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NzU2MjMwOQ==",
      "updated_at" : "2019-12-19T16:29:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/567562309",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17775#discussion_r359953272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17775"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359953272"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@sipa you mean here? Why would that make sense? We're inside a `try_no_witness` block already",
      "commit_id" : "6020ce3c01fe5ee15a236c47da23342005b63055",
      "created_at" : "2019-12-19T16:32:44Z",
      "diff_hunk" : "@@ -117,23 +117,23 @@ bool DecodeHexTx(CMutableTransaction& tx, const std::string& hex_tx, bool try_no\n \n     std::vector<unsigned char> txData(ParseHex(hex_tx));\n \n-    if (try_no_witness) {\n-        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION | SERIALIZE_TRANSACTION_NO_WITNESS);\n+    if (try_witness) {\n+        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION);\n         try {\n             ssData >> tx;\n-            if (ssData.eof() && (!try_witness || CheckTxScriptsSanity(tx))) {\n+            if (ssData.empty()) {\n                 return true;\n             }\n         } catch (const std::exception&) {\n             // Fall through.\n         }\n     }\n \n-    if (try_witness) {\n-        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION);\n+    if (try_no_witness) {\n+        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION | SERIALIZE_TRANSACTION_NO_WITNESS);\n         try {\n             ssData >> tx;\n-            if (ssData.empty()) {\n+            if (ssData.eof() && (!try_witness || CheckTxScriptsSanity(tx))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17775#discussion_r359953272",
      "id" : 359953272,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1OTk1MzI3Mg==",
      "original_commit_id" : "3f33f027e19346eb3263c0c57df68ba314bb76a3",
      "original_position" : 26,
      "path" : "src/core_read.cpp",
      "position" : null,
      "pull_request_review_id" : 334755508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17775",
      "updated_at" : "2019-12-19T16:44:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359953272",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17775#discussion_r359954178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17775"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359954178"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, in the other clause. It's supposed to bypass the sanity check when only one of try_witness and try_no_witness is set.",
      "commit_id" : "6020ce3c01fe5ee15a236c47da23342005b63055",
      "created_at" : "2019-12-19T16:34:40Z",
      "diff_hunk" : "@@ -117,23 +117,23 @@ bool DecodeHexTx(CMutableTransaction& tx, const std::string& hex_tx, bool try_no\n \n     std::vector<unsigned char> txData(ParseHex(hex_tx));\n \n-    if (try_no_witness) {\n-        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION | SERIALIZE_TRANSACTION_NO_WITNESS);\n+    if (try_witness) {\n+        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION);\n         try {\n             ssData >> tx;\n-            if (ssData.eof() && (!try_witness || CheckTxScriptsSanity(tx))) {\n+            if (ssData.empty()) {\n                 return true;\n             }\n         } catch (const std::exception&) {\n             // Fall through.\n         }\n     }\n \n-    if (try_witness) {\n-        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION);\n+    if (try_no_witness) {\n+        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION | SERIALIZE_TRANSACTION_NO_WITNESS);\n         try {\n             ssData >> tx;\n-            if (ssData.empty()) {\n+            if (ssData.eof() && (!try_witness || CheckTxScriptsSanity(tx))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17775#discussion_r359954178",
      "id" : 359954178,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1OTk1NDE3OA==",
      "original_commit_id" : "3f33f027e19346eb3263c0c57df68ba314bb76a3",
      "original_position" : 26,
      "path" : "src/core_read.cpp",
      "position" : null,
      "pull_request_review_id" : 334756728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17775",
      "updated_at" : "2019-12-19T16:44:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359954178",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17775#discussion_r359959485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17775"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359959485"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah I see, fixed it up(within my understanding) and put a quick comment there for future readers' comprehension ",
      "commit_id" : "6020ce3c01fe5ee15a236c47da23342005b63055",
      "created_at" : "2019-12-19T16:45:47Z",
      "diff_hunk" : "@@ -117,23 +117,23 @@ bool DecodeHexTx(CMutableTransaction& tx, const std::string& hex_tx, bool try_no\n \n     std::vector<unsigned char> txData(ParseHex(hex_tx));\n \n-    if (try_no_witness) {\n-        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION | SERIALIZE_TRANSACTION_NO_WITNESS);\n+    if (try_witness) {\n+        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION);\n         try {\n             ssData >> tx;\n-            if (ssData.eof() && (!try_witness || CheckTxScriptsSanity(tx))) {\n+            if (ssData.empty()) {\n                 return true;\n             }\n         } catch (const std::exception&) {\n             // Fall through.\n         }\n     }\n \n-    if (try_witness) {\n-        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION);\n+    if (try_no_witness) {\n+        CDataStream ssData(txData, SER_NETWORK, PROTOCOL_VERSION | SERIALIZE_TRANSACTION_NO_WITNESS);\n         try {\n             ssData >> tx;\n-            if (ssData.empty()) {\n+            if (ssData.eof() && (!try_witness || CheckTxScriptsSanity(tx))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17775#discussion_r359959485",
      "id" : 359959485,
      "in_reply_to_id" : 359954178,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1OTk1OTQ4NQ==",
      "original_commit_id" : "3f33f027e19346eb3263c0c57df68ba314bb76a3",
      "original_position" : 26,
      "path" : "src/core_read.cpp",
      "position" : null,
      "pull_request_review_id" : 334763947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17775",
      "updated_at" : "2019-12-19T16:45:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359959485",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "While touching this file and `DecodeHexTx`: what about separating the tx decoding from the unrelated hex decoding?  Such as having say a `DecodeTx` do the decoding which `DecodeHexTx` would call.\r\n\r\nWhen fuzzing the tx decoding part of this code it would be nice to not having to waste CPU cycles on hex encoding followed by immediate hex decoding for no reason at all :)",
      "created_at" : "2019-12-19T17:01:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17775#issuecomment-567575185",
      "id" : 567575185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17775",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NzU3NTE4NQ==",
      "updated_at" : "2019-12-19T17:03:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/567575185",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
