[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357124904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357124904"
         }
      },
      "author_association" : "MEMBER",
      "body" : "perhaps construct this string outside of the arg array assignment, or do:\r\n```python3\r\n \"--exit-on-first-error={}\".format(\"yes\" if exit_on_first_error else \"no\"),\r\n```",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:45:28Z",
      "diff_hunk" : "@@ -97,14 +97,16 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             \"-debugexclude=leveldb\",\n             \"-uacomment=testnode%d\" % i,\n         ]\n-        if use_valgrind:\n+        if self.is_valgrind_present() and use_valgrind:\n+            exit_on_first_error = self.should_exit_valgrind_on_first_error()\n             default_suppressions_file = os.path.join(\n                 os.path.dirname(os.path.realpath(__file__)),\n                 \"..\", \"..\", \"..\", \"contrib\", \"valgrind.supp\")\n             suppressions_file = os.getenv(\"VALGRIND_SUPPRESSIONS_FILE\",\n                                           default_suppressions_file)\n             self.args = [\"valgrind\", \"--suppressions={}\".format(suppressions_file),\n-                         \"--gen-suppressions=all\", \"--exit-on-first-error=yes\",\n+                         \"--gen-suppressions=all\",\n+                         \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357124904",
      "id" : 357124904,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEyNDkwNA==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 15,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 15,
      "pull_request_review_id" : 331203403,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:55:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357124904",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357126002"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357126002"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This won't throw an error if `--valgrind` is used on a system without valgrind.",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:48:12Z",
      "diff_hunk" : "@@ -97,14 +97,16 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             \"-debugexclude=leveldb\",\n             \"-uacomment=testnode%d\" % i,\n         ]\n-        if use_valgrind:\n+        if self.is_valgrind_present() and use_valgrind:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357126002",
      "id" : 357126002,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEyNjAwMg==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 5,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 5,
      "pull_request_review_id" : 331204844,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:51:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357126002",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357126161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357126161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: suggestion for readability, format the args array like in line 90 above:\r\n```diff\r\n-            self.args = [\"valgrind\", \"--suppressions={}\".format(suppressions_file),\r\n-                         \"--gen-suppressions=all\",\r\n-                         \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",\r\n-                         \"--error-exitcode=1\", \"--quiet\"] + self.args\r\n+            self.args = [\r\n+                \"valgrind\",\r\n+                \"--suppressions={}\".format(suppressions_file),\r\n+                \"--gen-suppressions=all\",\r\n+                \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",\r\n+                \"--error-exitcode=1\",\r\n+                \"--quiet\",\r\n+            ] + self.args\r\n```",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:48:35Z",
      "diff_hunk" : "@@ -97,14 +97,16 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             \"-debugexclude=leveldb\",\n             \"-uacomment=testnode%d\" % i,\n         ]\n-        if use_valgrind:\n+        if self.is_valgrind_present() and use_valgrind:\n+            exit_on_first_error = self.should_exit_valgrind_on_first_error()\n             default_suppressions_file = os.path.join(\n                 os.path.dirname(os.path.realpath(__file__)),\n                 \"..\", \"..\", \"..\", \"contrib\", \"valgrind.supp\")\n             suppressions_file = os.getenv(\"VALGRIND_SUPPRESSIONS_FILE\",\n                                           default_suppressions_file)\n             self.args = [\"valgrind\", \"--suppressions={}\".format(suppressions_file),\n-                         \"--gen-suppressions=all\", \"--exit-on-first-error=yes\",\n+                         \"--gen-suppressions=all\",\n+                         \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",\n                          \"--error-exitcode=1\", \"--quiet\"] + self.args",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357126161",
      "id" : 357126161,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEyNjE2MQ==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 16,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 16,
      "pull_request_review_id" : 331203403,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:55:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357126161",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357126725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357126725"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I haven't tested this, but I expect `--exit-on-first-error=no` to throw an error on versions that don't have this option.",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:49:58Z",
      "diff_hunk" : "@@ -97,14 +97,16 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             \"-debugexclude=leveldb\",\n             \"-uacomment=testnode%d\" % i,\n         ]\n-        if use_valgrind:\n+        if self.is_valgrind_present() and use_valgrind:\n+            exit_on_first_error = self.should_exit_valgrind_on_first_error()\n             default_suppressions_file = os.path.join(\n                 os.path.dirname(os.path.realpath(__file__)),\n                 \"..\", \"..\", \"..\", \"contrib\", \"valgrind.supp\")\n             suppressions_file = os.getenv(\"VALGRIND_SUPPRESSIONS_FILE\",\n                                           default_suppressions_file)\n             self.args = [\"valgrind\", \"--suppressions={}\".format(suppressions_file),\n-                         \"--gen-suppressions=all\", \"--exit-on-first-error=yes\",\n+                         \"--gen-suppressions=all\",\n+                         \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357126725",
      "id" : 357126725,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEyNjcyNQ==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 15,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 15,
      "pull_request_review_id" : 331204844,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:51:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357126725",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357127399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357127399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe this was added in 3.14: https://stackoverflow.com/a/50289059",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:51:22Z",
      "diff_hunk" : "@@ -140,6 +142,29 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             AddressKeyPair('mzRe8QZMfGi58KyWCse2exxEFry2sfF2Y7', 'cPiRWE8KMjTRxH1MWkPerhfoHFn5iHPWVK5aPqjW8NxmdwenFinJ'),\n     ]\n \n+    def is_valgrind_present(self):\n+        \"\"\"Check for valgrind presence\"\"\"\n+        try:\n+          version = subprocess.run([\"valgrind\", \"--version\"], stdout=subprocess.PIPE).stdout.decode(\"utf-8\")\n+          if version.find(\"valgrind\", 0, 10) > -1:\n+              return True\n+          else:\n+              return False\n+        except OSError:\n+          return False\n+\n+    def should_exit_valgrind_on_first_error(self):\n+        \"\"\"Determine if valgrind should run with --exit-on-first-error flag (>=3.15 runs with it while older versions don't)\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357127399",
      "id" : 357127399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEyNzM5OQ==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 35,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 35,
      "pull_request_review_id" : 331204844,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:51:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357127399",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357127816"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357127816"
         }
      },
      "author_association" : "MEMBER",
      "body" : "suggest wrapping long lines like here and the docstring just above",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:52:19Z",
      "diff_hunk" : "@@ -140,6 +142,29 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             AddressKeyPair('mzRe8QZMfGi58KyWCse2exxEFry2sfF2Y7', 'cPiRWE8KMjTRxH1MWkPerhfoHFn5iHPWVK5aPqjW8NxmdwenFinJ'),\n     ]\n \n+    def is_valgrind_present(self):\n+        \"\"\"Check for valgrind presence\"\"\"\n+        try:\n+          version = subprocess.run([\"valgrind\", \"--version\"], stdout=subprocess.PIPE).stdout.decode(\"utf-8\")\n+          if version.find(\"valgrind\", 0, 10) > -1:\n+              return True\n+          else:\n+              return False\n+        except OSError:\n+          return False\n+\n+    def should_exit_valgrind_on_first_error(self):\n+        \"\"\"Determine if valgrind should run with --exit-on-first-error flag (>=3.15 runs with it while older versions don't)\"\"\"\n+        version_regex = re.compile('[.bv]')\n+        version_info = subprocess.run([\"valgrind\", \"--version\"], stdout=subprocess.PIPE).stdout.decode(\"utf-8\").rstrip().split(\"valgrind-\")[1:][0]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357127816",
      "id" : 357127816,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEyNzgxNg==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 37,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 37,
      "pull_request_review_id" : 331203403,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:55:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357127816",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357128396"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357128396"
         }
      },
      "author_association" : "MEMBER",
      "body" : "suggest hoisting these two magic values to constants",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:53:37Z",
      "diff_hunk" : "@@ -140,6 +142,29 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             AddressKeyPair('mzRe8QZMfGi58KyWCse2exxEFry2sfF2Y7', 'cPiRWE8KMjTRxH1MWkPerhfoHFn5iHPWVK5aPqjW8NxmdwenFinJ'),\n     ]\n \n+    def is_valgrind_present(self):\n+        \"\"\"Check for valgrind presence\"\"\"\n+        try:\n+          version = subprocess.run([\"valgrind\", \"--version\"], stdout=subprocess.PIPE).stdout.decode(\"utf-8\")\n+          if version.find(\"valgrind\", 0, 10) > -1:\n+              return True\n+          else:\n+              return False\n+        except OSError:\n+          return False\n+\n+    def should_exit_valgrind_on_first_error(self):\n+        \"\"\"Determine if valgrind should run with --exit-on-first-error flag (>=3.15 runs with it while older versions don't)\"\"\"\n+        version_regex = re.compile('[.bv]')\n+        version_info = subprocess.run([\"valgrind\", \"--version\"], stdout=subprocess.PIPE).stdout.decode(\"utf-8\").rstrip().split(\"valgrind-\")[1:][0]\n+        version_array = re.split(version_regex, version_info)\n+        major = int(version_array[0])\n+        minor = int(version_array[1])\n+        if major >=3 and minor >=15:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357128396",
      "id" : 357128396,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEyODM5Ng==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 41,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 41,
      "pull_request_review_id" : 331203403,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:55:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357128396",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357129740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357129740"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Many thanks! I am going through the comments and will adapt the code accordingly. ",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:56:57Z",
      "diff_hunk" : "@@ -97,14 +97,16 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             \"-debugexclude=leveldb\",\n             \"-uacomment=testnode%d\" % i,\n         ]\n-        if use_valgrind:\n+        if self.is_valgrind_present() and use_valgrind:\n+            exit_on_first_error = self.should_exit_valgrind_on_first_error()\n             default_suppressions_file = os.path.join(\n                 os.path.dirname(os.path.realpath(__file__)),\n                 \"..\", \"..\", \"..\", \"contrib\", \"valgrind.supp\")\n             suppressions_file = os.getenv(\"VALGRIND_SUPPRESSIONS_FILE\",\n                                           default_suppressions_file)\n             self.args = [\"valgrind\", \"--suppressions={}\".format(suppressions_file),\n-                         \"--gen-suppressions=all\", \"--exit-on-first-error=yes\",\n+                         \"--gen-suppressions=all\",\n+                         \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357129740",
      "id" : 357129740,
      "in_reply_to_id" : 357124904,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEyOTc0MA==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 15,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 15,
      "pull_request_review_id" : 331209556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:56:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357129740",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357129905"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357129905"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes! Thanks :)",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:57:24Z",
      "diff_hunk" : "@@ -97,14 +97,16 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             \"-debugexclude=leveldb\",\n             \"-uacomment=testnode%d\" % i,\n         ]\n-        if use_valgrind:\n+        if self.is_valgrind_present() and use_valgrind:\n+            exit_on_first_error = self.should_exit_valgrind_on_first_error()\n             default_suppressions_file = os.path.join(\n                 os.path.dirname(os.path.realpath(__file__)),\n                 \"..\", \"..\", \"..\", \"contrib\", \"valgrind.supp\")\n             suppressions_file = os.getenv(\"VALGRIND_SUPPRESSIONS_FILE\",\n                                           default_suppressions_file)\n             self.args = [\"valgrind\", \"--suppressions={}\".format(suppressions_file),\n-                         \"--gen-suppressions=all\", \"--exit-on-first-error=yes\",\n+                         \"--gen-suppressions=all\",\n+                         \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",\n                          \"--error-exitcode=1\", \"--quiet\"] + self.args",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357129905",
      "id" : 357129905,
      "in_reply_to_id" : 357126161,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEyOTkwNQ==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 16,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 16,
      "pull_request_review_id" : 331209809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:57:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357129905",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357130330"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357130330"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Will test it on my macOS Catalina, because valgrind can't be installed there. :)",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:58:24Z",
      "diff_hunk" : "@@ -97,14 +97,16 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             \"-debugexclude=leveldb\",\n             \"-uacomment=testnode%d\" % i,\n         ]\n-        if use_valgrind:\n+        if self.is_valgrind_present() and use_valgrind:\n+            exit_on_first_error = self.should_exit_valgrind_on_first_error()\n             default_suppressions_file = os.path.join(\n                 os.path.dirname(os.path.realpath(__file__)),\n                 \"..\", \"..\", \"..\", \"contrib\", \"valgrind.supp\")\n             suppressions_file = os.getenv(\"VALGRIND_SUPPRESSIONS_FILE\",\n                                           default_suppressions_file)\n             self.args = [\"valgrind\", \"--suppressions={}\".format(suppressions_file),\n-                         \"--gen-suppressions=all\", \"--exit-on-first-error=yes\",\n+                         \"--gen-suppressions=all\",\n+                         \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357130330",
      "id" : 357130330,
      "in_reply_to_id" : 357126725,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEzMDMzMA==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 15,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 15,
      "pull_request_review_id" : 331210391,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:58:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357130330",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357130419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357130419"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Will adapt!",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T12:58:37Z",
      "diff_hunk" : "@@ -140,6 +142,29 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             AddressKeyPair('mzRe8QZMfGi58KyWCse2exxEFry2sfF2Y7', 'cPiRWE8KMjTRxH1MWkPerhfoHFn5iHPWVK5aPqjW8NxmdwenFinJ'),\n     ]\n \n+    def is_valgrind_present(self):\n+        \"\"\"Check for valgrind presence\"\"\"\n+        try:\n+          version = subprocess.run([\"valgrind\", \"--version\"], stdout=subprocess.PIPE).stdout.decode(\"utf-8\")\n+          if version.find(\"valgrind\", 0, 10) > -1:\n+              return True\n+          else:\n+              return False\n+        except OSError:\n+          return False\n+\n+    def should_exit_valgrind_on_first_error(self):\n+        \"\"\"Determine if valgrind should run with --exit-on-first-error flag (>=3.15 runs with it while older versions don't)\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357130419",
      "id" : 357130419,
      "in_reply_to_id" : 357127399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEzMDQxOQ==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 35,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 35,
      "pull_request_review_id" : 331210524,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T12:58:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357130419",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357137164"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357137164"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You mean the previous comment? This one is easiest to test on e.g. a fresh Ubuntu 18.04 machine, which has valgrind 3.13. You can then compile it from source and install 3.15 to see the difference. ",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T13:14:07Z",
      "diff_hunk" : "@@ -97,14 +97,16 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             \"-debugexclude=leveldb\",\n             \"-uacomment=testnode%d\" % i,\n         ]\n-        if use_valgrind:\n+        if self.is_valgrind_present() and use_valgrind:\n+            exit_on_first_error = self.should_exit_valgrind_on_first_error()\n             default_suppressions_file = os.path.join(\n                 os.path.dirname(os.path.realpath(__file__)),\n                 \"..\", \"..\", \"..\", \"contrib\", \"valgrind.supp\")\n             suppressions_file = os.getenv(\"VALGRIND_SUPPRESSIONS_FILE\",\n                                           default_suppressions_file)\n             self.args = [\"valgrind\", \"--suppressions={}\".format(suppressions_file),\n-                         \"--gen-suppressions=all\", \"--exit-on-first-error=yes\",\n+                         \"--gen-suppressions=all\",\n+                         \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357137164",
      "id" : 357137164,
      "in_reply_to_id" : 357126725,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEzNzE2NA==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 15,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 15,
      "pull_request_review_id" : 331219376,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T13:14:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357137164",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357138153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357138153"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, I have one cheap VPS running, with Ubuntu 18.04. Will follow your recommendation. Thanks!",
      "commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "created_at" : "2019-12-12T13:16:05Z",
      "diff_hunk" : "@@ -97,14 +97,16 @@ def __init__(self, i, datadir, *, chain, rpchost, timewait, bitcoind, bitcoin_cl\n             \"-debugexclude=leveldb\",\n             \"-uacomment=testnode%d\" % i,\n         ]\n-        if use_valgrind:\n+        if self.is_valgrind_present() and use_valgrind:\n+            exit_on_first_error = self.should_exit_valgrind_on_first_error()\n             default_suppressions_file = os.path.join(\n                 os.path.dirname(os.path.realpath(__file__)),\n                 \"..\", \"..\", \"..\", \"contrib\", \"valgrind.supp\")\n             suppressions_file = os.getenv(\"VALGRIND_SUPPRESSIONS_FILE\",\n                                           default_suppressions_file)\n             self.args = [\"valgrind\", \"--suppressions={}\".format(suppressions_file),\n-                         \"--gen-suppressions=all\", \"--exit-on-first-error=yes\",\n+                         \"--gen-suppressions=all\",\n+                         \"--exit-on-first-error=yes\" if exit_on_first_error else \"--exit-on-first-error=no\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17732#discussion_r357138153",
      "id" : 357138153,
      "in_reply_to_id" : 357126725,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NzEzODE1Mw==",
      "original_commit_id" : "d9b5bd7372e873baa158a065147f4ddfe59eb5fd",
      "original_position" : 15,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 15,
      "pull_request_review_id" : 331220578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17732",
      "updated_at" : "2019-12-12T13:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/357138153",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/56779?v=4",
         "events_url" : "https://api.github.com/users/brakmic/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brakmic/followers",
         "following_url" : "https://api.github.com/users/brakmic/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brakmic/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brakmic",
         "id" : 56779,
         "login" : "brakmic",
         "node_id" : "MDQ6VXNlcjU2Nzc5",
         "organizations_url" : "https://api.github.com/users/brakmic/orgs",
         "received_events_url" : "https://api.github.com/users/brakmic/received_events",
         "repos_url" : "https://api.github.com/users/brakmic/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brakmic/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brakmic/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brakmic"
      }
   }
]
