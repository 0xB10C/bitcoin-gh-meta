[
   {
      "body" : "Concept ACK, but I'm not sure setting onion proxy to 127.0.0.1:9051 by default is a good idea. \r\nEven if no tor is present it will try and try and keep trying to connect to onions.\r\n\r\nMaybe a better approach would be to have torcontrol set -onion proxy automatically, when it manages to negotiate with tor?\r\n(possibly it could even ask tor what its port it)\r\n",
      "created_at" : "2015-11-24T14:54:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159292023",
      "id" : 159292023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-24T14:58:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159292023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "So, the disadvantage with that idea is support for the HS control thing is actually pretty recent, while connecting to 127.0.0.1:9050 works with any Tor version. OTOH, come to think of it there's a valid argument that we want the # of nodes connecting to HS's to grow in line with the number of nodes making them available.",
      "created_at" : "2015-11-24T14:59:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159293195",
      "id" : 159293195,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-24T14:59:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159293195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "In principle the tor control port authentication/communication works with older versions. It's just the HS creation itself that is recent. If the control connection is also used for other things it could tolerate that failing.",
      "created_at" : "2015-11-24T15:09:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159296547",
      "id" : 159296547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-24T15:09:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159296547",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj How about this?\r\n\r\nI looked into getting the proxy info automatically; doesn't look to be trivial as you have to use the GETCONF command on the control port to read the config file values yourself, and what they actually mean for you is non-trivial. I'm inclined to just use the hardcoded default - pretty rare for that to be setup differently.",
      "created_at" : "2015-11-24T15:30:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159304963",
      "id" : 159304963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-24T15:30:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159304963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "(and yeah, the duplication of code is kinda ugly; open to suggestions)",
      "created_at" : "2015-11-24T15:33:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159305729",
      "id" : 159305729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-24T15:33:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159305729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "Agree that this may be the best thing to do for now. This sets `-onion` when tor is there, unless an explicit `-onion` proxy was given, or it was explicitly disabled using `-onion=0`.\r\n\r\n(and you are right, actually getting a proxy port from Tor given just the control port seems to be non-trivial! I thought it was just me)\r\n\r\nMaybe also disable the NET_TOR proxy in `disconnected_cb`, *if* it was enabled by this mechanism?\r\n",
      "created_at" : "2015-11-24T16:27:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159323044",
      "id" : 159323044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-24T16:30:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159323044",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Concept ACK.  We should do something like this; otherwise we could get a strange result where listening gets commonly setup but we can't connect out to it!",
      "created_at" : "2015-11-24T22:24:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159425603",
      "id" : 159425603,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-24T22:24:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159425603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Concept ACK\n\nOn November 24, 2015 2:24:50 PM PST, Gregory Maxwell <notifications@github.com> wrote:\n>Concept ACK.  We should do something like this; otherwise we could get\n>a strange result where listening gets commonly setup but we can't\n>connect out to it!\n>\n>---\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159425603\n",
      "created_at" : "2015-11-24T22:36:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159428176",
      "id" : 159428176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-24T22:36:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159428176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@petertodd Not saying it has to be done in this pull, but requesting the proxy port(s) seems easy enough, after experimenting a bit:\r\n```\r\n$ nc 127.0.0.1 9051\r\nAUTHENTICATE <hexify(control_auth_cookie)>\r\n250 OK\r\nGETCONF SocksPort\r\n250 SocksPort=9050\r\n```\r\n",
      "created_at" : "2015-11-25T08:49:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159536994",
      "id" : 159536994,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-25T08:50:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159536994",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj The problem is SocksPort can be in many different formats depending on the local configuration, not to mention multiple lines of SocksPort's. \r\n\r\nRe: disconnected_cb, I'm inclined to just leave the behavior the same as what -onion would do anyway for simplicity.\r\n\r\nRemoved the first two reverted commits; ready for merging.",
      "created_at" : "2015-11-25T17:52:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159686928",
      "id" : 159686928,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-25T17:52:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159686928",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "utACK.",
      "created_at" : "2015-11-26T00:47:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7090#issuecomment-159768264",
      "id" : 159768264,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7090",
      "updated_at" : "2015-11-26T00:47:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/159768264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   }
]
