[
   {
      "body" : "Thanks. This is known, and there is a preexisting plan to improve it; though there is also a standard and widely deployed architecture miners use to work around this today (run multiple daemons).\r\n\r\nThe locks simply can't be disposed of there because createnewblock and block handling must necessarily lock the state of the blockchain. :) But just because they must doesn't mean there must be considerable delays.",
      "created_at" : "2015-11-14T01:44:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7015#issuecomment-156605612",
      "id" : 156605612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7015",
      "updated_at" : "2015-11-14T01:44:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156605612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "I checked with #ckpool on this before bringing it here, and they (Con Kolivas and Kano) said that ckpool does not implement the workaround for this issue. It's possible they confused the issue with another one and do actually have this worked around, and it's also possible that the workaround can be implemented outside of ckpool.\r\n\r\nThe locks can be replaced with finer-grained locks. CreateNewBlock needs to lock against modifying or deleting transactions and against reorgs. It also needs to make sure it's working off of the same blockchain tip the entire time, so it needs to grab a pointer to the tip at the beginning. It also needs to grab a view of the mempool that will not change. It does not need to prevent new transactions from being added to the mempool or new blocks from being added to the blockchain.",
      "created_at" : "2015-11-14T01:55:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7015#issuecomment-156607099",
      "id" : 156607099,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7015",
      "updated_at" : "2015-11-14T02:02:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156607099",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11898859?v=3",
         "events_url" : "https://api.github.com/users/jtoomim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtoomim/followers",
         "following_url" : "https://api.github.com/users/jtoomim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtoomim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtoomim",
         "id" : 11898859,
         "login" : "jtoomim",
         "organizations_url" : "https://api.github.com/users/jtoomim/orgs",
         "received_events_url" : "https://api.github.com/users/jtoomim/received_events",
         "repos_url" : "https://api.github.com/users/jtoomim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtoomim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtoomim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtoomim"
      }
   },
   {
      "body" : "This is more complex than you think--, due to iterator invalidation, mempool eviction, cache management, utxo state, etc.  Fortunately, it's also not necessary to get very low latency.",
      "created_at" : "2015-11-14T01:56:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7015#issuecomment-156607420",
      "id" : 156607420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7015",
      "updated_at" : "2015-11-14T02:00:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156607420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Do you mean because of CLTV transactions and nLockTime stuff?",
      "created_at" : "2015-11-14T01:59:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7015#issuecomment-156607775",
      "id" : 156607775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7015",
      "updated_at" : "2015-11-14T01:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156607775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11898859?v=3",
         "events_url" : "https://api.github.com/users/jtoomim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtoomim/followers",
         "following_url" : "https://api.github.com/users/jtoomim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtoomim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtoomim",
         "id" : 11898859,
         "login" : "jtoomim",
         "organizations_url" : "https://api.github.com/users/jtoomim/orgs",
         "received_events_url" : "https://api.github.com/users/jtoomim/received_events",
         "repos_url" : "https://api.github.com/users/jtoomim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtoomim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtoomim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtoomim"
      }
   }
]
