[
   {
      "author_association" : "MEMBER",
      "body" : "utACK.\r\n\r\nIt looks like `-pie` is on by default in the linker on GCC 6 and onward (and same for clang), so this was probably passed to the compiler instead of the linker... Either way, this PR fixes it, for systems where `-pie` is not enabled by default.",
      "created_at" : "2018-04-06T05:23:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#issuecomment-379151254",
      "id" : 379151254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12899",
      "updated_at" : "2018-04-06T05:23:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/379151254",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice! Tested ACK.\r\nMacOS 10.13.4 (17E199) and Xcode 9.3 (9E145)",
      "created_at" : "2018-04-06T23:49:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#issuecomment-379413250",
      "id" : 379413250,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12899",
      "updated_at" : "2018-04-06T23:49:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/379413250",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/13120787?v=4",
         "events_url" : "https://api.github.com/users/251labs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/251labs/followers",
         "following_url" : "https://api.github.com/users/251labs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/251labs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/251labs",
         "id" : 13120787,
         "login" : "251labs",
         "organizations_url" : "https://api.github.com/users/251labs/orgs",
         "received_events_url" : "https://api.github.com/users/251labs/received_events",
         "repos_url" : "https://api.github.com/users/251labs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/251labs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/251labs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/251labs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12899#discussion_r180112353"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12899"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/180112353"
         }
      },
      "author_association" : "OWNER",
      "body" : "Is this also correct for non-macOS? I've seen `-pie` a lot in build systems but never `-Wl,-pie`.\r\n@theuni?",
      "commit_id" : "12ebae7ba7980ffc11f8d7254c18a502cec268e3",
      "created_at" : "2018-04-09T14:27:38Z",
      "diff_hunk" : "@@ -633,7 +633,7 @@ if test x$use_hardening != xno; then\n \n   if test x$TARGET_OS != xwindows; then\n     AX_CHECK_COMPILE_FLAG([-fPIE],[PIE_FLAGS=\"-fPIE\"])\n-    AX_CHECK_LINK_FLAG([[-pie]], [HARDENED_LDFLAGS=\"$HARDENED_LDFLAGS -pie\"])\n+    AX_CHECK_LINK_FLAG([[-Wl,-pie]], [HARDENED_LDFLAGS=\"$HARDENED_LDFLAGS -Wl,-pie\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#discussion_r180112353",
      "id" : 180112353,
      "original_commit_id" : "12ebae7ba7980ffc11f8d7254c18a502cec268e3",
      "original_position" : 5,
      "path" : "configure.ac",
      "position" : 5,
      "pull_request_review_id" : 110476137,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12899",
      "updated_at" : "2018-04-09T14:27:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/180112353",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "(see edit at bottom)\r\n\r\nThe issue here is that macOS is always pie, so there's no need to specify it. The compiler front-end warns about it, but I guess the linker doesn't care.\r\n\r\n@kallewoof default-pie is a configure option for recent compilers (at least for gcc, and I assume clang as well). It's up to distros/packagers whether they want to enable it or not. Modern distros have begun enabling it.\r\n\r\nSo the change here doesn't really fix the problem, it just bypasses the compiler and goes straight to the linker, which may also start complaining in some future version.\r\n\r\nWhat we should be doing here is checking for warnings in the test instead. Windows is also default-pie and was special-cased because it also warned, but we can also eliminate that case if warnings are caught:\r\n```diff\r\n   AX_CHECK_LINK_FLAG([[-Wl,-z,relro]], [HARDENED_LDFLAGS=\"$HARDENED_LDFLAGS -Wl,-z,relro\"])\r\n   AX_CHECK_LINK_FLAG([[-Wl,-z,now]], [HARDENED_LDFLAGS=\"$HARDENED_LDFLAGS -Wl,-z,now\"])\r\n\r\n-  if test x$TARGET_OS != xwindows; then\r\n-    AX_CHECK_COMPILE_FLAG([-fPIE],[PIE_FLAGS=\"-fPIE\"])\r\n-    AX_CHECK_LINK_FLAG([[-pie]], [HARDENED_LDFLAGS=\"$HARDENED_LDFLAGS -pie\"])\r\n-  fi\r\n+  AX_CHECK_COMPILE_FLAG([-fPIE],[PIE_FLAGS=\"-fPIE\"], [[$CXXFLAG_WERROR]]))\r\n+  AX_CHECK_LINK_FLAG([[-pie]], [HARDENED_LDFLAGS=\"$HARDENED_LDFLAGS -pie\"], [[$CXXFLAG_WERROR]])\r\n\r\n   case $host in\r\n     *mingw*)\r\n```\r\n\r\nAs for libbitcoinconsensus, building it as pie is the wrong thing to be doing anyway. I'm actually not sure how that's working now. I believe the proper fix is simply:\r\n```diff\r\ndiff --git a/src/Makefile.am b/src/Makefile.am\r\nindex 993bf20387..b5f8b2c197 100644\r\n--- a/src/Makefile.am\r\n+++ b/src/Makefile.am\r\n@@ -457,7 +457,7 @@ endif\r\n libbitcoinconsensus_la_LDFLAGS = $(AM_LDFLAGS) -no-undefined $(RELDFLAGS)\r\n libbitcoinconsensus_la_LIBADD = $(LIBSECP256K1)\r\n libbitcoinconsensus_la_CPPFLAGS = $(AM_CPPFLAGS) -I$(builddir)/obj -I$(srcdir)/secp256k1/include -DBUILD_BITCOIN_INTERNAL\r\n-libbitcoinconsensus_la_CXXFLAGS = $(AM_CXXFLAGS) $(PIE_FLAGS)\r\n+libbitcoinconsensus_la_CXXFLAGS = $(AM_CXXFLAGS) $(PIC_FLAGS)\r\n\r\n endif\r\n #\r\n```\r\n\r\nEdit: On second glance, libbitcoinconsensus will still end up with -pie on linux because AM_LDFLAGS contains HARDENED_LDFLAGS. I guess we'll need to split pie out of HARDENED_LDFLAGS :(\r\n\r\nEdit2: Researching this for what must be the hundredth time and it's just as hazy as ever. It looks like building the lib as -pie might be fine, but it'd be nice to find a definitive answer and add a comment with an explanation. If that's the case, the second patch here can just be dropped.",
      "created_at" : "2018-04-09T17:39:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#issuecomment-379833581",
      "id" : 379833581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12899",
      "updated_at" : "2018-04-09T18:01:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/379833581",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni Thank you for your review. ",
      "created_at" : "2018-04-09T22:01:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#issuecomment-379907676",
      "id" : 379907676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12899",
      "updated_at" : "2018-04-09T22:01:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/379907676",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/24285095?v=4",
         "events_url" : "https://api.github.com/users/AkioNak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AkioNak/followers",
         "following_url" : "https://api.github.com/users/AkioNak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AkioNak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AkioNak",
         "id" : 24285095,
         "login" : "AkioNak",
         "organizations_url" : "https://api.github.com/users/AkioNak/orgs",
         "received_events_url" : "https://api.github.com/users/AkioNak/received_events",
         "repos_url" : "https://api.github.com/users/AkioNak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AkioNak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AkioNak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AkioNak"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theuni Thanks for the detailed explanation! I agree that we should check for pie warnings as in your first patch. No idea on the second patch, really.",
      "created_at" : "2018-04-10T01:57:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#issuecomment-379948969",
      "id" : 379948969,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12899",
      "updated_at" : "2018-04-10T01:57:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/379948969",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni I understood that how to use 4th parameter of AX_CHECK_{COMPILE,LINK}_FLAG().\r\nI agree what you pointed out. thanks.",
      "created_at" : "2018-04-10T02:05:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#issuecomment-379950286",
      "id" : 379950286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12899",
      "updated_at" : "2018-04-10T02:05:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/379950286",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/24285095?v=4",
         "events_url" : "https://api.github.com/users/AkioNak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AkioNak/followers",
         "following_url" : "https://api.github.com/users/AkioNak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AkioNak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AkioNak",
         "id" : 24285095,
         "login" : "AkioNak",
         "organizations_url" : "https://api.github.com/users/AkioNak/orgs",
         "received_events_url" : "https://api.github.com/users/AkioNak/received_events",
         "repos_url" : "https://api.github.com/users/AkioNak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AkioNak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AkioNak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AkioNak"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@kallewoof I think the first patch is enough to fix the warnings reported by @AkioNak, and the second patch (building a shared lib as pie) can actually be dropped here as it is a separate concern.\r\n\r\n@AkioNak Could you try that and see if it works for you?",
      "created_at" : "2018-04-10T02:07:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#issuecomment-379950612",
      "id" : 379950612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12899",
      "updated_at" : "2018-04-10T02:07:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/379950612",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni sure. I will try it soon.",
      "created_at" : "2018-04-10T02:10:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#issuecomment-379951079",
      "id" : 379951079,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12899",
      "updated_at" : "2018-04-10T02:10:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/379951079",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/24285095?v=4",
         "events_url" : "https://api.github.com/users/AkioNak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AkioNak/followers",
         "following_url" : "https://api.github.com/users/AkioNak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AkioNak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AkioNak",
         "id" : 24285095,
         "login" : "AkioNak",
         "organizations_url" : "https://api.github.com/users/AkioNak/orgs",
         "received_events_url" : "https://api.github.com/users/AkioNak/received_events",
         "repos_url" : "https://api.github.com/users/AkioNak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AkioNak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AkioNak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AkioNak"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni @kallewoof  fixed and rebased to master 727175a.\r\nIt works fine (there is no warnings about ```-pie```, ```make check```  reports all ```PASS```) on my enviroment , both macos10.13.4/XCode9.3 and ubuntu 17.10/g++7.2.0.\r\n\r\nBut Travis-Job #27212.2 and #27212.5 have failed at ```bitcoin-util-test.py```.\r\n#27212.2 https://travis-ci.org/bitcoin/bitcoin/jobs/364451508\r\n#27212.5 https://travis-ci.org/bitcoin/bitcoin/jobs/364451511\r\n\r\n",
      "created_at" : "2018-04-10T08:01:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12899#issuecomment-380010585",
      "id" : 380010585,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12899",
      "updated_at" : "2018-04-10T08:01:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380010585",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/24285095?v=4",
         "events_url" : "https://api.github.com/users/AkioNak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AkioNak/followers",
         "following_url" : "https://api.github.com/users/AkioNak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AkioNak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AkioNak",
         "id" : 24285095,
         "login" : "AkioNak",
         "organizations_url" : "https://api.github.com/users/AkioNak/orgs",
         "received_events_url" : "https://api.github.com/users/AkioNak/received_events",
         "repos_url" : "https://api.github.com/users/AkioNak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AkioNak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AkioNak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AkioNak"
      }
   }
]
