{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "When snappy compression is disabled, LevelDB does not use a block cache. This PR avoids wasting memory reserved for the block cache in that situation, and gives it to the write buffer instead.\r\n\r\nUnfortunately this behavior is not documented (I have filed a bug upstream already). You can see [here](https://github.com/bitcoin-core/leveldb/blob/bitcoin-fork/util/env_posix.cc#L202) that `PosixMmapReadableFile` takes a `scratch` argument that is unused. This isn't by accident; the return value of the method is compared against the supplied buffer [here](https://github.com/bitcoin-core/leveldb/blob/bitcoin-fork/table/format.cc#L109) to determine whether the block cache should be used.\r\n\r\nGiving more memory to the write buffer is good for a number of reasons. Among them: LevelDB checks reads against the mem table holding current writes, so the write buffer acts as an LRU within LevelDB. I have some other changes queued up in this area, but am hoping to get the basic stuff through first. The first commit in this PR is from #12495, and the second commit has the logic to actually modify the block cache size. I can merge this with #12495, but since that has already been approved I thought I'd split this out.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12825/comments",
   "created_at" : "2018-03-29T06:18:39Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12825/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/12825",
   "id" : 309632387,
   "labels" : [
      {
         "color" : "000000",
         "default" : false,
         "id" : 219890555,
         "name" : "Block storage",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage"
      },
      {
         "color" : "981023",
         "default" : false,
         "id" : 326918230,
         "name" : "Resource usage",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Resource%20usage"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12825/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 12825,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/12825.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12825",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/12825.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12825"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Only allocate a LevelDB block cache if LevelDB will actually use it",
   "updated_at" : "2018-03-29T06:42:43Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12825",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
      "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
      "followers_url" : "https://api.github.com/users/eklitzke/followers",
      "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
      "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/eklitzke",
      "id" : 2734,
      "login" : "eklitzke",
      "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
      "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
      "repos_url" : "https://api.github.com/users/eklitzke/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/eklitzke"
   }
}
