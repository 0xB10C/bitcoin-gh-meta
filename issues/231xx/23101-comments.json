[
   {
      "author_association" : "MEMBER",
      "body" : "Can be fixed with:\r\n\r\n```diff\r\ndiff --git a/src/test/validation_chainstate_tests.cpp b/src/test/validation_chainstate_tests.cpp\r\nindex 726c9ebbb..9bb08f774 100644\r\n--- a/src/test/validation_chainstate_tests.cpp\r\n+++ b/src/test/validation_chainstate_tests.cpp\r\n@@ -107,20 +107,21 @@ BOOST_FIXTURE_TEST_CASE(chainstate_update_tip, TestChain100Setup)\r\n \r\n     curr_tip = ::g_best_block;\r\n \r\n-    CChainState* background_cs;\r\n-\r\n     BOOST_CHECK_EQUAL(chainman.GetAll().size(), 2);\r\n-    for (CChainState* cs : chainman.GetAll()) {\r\n-        if (cs != &chainman.ActiveChainstate()) {\r\n-            background_cs = cs;\r\n+\r\n+    CChainState& background_cs{*[&] {\r\n+        for (CChainState* cs : chainman.GetAll()) {\r\n+            if (cs != &chainman.ActiveChainstate()) {\r\n+                return cs;\r\n+            }\r\n         }\r\n-    }\r\n-    BOOST_CHECK(background_cs);\r\n+        assert(false);\r\n+    }()};\r\n \r\n     // Create a block to append to the validation chain.\r\n     std::vector<CMutableTransaction> noTxns;\r\n     CScript scriptPubKey = CScript() << ToByteVector(coinbaseKey.GetPubKey()) << OP_CHECKSIG;\r\n-    CBlock validation_block = this->CreateBlock(noTxns, scriptPubKey, *background_cs);\r\n+    CBlock validation_block = this->CreateBlock(noTxns, scriptPubKey, background_cs);\r\n     auto pblock = std::make_shared<const CBlock>(validation_block);\r\n     BlockValidationState state;\r\n     CBlockIndex* pindex = nullptr;\r\n@@ -133,15 +134,15 @@ BOOST_FIXTURE_TEST_CASE(chainstate_update_tip, TestChain100Setup)\r\n         LOCK(::cs_main);\r\n         bool checked = CheckBlock(*pblock, state, chainparams.GetConsensus());\r\n         BOOST_CHECK(checked);\r\n-        bool accepted = background_cs->AcceptBlock(\r\n+        bool accepted = background_cs.AcceptBlock(\r\n             pblock, state, &pindex, true, nullptr, &newblock);\r\n         BOOST_CHECK(accepted);\r\n     }\r\n     // UpdateTip is called here\r\n-    bool block_added = background_cs->ActivateBestChain(state, pblock);\r\n+    bool block_added = background_cs.ActivateBestChain(state, pblock);\r\n \r\n     // Ensure tip is as expected\r\n-    BOOST_CHECK_EQUAL(background_cs->m_chain.Tip()->GetBlockHash(), validation_block.GetHash());\r\n+    BOOST_CHECK_EQUAL(background_cs.m_chain.Tip()->GetBlockHash(), validation_block.GetHash());\r\n \r\n     // g_best_block should be unchanged after adding a block to the background\r\n     // validation chain.\r\n",
      "created_at" : "2021-09-27T07:36:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/23101#issuecomment-927610498",
      "id" : 927610498,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23101",
      "node_id" : "IC_kwDOABII5843SjaC",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-27T07:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/927610498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
