[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16682](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16682.html) ([WIP] p2p: Disconnect peer that send us tx INVs when we opted out of tx relay by jnewbery)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-09-17T00:55:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16890#issuecomment-532013608",
      "id" : 532013608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16890",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjAxMzYwOA==",
      "updated_at" : "2019-09-17T00:55:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532013608",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16890#discussion_r325016288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16890"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325016288"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, add braces or single line.",
      "commit_id" : "33cb347a6b4181491f88a8d43cf7d4224c935e7b",
      "created_at" : "2019-09-17T07:24:36Z",
      "diff_hunk" : "@@ -830,6 +830,9 @@ static UniValue estimatesmartfee(const JSONRPCRequest& request)\n         if (fee_mode == FeeEstimateMode::ECONOMICAL) conservative = false;\n     }\n \n+    if (!g_relay_txes)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16890#discussion_r325016288",
      "id" : 325016288,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTAxNjI4OA==",
      "original_commit_id" : "33cb347a6b4181491f88a8d43cf7d4224c935e7b",
      "original_position" : 4,
      "path" : "src/rpc/mining.cpp",
      "position" : 4,
      "pull_request_review_id" : 289064544,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16890",
      "updated_at" : "2019-09-17T07:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325016288",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm not sure I understand the thinking here -- should we also disallow transacting if in blocksonly mode?  It's not clear to me that hiding the fee estimation results but allowing the wallet to transact is a useful user experience.\r\n\r\nI see the original issue has to do with a lightning wallet that is using our fee estimates under the hood; perhaps we should instead expose the blocksonly setting via an rpc call (if we're not doing it already) and the lightning wallet can decide how to handle the configuration?",
      "created_at" : "2019-09-17T13:18:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16890#issuecomment-532216705",
      "id" : 532216705,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16890",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjIxNjcwNQ==",
      "updated_at" : "2019-09-17T13:18:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532216705",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'm not sure I understand the thinking here -- should we also disallow transacting if in blocksonly mode? It's not clear to me that hiding the fee estimation results but allowing the wallet to transact is a useful user experience.\r\n\r\nSince the `estimatesmartfee` command returns an estimation based on relayed transaction, if we don't relay (or rather stop relaying) the estimation will be wrong ([based on the last relayed transactions](https://github.com/bitcoin/bitcoin/issues/16840#issuecomment-529904220)). This change assumes that it's wise to return an error instead of a wrong information.\r\n\r\n> I see the original issue has to do with a lightning wallet that is using our fee estimates under the hood;\r\n\r\nYes (C-lightning) and it assumes that the estimation is accurate (or rather not very inaccurate).\r\n\r\n> perhaps we should instead expose the blocksonly setting via an rpc call (if we're not doing it already) and the lightning wallet can decide how to handle the configuration?\r\n\r\nI think this should be handled on our side as we expose an inaccurate information.",
      "created_at" : "2019-09-17T16:24:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16890#issuecomment-532295813",
      "id" : 532295813,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16890",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjI5NTgxMw==",
      "updated_at" : "2019-09-17T16:24:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532295813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think this should be handled on our side as we expose an inaccurate information.\r\n\r\nIf this is a substantial problem, then I would think we should take action to protect our own wallet users as well (rather than hide the results of what our fee estimation would do!).",
      "created_at" : "2019-09-17T16:51:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16890#issuecomment-532306026",
      "id" : 532306026,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16890",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjMwNjAyNg==",
      "updated_at" : "2019-09-17T16:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532306026",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes that's preferable and also what I wanted to do instead of this PR.\r\nHowever I don't see how we could give an accurate estimation without an updated mempool ? If you have an idea I'd be happy to work on this.\r\n\r\nI thought about median fees in the last `n` blocks but in the case that a lot of transactions are mined with unnecessary high fees that would give inaccurate estimation and contribute to a global fee increase. Or maybe I miss something ?",
      "created_at" : "2019-09-17T20:48:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16890#issuecomment-532395734",
      "id" : 532395734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16890",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjM5NTczNA==",
      "updated_at" : "2019-09-17T20:48:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532395734",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> However I don't see how we could give an accurate estimation without an updated mempool\r\n\r\nCould just fail? There's already the error \"Insufficient data or no feerate found\" so looks like we could add \"Expired data\" or something like that - this would affect wallets too.",
      "created_at" : "2019-09-18T13:52:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16890#issuecomment-532694319",
      "id" : 532694319,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16890",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUzMjY5NDMxOQ==",
      "updated_at" : "2019-09-18T13:52:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/532694319",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
