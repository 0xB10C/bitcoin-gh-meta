{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "This pull request proposes a solution to make the test `DoS_mapOrphans` in denialofservice_tests.cpp have deterministic coverage.\r\n\r\nThe `RandomOrphan` function in denialofservice_tests.cpp and the implicitly called function `ecdsa_signature_parse_der_lax` in pubkey.cpp were causing the non-deterministic test coverage.\r\n\r\nIn the former, if a random orphan was selected the index of which is bigger than the max. orphan index in `mapOrphanTransactions`, the last orphan was returned from `RandomOrphan`. If the random number generated was never large enough, this condition would not be fulfilled and the corresponding branch wouldn't run. The proposed solution is to force one of the 50 dependant orphans to depend on the last orphan in `mapOrphanTransactions` using the newly introduced function `OrphanByIndex` (and passing it a large uint256), forcing this branch to run at least once.\r\n\r\nIn the latter, if values for ECDSA `R` or `S` (or both) had no leading zeros, some code would not be executed. The solution was to find a constant signature that would be comprised of `R` and `S` values with leading zeros and calling `CPubKey::Verify` at the end of the test with this signature forcing this code to always run at least once at the end even if it hadn't throughout the test.\r\n\r\nTo test that the coverage is (at least highly likely) deterministic, I ran \r\n\r\n`contrib/devtools/test_deterministic_coverage.sh denialofservice_tests/DoS_mapOrphans 1000`\r\n\r\nand the result was deterministic coverage across 1000 runs.\r\n\r\nAlso - removed denialofservice_tests test entry from the list of non-deterministic tests in the coverage script.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16878/comments",
   "created_at" : "2019-09-16T05:20:27Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16878/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/16878",
   "id" : 493851553,
   "labels" : [
      {
         "color" : "d4c5f9",
         "default" : false,
         "id" : 62963516,
         "name" : "Tests",
         "node_id" : "MDU6TGFiZWw2Mjk2MzUxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16878/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0MzE3NzIwMTE3",
   "number" : 16878,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/16878.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16878",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/16878.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Fix non-deterministic coverage of test DoS_mapOrphans ",
   "updated_at" : "2019-09-16T06:05:05Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/5347350?v=4",
      "events_url" : "https://api.github.com/users/davereikher/events{/privacy}",
      "followers_url" : "https://api.github.com/users/davereikher/followers",
      "following_url" : "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url" : "https://api.github.com/users/davereikher/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/davereikher",
      "id" : 5347350,
      "login" : "davereikher",
      "node_id" : "MDQ6VXNlcjUzNDczNTA=",
      "organizations_url" : "https://api.github.com/users/davereikher/orgs",
      "received_events_url" : "https://api.github.com/users/davereikher/received_events",
      "repos_url" : "https://api.github.com/users/davereikher/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/davereikher/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/davereikher"
   }
}
