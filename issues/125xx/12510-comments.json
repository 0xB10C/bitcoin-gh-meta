[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12510#discussion_r169994145"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12510"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169994145"
         }
      },
      "author_association" : "OWNER",
      "body" : "The allowip test could also be done by connecting from a second loopback IP, say, 127.0.0.2. This would obliterate the need for a non loopback IP, but would need support in the test framework at the RPC/HTTP level for binding to a different address before outgoing connection (connecting to a different interface IP does that part automatically...)",
      "commit_id" : "066527b9b1212ee503da30f355befdf5912a3852",
      "created_at" : "2018-02-22T15:29:23Z",
      "diff_hunk" : "@@ -89,19 +83,26 @@ def run_test(self):\n         # check only IPv4 localhost (explicit) with multiple alternative ports on same host\n         self.run_bind_test(['127.0.0.1'], '127.0.0.1:32171', ['127.0.0.1:32171', '127.0.0.1:32172'],\n             [('127.0.0.1', 32171), ('127.0.0.1', 32172)])\n-        # check only IPv6 localhost (explicit)\n-        self.run_bind_test(['[::1]'], '[::1]', ['[::1]'],\n-            [('::1', defaultport)])\n-        # check both IPv4 and IPv6 localhost (explicit)\n-        self.run_bind_test(['127.0.0.1'], '127.0.0.1', ['127.0.0.1', '[::1]'],\n-            [('127.0.0.1', defaultport), ('::1', defaultport)])\n-        # check only non-loopback interface\n-        self.run_bind_test([non_loopback_ip], non_loopback_ip, [non_loopback_ip],\n-            [(non_loopback_ip, defaultport)])\n+        if have_ipv6:\n+            self.log.info(\"Using interface %s for testing\" % non_loopback_ip)\n+\n+            # check only IPv6 localhost (explicit)\n+            self.run_bind_test(['[::1]'], '[::1]', ['[::1]'],\n+                [('::1', defaultport)])\n+            # check both IPv4 and IPv6 localhost (explicit)\n+            self.run_bind_test(['127.0.0.1'], '127.0.0.1', ['127.0.0.1', '[::1]'],\n+                [('127.0.0.1', defaultport), ('::1', defaultport)])\n+\n+        if non_loopback_ip is not None:\n+            # check only non-loopback interface\n+            self.run_bind_test([non_loopback_ip], non_loopback_ip, [non_loopback_ip],\n+                [(non_loopback_ip, defaultport)])\n \n-        # Check that with invalid rpcallowip, we are denied\n-        self.run_allowip_test([non_loopback_ip], non_loopback_ip, defaultport)\n-        assert_raises_rpc_error(-342, \"non-JSON HTTP response with '403 Forbidden' from server\", self.run_allowip_test, ['1.1.1.1'], non_loopback_ip, defaultport)\n+            # Check that with invalid rpcallowip, we are denied\n+            self.run_allowip_test([non_loopback_ip], non_loopback_ip, defaultport)\n+            assert_raises_rpc_error(-342, \"non-JSON HTTP response with '403 Forbidden' from server\", self.run_allowip_test, ['1.1.1.1'], non_loopback_ip, defaultport)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12510#discussion_r169994145",
      "id" : 169994145,
      "original_commit_id" : "598b273781381a69e4b2118c64fff7fa776c6f15",
      "original_position" : 75,
      "path" : "test/functional/rpc_bind.py",
      "position" : 83,
      "pull_request_review_id" : 98607421,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12510",
      "updated_at" : "2018-02-22T15:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169994145",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12510#discussion_r170003975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12510"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170003975"
         }
      },
      "author_association" : "OWNER",
      "body" : "Ughh, I tried this but it doesn't work. Apparently the entire IPv4 subnet is unconditionally allowed.\r\n```c++\r\nrpc_allow_subnets.push_back(CSubNet(localv4, 8));      // always allow IPv4 local subnet\r\n```\r\n(It works when removing the `, 8` - the full changes are here: https://github.com/laanwj/bitcoin/commit/0dad20fe2f9ef3c053b007704f46fd1f0e26fc5f)\r\n(It would also work for IPv6, as it only binds on a single localhost IP there. But that won't help for Travis)",
      "commit_id" : "066527b9b1212ee503da30f355befdf5912a3852",
      "created_at" : "2018-02-22T15:56:57Z",
      "diff_hunk" : "@@ -89,19 +83,26 @@ def run_test(self):\n         # check only IPv4 localhost (explicit) with multiple alternative ports on same host\n         self.run_bind_test(['127.0.0.1'], '127.0.0.1:32171', ['127.0.0.1:32171', '127.0.0.1:32172'],\n             [('127.0.0.1', 32171), ('127.0.0.1', 32172)])\n-        # check only IPv6 localhost (explicit)\n-        self.run_bind_test(['[::1]'], '[::1]', ['[::1]'],\n-            [('::1', defaultport)])\n-        # check both IPv4 and IPv6 localhost (explicit)\n-        self.run_bind_test(['127.0.0.1'], '127.0.0.1', ['127.0.0.1', '[::1]'],\n-            [('127.0.0.1', defaultport), ('::1', defaultport)])\n-        # check only non-loopback interface\n-        self.run_bind_test([non_loopback_ip], non_loopback_ip, [non_loopback_ip],\n-            [(non_loopback_ip, defaultport)])\n+        if have_ipv6:\n+            self.log.info(\"Using interface %s for testing\" % non_loopback_ip)\n+\n+            # check only IPv6 localhost (explicit)\n+            self.run_bind_test(['[::1]'], '[::1]', ['[::1]'],\n+                [('::1', defaultport)])\n+            # check both IPv4 and IPv6 localhost (explicit)\n+            self.run_bind_test(['127.0.0.1'], '127.0.0.1', ['127.0.0.1', '[::1]'],\n+                [('127.0.0.1', defaultport), ('::1', defaultport)])\n+\n+        if non_loopback_ip is not None:\n+            # check only non-loopback interface\n+            self.run_bind_test([non_loopback_ip], non_loopback_ip, [non_loopback_ip],\n+                [(non_loopback_ip, defaultport)])\n \n-        # Check that with invalid rpcallowip, we are denied\n-        self.run_allowip_test([non_loopback_ip], non_loopback_ip, defaultport)\n-        assert_raises_rpc_error(-342, \"non-JSON HTTP response with '403 Forbidden' from server\", self.run_allowip_test, ['1.1.1.1'], non_loopback_ip, defaultport)\n+            # Check that with invalid rpcallowip, we are denied\n+            self.run_allowip_test([non_loopback_ip], non_loopback_ip, defaultport)\n+            assert_raises_rpc_error(-342, \"non-JSON HTTP response with '403 Forbidden' from server\", self.run_allowip_test, ['1.1.1.1'], non_loopback_ip, defaultport)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12510#discussion_r170003975",
      "id" : 170003975,
      "in_reply_to_id" : 169994145,
      "original_commit_id" : "598b273781381a69e4b2118c64fff7fa776c6f15",
      "original_position" : 75,
      "path" : "test/functional/rpc_bind.py",
      "position" : 83,
      "pull_request_review_id" : 98619477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12510",
      "updated_at" : "2018-02-22T16:07:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170003975",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
