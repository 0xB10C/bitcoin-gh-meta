[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12565#discussion_r171235800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12565"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171235800"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Missing lock?",
      "commit_id" : "81bcb253e18ff830a80145dfebf8339e5f47993a",
      "created_at" : "2018-02-28T12:58:00Z",
      "diff_hunk" : "@@ -671,14 +671,30 @@ bool WalletModel::bumpFee(uint256 hash)\n     CAmount old_fee;\n     CAmount new_fee;\n     CMutableTransaction mtx;\n-    if (feebumper::CreateTransaction(wallet, hash, coin_control, 0 /* totalFee */, errors, old_fee, new_fee, mtx) != feebumper::Result::OK) {\n+\n+    // If the transaction has a single output, ask user if it's OK to reduce:\n+    int32_t reduce_output = -1;\n+    auto it = wallet->mapWallet.find(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12565#discussion_r171235800",
      "id" : 171235800,
      "original_commit_id" : "81bcb253e18ff830a80145dfebf8339e5f47993a",
      "original_position" : 8,
      "path" : "src/qt/walletmodel.cpp",
      "position" : 8,
      "pull_request_review_id" : 100051505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12565",
      "updated_at" : "2018-02-28T13:06:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171235800",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12565#discussion_r171237505"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12565"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171237505"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, and the diff is smaller:\r\n```cpp\r\nQString questionString = tr(...);\r\nif (reduce_output != -1) {\r\n     questionString = tr(...);\r\n}",
      "commit_id" : "81bcb253e18ff830a80145dfebf8339e5f47993a",
      "created_at" : "2018-02-28T13:04:54Z",
      "diff_hunk" : "@@ -671,14 +671,30 @@ bool WalletModel::bumpFee(uint256 hash)\n     CAmount old_fee;\n     CAmount new_fee;\n     CMutableTransaction mtx;\n-    if (feebumper::CreateTransaction(wallet, hash, coin_control, 0 /* totalFee */, errors, old_fee, new_fee, mtx) != feebumper::Result::OK) {\n+\n+    // If the transaction has a single output, ask user if it's OK to reduce:\n+    int32_t reduce_output = -1;\n+    auto it = wallet->mapWallet.find(hash);\n+    if (it != wallet->mapWallet.end()) {\n+        const CWalletTx wtx = it->second;\n+        if (wtx.tx->vout.size() == 1) {\n+            reduce_output = 0;\n+        }\n+    }\n+\n+    if (feebumper::CreateTransaction(wallet, hash, coin_control, 0 /* totalFee */, reduce_output, errors, old_fee, new_fee, mtx) != feebumper::Result::OK) {\n         QMessageBox::critical(0, tr(\"Fee bump error\"), tr(\"Increasing transaction fee failed\") + \"<br />(\" +\n             (errors.size() ? QString::fromStdString(errors[0]) : \"\") +\")\");\n          return false;\n     }\n \n     // allow a user based fee verification\n-    QString questionString = tr(\"Do you want to increase the fee?\");\n+    QString questionString;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12565#discussion_r171237505",
      "id" : 171237505,
      "original_commit_id" : "81bcb253e18ff830a80145dfebf8339e5f47993a",
      "original_position" : 24,
      "path" : "src/qt/walletmodel.cpp",
      "position" : 24,
      "pull_request_review_id" : 100051505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12565",
      "updated_at" : "2018-02-28T13:06:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171237505",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> add a parameter to feebumper::CreateTransaction to return whether a non-change output was reduced\r\n\r\n@kallewoof can that be part of #12096, e.g. if `reduce_output==-2` it picks the biggest output?",
      "created_at" : "2018-02-28T14:10:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12565#issuecomment-369250471",
      "id" : 369250471,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12565",
      "updated_at" : "2018-02-28T14:10:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/369250471",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12565#discussion_r171256207"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12565"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171256207"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there good documentation about when locks are appropriate? Other than: https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#lockingmutex-usage-notes",
      "commit_id" : "81bcb253e18ff830a80145dfebf8339e5f47993a",
      "created_at" : "2018-02-28T14:12:56Z",
      "diff_hunk" : "@@ -671,14 +671,30 @@ bool WalletModel::bumpFee(uint256 hash)\n     CAmount old_fee;\n     CAmount new_fee;\n     CMutableTransaction mtx;\n-    if (feebumper::CreateTransaction(wallet, hash, coin_control, 0 /* totalFee */, errors, old_fee, new_fee, mtx) != feebumper::Result::OK) {\n+\n+    // If the transaction has a single output, ask user if it's OK to reduce:\n+    int32_t reduce_output = -1;\n+    auto it = wallet->mapWallet.find(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12565#discussion_r171256207",
      "id" : 171256207,
      "in_reply_to_id" : 171235800,
      "original_commit_id" : "81bcb253e18ff830a80145dfebf8339e5f47993a",
      "original_position" : 8,
      "path" : "src/qt/walletmodel.cpp",
      "position" : 8,
      "pull_request_review_id" : 100075675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12565",
      "updated_at" : "2018-02-28T14:13:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171256207",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12565#discussion_r171256896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12565"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171256896"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`mapWallet` is protected by `cs_wallet`. If this is moved to `feebumper::CreateTransaction` then the lock is already held there.",
      "commit_id" : "81bcb253e18ff830a80145dfebf8339e5f47993a",
      "created_at" : "2018-02-28T14:15:21Z",
      "diff_hunk" : "@@ -671,14 +671,30 @@ bool WalletModel::bumpFee(uint256 hash)\n     CAmount old_fee;\n     CAmount new_fee;\n     CMutableTransaction mtx;\n-    if (feebumper::CreateTransaction(wallet, hash, coin_control, 0 /* totalFee */, errors, old_fee, new_fee, mtx) != feebumper::Result::OK) {\n+\n+    // If the transaction has a single output, ask user if it's OK to reduce:\n+    int32_t reduce_output = -1;\n+    auto it = wallet->mapWallet.find(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12565#discussion_r171256896",
      "id" : 171256896,
      "in_reply_to_id" : 171235800,
      "original_commit_id" : "81bcb253e18ff830a80145dfebf8339e5f47993a",
      "original_position" : 8,
      "path" : "src/qt/walletmodel.cpp",
      "position" : 8,
      "pull_request_review_id" : 100076550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12565",
      "updated_at" : "2018-02-28T14:15:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171256896",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think this is the right route. While I think users should be able to reduce outputs if desired, we should by default offer to add inputs, not reduce outputs.",
      "created_at" : "2018-02-28T16:24:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12565#issuecomment-369294887",
      "id" : 369294887,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12565",
      "updated_at" : "2018-02-28T16:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/369294887",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   }
]
