[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some of the previously proposed USDTs by @jb55 from #19866:\r\n\r\n#### `net:push_message`\r\n  - traces all sent P2P messages as TRACE5:\r\n    - `int node_id`\r\n    - `char* node_addr`\r\n    - `char* msg_type`\r\n    - `size_t msg_size`\r\n    - `uint8_t* msg_data`\r\n\r\n \r\n https://github.com/bitcoin/bitcoin/blob/7d8a10a6f4d61df1f4afb138e379149565afa02d/src/net.cpp#L3001\r\n \r\n ---\r\n\r\n#### `net:process_message`\r\nTraces all received P2P messages as TRACE5:\r\n  - `int node_id`\r\n  - `char* node_addr`\r\n  - `char* msg_type`\r\n  - `size_t msg_size`\r\n  - `uint8_t* msg_data`\r\n    \r\nhttps://github.com/bitcoin/bitcoin/blob/7d8a10a6f4d61df1f4afb138e379149565afa02d/src/net_processing.cpp#L3812\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/19866 has an example bpftrace script using  `net:process_message` and `net:push_message`.\r\n\r\n---\r\n\r\n#### `validation:connect_block`\r\nTraces all blocks for which ConnectBlock() is called as TRACE4:\r\n  - `uint32 height`\r\n  - `int tx_count`\r\n  - `uint8_t[32] hash`\r\n  - `uint8_t[32] prevhash`\r\n  - (more header fields?)\r\n\r\nPassing the full serialized block is not possible as this could be bigger than both the bcc and bftrace stack (the kernel VM crashes gracefully, no stack overflow). While the serialized block header would not be bigger than the stack size, header serialization would need to happen even when no USDTs are attached. This has an performance impact and should not be done.  \r\n\r\n@jb55 used an earlier version of `validation:connect_block` to measure IBD performance.  \r\n\r\nDepending on placement in `ConnectBlock()`, this could either trace to-be-connected blocks or connected blocks (no error while connecting). In either way, the documentation should make it clear for which blocks the data is passed. \r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/7d8a10a6f4d61df1f4afb138e379149565afa02d/src/validation.cpp#L1946",
      "created_at" : "2021-01-23T15:03:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20981#issuecomment-766092705",
      "id" : 766092705,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20981",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NjA5MjcwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-23T15:06:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/766092705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj [mentioned](https://github.com/bitcoin/bitcoin/pull/19866#issuecomment-687336319) that traces for dis- and connections of peers would be useful too. I'll have a look where these could be placed. I guess there are some places where there is already `net` debug logging which can be used for orientation. @jlopp's statoshi diff could be helpful to look at too. \r\n\r\nAlso interesting:\r\n- function timings, like [statoshi.info/function-timings](https://statoshi.info/dashboard/db/function-timings) for block and transaction validation functions\r\n- tracing fee estimation\r\n\r\n\r\n\r\n  ",
      "created_at" : "2021-01-23T15:27:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/20981#issuecomment-766096054",
      "id" : 766096054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20981",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NjA5NjA1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-23T15:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/766096054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   }
]
