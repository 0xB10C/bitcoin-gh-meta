[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557365662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557365662"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n     * @return \\p p if \\p p is an absolute path, otherwise \\p base joined with \\p p is returned.\r\n```",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-14T12:39:43Z",
      "diff_hunk" : "@@ -21,6 +21,15 @@ namespace fs = boost::filesystem;\n namespace fsbridge {\n     FILE *fopen(const fs::path& p, const char *mode);\n \n+    /**\n+     * Helper function asserting that \\p base is an absolute path and returning the result of boost::filesystem::absolute(p, base) then.\n+     *\n+     * @param[in] base  Absolute path.\n+     * @param[in] p     Path to combine with \\p base.\n+     * @return \\p p if \\p p is an absolute path, othwerwise \\p base joined with \\p p is returned.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557365662",
      "id" : 557365662,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzM2NTY2Mg==",
      "original_commit_id" : "6d5947e1c6ba7384b7407fa429778272de518eb3",
      "original_line" : 29,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/fs.h",
      "position" : null,
      "pull_request_review_id" : 568194346,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557365662",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20017 (rpc: Add RPCContext by promag)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-01-14T15:35:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#issuecomment-760273962",
      "id" : 760273962,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDI3Mzk2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-14T15:35:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760273962",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557657689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557657689"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Introduce fsbridge::AbsPathJoin(base, p).\" (c0da7456833fac6d5613d97e09266cf54f13594f)\r\n\r\nI think it would be good to add \"refactor:\" to the PR title to be clear that there is no intended behavior change here. New code is exactly equivalent to previous code, it is just going through a helper function and adding an assert.",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-14T19:53:34Z",
      "diff_hunk" : "@@ -21,6 +21,15 @@ namespace fs = boost::filesystem;\n namespace fsbridge {\n     FILE *fopen(const fs::path& p, const char *mode);\n \n+    /**\n+     * Helper function asserting that \\p base is an absolute path and returning the result of boost::filesystem::absolute(p, base) then.\n+     *\n+     * @param[in] base  Absolute path.\n+     * @param[in] p     Path to combine with \\p base.\n+     * @return \\p p if \\p p is an absolute path, otherwise \\p base joined with \\p p is returned.\n+     */\n+    fs::path AbsPathJoin(const fs::path& base, const fs::path& p);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557657689",
      "id" : 557657689,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY1NzY4OQ==",
      "original_commit_id" : "c0da7456833fac6d5613d97e09266cf54f13594f",
      "original_line" : 31,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/fs.h",
      "position" : null,
      "pull_request_review_id" : 568576065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557657689",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557662281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557662281"
         }
      },
      "author_association" : "MEMBER",
      "body" : "naming nit, suggest s/p/path/\r\n\r\nand the following Doxygen documentation seems more clear to me\r\n```diff\r\n-     * @param[in] base  Absolute path.\r\n-     * @param[in] p     Path to combine with \\p base.\r\n-     * @return \\p p if \\p p is an absolute path, otherwise \\p base joined with \\p p is returned.\r\n+     * @param[in] base  Absolute path\r\n+     * @param[in] path  Path to combine with base\r\n+     * @returns path if it is an absolute path, otherwise base joined with path\r\n```\r\n",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-14T19:58:08Z",
      "diff_hunk" : "@@ -21,6 +21,15 @@ namespace fs = boost::filesystem;\n namespace fsbridge {\n     FILE *fopen(const fs::path& p, const char *mode);\n \n+    /**\n+     * Helper function asserting that \\p base is an absolute path and returning the result of boost::filesystem::absolute(p, base) then.\n+     *\n+     * @param[in] base  Absolute path.\n+     * @param[in] p     Path to combine with \\p base.\n+     * @return \\p p if \\p p is an absolute path, otherwise \\p base joined with \\p p is returned.\n+     */\n+    fs::path AbsPathJoin(const fs::path& base, const fs::path& p);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557662281",
      "id" : 557662281,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY2MjI4MQ==",
      "original_commit_id" : "c0da7456833fac6d5613d97e09266cf54f13594f",
      "original_line" : 31,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/fs.h",
      "position" : null,
      "pull_request_review_id" : 568579508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557662281",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557664773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557664773"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Introduce fsbridge::AbsPathJoin(base, p).\" (c0da7456833fac6d5613d97e09266cf54f13594f)\r\n\r\nWould be good to drop \"and returning the result of boost::filesystem...\". Return value is already described below and the point of this function is to avoid the need for people to understand the extremely complicated boost function, which doesn't make any assumptions, by replacing with it a more straightforward join assuming at least one absolute path.",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-14T20:02:19Z",
      "diff_hunk" : "@@ -21,6 +21,15 @@ namespace fs = boost::filesystem;\n namespace fsbridge {\n     FILE *fopen(const fs::path& p, const char *mode);\n \n+    /**\n+     * Helper function asserting that \\p base is an absolute path and returning the result of boost::filesystem::absolute(p, base) then.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557664773",
      "id" : 557664773,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY2NDc3Mw==",
      "original_commit_id" : "c0da7456833fac6d5613d97e09266cf54f13594f",
      "original_line" : 25,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/fs.h",
      "position" : null,
      "pull_request_review_id" : 568576065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557664773",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557665415"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557665415"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const fs::path wallet_path = fsbridge::AbsPathJoin(GetWalletDir(), name);\r\n```",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-14T20:03:36Z",
      "diff_hunk" : "@@ -3780,7 +3780,7 @@ std::unique_ptr<WalletDatabase> MakeWalletDatabase(const std::string& name, cons\n     // 2. Path to an existing directory.\n     // 3. Path to a symlink to a directory.\n     // 4. For backwards compatibility, the name of a data file in -walletdir.\n-    const fs::path& wallet_path = fs::absolute(name, GetWalletDir());\n+    const fs::path& wallet_path = fsbridge::AbsPathJoin(GetWalletDir(), name);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557665415",
      "id" : 557665415,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY2NTQxNQ==",
      "original_commit_id" : "c0da7456833fac6d5613d97e09266cf54f13594f",
      "original_line" : 3783,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 568579508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557665415",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557667116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557667116"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const fs::path path = fsbridge::AbsPathJoin(GetWalletDir(), name);\r\n```",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-14T20:06:33Z",
      "diff_hunk" : "@@ -105,7 +105,7 @@ static void WalletShowInfo(CWallet* wallet_instance)\n \n bool ExecuteWalletToolFunc(const ArgsManager& args, const std::string& command, const std::string& name)\n {\n-    fs::path path = fs::absolute(name, GetWalletDir());\n+    fs::path path = fsbridge::AbsPathJoin(GetWalletDir(), name);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557667116",
      "id" : 557667116,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY2NzExNg==",
      "original_commit_id" : "c0da7456833fac6d5613d97e09266cf54f13594f",
      "original_line" : 108,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 568579508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557667116",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557667341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557667341"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const fs::path path = fsbridge::AbsPathJoin(GetDataDir(), request.params[0].get_str());\r\n```",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-14T20:06:54Z",
      "diff_hunk" : "@@ -2399,10 +2399,10 @@ static RPCHelpMan dumptxoutset()\n         },\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n-    fs::path path = fs::absolute(request.params[0].get_str(), GetDataDir());\n+    fs::path path = fsbridge::AbsPathJoin(GetDataDir(), request.params[0].get_str());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557667341",
      "id" : 557667341,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY2NzM0MQ==",
      "original_commit_id" : "c0da7456833fac6d5613d97e09266cf54f13594f",
      "original_line" : 2402,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 568579508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557667341",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557667469"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557667469"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const fs::path temppath = fsbridge::AbsPathJoin(GetDataDir(), request.params[0].get_str() + \".incomplete\");\r\n```",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-14T20:07:07Z",
      "diff_hunk" : "@@ -2399,10 +2399,10 @@ static RPCHelpMan dumptxoutset()\n         },\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n {\n-    fs::path path = fs::absolute(request.params[0].get_str(), GetDataDir());\n+    fs::path path = fsbridge::AbsPathJoin(GetDataDir(), request.params[0].get_str());\n     // Write to a temporary path and then move into `path` on completion\n     // to avoid confusion due to an interruption.\n-    fs::path temppath = fs::absolute(request.params[0].get_str() + \".incomplete\", GetDataDir());\n+    fs::path temppath = fsbridge::AbsPathJoin(GetDataDir(), request.params[0].get_str() + \".incomplete\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557667469",
      "id" : 557667469,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY2NzQ2OQ==",
      "original_commit_id" : "c0da7456833fac6d5613d97e09266cf54f13594f",
      "original_line" : 2405,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 568579508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557667469",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557671007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557671007"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Introduce fsbridge::AbsPathJoin(base, p).\" (c0da7456833fac6d5613d97e09266cf54f13594f)\r\n\r\nIt would be good to add another test joining an absolute path with the empty `\"\"` path and ensuring the absolute path is returned unchanged (no trailing slash). This is the difference between boost and std join functions and cause of bugs in #20744",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-14T20:13:17Z",
      "diff_hunk" : "@@ -52,6 +52,18 @@ BOOST_AUTO_TEST_CASE(fsbridge_fstream)\n         file >> input_buffer;\n         BOOST_CHECK_EQUAL(input_buffer, \"bitcoin\");\n     }\n+    {\n+        // Join an absolute path and a relative path.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557671007",
      "id" : 557671007,
      "line" : 56,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY3MTAwNw==",
      "original_commit_id" : "c0da7456833fac6d5613d97e09266cf54f13594f",
      "original_line" : 56,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fs_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 568576065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:36:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557671007",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm able to reproduce appveyor failure on linux with\r\n\r\n```\r\nmake -C src test/test_bitcoin && src/test/test_bitcoin -l test_suite -t init_tests -t wallet_tests/CreateWallet --random=2\r\n```\r\n\r\nTo reproduce, it may be necessary to vary the random seed to get CreateWallet test to run after the init_tests as happens on appveyor.\r\n\r\nThe problem seems to be that init_tests [force set](https://github.com/bitcoin/bitcoin/blob/f91587f050d9dceb45fe10129a76a4a9a060a09c/src/wallet/test/init_test_fixture.cpp#L45) a -walletdir that [GetWalletDir](https://github.com/bitcoin/bitcoin/blob/f91587f050d9dceb45fe10129a76a4a9a060a09c/src/wallet/walletutil.cpp#L16-L19) rejects and turns into an empty path, which gets rejected by the assert because it is not absolute.\r\n\r\nProbably a minimal fix is possible in init_tests. Backtrace at assert fail looks like\r\n\r\n```\r\n#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\r\n#1  0x00007ffff59b38b1 in __GI_abort () at abort.c:79\r\n#2  0x00007ffff59a342a in __assert_fail_base (fmt=0x7ffff5b2aa38 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\", \r\n    assertion=assertion@entry=0x5555566fc54f \"base.is_absolute()\", file=file@entry=0x5555566fc548 \"fs.cpp\", line=line@entry=36, \r\n    function=function@entry=0x5555566fc600 <fsbridge::AbsPathJoin(boost::filesystem::path const&, boost::filesystem::path const&)::__PRETTY_FUNCTION__> \"boost::filesystem::path fsbridge::AbsPathJoin(const boost::filesystem::path&, const boost::filesystem::path&)\") at assert.c:92\r\n#3  0x00007ffff59a34a2 in __GI___assert_fail (assertion=0x5555566fc54f \"base.is_absolute()\", file=0x5555566fc548 \"fs.cpp\", line=36, \r\n    function=0x5555566fc600 <fsbridge::AbsPathJoin(boost::filesystem::path const&, boost::filesystem::path const&)::__PRETTY_FUNCTION__> \"boost::filesystem::path fsbridge::AbsPathJoin(const boost::filesystem::path&, const boost::filesystem::path&)\") at assert.c:101\r\n#4  0x000055555620de2f in fsbridge::AbsPathJoin (base=..., p=...) at fs.cpp:36\r\n#5  0x00005555563d5298 in MakeWalletDatabase (name=\"\", options=..., status=@0x7fffffffb57c: 21845, error_string=...) at wallet/wallet.cpp:3783\r\n#6  0x0000555555cd0d59 in wallet_tests::TestLoadWallet (chain=...) at wallet/test/wallet_tests.cpp:46\r\n#7  0x0000555555ce03f2 in wallet_tests::CreateWallet::test_method (this=0x7fffffffc9c0) at wallet/test/wallet_tests.cpp:699\r\n#8  0x0000555555cdf585 in wallet_tests::CreateWallet_invoker () at wallet/test/wallet_tests.cpp:696\r\n```\r\n\r\n",
      "created_at" : "2021-01-14T21:27:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#issuecomment-760487360",
      "id" : 760487360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDQ4NzM2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-14T21:27:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760487360",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Following fix seems to work:\r\n\r\n```diff\r\n--- a/src/wallet/test/init_test_fixture.cpp\r\n+++ b/src/wallet/test/init_test_fixture.cpp\r\n@@ -3,6 +3,7 @@\r\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n \r\n #include <fs.h>\r\n+#include <univalue.h>\r\n #include <util/check.h>\r\n #include <util/system.h>\r\n \r\n@@ -37,6 +38,9 @@ InitWalletDirTestingSetup::InitWalletDirTestingSetup(const std::string& chainNam\r\n \r\n InitWalletDirTestingSetup::~InitWalletDirTestingSetup()\r\n {\r\n+    gArgs.LockSettings([&](util::Settings& settings) {\r\n+        settings.forced_settings.erase(\"walletdir\");\r\n+    });\r\n     fs::current_path(m_cwd);\r\n }\r\n \r\n```\r\n\r\nWould suggest commit message like:\r\n\r\n> test: Clear forced -walletdir setting after wallet init_tests\r\n>\r\n> Leaving this value set interfered with the CreateWallet test if it happened to execute later in the test ordering. Specifically it would cause CreateWallet test to write data to the current directory instead of temporary test directory.",
      "created_at" : "2021-01-14T21:38:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#issuecomment-760492506",
      "id" : 760492506,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDQ5MjUwNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-14T21:38:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760492506",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/20932#issue-554809577\r\n\r\n> This PR is based on @ryanofsky suggestion here [#20744 (review)](https://github.com/bitcoin/bitcoin/pull/20744#pullrequestreview-558131849) and it should help make #20744 diff smaller in the long run.\r\n\r\nWould suggest writing a self-contained PR description that doesn't require reading a comment in another issue to understand. Something like:\r\n\r\nrefactor: Replace fs::absolute calls with AbsPathJoin calls\r\n\r\nThis adds better test coverage and will make it easier in #20744 to remove our dependency on the two-argument `boost::filesystem::absolute()` function which does not have a direct equivalent in C++17.\r\n\r\nThis PR doesn't change behavior aside from adding an assert and fixing a test bug.\r\n\r\n\r\n",
      "created_at" : "2021-01-14T21:48:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#issuecomment-760497563",
      "id" : 760497563,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20932",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MDQ5NzU2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-14T21:48:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/760497563",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557953334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557953334"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I understand that one is supposed to apply the commit locally without using Github's \"Commit suggestion\" as that would lead to a new CI run, right?",
      "commit_id" : "72205add2aa1db8e170aee8cd194d885cbd112ca",
      "created_at" : "2021-01-15T07:37:48Z",
      "diff_hunk" : "@@ -3780,7 +3780,7 @@ std::unique_ptr<WalletDatabase> MakeWalletDatabase(const std::string& name, cons\n     // 2. Path to an existing directory.\n     // 3. Path to a symlink to a directory.\n     // 4. For backwards compatibility, the name of a data file in -walletdir.\n-    const fs::path& wallet_path = fs::absolute(name, GetWalletDir());\n+    const fs::path& wallet_path = fsbridge::AbsPathJoin(GetWalletDir(), name);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20932#discussion_r557953334",
      "id" : 557953334,
      "in_reply_to_id" : 557665415,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Nzk1MzMzNA==",
      "original_commit_id" : "c0da7456833fac6d5613d97e09266cf54f13594f",
      "original_line" : 3783,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 569005158,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20932",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-15T07:37:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/557953334",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/58662979?v=4",
         "events_url" : "https://api.github.com/users/kiminuo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kiminuo/followers",
         "following_url" : "https://api.github.com/users/kiminuo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kiminuo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kiminuo",
         "id" : 58662979,
         "login" : "kiminuo",
         "node_id" : "MDQ6VXNlcjU4NjYyOTc5",
         "organizations_url" : "https://api.github.com/users/kiminuo/orgs",
         "received_events_url" : "https://api.github.com/users/kiminuo/received_events",
         "repos_url" : "https://api.github.com/users/kiminuo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kiminuo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kiminuo"
      }
   }
]
