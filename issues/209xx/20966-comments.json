[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21244 (Move GetDataDir to ArgsManager by kiminuo)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-01-20T05:29:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763344104",
      "id" : 763344104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzM0NDEwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-07T03:23:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763344104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-01-20T10:16:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763497435",
      "id" : 763497435,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzQ5NzQzNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T10:16:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763497435",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "790727eea..fd751850e: add the tests from #20904 (closed without merge), they are precious",
      "created_at" : "2021-01-20T10:57:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763521567",
      "id" : 763521567,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzUyMTU2Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T11:02:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763521567",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "fd751850e..2d287f639: add release notes",
      "created_at" : "2021-01-20T11:30:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763540526",
      "id" : 763540526,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzU0MDUyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T11:30:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763540526",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r560912563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560912563"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please add the release notes to https://github.com/bitcoin-core/bitcoin-devwiki/wiki/%2320852-Release-notes-snippet\r\n\r\nOtherwise they will have to be removed here after merge, then added to the `0.21` branch. (Release notes are only added to the point releases, not the next major version that also includes those fixes)",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-01-20T12:10:31Z",
      "diff_hunk" : "@@ -105,6 +105,15 @@ RPC\n Tests\n -----\n \n+Files\n+-----\n+\n+- The list of banned hosts and networks (via `setban` RPC) is now saved on disk\n+  in JSON format in `banlist.json` instead of `banlist.dat`. Both files are\n+  read on startup and contents merged. Updateds are only written to the new\n+  `banlist.json`. A future version of Bitcoin Core may completely ignore\n+  `banlist.dat`. (#20966)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r560912563",
      "id" : 560912563,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDkxMjU2Mw==",
      "original_commit_id" : "2d287f639a77e03b07009712c756664c761d2867",
      "original_line" : 119,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 572158049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560912563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-01-20T12:37:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763578760",
      "id" : 763578760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzU3ODc2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T12:37:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763578760",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r560934560"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560934560"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I guess after/if this PR is merged?",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-01-20T12:49:05Z",
      "diff_hunk" : "@@ -105,6 +105,15 @@ RPC\n Tests\n -----\n \n+Files\n+-----\n+\n+- The list of banned hosts and networks (via `setban` RPC) is now saved on disk\n+  in JSON format in `banlist.json` instead of `banlist.dat`. Both files are\n+  read on startup and contents merged. Updateds are only written to the new\n+  `banlist.json`. A future version of Bitcoin Core may completely ignore\n+  `banlist.dat`. (#20966)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r560934560",
      "id" : 560934560,
      "in_reply_to_id" : 560912563,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDkzNDU2MA==",
      "original_commit_id" : "2d287f639a77e03b07009712c756664c761d2867",
      "original_line" : 119,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "doc/release-notes.md",
      "position" : null,
      "pull_request_review_id" : 572186410,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/560934560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "2d287f639...fd751850e: remove edits of `doc/release-notes.md`",
      "created_at" : "2021-01-20T12:53:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763587128",
      "id" : 763587128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzU4NzEyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T12:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763587128",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Notes:\r\n\r\n* I guess it would be possible to write the ban list to `settings.json` instead of in `banlist.json` (as originally proposed in https://github.com/bitcoin/bitcoin/issues/19748), but the periodic dump may create some complications and also it is unclear what to do if we are running with `-nosettings`.\r\n\r\n* The current patch would write `banlist.json` on the first change of the ban list. This means that a node that upgrades from before this PR with only `banlist.dat` on disk may not create `banlist.json` for some time. I think this is ok.",
      "created_at" : "2021-01-20T13:01:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-763591233",
      "id" : 763591233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2MzU5MTIzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-20T13:01:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/763591233",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\n> [790727e](https://github.com/bitcoin/bitcoin/commit/790727eeaf165449f691d1f874b70f0816ef7601)..[fd75185](https://github.com/bitcoin/bitcoin/commit/fd751850e5dc918b523c63ce9db98279f2398c96): add the tests from #20904 (closed without merge), they are precious\r\n\r\nGood to see these tests brought in.",
      "created_at" : "2021-01-27T12:46:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-768261953",
      "id" : 768261953,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODI2MTk1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T12:46:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768261953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "fd751850e...e74196741: read `banlist.dat` only if `banlist.json` is not present and catch all exceptions that could come from an invalid JSON.\r\n\r\n@promag  \r\n> Should try to read JSON first, and if it exists then skip old format?\r\n\r\nI made it to read both if present so that if the user temporary downgrades and makes some changes to `banlist.dat` those changes would be picked up by the new version. However this has the deficiency that if an entry is deleted from `banlist.json` it will keep being loaded from `banlist.dat`. Changed to what you suggest above.\r\n\r\n> Personally I wouldn't add from/to JSON in `CBanEntry`, `BanMapFromJson` and `BanMapToJson` seem enough.\r\n\r\n`CBanEntry` being able to ser/unser itself to/from JSON improves its encapsulation.\r\n\r\n> Also, there should be some validation in `BanMapFromJson`?\r\n\r\nRight! Added `try/catch` to handle invalid JSONs.",
      "created_at" : "2021-01-28T13:39:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-769058840",
      "id" : 769058840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTA1ODg0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-28T13:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769058840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "needs rebase after #21167",
      "created_at" : "2021-02-15T14:20:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-779253018",
      "id" : 779253018,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTI1MzAxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T14:20:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779253018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`e74196741...7493bbe38`: rebase due to conflicts",
      "created_at" : "2021-02-15T14:54:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-779272710",
      "id" : 779272710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTI3MjcxMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T14:54:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779272710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r576391571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576391571"
         }
      },
      "author_association" : "NONE",
      "body" : "-    m_node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist\", nullptr, DEFAULT_MISBEHAVING_BANTIME) ;",
      "commit_id" : "7493bbe388a8016cac7aff3ab176d2cc73ac3d69",
      "created_at" : "2021-02-15T19:37:44Z",
      "diff_hunk" : "@@ -187,7 +187,7 @@ TestingSetup::TestingSetup(const std::string& chainName, const std::vector<const\n         throw std::runtime_error(strprintf(\"ActivateBestChain failed. (%s)\", state.ToString()));\n     }\n \n-    m_node.banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", nullptr, DEFAULT_MISBEHAVING_BANTIME);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r576391571",
      "id" : 576391571,
      "line" : 190,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjM5MTU3MQ==",
      "original_commit_id" : "7493bbe388a8016cac7aff3ab176d2cc73ac3d69",
      "original_line" : 190,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/util/setup_common.cpp",
      "position" : 4,
      "pull_request_review_id" : 590718713,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-15T19:37:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576391571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/52614312?v=4",
         "events_url" : "https://api.github.com/users/trongham/events{/privacy}",
         "followers_url" : "https://api.github.com/users/trongham/followers",
         "following_url" : "https://api.github.com/users/trongham/following{/other_user}",
         "gists_url" : "https://api.github.com/users/trongham/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/trongham",
         "id" : 52614312,
         "login" : "trongham",
         "node_id" : "MDQ6VXNlcjUyNjE0MzEy",
         "organizations_url" : "https://api.github.com/users/trongham/orgs",
         "received_events_url" : "https://api.github.com/users/trongham/received_events",
         "repos_url" : "https://api.github.com/users/trongham/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/trongham/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/trongham/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/trongham"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-23T15:47:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-784298049",
      "id" : 784298049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4NDI5ODA0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-23T15:47:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/784298049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`7493bbe38...1310b5460`: rebase due to conflicts",
      "created_at" : "2021-03-10T16:12:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-795669488",
      "id" : 795669488,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NTY2OTQ4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-10T16:12:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/795669488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So many rebases. I hope the backport won't be too nasty",
      "created_at" : "2021-03-10T16:20:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-795681231",
      "id" : 795681231,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NTY4MTIzMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-10T16:20:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/795681231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-12T07:41:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-797300625",
      "id" : 797300625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzMwMDYyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T07:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797300625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`1310b5460...469da8ca3`: rebase due to conflicts",
      "created_at" : "2021-03-15T15:27:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-799510958",
      "id" : 799510958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5OTUxMDk1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-15T15:27:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/799510958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2021-03-15T17:08:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-799588784",
      "id" : 799588784,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5OTU4ODc4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-15T17:08:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/799588784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598083776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598083776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8372aad9cc01774e981edee1dd8822a31ef6ea18\r\n\r\nis the goal still to backport this? If yes, it could make sense to use C++11",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-20T08:45:11Z",
      "diff_hunk" : "@@ -11,13 +11,69 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& [address, ban_entry] : bans) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598083776",
      "id" : 598083776,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4Mzc3Ng==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 48,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598083776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598084377"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598084377"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8372aad9cc01774e981edee1dd8822a31ef6ea18\r\n\r\n* Any reason to prepend the function name? This is already done by -logfunctionnames\r\n* Any reason to use `error` here, but `std::runtime_error` if a field is missing?\r\n* It would be better to leave the logging to the caller and not mix logging responsibility between a utility function and the caller object",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-20T08:50:00Z",
      "diff_hunk" : "@@ -11,13 +11,69 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& [address, ban_entry] : bans) {\n+        UniValue j = ban_entry.ToJson();\n+        j.pushKV(\"address\", address.ToString());\n+        bans_json.push_back(j);\n+    }\n+    return bans_json;\n+}\n+\n+/**\n+ * Convert a JSON array to a `banmap_t` object.\n+ * @param[in] bans_json JSON to convert, must be as returned by `BanMapToJson()`.\n+ * @param[out] bans Bans list to create from the JSON.\n+ * @return true if the conversion was successful.\n+ * @throws std::runtime_error if the JSON does not have the expected fields.\n+ */\n+bool BanMapFromJson(const UniValue& bans_json, banmap_t& bans)\n+{\n+    for (const auto& ban_entry_json : bans_json.getValues()) {\n+        CSubNet subnet;\n+        const auto& subnet_str = ban_entry_json[\"address\"].get_str();\n+        if (!LookupSubNet(subnet_str, subnet)) {\n+            return error(\"%s: Cannot parse banned address or subnet: %s\", __func__, subnet_str);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598084377",
      "id" : 598084377,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NDM3Nw==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 69,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598084377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085409"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same commit:\r\n\r\n* It seems the caller ignores the return code, so calling this ERROR seems confusing\r\n* No longer need `__func__`",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-20T09:00:47Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085409",
      "id" : 598085409,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NTQwOQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 192,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085607"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same commit:\r\n\r\n* The caller will be \"Recreating the banlist database\", so calling this ERROR seems confusing\r\n* `__func__` ;)",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-20T09:03:43Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085607",
      "id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NTYwNw==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085630"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same ;)",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-20T09:03:55Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);\n+        }\n+        return false;\n+    }\n+\n+    try {\n+        return BanMapFromJson(settings[JSON_KEY], banSet);\n+    } catch (const std::runtime_error& e) {\n+        return error(\"%s: Cannot parse %s: %s\", __func__, m_banlist_json.string(), e.what());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598085630",
      "id" : 598085630,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NTYzMA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 216,
      "original_position" : 115,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598085630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598086423"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598086423"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same commit:\r\n\r\nI don't understand this line. There shouldn't be any reason this instance will ever write a banlist.dat file.\r\n\r\nAlso, to make the fuzz test more useful, it should probably *create* a banlist.dat file. Extra points for creating a corrupted one. With extra bonus points for passing one in without disk access.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-20T09:11:33Z",
      "diff_hunk" : "@@ -34,8 +34,9 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist.dat\";\n-    fs::remove(banlist_file);\n+    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist\";\n+    fs::remove(banlist_file.string() + \".dat\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r598086423",
      "id" : 598086423,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5ODA4NjQyMw==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 38,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 616895551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/598086423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`469da8ca3...4efa5e73b`: address review suggestions, remove the release notes that were removed before but sneaked back in one of the updates",
      "created_at" : "2021-03-24T15:35:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-805928003",
      "id" : 805928003,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNTkyODAwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-24T15:35:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/805928003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600601565"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600601565"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My understanding is that this deserves a backport because it would allow storing torv3 addresses in the banlist on disk. Not super important though.\r\n\r\nSwitched to C++11.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-24T15:37:09Z",
      "diff_hunk" : "@@ -11,13 +11,69 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& [address, ban_entry] : bans) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600601565",
      "id" : 600601565,
      "in_reply_to_id" : 598083776,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwMTU2NQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 48,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619883706,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600601565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600604218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600604218"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You probably mean `-logsourcelocations` instead of `-logfunctionnames`.\r\n\r\nRemoved `__func__`. Changed this function to throw an exception for all errors and return `void`. Now it does not do any logging - just bubble up a detailed error message to the callers via the exception.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-24T15:39:46Z",
      "diff_hunk" : "@@ -11,13 +11,69 @@\n #include <cstdint>\n #include <hash.h>\n #include <logging/timer.h>\n+#include <netbase.h>\n #include <random.h>\n #include <streams.h>\n #include <tinyformat.h>\n+#include <univalue.h>\n+#include <util/settings.h>\n #include <util/system.h>\n \n+CBanEntry::CBanEntry(const UniValue& json)\n+    : nVersion(json[\"version\"].get_int()), nCreateTime(json[\"ban_created\"].get_int64()),\n+      nBanUntil(json[\"banned_until\"].get_int64())\n+{\n+}\n+\n+UniValue CBanEntry::ToJson() const\n+{\n+    UniValue json(UniValue::VOBJ);\n+    json.pushKV(\"version\", nVersion);\n+    json.pushKV(\"ban_created\", nCreateTime);\n+    json.pushKV(\"banned_until\", nBanUntil);\n+    return json;\n+}\n+\n namespace {\n \n+/**\n+ * Convert a `banmap_t` object to a JSON array.\n+ * @param[in] bans Bans list to convert.\n+ * @return a JSON array, similar to the one returned by the `listbanned` RPC. Suitable for\n+ * passing to `BanMapFromJson()`.\n+ */\n+UniValue BanMapToJson(const banmap_t& bans)\n+{\n+    UniValue bans_json(UniValue::VARR);\n+    for (const auto& [address, ban_entry] : bans) {\n+        UniValue j = ban_entry.ToJson();\n+        j.pushKV(\"address\", address.ToString());\n+        bans_json.push_back(j);\n+    }\n+    return bans_json;\n+}\n+\n+/**\n+ * Convert a JSON array to a `banmap_t` object.\n+ * @param[in] bans_json JSON to convert, must be as returned by `BanMapToJson()`.\n+ * @param[out] bans Bans list to create from the JSON.\n+ * @return true if the conversion was successful.\n+ * @throws std::runtime_error if the JSON does not have the expected fields.\n+ */\n+bool BanMapFromJson(const UniValue& bans_json, banmap_t& bans)\n+{\n+    for (const auto& ban_entry_json : bans_json.getValues()) {\n+        CSubNet subnet;\n+        const auto& subnet_str = ban_entry_json[\"address\"].get_str();\n+        if (!LookupSubNet(subnet_str, subnet)) {\n+            return error(\"%s: Cannot parse banned address or subnet: %s\", __func__, subnet_str);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600604218",
      "id" : 600604218,
      "in_reply_to_id" : 598084377,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwNDIxOA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 69,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619887083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600604218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600607040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600607040"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The caller of `CBanDB::Write()` does not ignore its return code? If you mean the return code of `error()` itself - this is because we want to log all of the errors (possibly more than one) before returning `false`.\r\n\r\nRemoved `__func__`.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-24T15:42:21Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600607040",
      "id" : 600607040,
      "in_reply_to_id" : 598085409,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwNzA0MA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 192,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619890819,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600607040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600609034"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600609034"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it is ok to see something like the following in the log:\r\n```\r\nERROR: ... banlist foo ...\r\nERROR: ... banlist bar ...\r\nRecreating the banlist database\r\n```\r\n\r\nRemoved `__func__`.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-24T15:44:14Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600609034",
      "id" : 600609034,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwOTAzNA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619892999,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600609034",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600609538"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600609538"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed `__func__`.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-24T15:44:51Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);\n+        }\n+        return false;\n+    }\n+\n+    try {\n+        return BanMapFromJson(settings[JSON_KEY], banSet);\n+    } catch (const std::runtime_error& e) {\n+        return error(\"%s: Cannot parse %s: %s\", __func__, m_banlist_json.string(), e.what());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600609538",
      "id" : 600609538,
      "in_reply_to_id" : 598085630,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYwOTUzOA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 216,
      "original_position" : 115,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 619893728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600609538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600612275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600612275"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, removed the `fs::remove` calls and replaced them with a creation of a corrupted or inaccessible banlist file.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-03-24T15:47:45Z",
      "diff_hunk" : "@@ -34,8 +34,9 @@ FUZZ_TARGET_INIT(banman, initialize_banman)\n {\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n     SetMockTime(ConsumeTime(fuzzed_data_provider));\n-    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist.dat\";\n-    fs::remove(banlist_file);\n+    const fs::path banlist_file = GetDataDir() / \"fuzzed_banlist\";\n+    fs::remove(banlist_file.string() + \".dat\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r600612275",
      "id" : 600612275,
      "in_reply_to_id" : 598086423,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDYxMjI3NQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 38,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/fuzz/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 619898024,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/600612275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-30T11:13:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-810135353",
      "id" : 810135353,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMDEzNTM1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-30T11:13:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/810135353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild I've split up the unit tests from this pull, since they are unrelated to changes here (They are checking functionality that already works just fine on master). See #21571. The benefit is that this pull can focus on the disk serialization changes only. I hope you don't mind and maybe can leave a (Concept) (N)ACK.",
      "created_at" : "2021-04-02T17:41:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-812635126",
      "id" : 812635126,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMjYzNTEyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-02T17:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/812635126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebase should be easy now `git rebase --skip`",
      "created_at" : "2021-04-06T08:27:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-813933912",
      "id" : 813933912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzkzMzkxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T08:27:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813933912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`4efa5e7...03239a3ab`: rebase due to conflicts, remove 3 commits from this PR that were already merged via https://github.com/bitcoin/bitcoin/pull/21571.",
      "created_at" : "2021-04-06T09:00:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-813955853",
      "id" : 813955853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxMzk1NTg1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-06T09:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/813955853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Moving milestone to 0.21.2. We'd like to do 0.21.1 soon, and even though this may be ready for merge soon, it seems like a risky thing to rush into a point release.",
      "created_at" : "2021-04-16T05:15:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-820911383",
      "id" : 820911383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMDkxMTM4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-16T05:15:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820911383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615236159"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615236159"
         }
      },
      "author_association" : "MEMBER",
      "body" : "User will report bugs if they see `ERROR`. For example, http://www.erisian.com.au/bitcoin-core-dev/log-2021-02-13.html#l-296",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-17T10:03:59Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615236159",
      "id" : 615236159,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTIzNjE1OQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 638215405,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615236159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615236932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615236932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can remove `__func__` while touching this line?",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-17T10:11:18Z",
      "diff_hunk" : "@@ -188,7 +188,7 @@ void BanMan::SweepBanned()\n                 m_banned.erase(it++);\n                 m_is_dirty = true;\n                 notify_ui = true;\n-                LogPrint(BCLog::NET, \"%s: Removed banned node ip/subnet from banlist.dat: %s\\n\", __func__, sub_net.ToString());\n+                LogPrint(BCLog::NET, \"%s: Removed banned node address/subnet: %s\\n\", __func__, sub_net.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615236932",
      "id" : 615236932,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTIzNjkzMg==",
      "original_commit_id" : "03239a3ab204dfc71bb46f85679414b331836763",
      "original_line" : 191,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 638215872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615236932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`03239a3ab...aa90a7d46`: address suggestions",
      "created_at" : "2021-04-19T14:59:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-822536616",
      "id" : 822536616,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjUzNjYxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-19T14:59:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822536616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615925693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615925693"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed",
      "commit_id" : "7e399e2ded5d6c12d923a2a503600cb72a521b53",
      "created_at" : "2021-04-19T14:59:53Z",
      "diff_hunk" : "@@ -188,7 +188,7 @@ void BanMan::SweepBanned()\n                 m_banned.erase(it++);\n                 m_is_dirty = true;\n                 notify_ui = true;\n-                LogPrint(BCLog::NET, \"%s: Removed banned node ip/subnet from banlist.dat: %s\\n\", __func__, sub_net.ToString());\n+                LogPrint(BCLog::NET, \"%s: Removed banned node address/subnet: %s\\n\", __func__, sub_net.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615925693",
      "id" : 615925693,
      "in_reply_to_id" : 615236932,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTkyNTY5Mw==",
      "original_commit_id" : "03239a3ab204dfc71bb46f85679414b331836763",
      "original_line" : 191,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 638974463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615925693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615930585"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615930585"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I changed it to avoid the word \"error\". I don't think those errors should be hushed - those are errors from loading the file and we already checked that the file exists. So may include something like \"json parse error\", \"io error\", \"permission denied\".\r\n\r\nIn general I don't think we should avoid using \"error\" or use it just for cases where we have detected a bug in the program. Messages like \"error: permission denied\" or \"error: connection reset\" are to be expected.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-19T15:05:44Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r615930585",
      "id" : 615930585,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTkzMDU4NQ==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 638981145,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/615930585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616099538"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616099538"
         }
      },
      "author_association" : "MEMBER",
      "body" : ":facepalm: Oh wait, I might have missed that this is actually an error. Then it is fine to mention the word \"error\"",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-19T19:00:11Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616099538",
      "id" : 616099538,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjA5OTUzOA==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 639208463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616099538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616166735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616166735"
         }
      },
      "author_association" : "MEMBER",
      "body" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99\r\n\r\nnit, here and below, add a comment on why the check is repeated after the restart.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-19T20:47:46Z",
      "diff_hunk" : "@@ -51,12 +51,22 @@ def run_test(self):\n         ip_addr = \"1.2.3.4\"\n         assert(not self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n         node.setban(tor_addr, \"add\")\n         assert(self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n+        self.restart_node(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616166735",
      "id" : 616166735,
      "line" : 61,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjE2NjczNQ==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 61,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 11,
      "pull_request_review_id" : 639293715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616166735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616173334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616173334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "51909ded1e8b26158f8d36cfe323ac72feac1d78\r\n\r\nnit, `fs::path(ban_list_path).replace_extension(\"dat\")`.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-19T20:58:44Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616173334",
      "id" : 616173334,
      "line" : 180,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjE3MzMzNA==",
      "original_commit_id" : "51909ded1e8b26158f8d36cfe323ac72feac1d78",
      "original_line" : 180,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 77,
      "pull_request_review_id" : 639293715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616173334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616211147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616211147"
         }
      },
      "author_association" : "MEMBER",
      "body" : "51909ded1e8b26158f8d36cfe323ac72feac1d78\r\n\r\nA comment here would be nice. Or maybe just take the next suggestion so it's clear what this is doing.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-19T22:11:19Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616211147",
      "id" : 616211147,
      "line" : 201,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjIxMTE0Nw==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 201,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 101,
      "pull_request_review_id" : 639293715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616211147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616214439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616214439"
         }
      },
      "author_association" : "MEMBER",
      "body" : "51909ded1e8b26158f8d36cfe323ac72feac1d78\r\n\r\nMaybe migrate on 1st run?\r\n```diff\r\n bool CBanDB::Read(banmap_t& banSet)\r\n {\r\n     if (!fs::exists(m_banlist_json)) {\r\n-        return DeserializeFileDB(m_banlist_dat, banSet);\r\n+        if (!DeserializeFileDB(m_banlist_dat, banSet)) {\r\n+            return false;\r\n+        }\r\n+        // log something\r\n+        Write(banSet);\r\n+        return true;\r\n     }\r\n```",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-19T22:19:17Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616214439",
      "id" : 616214439,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjIxNDQzOQ==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 204,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 104,
      "pull_request_review_id" : 639293715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616214439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-20T02:33:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-822927038",
      "id" : 822927038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMjkyNzAzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-20T02:33:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/822927038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`aa90a7d46...7e399e2de`: rebase due to conflicts",
      "created_at" : "2021-04-20T15:55:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-823396970",
      "id" : 823396970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMzM5Njk3MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-20T15:55:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823396970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`7e399e2de...08f4f98ea`: address some suggestions; force saving on disk if we loaded just the old `banlist.dat` so that we create the new `banlist.json` this way, without waiting for mods to the list in order to flush it to disk.",
      "created_at" : "2021-04-20T15:58:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#issuecomment-823399313",
      "id" : 823399313,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20966",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyMzM5OTMxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-20T15:58:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/823399313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616826373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616826373"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am leaving it as is, I don't like `error()` too much.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-20T15:59:23Z",
      "diff_hunk" : "@@ -119,18 +175,46 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s: %s\", __func__, err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);\n+    }\n+\n+    std::map<std::string, util::SettingsValue> settings;\n+    std::vector<std::string> errors;\n+\n+    if (!util::ReadSettings(m_banlist_json, settings, errors)) {\n+        for (const auto& err : errors) {\n+            error(\"%s: %s\", __func__, err);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616826373",
      "id" : 616826373,
      "in_reply_to_id" : 598085607,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyNjM3Mw==",
      "original_commit_id" : "8372aad9cc01774e981edee1dd8822a31ef6ea18",
      "original_line" : 208,
      "original_position" : 107,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 640147406,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:59:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616826373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616826715"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616826715"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added a comment.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-20T15:59:46Z",
      "diff_hunk" : "@@ -51,12 +51,22 @@ def run_test(self):\n         ip_addr = \"1.2.3.4\"\n         assert(not self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n         node.setban(tor_addr, \"add\")\n         assert(self.is_banned(node, tor_addr))\n         assert(not self.is_banned(node, ip_addr))\n+\n+        self.restart_node(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616826715",
      "id" : 616826715,
      "in_reply_to_id" : 616166735,
      "line" : 61,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyNjcxNQ==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 61,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/rpc_setban.py",
      "position" : 11,
      "pull_request_review_id" : 640147832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T15:59:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616826715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616827889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616827889"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I find `replace_extension()` a bit confusing in this case because we know that there is no extension, so we are not replacing anything (I know it will do the right thing, but still).",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-20T16:01:15Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616827889",
      "id" : 616827889,
      "in_reply_to_id" : 616173334,
      "line" : 180,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyNzg4OQ==",
      "original_commit_id" : "51909ded1e8b26158f8d36cfe323ac72feac1d78",
      "original_line" : 180,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 77,
      "pull_request_review_id" : 640149483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T16:01:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616827889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616828047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616828047"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added some comments.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-20T16:01:27Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616828047",
      "id" : 616828047,
      "in_reply_to_id" : 616211147,
      "line" : 201,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyODA0Nw==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 201,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 101,
      "pull_request_review_id" : 640149711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T16:01:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616828047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616829628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616829628"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Migrate on first run - yes. But `Read()` calling `Write()` seems like some anti-pattern to me. Instead I signal from `Read()` that the list needs re-flushing, so that the caller takes care of it.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-20T16:03:30Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616829628",
      "id" : 616829628,
      "in_reply_to_id" : 616214439,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjgyOTYyOA==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 204,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 104,
      "pull_request_review_id" : 640151910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T16:03:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616829628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616843518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616843518"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point. Maybe add a `CBanDB::MigrateAndRead` where calling `Write()` isn't so bad.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-20T16:20:39Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r616843518",
      "id" : 616843518,
      "in_reply_to_id" : 616214439,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNjg0MzUxOA==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 204,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 104,
      "pull_request_review_id" : 640170176,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-20T16:20:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/616843518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r617300060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617300060"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not necessary with the latest changes.",
      "commit_id" : "08f4f98ea2cdc3fbff5c9e21870296106430e468",
      "created_at" : "2021-04-21T08:13:44Z",
      "diff_hunk" : "@@ -119,18 +176,49 @@ bool DeserializeFileDB(const fs::path& path, Data& data)\n }\n } // namespace\n \n-CBanDB::CBanDB(fs::path ban_list_path) : m_ban_list_path(std::move(ban_list_path))\n+CBanDB::CBanDB(fs::path ban_list_path)\n+    : m_banlist_dat(ban_list_path.string() + \".dat\"),\n+      m_banlist_json(ban_list_path.string() + \".json\")\n {\n }\n \n bool CBanDB::Write(const banmap_t& banSet)\n {\n-    return SerializeFileDB(\"banlist\", m_ban_list_path, banSet);\n+    std::vector<std::string> errors;\n+    if (util::WriteSettings(m_banlist_json, {{JSON_KEY, BanMapToJson(banSet)}}, errors)) {\n+        return true;\n+    }\n+\n+    for (const auto& err : errors) {\n+        error(\"%s\", err);\n+    }\n+    return false;\n }\n \n bool CBanDB::Read(banmap_t& banSet)\n {\n-    return DeserializeFileDB(m_ban_list_path, banSet);\n+    if (!fs::exists(m_banlist_json)) {\n+        return DeserializeFileDB(m_banlist_dat, banSet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20966#discussion_r617300060",
      "id" : 617300060,
      "in_reply_to_id" : 616214439,
      "line" : 204,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzMwMDA2MA==",
      "original_commit_id" : "aa90a7d46a506b26a6016d1171f7ddae809e9c99",
      "original_line" : 204,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : 104,
      "pull_request_review_id" : 640752196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20966",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-21T08:13:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/617300060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
