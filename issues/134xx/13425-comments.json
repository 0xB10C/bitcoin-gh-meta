[
   {
      "author_association" : "MEMBER",
      "body" : "Here is an extra simplification we discussed IRL: https://github.com/sipa/bitcoin/commits/achow_sigdata-partial-sigs",
      "created_at" : "2018-06-09T03:59:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#issuecomment-395937612",
      "id" : 395937612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13425",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NTkzNzYxMg==",
      "updated_at" : "2018-06-09T03:59:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/395937612",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236571"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Use `CScriptID` as key type?",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:11:54Z",
      "diff_hunk" : "@@ -56,9 +56,12 @@ extern const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR;\n struct SignatureData {\n     CScript scriptSig;\n     CScriptWitness scriptWitness;\n+    std::map<CPubKey, std::vector<unsigned char>> signatures;\n+    std::map<uint160, CScript> scripts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236571",
      "id" : 194236571,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNjU3MQ==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 5,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 127376095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236571",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236575"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236575"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you use `CKeyID` as key type here, you can avoid the iteration to find matches.",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:12:15Z",
      "diff_hunk" : "@@ -56,9 +56,12 @@ extern const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR;\n struct SignatureData {\n     CScript scriptSig;\n     CScriptWitness scriptWitness;\n+    std::map<CPubKey, std::vector<unsigned char>> signatures;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236575",
      "id" : 194236575,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNjU3NQ==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 4,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 127376095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236575",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236583"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `> >`.",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:12:48Z",
      "diff_hunk" : "@@ -184,12 +184,101 @@ bool ProduceSignature(const SigningProvider& provider, const BaseSignatureCreato\n     return solved && VerifyScript(sigdata.scriptSig, fromPubKey, &sigdata.scriptWitness, STANDARD_SCRIPT_VERIFY_FLAGS, creator.Checker());\n }\n \n-SignatureData DataFromTransaction(const CMutableTransaction& tx, unsigned int nIn)\n+bool SignatureExtractorChecker::CheckSig(const std::vector<unsigned char>& scriptSig, const std::vector<unsigned char>& vchPubKey, const CScript& scriptCode, SigVersion sigversion) const\n+{\n+    if (MutableTransactionSignatureChecker::CheckSig(scriptSig, vchPubKey, scriptCode, sigversion)) {\n+        CPubKey pubkey(vchPubKey);\n+        sigdata->signatures.emplace(pubkey, scriptSig);\n+        return true;\n+    }\n+    return false;\n+}\n+\n+namespace\n+{\n+struct Stacks\n+{\n+    std::vector<valtype> script;\n+    std::vector<valtype> witness;\n+\n+    Stacks() {}\n+    explicit Stacks(const std::vector<valtype>& scriptSigStack_) : script(scriptSigStack_), witness() {}\n+    explicit Stacks(const SignatureData& data) : witness(data.scriptWitness.stack) {\n+        EvalScript(script, data.scriptSig, SCRIPT_VERIFY_STRICTENC, BaseSignatureChecker(), SigVersion::BASE);\n+    }\n+\n+    SignatureData Output() const {\n+        SignatureData result;\n+        result.scriptSig = PushAll(script);\n+        result.scriptWitness.stack = witness;\n+        return result;\n+    }\n+};\n+}\n+\n+// Extracts signatures and scripts from scriptSigs. Please do not extend this, use PSBT instead\n+SignatureData DataFromTransaction(const CMutableTransaction& tx, unsigned int nIn, const CTxOut& txout)\n {\n     SignatureData data;\n     assert(tx.vin.size() > nIn);\n     data.scriptSig = tx.vin[nIn].scriptSig;\n     data.scriptWitness = tx.vin[nIn].scriptWitness;\n+    Stacks stack(data);\n+\n+    // Get signatures\n+    SignatureExtractorChecker checker(&tx, nIn, txout.nValue, &data);\n+    VerifyScript(data.scriptSig, txout.scriptPubKey, &data.scriptWitness, STANDARD_SCRIPT_VERIFY_FLAGS, checker);\n+\n+    // Get scripts\n+    txnouttype script_type;\n+    std::vector<std::vector<unsigned char> > solutions;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236583",
      "id" : 194236583,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNjU4Mw==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 52,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 127376095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236583",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236633"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236633"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps add a comment that explains the overlap in relevance of these fields:\r\n* `scriptSig` and `scriptWitness` are used for both complete signatures, and for old-style partial signatures.\r\n* `signatures` and `scripts` are only used for new-style partial signatures, but may be present for complete signatures too.",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:15:17Z",
      "diff_hunk" : "@@ -56,9 +56,12 @@ extern const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR;\n struct SignatureData {\n     CScript scriptSig;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236633",
      "id" : 194236633,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNjYzMw==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 2,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 127376095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236633",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236723"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It feels a bit ugly to hardcode the dependency on `MutableTransactionSignatureChecker`, as there isn't technically anything in this class that requires it (you could pass in a `BaseSignatureChecker` reference instead).\r\n\r\nThis is just a nit, as it's really only used in `DataFromTransaction` and probably won't ever be used elsewhere.",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:18:21Z",
      "diff_hunk" : "@@ -81,4 +84,14 @@ void UpdateInput(CTxIn& input, const SignatureData& data);\n  * Solvability is unrelated to whether we consider this output to be ours. */\n bool IsSolvable(const SigningProvider& provider, const CScript& script);\n \n+class SignatureExtractorChecker : public MutableTransactionSignatureChecker",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236723",
      "id" : 194236723,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNjcyMw==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 26,
      "path" : "src/script/sign.h",
      "position" : 52,
      "pull_request_review_id" : 127376095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236723",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236827"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In \"Replace CombineSignatures with ProduceSignature\"\r\n\r\nSee my suggested commits in https://github.com/sipa/bitcoin/tree/achow_sigdata-partial-sigs to avoid introducing the `SignatureDataSigningProvider` and `SignatureDataSignatureCreator` classes here.",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:22:58Z",
      "diff_hunk" : "@@ -648,10 +648,8 @@ static void MutateTxSign(CMutableTransaction& tx, const std::string& flagStr)\n         SignatureData sigdata = DataFromTransaction(mergedTx, i, coin.out);\n         // Only sign SIGHASH_SINGLE if there's a corresponding output:\n         if (!fHashSingle || (i < mergedTx.vout.size()))\n-            ProduceSignature(keystore, MutableTransactionSignatureCreator(&mergedTx, i, amount, nHashType), prevPubKey, sigdata);\n+            ProduceSignature(SignatureDataSigningProvider(&sigdata, &keystore), SignatureDataSignatureCreator(&sigdata, &mergedTx, i, amount, nHashType), prevPubKey, sigdata);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236827",
      "id" : 194236827,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNjgyNw==",
      "original_commit_id" : "d0f96c4544f13e6c44896b2338859ee10c273f11",
      "original_position" : 5,
      "path" : "src/bitcoin-tx.cpp",
      "position" : null,
      "pull_request_review_id" : 127376095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236827",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236845"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it make sense to introduce a wrapper here as well for the pattern that replaces the `CombineSignatures` calls?",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:23:53Z",
      "diff_hunk" : "@@ -629,7 +629,10 @@ BOOST_AUTO_TEST_CASE(test_witness)\n     CreateCreditAndSpend(keystore2, scriptMulti, output2, input2, false);\n     CheckWithFlag(output2, input2, 0, false);\n     BOOST_CHECK(*output1 == *output2);\n-    UpdateInput(input1.vin[0], CombineSignatures(output1->vout[0].scriptPubKey, MutableTransactionSignatureChecker(&input1, 0, output1->vout[0].nValue), DataFromTransaction(input1, 0, output1->vout[0]), DataFromTransaction(input2, 0, output1->vout[0])));\n+    sigdata = DataFromTransaction(input1, 0, output1->vout[0]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194236845",
      "id" : 194236845,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNjg0NQ==",
      "original_commit_id" : "40d5ce7016afb2ec61e3155018aed3b635eac58d",
      "original_position" : 5,
      "path" : "src/test/transaction_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 127376095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194236845",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194237125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194237125"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`GetPubKey` won't work if these are `CKeyID`s",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:37:23Z",
      "diff_hunk" : "@@ -56,9 +56,12 @@ extern const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR;\n struct SignatureData {\n     CScript scriptSig;\n     CScriptWitness scriptWitness;\n+    std::map<CPubKey, std::vector<unsigned char>> signatures;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194237125",
      "id" : 194237125,
      "in_reply_to_id" : 194236575,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNzEyNQ==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 4,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 127376726,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194237125",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194237258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194237258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, good point. You could have an `std::map<CKeyID, std::pair<CPubKey, std::vector<unsigned char>>>` though, which stores both full public key and signature.",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:42:35Z",
      "diff_hunk" : "@@ -56,9 +56,12 @@ extern const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR;\n struct SignatureData {\n     CScript scriptSig;\n     CScriptWitness scriptWitness;\n+    std::map<CPubKey, std::vector<unsigned char>> signatures;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194237258",
      "id" : 194237258,
      "in_reply_to_id" : 194236575,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNzI1OA==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 4,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 127376854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194237258",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I have included squashed in @sipa's suggested commits.",
      "created_at" : "2018-06-09T19:42:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#issuecomment-395993832",
      "id" : 395993832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13425",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NTk5MzgzMg==",
      "updated_at" : "2018-06-09T19:42:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/395993832",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194237501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194237501"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you'd introduce a `sigdata.scripts.emplace(CScriptID(subscript), subscript);` here (and similarly below for the `TX_WITNESS_V0_SCRIPTHASH` case), you get (I think) all functionality you need for operating on `SignatureData` objects without the need for the legacy partial signatures.",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T19:51:27Z",
      "diff_hunk" : "@@ -152,7 +180,7 @@ bool ProduceSignature(const SigningProvider& provider, const BaseSignatureCreato\n         // the final scriptSig is the signatures from that\n         // and then the serialized subscript:\n         subscript = CScript(result[0].begin(), result[0].end());\n-        solved = solved && SignStep(provider, creator, subscript, result, whichType, SigVersion::BASE) && whichType != TX_SCRIPTHASH;\n+        solved = solved && SignStep(provider, creator, subscript, result, whichType, SigVersion::BASE, sigdata) && whichType != TX_SCRIPTHASH;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194237501",
      "id" : 194237501,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzNzUwMQ==",
      "original_commit_id" : "6ce5a289bd6db2d7392957745601d0acff35a41e",
      "original_position" : 155,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 127377053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194237501",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "You're missing the `DUMMY_SIGNING_PROVIDER` instance.",
      "created_at" : "2018-06-09T19:54:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#issuecomment-395994552",
      "id" : 395994552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13425",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NTk5NDU1Mg==",
      "updated_at" : "2018-06-09T19:54:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/395994552",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238177"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure that that is possible since I need to use `MutableTransactionSignatureChecker::CheckSig` as I do not want to re-implement a signature checker when one already exists.",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T20:25:45Z",
      "diff_hunk" : "@@ -81,4 +84,14 @@ void UpdateInput(CTxIn& input, const SignatureData& data);\n  * Solvability is unrelated to whether we consider this output to be ours. */\n bool IsSolvable(const SigningProvider& provider, const CScript& script);\n \n+class SignatureExtractorChecker : public MutableTransactionSignatureChecker",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238177",
      "id" : 194238177,
      "in_reply_to_id" : 194236723,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzODE3Nw==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 26,
      "path" : "src/script/sign.h",
      "position" : 52,
      "pull_request_review_id" : 127377741,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238177",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238270"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh of course; I just mean that you pass in a `BaseSignatureChecker*` which is stored inside. You can then call its CheckSig member function (which is public).",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T20:30:19Z",
      "diff_hunk" : "@@ -81,4 +84,14 @@ void UpdateInput(CTxIn& input, const SignatureData& data);\n  * Solvability is unrelated to whether we consider this output to be ours. */\n bool IsSolvable(const SigningProvider& provider, const CScript& script);\n \n+class SignatureExtractorChecker : public MutableTransactionSignatureChecker",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238270",
      "id" : 194238270,
      "in_reply_to_id" : 194236723,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzODI3MA==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 26,
      "path" : "src/script/sign.h",
      "position" : 52,
      "pull_request_review_id" : 127377832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238270",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238659"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T20:49:02Z",
      "diff_hunk" : "@@ -56,9 +56,12 @@ extern const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR;\n struct SignatureData {\n     CScript scriptSig;\n     CScriptWitness scriptWitness;\n+    std::map<CPubKey, std::vector<unsigned char>> signatures;\n+    std::map<uint160, CScript> scripts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238659",
      "id" : 194238659,
      "in_reply_to_id" : 194236571,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzODY1OQ==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 5,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 127378199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:49:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238659",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238674"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T20:49:48Z",
      "diff_hunk" : "@@ -184,12 +184,101 @@ bool ProduceSignature(const SigningProvider& provider, const BaseSignatureCreato\n     return solved && VerifyScript(sigdata.scriptSig, fromPubKey, &sigdata.scriptWitness, STANDARD_SCRIPT_VERIFY_FLAGS, creator.Checker());\n }\n \n-SignatureData DataFromTransaction(const CMutableTransaction& tx, unsigned int nIn)\n+bool SignatureExtractorChecker::CheckSig(const std::vector<unsigned char>& scriptSig, const std::vector<unsigned char>& vchPubKey, const CScript& scriptCode, SigVersion sigversion) const\n+{\n+    if (MutableTransactionSignatureChecker::CheckSig(scriptSig, vchPubKey, scriptCode, sigversion)) {\n+        CPubKey pubkey(vchPubKey);\n+        sigdata->signatures.emplace(pubkey, scriptSig);\n+        return true;\n+    }\n+    return false;\n+}\n+\n+namespace\n+{\n+struct Stacks\n+{\n+    std::vector<valtype> script;\n+    std::vector<valtype> witness;\n+\n+    Stacks() {}\n+    explicit Stacks(const std::vector<valtype>& scriptSigStack_) : script(scriptSigStack_), witness() {}\n+    explicit Stacks(const SignatureData& data) : witness(data.scriptWitness.stack) {\n+        EvalScript(script, data.scriptSig, SCRIPT_VERIFY_STRICTENC, BaseSignatureChecker(), SigVersion::BASE);\n+    }\n+\n+    SignatureData Output() const {\n+        SignatureData result;\n+        result.scriptSig = PushAll(script);\n+        result.scriptWitness.stack = witness;\n+        return result;\n+    }\n+};\n+}\n+\n+// Extracts signatures and scripts from scriptSigs. Please do not extend this, use PSBT instead\n+SignatureData DataFromTransaction(const CMutableTransaction& tx, unsigned int nIn, const CTxOut& txout)\n {\n     SignatureData data;\n     assert(tx.vin.size() > nIn);\n     data.scriptSig = tx.vin[nIn].scriptSig;\n     data.scriptWitness = tx.vin[nIn].scriptWitness;\n+    Stacks stack(data);\n+\n+    // Get signatures\n+    SignatureExtractorChecker checker(&tx, nIn, txout.nValue, &data);\n+    VerifyScript(data.scriptSig, txout.scriptPubKey, &data.scriptWitness, STANDARD_SCRIPT_VERIFY_FLAGS, checker);\n+\n+    // Get scripts\n+    txnouttype script_type;\n+    std::vector<std::vector<unsigned char> > solutions;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238674",
      "id" : 194238674,
      "in_reply_to_id" : 194236583,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzODY3NA==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 52,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 127378226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:49:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238674",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238677"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T20:49:53Z",
      "diff_hunk" : "@@ -56,9 +56,12 @@ extern const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR;\n struct SignatureData {\n     CScript scriptSig;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238677",
      "id" : 194238677,
      "in_reply_to_id" : 194236633,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzODY3Nw==",
      "original_commit_id" : "642a8b867430684aefbf99f038666b25c7ddc5af",
      "original_position" : 2,
      "path" : "src/script/sign.h",
      "position" : null,
      "pull_request_review_id" : 127378228,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:49:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238677",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238684"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T20:50:06Z",
      "diff_hunk" : "@@ -648,10 +648,8 @@ static void MutateTxSign(CMutableTransaction& tx, const std::string& flagStr)\n         SignatureData sigdata = DataFromTransaction(mergedTx, i, coin.out);\n         // Only sign SIGHASH_SINGLE if there's a corresponding output:\n         if (!fHashSingle || (i < mergedTx.vout.size()))\n-            ProduceSignature(keystore, MutableTransactionSignatureCreator(&mergedTx, i, amount, nHashType), prevPubKey, sigdata);\n+            ProduceSignature(SignatureDataSigningProvider(&sigdata, &keystore), SignatureDataSignatureCreator(&sigdata, &mergedTx, i, amount, nHashType), prevPubKey, sigdata);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238684",
      "id" : 194238684,
      "in_reply_to_id" : 194236827,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzODY4NA==",
      "original_commit_id" : "d0f96c4544f13e6c44896b2338859ee10c273f11",
      "original_position" : 5,
      "path" : "src/bitcoin-tx.cpp",
      "position" : null,
      "pull_request_review_id" : 127378237,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:50:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238684",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238688"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "340201bfff0328ec4f7867ce5d957412804808f8",
      "created_at" : "2018-06-09T20:50:14Z",
      "diff_hunk" : "@@ -152,7 +180,7 @@ bool ProduceSignature(const SigningProvider& provider, const BaseSignatureCreato\n         // the final scriptSig is the signatures from that\n         // and then the serialized subscript:\n         subscript = CScript(result[0].begin(), result[0].end());\n-        solved = solved && SignStep(provider, creator, subscript, result, whichType, SigVersion::BASE) && whichType != TX_SCRIPTHASH;\n+        solved = solved && SignStep(provider, creator, subscript, result, whichType, SigVersion::BASE, sigdata) && whichType != TX_SCRIPTHASH;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#discussion_r194238688",
      "id" : 194238688,
      "in_reply_to_id" : 194237501,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDIzODY4OA==",
      "original_commit_id" : "6ce5a289bd6db2d7392957745601d0acff35a41e",
      "original_position" : 155,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 127378239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13425",
      "updated_at" : "2018-06-09T20:50:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194238688",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> You're missing the `DUMMY_SIGNING_PROVIDER` instance.\r\n\r\nFixed",
      "created_at" : "2018-06-09T20:50:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13425#issuecomment-395997934",
      "id" : 395997934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13425",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NTk5NzkzNA==",
      "updated_at" : "2018-06-09T20:50:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/395997934",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
