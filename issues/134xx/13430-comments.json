[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is slightly different because `!IsBlockPruned` is true when `BLOCK_HAVE_DATA` but from the immediate code alone `nTx > 0` is not guaranteed. Is it the case that `BLOCK_HAVE_DATA` blocks are guaranteed to have `nTx > 0`?",
      "commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "created_at" : "2018-06-11T07:11:23Z",
      "diff_hunk" : "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308210",
      "id" : 194308210,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMwODIxMA==",
      "original_commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 9,
      "pull_request_review_id" : 127453026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
      "updated_at" : "2018-06-11T07:11:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308210",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308580"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308580"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Explicit precedence for `chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave` would be nice",
      "commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "created_at" : "2018-06-11T07:13:30Z",
      "diff_hunk" : "@@ -2040,8 +2040,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             // If pruning, don't inv blocks unless we have on disk and are likely to still have\n             // for some reasonable time window (1 hour) that block relay might require.\n             const int nPrunedBlocksLikelyToHave = MIN_BLOCKS_TO_KEEP - 3600 / chainparams.GetConsensus().nPowTargetSpacing;\n-            if (fPruneMode && (!(pindex->nStatus & BLOCK_HAVE_DATA) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave))\n-            {\n+            if (fPruneMode && (IsBlockPruned(pindex) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308580",
      "id" : 194308580,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMwODU4MA==",
      "original_commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "original_position" : 6,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 127453466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
      "updated_at" : "2018-06-11T07:13:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308580",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308812"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Just noting that I see you mention this in your notes: \"Note that nTx > 0? is supposed to always be equivalent to (pindex->nStatus & BLOCK_HAVE_DATA)?.\"",
      "commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "created_at" : "2018-06-11T07:14:41Z",
      "diff_hunk" : "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194308812",
      "id" : 194308812,
      "in_reply_to_id" : 194308210,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMwODgxMg==",
      "original_commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 9,
      "pull_request_review_id" : 127453744,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
      "updated_at" : "2018-06-11T07:14:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194308812",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194310667"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194310667"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah. if nTx = 0, it means you do not have data (nStatus & BHD), and if nTx > 0, it means you do have data, so the two checks are supposed to be equivalent, but I think they're done as a safety harness. That said, in this case the old code does `block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0` which is identical to the `!IsBlockPruned` case, isn't it?",
      "commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "created_at" : "2018-06-11T07:24:24Z",
      "diff_hunk" : "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194310667",
      "id" : 194310667,
      "in_reply_to_id" : 194308210,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMxMDY2Nw==",
      "original_commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 9,
      "pull_request_review_id" : 127455898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
      "updated_at" : "2018-06-11T07:24:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194310667",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194311026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194311026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You mean `()`? I don't think it's unclear that `<=` takes precedence over `-` (as opposed to e.g. `&&` and `||`)...",
      "commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "created_at" : "2018-06-11T07:25:59Z",
      "diff_hunk" : "@@ -2040,8 +2040,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             // If pruning, don't inv blocks unless we have on disk and are likely to still have\n             // for some reasonable time window (1 hour) that block relay might require.\n             const int nPrunedBlocksLikelyToHave = MIN_BLOCKS_TO_KEEP - 3600 / chainparams.GetConsensus().nPowTargetSpacing;\n-            if (fPruneMode && (!(pindex->nStatus & BLOCK_HAVE_DATA) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave))\n-            {\n+            if (fPruneMode && (IsBlockPruned(pindex) || pindex->nHeight <= chainActive.Tip()->nHeight - nPrunedBlocksLikelyToHave)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194311026",
      "id" : 194311026,
      "in_reply_to_id" : 194308580,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMxMTAyNg==",
      "original_commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "original_position" : 6,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 127456273,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
      "updated_at" : "2018-06-11T07:25:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194311026",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194315186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194315186"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's not identical - via De Morgan's law:\r\n* IsBlockPruned: `!(nStatus & BLOCK_HAVE_DATA) && nTx > 0`\r\n* !IsBlockPruned: `(nStatus & BLOCK_HAVE_DATA) || nTx <= 0`",
      "commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "created_at" : "2018-06-11T07:45:58Z",
      "diff_hunk" : "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194315186",
      "id" : 194315186,
      "in_reply_to_id" : 194308210,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMxNTE4Ng==",
      "original_commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 9,
      "pull_request_review_id" : 127461202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
      "updated_at" : "2018-06-11T07:45:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194315186",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ConceptACK for improved readability, though for the same reason I can't easily tell if it's correct :-)",
      "created_at" : "2018-06-11T08:04:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13430#issuecomment-396157042",
      "id" : 396157042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13430",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDM5NjE1NzA0Mg==",
      "updated_at" : "2018-06-11T08:04:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/396157042",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194322419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194322419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hm, you're right. I got the `nTx > 0` part backwards... Eesh.",
      "commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "created_at" : "2018-06-11T08:15:33Z",
      "diff_hunk" : "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194322419",
      "id" : 194322419,
      "in_reply_to_id" : 194308210,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMyMjQxOQ==",
      "original_commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 9,
      "pull_request_review_id" : 127469635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
      "updated_at" : "2018-06-11T08:15:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194322419",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194324920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194324920"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The more I stare at the original line, the more I think the nTx part is backwards. I think they intended to check if it was pruned, but got the check to instead check if 'they have the data and the nTx > 0'. But if they have the data, nTx should always be > 0.\r\n\r\nI.e.\r\n* for a pruned block, `nTx > 0` but `nStatus & BHD == 0`\r\n* for a non-pruned block, `nTx > 0` and `nStatus & BHD != 0`\r\n* for a block the node has not retrieved yet, `nTx == 0` and `nStatus & BHD == 0`\r\n\r\nI.e.\r\n```\r\nnTx > 0 nStatus & BHD != 0 case\r\n======= ================== =====================\r\nfalse   false              block data never seen\r\nfalse   true               ?????\r\ntrue    false              pruned block\r\ntrue    true               block data available\r\n```\r\n\r\nThe code checks that case 2 in the above table (`false true`) is not the case, but this check is unnecessary.\r\n\r\nI think the `!IsBlockPruned()` replacement here is correct.",
      "commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "created_at" : "2018-06-11T08:26:03Z",
      "diff_hunk" : "@@ -4277,11 +4277,11 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(const std::string& name,\n         //We can't rescan beyond non-pruned blocks, stop and throw an error\n         //this might happen if a user uses an old wallet within a pruned node\n         // or if he ran -disablewallet for a longer time, then decided to re-enable\n-        if (fPruneMode)\n-        {\n+        if (fPruneMode) {\n             CBlockIndex *block = chainActive.Tip();\n-            while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+            while (block && block->pprev && !IsBlockPruned(block->pprev) && pindexRescan != block) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13430#discussion_r194324920",
      "id" : 194324920,
      "in_reply_to_id" : 194308210,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE5NDMyNDkyMA==",
      "original_commit_id" : "106a2a5110665ad7a7ee890c97997e0a50a414b7",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 9,
      "pull_request_review_id" : 127472694,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13430",
      "updated_at" : "2018-06-11T08:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/194324920",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "node_id" : "MDQ6VXNlcjI1MDIyNA==",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   }
]
