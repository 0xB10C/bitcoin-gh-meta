[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11653#discussion_r150195288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11653"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150195288"
         }
      },
      "author_association" : "OWNER",
      "body" : "This table is duplicated with signrawtransaction, which makes it harder to change later. Please factor it out.",
      "commit_id" : "3f98c3c55425133f010f69d05dd4f0b66e9f47a0",
      "created_at" : "2017-11-10T10:03:03Z",
      "diff_hunk" : "@@ -320,6 +320,86 @@ UniValue createmultisig(const JSONRPCRequest& request)\n     return result;\n }\n \n+UniValue getsignaturehash(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() < 5 || request.params.size() > 6)\n+        throw std::runtime_error(\n+            \"getsignaturehash \\\"tx\\\" \\\"scriptcode\\\" \\\"amount\\\" \\\"sigversion\\\" inputindex (\\\"sighashtype\\\")\\n\"\n+            \"\\nCreate the hash to sign for the given input\\n\"\n+\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"tx\\\"     (string, required) The transaction hex string\\n\"\n+            \"2. \\\"scriptcode\\\"     (string, required) The scriptCode to sign\\n\"\n+            \"3. \\\"amount\\\"     (numeric, required) The amount spent\\n\"\n+            \"4. \\\"sigversion\\\"     (string, required) The signature version\\n\"\n+            \"       \\\"BASE\\\"\\n\"\n+            \"       \\\"WITNESS_V0\\\"\\n\"\n+            \"5. inputindex                  (numeric, required) The index of the input to sign\\n\"\n+            \"6. \\\"sighashtype\\\"     (string, optional, default=ALL) The signature hash type. Must be one of\\n\"\n+            \"       \\\"ALL\\\"\\n\"\n+            \"       \\\"NONE\\\"\\n\"\n+            \"       \\\"SINGLE\\\"\\n\"\n+            \"       \\\"ALL|ANYONECANPAY\\\"\\n\"\n+            \"       \\\"NONE|ANYONECANPAY\\\"\\n\"\n+            \"       \\\"SINGLE|ANYONECANPAY\\\"\\n\"\n+            \"\\nResult:\\n\"\n+            \"\\\"signature\\\"              (string) hex string of the signature\\n\"\n+\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"getsignaturehash\", \"\\\"txhex\\\" \\\"scriptcode\\\" \\\"0.01\\\" \\\"WITNESS_V0\\\" 1 \\\"SINGLE\\\"\")\n+            + HelpExampleRpc(\"getsignaturehash\", \"\\\"txhex\\\" \\\"scriptcode\\\" \\\"0.01\\\" \\\"WITNESS_V0\\\" 1 \\\"SINGLE\\\"\")\n+        );\n+\n+    RPCTypeCheck(request.params, {\n+        UniValue::VSTR, // tx\n+        UniValue::VSTR, // scriptCode\n+        UniValue::VSTR, // amount\n+        UniValue::VSTR, // sigVersion\n+        UniValue::VNUM // inputIndex\n+    },\n+        false);\n+\n+    CMutableTransaction mtx;\n+    if (!DecodeHexTx(mtx, request.params[0].get_str(), true))\n+        throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"TX decode failed\");\n+\n+    std::vector<unsigned char> scriptCodeData(ParseHexV(request.params[1], \"scriptCode\"));\n+    CScript scriptCode(scriptCodeData.begin(), scriptCodeData.end());\n+\n+    auto amount = AmountFromValue(request.params[2].get_str());\n+    SigVersion sigVersion;\n+    static std::map<std::string, SigVersion> mapSigVersionValues = {\n+        { std::string(\"BASE\"), SigVersion::SIGVERSION_BASE },\n+        { std::string(\"WITNESS_V0\"), SigVersion::SIGVERSION_WITNESS_V0 },\n+    };\n+    std::string strHashType = request.params[3].get_str();\n+    if (mapSigVersionValues.count(strHashType))\n+        sigVersion = mapSigVersionValues[strHashType];\n+    else\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid sigversion param\");\n+\n+    int inputIndex = request.params[4].get_int();\n+    int nHashType = SIGHASH_ALL;\n+    if (!request.params[5].isNull()) {\n+        RPCTypeCheckArgument(request.params[5], UniValue::VSTR);\n+        static std::map<std::string, int> mapSigHashValues = {\n+            { std::string(\"ALL\"), int(SIGHASH_ALL) },",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11653#discussion_r150195288",
      "id" : 150195288,
      "original_commit_id" : "8875b95bc4ecf661daf23d0e9fdd341560f5b037",
      "original_position" : 67,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 75710346,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11653",
      "updated_at" : "2017-11-10T10:13:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/150195288",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just refactored.",
      "created_at" : "2017-11-10T10:14:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11653#issuecomment-343433280",
      "id" : 343433280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11653",
      "updated_at" : "2017-11-10T10:14:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/343433280",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   }
]
