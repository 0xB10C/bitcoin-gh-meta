[
   {
      "author_association" : "MEMBER",
      "body" : "This is too dangerous. It's not clear at face value to users that the `database/` directory will be created or must be maintained with the wallet file(s).",
      "created_at" : "2017-11-14T20:05:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-344381289",
      "id" : 344381289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-14T20:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344381289",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "FWIW, if you separate a wallet from its database directory you reliably get a wallet that won't open.  To see this for yourself, copy a wallet.dat from a running wallet to another directory and try starting another copy of bitcoin against it there.",
      "created_at" : "2017-11-14T20:44:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-344392268",
      "id" : 344392268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-14T20:44:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344392268",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree with @luke-jr, #11466 is safer until we decide on a better wallet directory structure (e.g. https://github.com/bitcoin/bitcoin/pull/11466#issuecomment-335827526), which would involve supporting multiple BDB environments first.",
      "created_at" : "2017-11-14T21:43:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-344409031",
      "id" : 344409031,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-14T21:44:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344409031",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Note that you might want to cherrypick https://github.com/bitcoin/bitcoin/pull/11466/commits/c36cb54711fe7677db6efc4db00a6e7d42e62f8d to help debug the travis failure",
      "created_at" : "2017-11-15T09:34:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-344536755",
      "id" : 344536755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-15T09:34:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344536755",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> FWIW, if you separate a wallet from its database directory you reliably get a wallet that won't open. \r\n\r\nOnly if it has uncompacted log files. To prevent this, bitcoin spends so much time consolidating the wallet database at runtime (in the MaybeCompactWalletDB thread), and does it at least at a clean shutdown.\r\n\r\nPeople are moving around wallet.dat already, from and to the data directory, so I'm not convinced that supporting multiple wallet directories in principle makes the risk much larger that wallets are separated from their database directory while \"live\". \r\n\r\nBut indeed, a database environment has to be created where the wallets are. Creating wallets in different places or even on different file systems but having the database environment in the main data directory is asking for trouble.",
      "created_at" : "2017-11-16T16:50:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-344985554",
      "id" : 344985554,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-16T16:50:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344985554",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151733182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151733182"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Full path? How will the url look like?",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T16:44:56Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151733182",
      "id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77493558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151733182",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151735244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151735244"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Full path? How will the url look like?\r\n\r\nIt doesn't have to be the full path, but it can be. Paths are urlencoded, and symlinks are also allowed. See the unit test which tests every imaginable type of path.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T16:53:10Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151735244",
      "id" : 151735244,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77496059,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151735244",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151741224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151741224"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Feels weird to known server side details. Not to mention it can break the client if you move the wallet to a new place.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T17:19:36Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151741224",
      "id" : 151741224,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77503538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151741224",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151742971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151742971"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Feels weird to known server side details. Not to mention it can break the client if you move the wallet to a new place.\r\n\r\nThe PR is not changing anything about this. Whatever string the server uses to identify the wallet, the client just has to use the same string. We've discussed adding and storing wallet identifiers in the past, but opted to just use filenames for simplicity. Server operator is free to choose a path, or alias or whatever he wants as the string used to identify the wallet.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T17:27:49Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151742971",
      "id" : 151742971,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77505623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151742971",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151743953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151743953"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See discussion in #10650 \"The walletID is currently defined by the filename (-wallet=<filename>), ideally, we later add a wallet RPC call to set the walletID (should be written to the wallet database).\" It would still be possible to do this if you are interested, but it's tangential to this PR.\r\n\r\nThere is more discussion starting at \"The walletID should in future not be a representation of the filename. User should be able to manually choose the walletID. Ideally, we write the walletID into the wallet database. There we could only allow alphanumeric chars.\" https://github.com/bitcoin/bitcoin/pull/10650#issuecomment-310606962",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T17:32:37Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151743953",
      "id" : 151743953,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77506851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151743953",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151746657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151746657"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My point is that IMO we should not allow absolute path in rpcwallet, which you introduce here.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T17:45:43Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151746657",
      "id" : 151746657,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77510098,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151746657",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151748247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151748247"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What is the problem exactly? If the server operator wants to use a plain path, or a relative path, he can use one. If he wants to use a symlink alias, he can use that. What is the problem with allowing him to use a full path as well?\r\n\r\nNote that RPC identifier for wallet is entirely up to the server and not up the client. The client has to use whatever string the server uses to identify the wallet, there is no translation of any kind done on the client value.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T17:53:02Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151748247",
      "id" : 151748247,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77511971,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151748247",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151755076"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151755076"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not arguing against full paths server side. I'm kind of against exposing absolute paths to RPC clients. `listwallets` will expose the full path right?",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T18:22:45Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151755076",
      "id" : 151755076,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77519860,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151755076",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151756281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151756281"
         }
      },
      "author_association" : "OWNER",
      "body" : "It exposes the name the server uses for the wallet.\n\nIn the current implementation that name indeed corresponds to the configured path, but there is no reason why that must remain the case.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T18:28:22Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151756281",
      "id" : 151756281,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77521305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151756281",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151757547"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151757547"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Well if the goal is to have some sort of id and have that exposed instead then +1.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T18:33:52Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151757547",
      "id" : 151757547,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77522828,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151757547",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151757822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151757822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> listwallets will expose the full path right?\r\n\r\nNo, or at least not by default. Listwallets just shows the wallet name. If the server is configured to use full paths for wallet name these will be full paths, but the server has to be specifically configured this way in order for this to happen.\r\n\r\nI'm still little puzzled about what you think the underlying problem is with allowing server admins to use full paths as wallet names. But if you really think it is a problem it would literally be a one-line code change to use a different identifier. E.g. the `name` argument to `CreateWalletFromFile()` could be changed from `walletFile` to `fs::path(walletFile).filename()`.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T18:35:02Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151757822",
      "id" : 151757822,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77523165,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151757822",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151761456"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151761456"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Suppose you have configured the server with an absolute wallet path. Then you have a couple of clients (in different hosts). You had to configure each client with the absolute path of the wallet. These clients can be others than bitcoin-cli. Now the server operator decides it has to move the wallet to a new location. The clients can handle a server restart, but now the wallet doesn't exists. And the operator simply doesn't know of these clients because they are managed by other operators etc..",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T18:50:15Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151761456",
      "id" : 151761456,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77527367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151761456",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151761934"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151761934"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My point is to not even allow such cases. An wallet id (filename or even relative path) is enough ",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T18:52:17Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151761934",
      "id" : 151761934,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77527937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151761934",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This is too dangerous. It's not clear at face value to users that the database/ directory will be created or must be maintained with the wallet file(s).\r\n\r\nNote that this was posted in response to an earlier version of this pr that did not include the third commit. With the third commit, the default for creating new wallets is as directories rather than a files (with each wallet directory containing its own wallet.dat file, db.log and database/log files). See the comments and release notes in the third commit for details.\r\n\r\n> But indeed, a database environment has to be created where the wallets are. Creating wallets in different places or even on different file systems but having the database environment in the main data directory is asking for trouble.\r\n\r\nThe PR doesn't do this (and never did). The first commit of the PR is a refactoring specifically to add support for opening multiple BDB environments.\r\n\r\n> Agree with @luke-jr, #11466 is safer until we decide on a better wallet directory structure (https://github.com/bitcoin/bitcoin/pull/11466#issuecomment-335827526), which would involve supporting multiple BDB environments first.\r\n\r\nAgain, the very first commit of this PR adds support for multiple BDB environments, and if you combine this PR with #11466 the result is exactly what you described in your linked comment.",
      "created_at" : "2017-11-17T18:53:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-345331793",
      "id" : 345331793,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-17T18:53:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345331793",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151767636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151767636"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Suppose you have configured the server with an absolute wallet path. Then you have a couple of clients (in different hosts). You had to configure each client with the absolute path of the wallet. These clients can be others than bitcoin-cli. Now the server operator decides it has to move the wallet to a new location. \r\n\r\nI don't see how this is much different than the server renaming the wallet. If a server admin wants to create a stable name for a wallet, it's perfectly possible to do that by creating a symlink or just manipulating the -datadir or -walletdir (#11687) settings to be able store the wallets in different locations without changing the name. I believe this PR actually gives server admins more flexibility in this regard rather than less, because previously wallet symlinks were disallowed.\r\n\r\nBut to take the example at face value, you have a server admin who accidentally exposed a non-stable wallet name, instead of a stable wallet name over the rpc interface to clients on the internet outside of his control. What solutions would you like to see for this problem? Would it be good enough to use `fs::path(walletFile).filename()` instead of `walletFile` as the wallet name passed to `CreateWalletFromFile` like I suggested earlier? Do you want wallet names to be configurable on the command line? Do you want them to be configurable by RPC? Do you want wallet names to be stored inside wallet databases like Jonas suggested?",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T19:17:06Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151767636",
      "id" : 151767636,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77534776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151767636",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151773896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151773896"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> accidentally exposed a non-stable wallet\r\n\r\nMy point is to prevent this. IMO symlinks are a weak solution to remedy that case. Renaming is indeed a breaking change from the client point of view.\r\n\r\nI'm not a server admin expert (not a bit either) but, correct me if I'm wrong, usually absolute paths aren't exposed outside.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-11-17T19:45:36Z",
      "diff_hunk" : "@@ -48,7 +48,7 @@ std::string HelpMessageCli()\n     strUsage += HelpMessageOpt(\"-rpcclienttimeout=<n>\", strprintf(_(\"Timeout in seconds during HTTP requests, or 0 for no timeout. (default: %d)\"), DEFAULT_HTTP_CLIENT_TIMEOUT));\n     strUsage += HelpMessageOpt(\"-stdinrpcpass\", strprintf(_(\"Read RPC password from standard input as a single line.  When combined with -stdin, the first line from standard input is used for the RPC password.\")));\n     strUsage += HelpMessageOpt(\"-stdin\", _(\"Read extra arguments from standard input, one per line until EOF/Ctrl-D (recommended for sensitive information such as passphrases).  When combined with -stdinrpcpass, the first line from standard input is used for the RPC password.\"));\n-    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (argument is wallet filename in bitcoind directory, required if bitcoind/-Qt runs with multiple wallets)\"));\n+    strUsage += HelpMessageOpt(\"-rpcwallet=<walletname>\", _(\"Send RPC for non-default wallet on RPC server (needs to exactly match corresponding -wallet option passed to bitcoind)\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r151773896",
      "id" : 151773896,
      "in_reply_to_id" : 151733182,
      "original_commit_id" : "beedd374f0fd1df4d65391006c76f668affb01d9",
      "original_position" : 5,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 5,
      "pull_request_review_id" : 77542261,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151773896",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Note that this was posted in response to an earlier version of this pr that did not include the third commit. With the third commit, the default for creating new wallets is as directories rather than a files (with each wallet directory containing its own wallet.dat file, db.log and database/log files). See the comments and release notes in the third commit for details.\r\n\r\nIndeed, concept ACK on the new approach, will review soon",
      "created_at" : "2017-11-18T00:46:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-345403475",
      "id" : 345403475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-18T00:46:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345403475",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "IMO we should still forbid paths for file-based wallets, and only allow it for directory-based ones.\r\n\r\nSuggest renaming `wallet.dat` in the directory to `wallet.bdb` to convey the fact that you can't just copy the file to make a proper backup.",
      "created_at" : "2017-11-18T15:13:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-345448447",
      "id" : 345448447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-18T15:13:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345448447",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Concept ACK",
      "created_at" : "2017-11-18T20:10:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-345467887",
      "id" : 345467887,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-18T20:10:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345467887",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> The PR doesn't do this (and never did). The first commit of the PR is a refactoring specifically to add support for opening multiple BDB environments.\r\n\r\nSorry! I didn't read the code but was apparently confused by all the screaming about dangerousness. If you added support for multiple database environments you get my concept ACK.\r\n\r\n> Suggest renaming wallet.dat in the directory to wallet.bdb to convey the fact that you can't just copy the file to make a proper backup.\r\n\r\nI don't think we should be changing the default naming of wallet databases. People have been backing up separate wallet.dats forever, and generally it works because bitcoin core leaves the wallet in consolidated state. So I'd prefer documenting that behavior instead.\r\n\r\nEven a backup with the last update stripped is better than no backup. From that it's usually possible to recover due to the mempool or HD seed. But if they can't find 'wallet.dat', they might decide not to to a backup at all.\r\n\r\nTurning the abstraction in the user's mind of wallets into directories is going to be an upstream fight as well. I'm not against it, but I think it will result in a lot of confusion.",
      "created_at" : "2017-11-20T08:35:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-345625565",
      "id" : 345625565,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-20T08:36:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345625565",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> IMO we should still forbid paths for file-based wallets, and only allow it for directory-based ones.\r\n\r\nGood idea, added check for this.\r\n\r\n",
      "created_at" : "2017-11-30T19:11:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#issuecomment-348289802",
      "id" : 348289802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11687",
      "updated_at" : "2017-11-30T19:11:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348289802",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155093506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155093506"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ugh, can we return the CDBEnv* instead of return-by-setting-ref-to-ptr?",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-05T22:20:55Z",
      "diff_hunk" : "@@ -85,7 +86,8 @@ class CDBEnv\n     }\n };\n \n-extern CDBEnv bitdb;\n+/** Get CDBEnv and database filename given a wallet path. */\n+void GetWalletEnv(const fs::path& wallet_path, CDBEnv*& env, std::string& database_filename);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155093506",
      "id" : 155093506,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 45,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 81356359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155093506",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155319012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155319012"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why create the env before checking for mock? Why not add a fMock parameter to GetWalletEnv or so instead?",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T18:22:39Z",
      "diff_hunk" : "@@ -100,9 +102,15 @@ class CWalletDBWrapper\n     }\n \n     /** Create DB handle to real database */\n-    CWalletDBWrapper(CDBEnv *env_in, const std::string &strFile_in) :\n-        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0), env(env_in), strFile(strFile_in)\n+    CWalletDBWrapper(const fs::path& wallet_path, bool mock = false) :\n+        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n+        GetWalletEnv(wallet_path, env, strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155319012",
      "id" : 155319012,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 58,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 81356359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155319012",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155349827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155349827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why make the lock global instead of per-env? It seems like there should be nothing preventing you from keeping that and adding a second lock that only exists to protect g_dbenvs, though likely not a big deal in terms of concurrency.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T20:20:47Z",
      "diff_hunk" : "@@ -35,17 +35,18 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155349827",
      "id" : 155349827,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 4,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 81356359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155349827",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155350688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155350688"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "While you're at it, can you just merge EnvShutdown and Close? EnvShutdown is now only called from Close().",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T20:24:08Z",
      "diff_hunk" : "@@ -81,29 +90,38 @@ void CDBEnv::Reset()\n     fMockDb = false;\n }\n \n-CDBEnv::CDBEnv()\n+CDBEnv::CDBEnv(const fs::path& dir_path) : strPath(dir_path.string())\n {\n     Reset();\n }\n \n CDBEnv::~CDBEnv()\n {\n-    EnvShutdown();\n+    Close();\n }\n \n void CDBEnv::Close()\n {\n+    for (auto& db : mapDb) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155350688",
      "id" : 155350688,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 44,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 81356359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155350688",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155352781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155352781"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is this required? Somehow I had assumed they only conficted if they were both in the same env, but I dunno where I got that from.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T20:33:07Z",
      "diff_hunk" : "@@ -435,7 +467,9 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n             if (ret != 0) {\n                 throw std::runtime_error(strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename));\n             }\n-            CheckUniqueFileid(*env, strFilename, *pdb_temp);\n+            for (auto& env : g_dbenvs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155352781",
      "id" : 155352781,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 193,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 81356359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155352781",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155354119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155354119"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Heh, I have to admit I really prefer the old version from the new one. Creating a DB and then giving it to the wallet makes more sense conceptually to me than telling the wallet where to find the DB and then having the CWallet constructor create the DB (especially as the slow-moving goal is to abstract the DB out of the wallet and make it an interface).",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T20:38:45Z",
      "diff_hunk" : "@@ -3848,16 +3848,17 @@ std::vector<std::string> CWallet::GetDestValues(const std::string& prefix) const\n     return values;\n }\n \n-CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n+CWallet* CWallet::CreateWalletFromFile(const std::string& name, const fs::path& path)\n {\n+    const std::string& walletFile = name;\n+\n     // needed to restore wallet transaction meta data after -zapwallettxes\n     std::vector<CWalletTx> vWtx;\n \n     if (gArgs.GetBoolArg(\"-zapwallettxes\", false)) {\n         uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n \n-        std::unique_ptr<CWalletDBWrapper> dbw(new CWalletDBWrapper(&bitdb, walletFile));\n-        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(std::move(dbw));\n+        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(name, path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155354119",
      "id" : 155354119,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 81356359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155354119",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155358844"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155358844"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in 75ed8c595c53a2c3aeedfbc01810f291ee92ad51",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T20:58:02Z",
      "diff_hunk" : "@@ -81,29 +90,38 @@ void CDBEnv::Reset()\n     fMockDb = false;\n }\n \n-CDBEnv::CDBEnv()\n+CDBEnv::CDBEnv(const fs::path& dir_path) : strPath(dir_path.string())\n {\n     Reset();\n }\n \n CDBEnv::~CDBEnv()\n {\n-    EnvShutdown();\n+    Close();\n }\n \n void CDBEnv::Close()\n {\n+    for (auto& db : mapDb) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155358844",
      "id" : 155358844,
      "in_reply_to_id" : 155350688,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 44,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 81665486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155358844",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155359037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155359037"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added comment in 75ed8c595c53a2c3aeedfbc01810f291ee92ad51. It's done to prevent opening two paths that refer to the same file at the same time.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T20:58:50Z",
      "diff_hunk" : "@@ -435,7 +467,9 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n             if (ret != 0) {\n                 throw std::runtime_error(strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename));\n             }\n-            CheckUniqueFileid(*env, strFilename, *pdb_temp);\n+            for (auto& env : g_dbenvs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155359037",
      "id" : 155359037,
      "in_reply_to_id" : 155352781,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 193,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 81665486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155359037",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155360386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155360386"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "One lock seems a simpler than multiple multiple locks unless there is a performance rationale for more fine grained locking. One thing which I would not look forward to is dealing with even more lock-order bugs in the wallet than the ones that already frequently arise.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T21:04:55Z",
      "diff_hunk" : "@@ -35,17 +35,18 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155360386",
      "id" : 155360386,
      "in_reply_to_id" : 155349827,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 4,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 81665486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155360386",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155360999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155360999"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ugh. Good idea! Done in 75ed8c595c53a2c3aeedfbc01810f291ee92ad51",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T21:07:28Z",
      "diff_hunk" : "@@ -85,7 +86,8 @@ class CDBEnv\n     }\n };\n \n-extern CDBEnv bitdb;\n+/** Get CDBEnv and database filename given a wallet path. */\n+void GetWalletEnv(const fs::path& wallet_path, CDBEnv*& env, std::string& database_filename);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155360999",
      "id" : 155360999,
      "in_reply_to_id" : 155093506,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 45,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 81665486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155360999",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155364320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155364320"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I can't see how that would be an improvement. The `env` object needs to exist whether it is memory or file-backed. And `GetWalletEnv` is just intended to create and retrieve CDBEnv objects, not do that and then invoke unrelated CDBEnv methods that only one of its callers needs depending on a bool parameter...",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T21:20:28Z",
      "diff_hunk" : "@@ -100,9 +102,15 @@ class CWalletDBWrapper\n     }\n \n     /** Create DB handle to real database */\n-    CWalletDBWrapper(CDBEnv *env_in, const std::string &strFile_in) :\n-        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0), env(env_in), strFile(strFile_in)\n+    CWalletDBWrapper(const fs::path& wallet_path, bool mock = false) :\n+        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n+        GetWalletEnv(wallet_path, env, strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155364320",
      "id" : 155364320,
      "in_reply_to_id" : 155319012,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 58,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 81665486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155364320",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155371642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155371642"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Interesting, I guess you are imagining `CWalletDBWrapper` changing into some abstract interface that the wallet can call to load and store data. If that's the goal I can make the `CWallet(name, dbw)` constructor public instead of private and get rid of the other constructors. For callers, this means the current:\r\n\r\n```c++\r\nMakeUnique<CWallet>(name, path)\r\nMakeUnique<CWallet>(CWallet::Mock())\r\nMakeUnique<CWallet>(CWallet::Dummy()))\r\n```\r\n\r\nwould become something like:\r\n\r\n```c++\r\nMakeUnique<CWallet>(name, MakeUnique<CWalletDBWrapper>(path))\r\nMakeUnique<CWallet>(\"mock\", MakeUnique<CWalletDBWrapper>(CWalletDBWrapper::Mock()))\r\nMakeUnique<CWallet>(\"dummy\", MakeUnique<CWalletDBWrapper>(CWalletDBWrapper::Dummy()))\r\n```\r\n\r\nI would probably want to hold off on a change like this until `CWalletDBWrapper` did become a real abstraction. But let me know if you want this change or something along these lines. Obviously this is more verbose than code in the current pr, but it's not much more verbose than code currently in master.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-06T21:49:20Z",
      "diff_hunk" : "@@ -3848,16 +3848,17 @@ std::vector<std::string> CWallet::GetDestValues(const std::string& prefix) const\n     return values;\n }\n \n-CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n+CWallet* CWallet::CreateWalletFromFile(const std::string& name, const fs::path& path)\n {\n+    const std::string& walletFile = name;\n+\n     // needed to restore wallet transaction meta data after -zapwallettxes\n     std::vector<CWalletTx> vWtx;\n \n     if (gArgs.GetBoolArg(\"-zapwallettxes\", false)) {\n         uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n \n-        std::unique_ptr<CWalletDBWrapper> dbw(new CWalletDBWrapper(&bitdb, walletFile));\n-        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(std::move(dbw));\n+        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(name, path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155371642",
      "id" : 155371642,
      "in_reply_to_id" : 155354119,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 81665486,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155371642",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156420111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156420111"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yea, I really like that, tbh. If nothing else is much more clearly separates wallet.cpp from walletdb, etc, keeping wallet.cpp/CWallet only filled with wallet logic, and not database-backend stuff.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T16:29:24Z",
      "diff_hunk" : "@@ -3848,16 +3848,17 @@ std::vector<std::string> CWallet::GetDestValues(const std::string& prefix) const\n     return values;\n }\n \n-CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n+CWallet* CWallet::CreateWalletFromFile(const std::string& name, const fs::path& path)\n {\n+    const std::string& walletFile = name;\n+\n     // needed to restore wallet transaction meta data after -zapwallettxes\n     std::vector<CWalletTx> vWtx;\n \n     if (gArgs.GetBoolArg(\"-zapwallettxes\", false)) {\n         uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n \n-        std::unique_ptr<CWalletDBWrapper> dbw(new CWalletDBWrapper(&bitdb, walletFile));\n-        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(std::move(dbw));\n+        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(name, path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156420111",
      "id" : 156420111,
      "in_reply_to_id" : 155354119,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 82893773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156420111",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156422613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156422613"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> If nothing else is much more clearly separates wallet.cpp from walletdb, etc, keeping wallet.cpp/CWallet only filled with wallet logic\r\n\r\nIt really affects callers of wallet, not wallet itself. CWallet is barely affected and wallet.cpp doesn't change at all. Anyway, let me know if you would prefer to see this here or in another PR.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T16:36:59Z",
      "diff_hunk" : "@@ -3848,16 +3848,17 @@ std::vector<std::string> CWallet::GetDestValues(const std::string& prefix) const\n     return values;\n }\n \n-CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n+CWallet* CWallet::CreateWalletFromFile(const std::string& name, const fs::path& path)\n {\n+    const std::string& walletFile = name;\n+\n     // needed to restore wallet transaction meta data after -zapwallettxes\n     std::vector<CWalletTx> vWtx;\n \n     if (gArgs.GetBoolArg(\"-zapwallettxes\", false)) {\n         uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n \n-        std::unique_ptr<CWalletDBWrapper> dbw(new CWalletDBWrapper(&bitdb, walletFile));\n-        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(std::move(dbw));\n+        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(name, path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156422613",
      "id" : 156422613,
      "in_reply_to_id" : 155354119,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 82896718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156422613",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156423481"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156423481"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It just seems very weird given mock seems like it shouldn't have a/care what the wallet_path is. In the future I kinda feel like it should become more RAII (ie Open in the GetWalletEnv call) but not in this PR.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T16:39:50Z",
      "diff_hunk" : "@@ -100,9 +102,15 @@ class CWalletDBWrapper\n     }\n \n     /** Create DB handle to real database */\n-    CWalletDBWrapper(CDBEnv *env_in, const std::string &strFile_in) :\n-        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0), env(env_in), strFile(strFile_in)\n+    CWalletDBWrapper(const fs::path& wallet_path, bool mock = false) :\n+        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n+        GetWalletEnv(wallet_path, env, strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156423481",
      "id" : 156423481,
      "in_reply_to_id" : 155319012,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 58,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 82897819,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156423481",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156424854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156424854"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It just seems weird given it'd be even less code change to not split the lock out, and as long as the global lock is *only* held in the creation of new envs, no lockorder should be worried about (cause lockorder is always trivially correct if locks are held only for the duration of a function which uses them, without making callbacks).",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T16:43:56Z",
      "diff_hunk" : "@@ -35,17 +35,18 @@ class CDBEnv\n     void EnvShutdown();\n \n public:\n-    mutable CCriticalSection cs_db;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156424854",
      "id" : 156424854,
      "in_reply_to_id" : 155349827,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 4,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 82899372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156424854",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156428292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156428292"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> It just seems very weird given mock seems like it shouldn't have a/care what the wallet_path is. In the future I kinda feel like it should become more RAII (ie Open in the GetWalletEnv call) but not in this PR.\r\n\r\nRAII is not the model this uses because when there more than one wallet file open in the same directory they share the same environment. You could only resolve this by requiring all databases in the environment to be opened and closed at the same time (which would complicate dynamic loading/unloading) or by not allowing multiple databases in the same directory to be opened at the same time, or some combination these things, or just not using RAII.\r\n\r\nOn using fake \"\" path for mock databases, this is a little weird. Could be made less exposed by  adding a separate constructor for mocks like proposed in the other comment: https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155371642",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T16:54:27Z",
      "diff_hunk" : "@@ -100,9 +102,15 @@ class CWalletDBWrapper\n     }\n \n     /** Create DB handle to real database */\n-    CWalletDBWrapper(CDBEnv *env_in, const std::string &strFile_in) :\n-        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0), env(env_in), strFile(strFile_in)\n+    CWalletDBWrapper(const fs::path& wallet_path, bool mock = false) :\n+        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n+        GetWalletEnv(wallet_path, env, strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156428292",
      "id" : 156428292,
      "in_reply_to_id" : 155319012,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 58,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 82903256,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156428292",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156500862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156500862"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I mean given you're changing it here, I see no reason to change it to go in the opposite direction of where I think it should go - even if CWalletDBWrapper right now is just a BDB implementation, it still *has* a clean-ish interface, and having the CWallet cosntructor create one from a path instead of take one just seems like the wrong direction. Better to just leave this part of the diff out of the PR?",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T21:30:27Z",
      "diff_hunk" : "@@ -3848,16 +3848,17 @@ std::vector<std::string> CWallet::GetDestValues(const std::string& prefix) const\n     return values;\n }\n \n-CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n+CWallet* CWallet::CreateWalletFromFile(const std::string& name, const fs::path& path)\n {\n+    const std::string& walletFile = name;\n+\n     // needed to restore wallet transaction meta data after -zapwallettxes\n     std::vector<CWalletTx> vWtx;\n \n     if (gArgs.GetBoolArg(\"-zapwallettxes\", false)) {\n         uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n \n-        std::unique_ptr<CWalletDBWrapper> dbw(new CWalletDBWrapper(&bitdb, walletFile));\n-        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(std::move(dbw));\n+        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(name, path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156500862",
      "id" : 156500862,
      "in_reply_to_id" : 155354119,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 82989103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156500862",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156501584"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156501584"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, but instead of env = GetWalletEnv(wallet_path, strFile); env->Open(); or env->Close(); env->MakeMock();, GetWalletEnv could return a reference which is already open or otherwise has some level of understanding of closing when all refs to that env are lost. Even if not that, would prefer to not use the fake \"\" path as you suggest.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T21:33:11Z",
      "diff_hunk" : "@@ -100,9 +102,15 @@ class CWalletDBWrapper\n     }\n \n     /** Create DB handle to real database */\n-    CWalletDBWrapper(CDBEnv *env_in, const std::string &strFile_in) :\n-        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0), env(env_in), strFile(strFile_in)\n+    CWalletDBWrapper(const fs::path& wallet_path, bool mock = false) :\n+        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0)\n     {\n+        GetWalletEnv(wallet_path, env, strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156501584",
      "id" : 156501584,
      "in_reply_to_id" : 155319012,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 58,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 82989956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156501584",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156501935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156501935"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Did you forget to push? Noting this is the only way we handle hardlinks is useful, indeed.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T21:34:48Z",
      "diff_hunk" : "@@ -435,7 +467,9 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n             if (ret != 0) {\n                 throw std::runtime_error(strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename));\n             }\n-            CheckUniqueFileid(*env, strFilename, *pdb_temp);\n+            for (auto& env : g_dbenvs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156501935",
      "id" : 156501935,
      "in_reply_to_id" : 155352781,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 193,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 82990394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156501935",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156509771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156509771"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Did you forget to push?\r\n\r\nOops, yeah. It was on the pr/wfile.9 tag I linked to below. Should be updated now. Also I'll work on the \"just leave this part of the diff\" change you requested above.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T22:06:46Z",
      "diff_hunk" : "@@ -435,7 +467,9 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n             if (ret != 0) {\n                 throw std::runtime_error(strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename));\n             }\n-            CheckUniqueFileid(*env, strFilename, *pdb_temp);\n+            for (auto& env : g_dbenvs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156509771",
      "id" : 156509771,
      "in_reply_to_id" : 155352781,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 193,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 82999688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156509771",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156521046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156521046"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in 39fa1e9c01417bc9275d8f81bfef67bfc5ca308e",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-12T23:00:01Z",
      "diff_hunk" : "@@ -3848,16 +3848,17 @@ std::vector<std::string> CWallet::GetDestValues(const std::string& prefix) const\n     return values;\n }\n \n-CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n+CWallet* CWallet::CreateWalletFromFile(const std::string& name, const fs::path& path)\n {\n+    const std::string& walletFile = name;\n+\n     // needed to restore wallet transaction meta data after -zapwallettxes\n     std::vector<CWalletTx> vWtx;\n \n     if (gArgs.GetBoolArg(\"-zapwallettxes\", false)) {\n         uiInterface.InitMessage(_(\"Zapping all transactions from wallet...\"));\n \n-        std::unique_ptr<CWalletDBWrapper> dbw(new CWalletDBWrapper(&bitdb, walletFile));\n-        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(std::move(dbw));\n+        std::unique_ptr<CWallet> tempWallet = MakeUnique<CWallet>(name, path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156521046",
      "id" : 156521046,
      "in_reply_to_id" : 155354119,
      "original_commit_id" : "3dba60c313ae111492dafc3eb09f2c5044fb1b4d",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 83012857,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-12T23:03:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156521046",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156779308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156779308"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Make the constructors private now?",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-13T20:52:59Z",
      "diff_hunk" : "@@ -100,9 +101,33 @@ class CWalletDBWrapper\n     }\n \n     /** Create DB handle to real database */\n-    CWalletDBWrapper(CDBEnv *env_in, const std::string &strFile_in) :\n-        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0), env(env_in), strFile(strFile_in)\n+    CWalletDBWrapper(const fs::path& wallet_path, bool mock = false) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r156779308",
      "id" : 156779308,
      "original_commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "original_position" : 66,
      "path" : "src/wallet/db.h",
      "position" : 66,
      "pull_request_review_id" : 83313824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-13T22:20:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156779308",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r157285274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157285274"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Make the constructors private now?\r\n\r\nI didn't do this just because it prevents being able to call MakeUnique so makes code below more verbose. But I think I'll wind up making this tweak if @promag or someone else asks for other style changes on the PR.",
      "commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "created_at" : "2017-12-15T19:47:41Z",
      "diff_hunk" : "@@ -100,9 +101,33 @@ class CWalletDBWrapper\n     }\n \n     /** Create DB handle to real database */\n-    CWalletDBWrapper(CDBEnv *env_in, const std::string &strFile_in) :\n-        nUpdateCounter(0), nLastSeen(0), nLastFlushed(0), nLastWalletUpdate(0), env(env_in), strFile(strFile_in)\n+    CWalletDBWrapper(const fs::path& wallet_path, bool mock = false) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11687#discussion_r157285274",
      "id" : 157285274,
      "in_reply_to_id" : 156779308,
      "original_commit_id" : "99934923d4c1dc4c0f96865b2589cc0b5df66b31",
      "original_position" : 66,
      "path" : "src/wallet/db.h",
      "position" : 66,
      "pull_request_review_id" : 83908360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11687",
      "updated_at" : "2017-12-15T19:47:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/157285274",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
