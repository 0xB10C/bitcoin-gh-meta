[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@luke-jr @promag, would you mind reviewing this revised version? :-)",
      "created_at" : "2017-11-15T15:23:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11694#issuecomment-344626045",
      "id" : 344626045,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11694",
      "updated_at" : "2017-11-15T15:23:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344626045",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11694#discussion_r151159309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151159309"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My suggestion is to create a function like:\r\n```cpp\r\nbool KeepRunning() {\r\n    LOCK(cs_main);\r\n    assert(chainActive.Tip());\r\n    return chainActive.Tip()->GetBlockHash() == hashWatchedChain && IsRPCRunning();\r\n}\r\n```\r\nAnd here just:\r\n```cpp\r\nwhile (KeepRunning()) {\r\n    ...\r\n}\r\n```",
      "commit_id" : "6e65f35f23337cf0b284acb2bb2ec038ae83aeca",
      "created_at" : "2017-11-15T15:29:25Z",
      "diff_hunk" : "@@ -479,7 +479,12 @@ UniValue getblocktemplate(const JSONRPCRequest& request)\n             checktxtime = std::chrono::steady_clock::now() + std::chrono::minutes(1);\n \n             WaitableLock lock(csBestBlock);\n-            while (chainActive.Tip()->GetBlockHash() == hashWatchedChain && IsRPCRunning())\n+            bool keepRunning;\n+            {\n+                LOCK(cs_main);\n+                keepRunning = chainActive.Tip()->GetBlockHash() == hashWatchedChain && IsRPCRunning();\n+            }\n+            while (keepRunning)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11694#discussion_r151159309",
      "id" : 151159309,
      "original_commit_id" : "dbb4a14c7a5a656de2e3d9908d32a502f830711f",
      "original_position" : 10,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 76821740,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11694",
      "updated_at" : "2017-11-15T16:43:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151159309",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Restarted travis job.",
      "created_at" : "2017-11-15T16:11:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11694#issuecomment-344642334",
      "id" : 344642334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11694",
      "updated_at" : "2017-11-15T16:11:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344642334",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The whole point of csBestBlock was that we shouldn't need cs_main to simply check the best block. It looks like the logic for that got lost somewhere, and I'm not sure we're even safe from races anymore. :(\r\n\r\nSuggest instead of this, fixing csBestBlock so it is sufficient/works.",
      "created_at" : "2017-11-15T16:43:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11694#issuecomment-344652882",
      "id" : 344652882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11694",
      "updated_at" : "2017-11-15T16:43:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344652882",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag Now using a lambda to keep it DRY - please re-review :-)",
      "created_at" : "2017-11-15T16:45:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11694#issuecomment-344653344",
      "id" : 344653344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11694",
      "updated_at" : "2017-11-15T16:47:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344653344",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@luke-jr Do you mean that fixing this make things worse? If so, please describe why :-)\r\n\r\nI'm not familiar with the `csBestBlock` issue you are describing, so I'm afraid I'll have to leave fixing that to someone else :-)",
      "created_at" : "2017-11-21T19:08:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11694#issuecomment-346129546",
      "id" : 346129546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11694",
      "updated_at" : "2017-11-21T19:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346129546",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
