[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148977987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148977987"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Add newline.",
      "commit_id" : "740841e7dfa774407dd44b27f5d4ae3fdc56f22d",
      "created_at" : "2017-11-06T00:49:31Z",
      "diff_hunk" : "@@ -195,3 +199,14 @@ bool CZMQPublishRawTransactionNotifier::NotifyTransaction(const CTransaction &tr\n     ss << transaction;\n     return SendMessage(MSG_RAWTX, &(*ss.begin()), ss.size());\n }\n+\n+bool CZMQPublishDecodedTransactionNotifier::NotifyTransaction(const CTransaction &transaction)\n+{\n+    uint256 hash = transaction.GetHash();\n+    LogPrint(BCLog::ZMQ, \"zmq: Publish decodedtx %s\\n\", hash.GetHex());\n+    UniValue result(UniValue::VOBJ);\n+    TxToUniv(transaction, uint256(), result, false);\n+    CDataStream ss(SER_NETWORK, PROTOCOL_VERSION | RPCSerializationFlags());\n+    ss << result.write();\n+    return SendMessage(MSG_DECODEDTX, &(*ss.begin()), ss.size());\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148977987",
      "id" : 148977987,
      "original_commit_id" : "0568067ba0649c21bca363f567bc5f55de48d291",
      "original_position" : 36,
      "path" : "src/zmq/zmqpublishnotifier.cpp",
      "position" : null,
      "pull_request_review_id" : 74301330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614",
      "updated_at" : "2017-11-06T02:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148977987",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978040"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove raw? Same below.",
      "commit_id" : "740841e7dfa774407dd44b27f5d4ae3fdc56f22d",
      "created_at" : "2017-11-06T00:50:58Z",
      "diff_hunk" : "@@ -88,6 +90,9 @@ def _zmq_test(self):\n         self.sync_all()\n \n         for x in range(num_blocks):\n+            # Should receive the json broadcasted raw transaction.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978040",
      "id" : 148978040,
      "original_commit_id" : "0568067ba0649c21bca363f567bc5f55de48d291",
      "original_position" : 23,
      "path" : "test/functional/zmq_test.py",
      "position" : null,
      "pull_request_review_id" : 74301330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614",
      "updated_at" : "2017-11-06T02:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978040",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978104"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Have you tried `TxToJSON`?",
      "commit_id" : "740841e7dfa774407dd44b27f5d4ae3fdc56f22d",
      "created_at" : "2017-11-06T00:52:52Z",
      "diff_hunk" : "@@ -195,3 +199,14 @@ bool CZMQPublishRawTransactionNotifier::NotifyTransaction(const CTransaction &tr\n     ss << transaction;\n     return SendMessage(MSG_RAWTX, &(*ss.begin()), ss.size());\n }\n+\n+bool CZMQPublishDecodedTransactionNotifier::NotifyTransaction(const CTransaction &transaction)\n+{\n+    uint256 hash = transaction.GetHash();\n+    LogPrint(BCLog::ZMQ, \"zmq: Publish decodedtx %s\\n\", hash.GetHex());\n+    UniValue result(UniValue::VOBJ);\n+    TxToUniv(transaction, uint256(), result, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978104",
      "id" : 148978104,
      "original_commit_id" : "0568067ba0649c21bca363f567bc5f55de48d291",
      "original_position" : 32,
      "path" : "src/zmq/zmqpublishnotifier.cpp",
      "position" : 31,
      "pull_request_review_id" : 74301330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614",
      "updated_at" : "2017-11-06T02:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978104",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978122"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978122"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, sort includes.",
      "commit_id" : "740841e7dfa774407dd44b27f5d4ae3fdc56f22d",
      "created_at" : "2017-11-06T00:53:21Z",
      "diff_hunk" : "@@ -9,13 +9,17 @@\n #include \"validation.h\"\n #include \"util.h\"\n #include \"rpc/server.h\"\n+#include \"rpc/protocol.h\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978122",
      "id" : 148978122,
      "original_commit_id" : "0568067ba0649c21bca363f567bc5f55de48d291",
      "original_position" : 4,
      "path" : "src/zmq/zmqpublishnotifier.cpp",
      "position" : null,
      "pull_request_review_id" : 74301330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614",
      "updated_at" : "2017-11-06T02:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978122",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978190"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, sort.",
      "commit_id" : "740841e7dfa774407dd44b27f5d4ae3fdc56f22d",
      "created_at" : "2017-11-06T00:55:17Z",
      "diff_hunk" : "@@ -9,13 +9,17 @@\n #include \"validation.h\"\n #include \"util.h\"\n #include \"rpc/server.h\"\n+#include \"rpc/protocol.h\"\n+#include <univalue.h>\n+#include \"core_io.h\"\n \n static std::multimap<std::string, CZMQAbstractPublishNotifier*> mapPublishNotifiers;\n \n-static const char *MSG_HASHBLOCK = \"hashblock\";\n-static const char *MSG_HASHTX    = \"hashtx\";\n-static const char *MSG_RAWBLOCK  = \"rawblock\";\n-static const char *MSG_RAWTX     = \"rawtx\";\n+static const char *MSG_HASHBLOCK     = \"hashblock\";\n+static const char *MSG_HASHTX        = \"hashtx\";\n+static const char *MSG_RAWBLOCK      = \"rawblock\";\n+static const char *MSG_RAWTX         = \"rawtx\";\n+static const char *MSG_DECODEDTX     = \"decodedtx\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978190",
      "id" : 148978190,
      "original_commit_id" : "0568067ba0649c21bca363f567bc5f55de48d291",
      "original_position" : 18,
      "path" : "src/zmq/zmqpublishnotifier.cpp",
      "position" : null,
      "pull_request_review_id" : 74301330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614",
      "updated_at" : "2017-11-06T02:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978190",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978207"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978207"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Care to explain the offset?",
      "commit_id" : "740841e7dfa774407dd44b27f5d4ae3fdc56f22d",
      "created_at" : "2017-11-06T00:55:47Z",
      "diff_hunk" : "@@ -109,6 +114,10 @@ def _zmq_test(self):\n         payment_txid = self.nodes[1].sendtoaddress(self.nodes[0].getnewaddress(), 1.0)\n         self.sync_all()\n \n+        # Should receive the json broadcasted raw transaction.\n+        decodedtx = self.decodedtx.receive()\n+        assert_equal(payment_txid, json.loads(decodedtx[3:])['txid'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148978207",
      "id" : 148978207,
      "original_commit_id" : "0568067ba0649c21bca363f567bc5f55de48d291",
      "original_position" : 35,
      "path" : "test/functional/zmq_test.py",
      "position" : null,
      "pull_request_review_id" : 74301330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614",
      "updated_at" : "2017-11-06T02:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148978207",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148982778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148982778"
         }
      },
      "author_association" : "NONE",
      "body" : "`TxToJSON` just calls `TxToUniv` internally, and also adds that extra `hashBlock` check, which is not strictly necessary imo. If we think that extra info would be useful though (confirmations, time, blocktime, blockhash), we can try to get the block hash beforehand and switch to using this method.",
      "commit_id" : "740841e7dfa774407dd44b27f5d4ae3fdc56f22d",
      "created_at" : "2017-11-06T02:21:43Z",
      "diff_hunk" : "@@ -195,3 +199,14 @@ bool CZMQPublishRawTransactionNotifier::NotifyTransaction(const CTransaction &tr\n     ss << transaction;\n     return SendMessage(MSG_RAWTX, &(*ss.begin()), ss.size());\n }\n+\n+bool CZMQPublishDecodedTransactionNotifier::NotifyTransaction(const CTransaction &transaction)\n+{\n+    uint256 hash = transaction.GetHash();\n+    LogPrint(BCLog::ZMQ, \"zmq: Publish decodedtx %s\\n\", hash.GetHex());\n+    UniValue result(UniValue::VOBJ);\n+    TxToUniv(transaction, uint256(), result, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148982778",
      "id" : 148982778,
      "in_reply_to_id" : 148978104,
      "original_commit_id" : "0568067ba0649c21bca363f567bc5f55de48d291",
      "original_position" : 32,
      "path" : "src/zmq/zmqpublishnotifier.cpp",
      "position" : 31,
      "pull_request_review_id" : 74306928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614",
      "updated_at" : "2017-11-06T02:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148982778",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/280996?v=4",
         "events_url" : "https://api.github.com/users/astanway/events{/privacy}",
         "followers_url" : "https://api.github.com/users/astanway/followers",
         "following_url" : "https://api.github.com/users/astanway/following{/other_user}",
         "gists_url" : "https://api.github.com/users/astanway/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/astanway",
         "id" : 280996,
         "login" : "astanway",
         "organizations_url" : "https://api.github.com/users/astanway/orgs",
         "received_events_url" : "https://api.github.com/users/astanway/received_events",
         "repos_url" : "https://api.github.com/users/astanway/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/astanway/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/astanway/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/astanway"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148982851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148982851"
         }
      },
      "author_association" : "NONE",
      "body" : "Looks like it was some kind of header added by `CDataStream` - I'm not entirely sure, tbh. I switched it over to a vanilla string and char array and the offset went away.",
      "commit_id" : "740841e7dfa774407dd44b27f5d4ae3fdc56f22d",
      "created_at" : "2017-11-06T02:23:15Z",
      "diff_hunk" : "@@ -109,6 +114,10 @@ def _zmq_test(self):\n         payment_txid = self.nodes[1].sendtoaddress(self.nodes[0].getnewaddress(), 1.0)\n         self.sync_all()\n \n+        # Should receive the json broadcasted raw transaction.\n+        decodedtx = self.decodedtx.receive()\n+        assert_equal(payment_txid, json.loads(decodedtx[3:])['txid'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11614#discussion_r148982851",
      "id" : 148982851,
      "in_reply_to_id" : 148978207,
      "original_commit_id" : "0568067ba0649c21bca363f567bc5f55de48d291",
      "original_position" : 35,
      "path" : "test/functional/zmq_test.py",
      "position" : null,
      "pull_request_review_id" : 74307012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11614",
      "updated_at" : "2017-11-06T02:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/148982851",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/280996?v=4",
         "events_url" : "https://api.github.com/users/astanway/events{/privacy}",
         "followers_url" : "https://api.github.com/users/astanway/followers",
         "following_url" : "https://api.github.com/users/astanway/following{/other_user}",
         "gists_url" : "https://api.github.com/users/astanway/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/astanway",
         "id" : 280996,
         "login" : "astanway",
         "organizations_url" : "https://api.github.com/users/astanway/orgs",
         "received_events_url" : "https://api.github.com/users/astanway/received_events",
         "repos_url" : "https://api.github.com/users/astanway/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/astanway/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/astanway/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/astanway"
      }
   }
]
