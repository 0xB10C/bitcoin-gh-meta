[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased.",
      "created_at" : "2017-12-15T22:10:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#issuecomment-352124547",
      "id" : 352124547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11639",
      "updated_at" : "2017-12-15T22:10:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352124547",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r158033628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158033628"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Also BOOST_CHECK_EQUAL?",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2017-12-20T14:15:55Z",
      "diff_hunk" : "@@ -53,9 +53,8 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK(state.IsInvalid());\n     BOOST_CHECK_EQUAL(state.GetRejectReason(), \"coinbase\");\n \n-    int nDoS;\n-    BOOST_CHECK_EQUAL(state.IsInvalid(nDoS), true);\n-    BOOST_CHECK_EQUAL(nDoS, 100);\n+    BOOST_CHECK_EQUAL(state.IsInvalid(), true);\n+    BOOST_CHECK(state.GetReason() == ValidationInvalidReason::CONSENSUS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r158033628",
      "id" : 158033628,
      "original_commit_id" : "09dca76d6769cd3f1c8954f649fac5fd4c88c1a2",
      "original_position" : 8,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : 8,
      "pull_request_review_id" : 84774914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-01-09T22:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158033628",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r158036096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158036096"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Make it `CONSENSUS` only if `NOT_STANDARD`? I know that atm only those 2 are set but, imo, it's more clear to do so inside that condition:\r\n```cpp\r\nif (state.GetReason() == ValidationInvalidReason::NOT_STANDARD) {\r\n    state.Invalid(ValidationInvalidReason::CONSENSUS, ...);\r\n}\r\n```\r\nThe same happens in line 1951.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2017-12-20T14:25:50Z",
      "diff_hunk" : "@@ -1906,11 +1907,15 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         {\n             CAmount txfee = 0;\n             if (!Consensus::CheckTxInputs(tx, state, view, pindex->nHeight, txfee)) {\n+                // CheckTxInputs may return MISSING_INPUTS but we can't return that, as\n+                // its nonsense for a block, so we reset the reason flag to CONSENSUS here.\n+                state.Invalid(ValidationInvalidReason::CONSENSUS, false,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r158036096",
      "id" : 158036096,
      "original_commit_id" : "09dca76d6769cd3f1c8954f649fac5fd4c88c1a2",
      "original_position" : 244,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 84774914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-01-09T22:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158036096",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r158605611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158605611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Doesn't compile as GetReason() can't be printed.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2017-12-24T16:27:58Z",
      "diff_hunk" : "@@ -53,9 +53,8 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK(state.IsInvalid());\n     BOOST_CHECK_EQUAL(state.GetRejectReason(), \"coinbase\");\n \n-    int nDoS;\n-    BOOST_CHECK_EQUAL(state.IsInvalid(nDoS), true);\n-    BOOST_CHECK_EQUAL(nDoS, 100);\n+    BOOST_CHECK_EQUAL(state.IsInvalid(), true);\n+    BOOST_CHECK(state.GetReason() == ValidationInvalidReason::CONSENSUS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r158605611",
      "id" : 158605611,
      "in_reply_to_id" : 158033628,
      "original_commit_id" : "09dca76d6769cd3f1c8954f649fac5fd4c88c1a2",
      "original_position" : 8,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : 8,
      "pull_request_review_id" : 85444994,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-01-09T22:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158605611",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r158605955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158605955"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2017-12-24T16:45:29Z",
      "diff_hunk" : "@@ -1906,11 +1907,15 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         {\n             CAmount txfee = 0;\n             if (!Consensus::CheckTxInputs(tx, state, view, pindex->nHeight, txfee)) {\n+                // CheckTxInputs may return MISSING_INPUTS but we can't return that, as\n+                // its nonsense for a block, so we reset the reason flag to CONSENSUS here.\n+                state.Invalid(ValidationInvalidReason::CONSENSUS, false,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r158605955",
      "id" : 158605955,
      "in_reply_to_id" : 158036096,
      "original_commit_id" : "09dca76d6769cd3f1c8954f649fac5fd4c88c1a2",
      "original_position" : 244,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 85445303,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-01-09T22:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/158605955",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r160381451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160381451"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ATM `CheckTxInputs` set `MISSING_INPUTS` and `CONSENSUS` reasons and only makes sense to override when reason is `MISSING_INPUTS`:\r\n```cpp\r\nif (state.GetReason() == ValidationInvalidReason::MISSING_INPUTS) {\r\n    state.Invalid(ValidationInvalidReason::CONSENSUS, ...);\r\n}\r\n```\r\n  ",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-01-09T11:27:02Z",
      "diff_hunk" : "@@ -1906,11 +1907,15 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         {\n             CAmount txfee = 0;\n             if (!Consensus::CheckTxInputs(tx, state, view, pindex->nHeight, txfee)) {\n+                // CheckTxInputs may return MISSING_INPUTS but we can't return that, as\n+                // its nonsense for a block, so we reset the reason flag to CONSENSUS here.\n+                state.Invalid(ValidationInvalidReason::CONSENSUS, false,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r160381451",
      "id" : 160381451,
      "in_reply_to_id" : 158036096,
      "original_commit_id" : "09dca76d6769cd3f1c8954f649fac5fd4c88c1a2",
      "original_position" : 244,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 87486202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-01-09T22:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160381451",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r160383713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160383713"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`ValidationInvalidReason::NONE` instead?\r\n  ",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-01-09T11:38:26Z",
      "diff_hunk" : "@@ -22,6 +22,32 @@ static const unsigned char REJECT_NONSTANDARD = 0x40;\n static const unsigned char REJECT_INSUFFICIENTFEE = 0x42;\n static const unsigned char REJECT_CHECKPOINT = 0x43;\n \n+/** A \"reason\" why something was invalid, suitable for (possibly) getting angry\n+  * (and retaliating) at the provider of the object in question (ie banning\n+  * peers).\n+  * These are much more granular than the rejection codes, which may be more\n+  * useful for some other use-cases.\n+  */\n+enum class ValidationInvalidReason {\n+    // txn and blocks:\n+    VALID,           //!< not actually invalid",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r160383713",
      "id" : 160383713,
      "original_commit_id" : "2a117b2cc3a9a257f30312841f5d3f126d631cb7",
      "original_position" : 12,
      "path" : "src/consensus/validation.h",
      "position" : null,
      "pull_request_review_id" : 87486202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-01-09T22:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160383713",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r160538094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160538094"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Errrr....fixed, actually this time.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-01-09T22:04:24Z",
      "diff_hunk" : "@@ -1906,11 +1907,15 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         {\n             CAmount txfee = 0;\n             if (!Consensus::CheckTxInputs(tx, state, view, pindex->nHeight, txfee)) {\n+                // CheckTxInputs may return MISSING_INPUTS but we can't return that, as\n+                // its nonsense for a block, so we reset the reason flag to CONSENSUS here.\n+                state.Invalid(ValidationInvalidReason::CONSENSUS, false,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r160538094",
      "id" : 160538094,
      "in_reply_to_id" : 158036096,
      "original_commit_id" : "09dca76d6769cd3f1c8954f649fac5fd4c88c1a2",
      "original_position" : 244,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 87673566,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-01-09T22:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160538094",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r160538115"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160538115"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sure, sounds good.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-01-09T22:04:30Z",
      "diff_hunk" : "@@ -22,6 +22,32 @@ static const unsigned char REJECT_NONSTANDARD = 0x40;\n static const unsigned char REJECT_INSUFFICIENTFEE = 0x42;\n static const unsigned char REJECT_CHECKPOINT = 0x43;\n \n+/** A \"reason\" why something was invalid, suitable for (possibly) getting angry\n+  * (and retaliating) at the provider of the object in question (ie banning\n+  * peers).\n+  * These are much more granular than the rejection codes, which may be more\n+  * useful for some other use-cases.\n+  */\n+enum class ValidationInvalidReason {\n+    // txn and blocks:\n+    VALID,           //!< not actually invalid",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r160538115",
      "id" : 160538115,
      "in_reply_to_id" : 160383713,
      "original_commit_id" : "2a117b2cc3a9a257f30312841f5d3f126d631cb7",
      "original_position" : 12,
      "path" : "src/consensus/validation.h",
      "position" : null,
      "pull_request_review_id" : 87673597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-01-09T22:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160538115",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171021132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171021132"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The arguments don't match here:\r\n```\r\nvalidation.cpp:1921:79: error: no viable conversion from 'std::string' (aka 'basic_string<char, char_traits<char>, allocator<char> >') to 'bool'\r\n                              state.GetRejectCode(), state.GetRejectReason(), state.GetDebugMessage());\r\n```\r\nbut more generally I think this would be a lot more readable if we could just add an explicit way to set the invalid reason on a CValidationState, rather than invoke DoS() in this way (here and elsewhere as well).",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-02-27T18:30:07Z",
      "diff_hunk" : "@@ -1906,11 +1914,17 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         {\n             CAmount txfee = 0;\n             if (!Consensus::CheckTxInputs(tx, state, view, pindex->nHeight, txfee)) {\n+                if (state.GetReason() == ValidationInvalidReason::MISSING_INPUTS) {\n+                    // CheckTxInputs may return MISSING_INPUTS but we can't return that, as\n+                    // its nonsense for a block, so we reset the reason flag to CONSENSUS here.\n+                    state.DoS(state.GetDoS(), ValidationInvalidReason::CONSENSUS, false,\n+                              state.GetRejectCode(), state.GetRejectReason(), state.GetDebugMessage());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171021132",
      "id" : 171021132,
      "original_commit_id" : "0272d2e808024ccf14afef236b673dad9ae0bdd5",
      "original_position" : 230,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 99801359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-02-27T18:30:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171021132",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171022331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171022331"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't quite understand this comment?",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-02-27T18:34:21Z",
      "diff_hunk" : "@@ -765,6 +765,73 @@ void Misbehaving(NodeId pnode, int howmuch)\n         LogPrintf(\"%s: %s peer=%d (%d -> %d)\\n\", __func__, state->name, pnode, state->nMisbehavior-howmuch, state->nMisbehavior);\n }\n \n+/**\n+ * Returns true if the given validation state result may result in us banning/disconnecting a peer\n+ * which provided such an object. This is used to determine whether to relay transactions to\n+ * whitelisted peers, preventing us from relaying things which would result in them disconnecting\n+ * us.\n+ */\n+static bool MayResultInDisconnect(const CValidationState& state, bool via_compact_block) {\n+    switch (state.GetReason()) {\n+    case ValidationInvalidReason::NONE:\n+        return false;\n+    // The node is mean:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171022331",
      "id" : 171022331,
      "original_commit_id" : "4781a3d3ce12182edf3c686b008ea7066ed5dc66",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 99802794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-02-27T20:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171022331",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171022830"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171022830"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I personally find this fall-through for the non-compact block case harder to follow and more fragile than having each case end with a return or break.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-02-27T18:36:09Z",
      "diff_hunk" : "@@ -765,6 +765,73 @@ void Misbehaving(NodeId pnode, int howmuch)\n         LogPrintf(\"%s: %s peer=%d (%d -> %d)\\n\", __func__, state->name, pnode, state->nMisbehavior-howmuch, state->nMisbehavior);\n }\n \n+/**\n+ * Returns true if the given validation state result may result in us banning/disconnecting a peer\n+ * which provided such an object. This is used to determine whether to relay transactions to\n+ * whitelisted peers, preventing us from relaying things which would result in them disconnecting\n+ * us.\n+ */\n+static bool MayResultInDisconnect(const CValidationState& state, bool via_compact_block) {\n+    switch (state.GetReason()) {\n+    case ValidationInvalidReason::NONE:\n+        return false;\n+    // The node is mean:\n+    case ValidationInvalidReason::CONSENSUS:\n+    case ValidationInvalidReason::MUTATED:\n+    case ValidationInvalidReason::UNKNOWN_INVALID: // Really \"duplicate of invalid \"\n+        if (via_compact_block) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171022830",
      "id" : 171022830,
      "original_commit_id" : "4781a3d3ce12182edf3c686b008ea7066ed5dc66",
      "original_position" : 18,
      "path" : "src/net_processing.cpp",
      "position" : 18,
      "pull_request_review_id" : 99802794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-02-27T20:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171022830",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171033168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171033168"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this should probably be CONSENSUS rather than SOFT_FORK.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-02-27T19:09:23Z",
      "diff_hunk" : "@@ -1866,7 +1874,7 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         for (const auto& tx : block.vtx) {\n             for (size_t o = 0; o < tx->vout.size(); o++) {\n                 if (view.HaveCoin(COutPoint(tx->GetHash(), o))) {\n-                    return state.DoS(100, error(\"ConnectBlock(): tried to overwrite transaction\"),\n+                    return state.DoS(100, ValidationInvalidReason::SOFT_FORK, error(\"ConnectBlock(): tried to overwrite transaction\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171033168",
      "id" : 171033168,
      "original_commit_id" : "0272d2e808024ccf14afef236b673dad9ae0bdd5",
      "original_position" : 218,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 99802794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-02-27T20:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171033168",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171035667"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171035667"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that this could be \"SOFT_FORK\" (BIP 113).  But as I wrote elsewhere I think we should just use CONSENSUS everywhere in place of SOFT_FORK, for now.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-02-27T19:16:57Z",
      "diff_hunk" : "@@ -3136,7 +3164,7 @@ static bool ContextualCheckBlock(const CBlock& block, CValidationState& state, c\n     // Check that all transactions are finalized\n     for (const auto& tx : block.vtx) {\n         if (!IsFinalTx(*tx, nHeight, nLockTimeCutoff)) {\n-            return state.DoS(10, false, REJECT_INVALID, \"bad-txns-nonfinal\", false, \"non-final transaction\");\n+            return state.DoS(10, ValidationInvalidReason::CONSENSUS, false, REJECT_INVALID, \"bad-txns-nonfinal\", false, \"non-final transaction\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171035667",
      "id" : 171035667,
      "original_commit_id" : "0272d2e808024ccf14afef236b673dad9ae0bdd5",
      "original_position" : 404,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 99802794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-02-27T20:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171035667",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171036526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171036526"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If we're going to use this line of reasoning, then I think we may as well also not use SOFT_FORK anywhere else either (at least for invalid blocks, perhaps loose transactions should be different) -- presumably no nodes that support segwit validation should be unaware of any of the prior soft forks.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-02-27T19:19:45Z",
      "diff_hunk" : "@@ -3194,7 +3222,9 @@ static bool ContextualCheckBlock(const CBlock& block, CValidationState& state, c\n     // the block hash, so we couldn't mark the block as permanently\n     // failed).\n     if (GetBlockWeight(block) > MAX_BLOCK_WEIGHT) {\n-        return state.DoS(100, false, REJECT_INVALID, \"bad-blk-weight\", false, strprintf(\"%s : weight limit failed\", __func__));\n+        // We can call this a consensus failure as any data-providers who provided\n+        // us with witness data can be expected to support SegWit validation.\n+        return state.DoS(100, ValidationInvalidReason::CONSENSUS, false, REJECT_INVALID, \"bad-blk-weight\", false, strprintf(\"%s : weight limit failed\", __func__));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171036526",
      "id" : 171036526,
      "original_commit_id" : "0272d2e808024ccf14afef236b673dad9ae0bdd5",
      "original_position" : 447,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 99802794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-02-27T20:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171036526",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171042519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171042519"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1) As all parallel-validation script failures are SOFT_FORK further down, I think we ought to make the non-parallel validation case be the same, rather than filter for NOT_STANDARD first.\r\n2) Since our blocks are only coming from segwit peers, I actually think we should just change all these to CONSENSUS anyway, and leave a comment explaining that when we deploy a new soft fork, we need to be careful about not splitting the network.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-02-27T19:39:27Z",
      "diff_hunk" : "@@ -1934,17 +1948,25 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         // * witness (when witness enabled in flags and excludes coinbase)\n         nSigOpsCost += GetTransactionSigOpCost(tx, view, flags);\n         if (nSigOpsCost > MAX_BLOCK_SIGOPS_COST)\n-            return state.DoS(100, error(\"ConnectBlock(): too many sigops\"),\n+            return state.DoS(100, ValidationInvalidReason::SOFT_FORK, error(\"ConnectBlock(): too many sigops\"),\n                              REJECT_INVALID, \"bad-blk-sigops\");\n \n         txdata.emplace_back(tx);\n         if (!tx.IsCoinBase())\n         {\n             std::vector<CScriptCheck> vChecks;\n             bool fCacheResults = fJustCheck; /* Don't cache results if we're actually connecting blocks (still consult the cache, though) */\n-            if (!CheckInputs(tx, state, view, fScriptChecks, flags, fCacheResults, fCacheResults, txdata[i], nScriptCheckThreads ? &vChecks : nullptr))\n+            if (!CheckInputs(tx, state, view, fScriptChecks, flags, fCacheResults, fCacheResults, txdata[i], nScriptCheckThreads ? &vChecks : nullptr)) {\n+                if (state.GetReason() == ValidationInvalidReason::NOT_STANDARD) {\n+                    // CheckInputs may return NOT_STANDARD for extra flags we passed,\n+                    // but we can't return that, as its nonsense, so we reset the\n+                    // reason flag to SOFT_FORK here.\n+                    state.DoS(state.GetDoS(), ValidationInvalidReason::SOFT_FORK, false,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171042519",
      "id" : 171042519,
      "original_commit_id" : "0272d2e808024ccf14afef236b673dad9ae0bdd5",
      "original_position" : 269,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 99802794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-02-27T20:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171042519",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171045987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171045987"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not really obvious here why we use MUTATED rather than WITNESS_MUTATED, here and in the next few lines (other than needing to match the code in InvalidBlockFound() and AcceptBlock(), which only check against MUTATED). Perhaps add a comment explaining the usage somewhere?",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-02-27T19:51:26Z",
      "diff_hunk" : "@@ -3168,11 +3189,11 @@ static bool ContextualCheckBlock(const CBlock& block, CValidationState& state, c\n             // already does not permit it, it is impossible to trigger in the\n             // witness tree.\n             if (block.vtx[0]->vin[0].scriptWitness.stack.size() != 1 || block.vtx[0]->vin[0].scriptWitness.stack[0].size() != 32) {\n-                return state.DoS(100, false, REJECT_INVALID, \"bad-witness-nonce-size\", true, strprintf(\"%s : invalid witness nonce size\", __func__));\n+                return state.Invalid(ValidationInvalidReason::MUTATED, false, REJECT_INVALID, \"bad-witness-nonce-size\", strprintf(\"%s : invalid witness nonce size\", __func__));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171045987",
      "id" : 171045987,
      "original_commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "original_position" : 447,
      "path" : "src/validation.cpp",
      "position" : 447,
      "pull_request_review_id" : 99802794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-02-27T20:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171045987",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171877060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171877060"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We should figure out where we want to draw a line between CONSENSUS (ban the peer) and SOFT_FORK (ignore the peer). Obviously this case *is* a SOFT_FORK, but at this point its so old that it may not be worth keeping that distinction. I aired on the side of \"let any node, no matter how old, not get banned\" in general.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-03-02T15:29:26Z",
      "diff_hunk" : "@@ -1866,7 +1874,7 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         for (const auto& tx : block.vtx) {\n             for (size_t o = 0; o < tx->vout.size(); o++) {\n                 if (view.HaveCoin(COutPoint(tx->GetHash(), o))) {\n-                    return state.DoS(100, error(\"ConnectBlock(): tried to overwrite transaction\"),\n+                    return state.DoS(100, ValidationInvalidReason::SOFT_FORK, error(\"ConnectBlock(): tried to overwrite transaction\"),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171877060",
      "id" : 171877060,
      "in_reply_to_id" : 171033168,
      "original_commit_id" : "0272d2e808024ccf14afef236b673dad9ae0bdd5",
      "original_position" : 218,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 100811060,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-03-02T15:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171877060",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171877364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171877364"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "WITNESS_MUTATED is only for transactions. In the future we could separate out the InvalidReason into two different ones for transactions/blocks.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-03-02T15:30:27Z",
      "diff_hunk" : "@@ -3168,11 +3189,11 @@ static bool ContextualCheckBlock(const CBlock& block, CValidationState& state, c\n             // already does not permit it, it is impossible to trigger in the\n             // witness tree.\n             if (block.vtx[0]->vin[0].scriptWitness.stack.size() != 1 || block.vtx[0]->vin[0].scriptWitness.stack[0].size() != 32) {\n-                return state.DoS(100, false, REJECT_INVALID, \"bad-witness-nonce-size\", true, strprintf(\"%s : invalid witness nonce size\", __func__));\n+                return state.Invalid(ValidationInvalidReason::MUTATED, false, REJECT_INVALID, \"bad-witness-nonce-size\", strprintf(\"%s : invalid witness nonce size\", __func__));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171877364",
      "id" : 171877364,
      "in_reply_to_id" : 171045987,
      "original_commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "original_position" : 447,
      "path" : "src/validation.cpp",
      "position" : 447,
      "pull_request_review_id" : 100811440,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-03-02T15:30:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171877364",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171878154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171878154"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Huh? Doing so would break the ability of a pre-segwit node to provide us a non-segwit-but-valid block. Further, this line of reasoning does *not* assume that we only download blocks from segwit-enabled peers (which may be the case in practice in our current net layer, but making that assumption strong in validation seems bad). The line of reasoning here is only applicable to nodes that *provided* the witness, not nodes that (for some reason) does not.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-03-02T15:33:12Z",
      "diff_hunk" : "@@ -3194,7 +3222,9 @@ static bool ContextualCheckBlock(const CBlock& block, CValidationState& state, c\n     // the block hash, so we couldn't mark the block as permanently\n     // failed).\n     if (GetBlockWeight(block) > MAX_BLOCK_WEIGHT) {\n-        return state.DoS(100, false, REJECT_INVALID, \"bad-blk-weight\", false, strprintf(\"%s : weight limit failed\", __func__));\n+        // We can call this a consensus failure as any data-providers who provided\n+        // us with witness data can be expected to support SegWit validation.\n+        return state.DoS(100, ValidationInvalidReason::CONSENSUS, false, REJECT_INVALID, \"bad-blk-weight\", false, strprintf(\"%s : weight limit failed\", __func__));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171878154",
      "id" : 171878154,
      "in_reply_to_id" : 171036526,
      "original_commit_id" : "0272d2e808024ccf14afef236b673dad9ae0bdd5",
      "original_position" : 447,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 100812379,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-03-02T15:33:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171878154",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171878581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171878581"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm confused. The NOT_STANDARD return here is to keep behavior the same for transactions as well as blocks. NOT_STANDARD is not a valid response for block ValidationReasons, so we have to swap it here.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-03-02T15:34:51Z",
      "diff_hunk" : "@@ -1934,17 +1948,25 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         // * witness (when witness enabled in flags and excludes coinbase)\n         nSigOpsCost += GetTransactionSigOpCost(tx, view, flags);\n         if (nSigOpsCost > MAX_BLOCK_SIGOPS_COST)\n-            return state.DoS(100, error(\"ConnectBlock(): too many sigops\"),\n+            return state.DoS(100, ValidationInvalidReason::SOFT_FORK, error(\"ConnectBlock(): too many sigops\"),\n                              REJECT_INVALID, \"bad-blk-sigops\");\n \n         txdata.emplace_back(tx);\n         if (!tx.IsCoinBase())\n         {\n             std::vector<CScriptCheck> vChecks;\n             bool fCacheResults = fJustCheck; /* Don't cache results if we're actually connecting blocks (still consult the cache, though) */\n-            if (!CheckInputs(tx, state, view, fScriptChecks, flags, fCacheResults, fCacheResults, txdata[i], nScriptCheckThreads ? &vChecks : nullptr))\n+            if (!CheckInputs(tx, state, view, fScriptChecks, flags, fCacheResults, fCacheResults, txdata[i], nScriptCheckThreads ? &vChecks : nullptr)) {\n+                if (state.GetReason() == ValidationInvalidReason::NOT_STANDARD) {\n+                    // CheckInputs may return NOT_STANDARD for extra flags we passed,\n+                    // but we can't return that, as its nonsense, so we reset the\n+                    // reason flag to SOFT_FORK here.\n+                    state.DoS(state.GetDoS(), ValidationInvalidReason::SOFT_FORK, false,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r171878581",
      "id" : 171878581,
      "in_reply_to_id" : 171042519,
      "original_commit_id" : "0272d2e808024ccf14afef236b673dad9ae0bdd5",
      "original_position" : 269,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 100812909,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-03-02T15:34:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/171878581",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Commented on the points I disagreed with, I obviously strongly disagree about making assumptions about the net_processing layer in validation, as that's been one of my overarching goals over the past few years. Will address the other points when I get a chance to rebase.",
      "created_at" : "2018-03-02T15:35:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#issuecomment-369954899",
      "id" : 369954899,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11639",
      "updated_at" : "2018-03-02T15:35:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/369954899",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r172050340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172050340"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Re 1), I'm just saying that we should always rewrite the reason to be the same as we'd get if we did parallel validation (which is SOFT_FORK in this PR currently), versus only return SOFT_FORK if the reason was NOT_STANDARD.  It doesn't really make sense for ConnectBlock() to behave differently with regard to error codes if using single vs parallel script checking.",
      "commit_id" : "f2c33c3f19bf88064d38e4c7c02a8a4eb55fbb71",
      "created_at" : "2018-03-04T14:23:05Z",
      "diff_hunk" : "@@ -1934,17 +1948,25 @@ bool CChainState::ConnectBlock(const CBlock& block, CValidationState& state, CBl\n         // * witness (when witness enabled in flags and excludes coinbase)\n         nSigOpsCost += GetTransactionSigOpCost(tx, view, flags);\n         if (nSigOpsCost > MAX_BLOCK_SIGOPS_COST)\n-            return state.DoS(100, error(\"ConnectBlock(): too many sigops\"),\n+            return state.DoS(100, ValidationInvalidReason::SOFT_FORK, error(\"ConnectBlock(): too many sigops\"),\n                              REJECT_INVALID, \"bad-blk-sigops\");\n \n         txdata.emplace_back(tx);\n         if (!tx.IsCoinBase())\n         {\n             std::vector<CScriptCheck> vChecks;\n             bool fCacheResults = fJustCheck; /* Don't cache results if we're actually connecting blocks (still consult the cache, though) */\n-            if (!CheckInputs(tx, state, view, fScriptChecks, flags, fCacheResults, fCacheResults, txdata[i], nScriptCheckThreads ? &vChecks : nullptr))\n+            if (!CheckInputs(tx, state, view, fScriptChecks, flags, fCacheResults, fCacheResults, txdata[i], nScriptCheckThreads ? &vChecks : nullptr)) {\n+                if (state.GetReason() == ValidationInvalidReason::NOT_STANDARD) {\n+                    // CheckInputs may return NOT_STANDARD for extra flags we passed,\n+                    // but we can't return that, as its nonsense, so we reset the\n+                    // reason flag to SOFT_FORK here.\n+                    state.DoS(state.GetDoS(), ValidationInvalidReason::SOFT_FORK, false,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#discussion_r172050340",
      "id" : 172050340,
      "in_reply_to_id" : 171042519,
      "original_commit_id" : "0272d2e808024ccf14afef236b673dad9ae0bdd5",
      "original_position" : 269,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 101007263,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11639",
      "updated_at" : "2018-03-04T14:23:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172050340",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The more I think about this, the more I think we should drop the distinction between \"SOFT_FORK\" and \"CONSENSUS\" altogether.  At least when it comes to block processing, the only concept that matters is CONSENSUS.\r\n\r\nThe reason we care to distinguish SOFT_FORK from CONSENSUS is to highlight recent rule changes that our peers may not know about, so that the net_processing layer can optionally do something different for SOFT_FORK violations than it would do for CONSENSUS violations.  However I don't think this is a terribly meaningful distinction.  The main goals of the net_processing/net layers, with respect to these validation issues, is:\r\n * keep us connected to the honest network\r\n * prevent attackers from DoS'ing us\r\n * don't needlessly partition old nodes that have fallen back to SPV security because they're unaware of the consensus rules\r\n\r\nSo what is our strategy for each of these points?  For keeping us connected to the honest network, I think we mainly rely on having robust outbound peers -- any outbound peer that is not enforcing all the consensus rules should be disconnected.  Combined with the mitigations we deployed last fall for outbound peers whose tips aren't keeping up, and for protection in the case that our tip hasn't advanced in a while, I believe this is sufficient.  (See https://gist.github.com/sdaftuar/c2a3320c751efb078a7c1fd834036cb0 for more details around my thinking here.)\r\n\r\nFor not needlessly partitioning old nodes -- I think it's sufficient to not disconnect inbound peers that relay blocks that violate consensus rules, regardless of whether the rule is a recent soft fork or not.\r\n\r\nAnd to prevent DoS -- I think we just ensure that any blocks have valid proof-of-work, combined with protections against processing blocks that are too far behind our tip (or on a too-little-work-chain).\r\n\r\nIn all of these cases, I don't think we need to distinguish \"SOFT_FORK\" from \"CONSENSUS\".  And as its pretty arbitrary about when to decide to move something from the SOFT_FORK designation to CONSENSUS, I think we may as well not bother.",
      "created_at" : "2018-03-04T14:38:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11639#issuecomment-370234133",
      "id" : 370234133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11639",
      "updated_at" : "2018-03-04T14:39:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370234133",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
