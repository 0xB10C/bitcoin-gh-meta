[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17219#discussion_r337701626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337701626"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@instagibbs wrote:\r\n> At the risk of making the error message less precise, I think this whole block is easier to read if it just relies on `GetReservedDestination` to check if `CanGetAddress` is true or not. You also can just not store `ret` and use it directly in the conditional.",
      "commit_id" : "b2da2d9e56307f6a32ba6a39c293358580a2a91f",
      "created_at" : "2019-10-22T19:14:47Z",
      "diff_hunk" : "@@ -2980,21 +2981,23 @@ bool CWallet::CreateTransaction(interfaces::Chain::Lock& locked_chain, const std\n                 //  rediscover unknown transactions that were written with keys of ours to recover\n                 //  post-backup change.\n \n-                // Reserve a new key pair from key pool\n+                // Reserve a new key pair from key pool. If it fails, provide a dummy",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17219#discussion_r337701626",
      "id" : 337701626,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzNzcwMTYyNg==",
      "original_commit_id" : "b2da2d9e56307f6a32ba6a39c293358580a2a91f",
      "original_position" : 13,
      "path" : "src/wallet/wallet.cpp",
      "position" : 13,
      "pull_request_review_id" : 305445885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17219",
      "updated_at" : "2019-10-22T19:14:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/337701626",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "appreciated, will review",
      "created_at" : "2019-10-22T19:16:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17219#issuecomment-545112411",
      "id" : 545112411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTExMjQxMQ==",
      "updated_at" : "2019-10-22T19:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545112411",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16966](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16966.html) (ui: make send a wizard by Sjors)\n* [#16341](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16341.html) (Introduce ScriptPubKeyMan interface and use it for key and script management (aka wallet boxes) by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-10-22T22:14:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17219#issuecomment-545179108",
      "id" : 545179108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTE3OTEwOA==",
      "updated_at" : "2019-10-22T22:14:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545179108",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks like you could avoid `failed_to_get_change_address` by applying\r\n```diff\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -2968,7 +2968,7 @@ bool CWallet::CreateTransaction(interfaces::Chain::Lock& locked_chain, const std\r\n             // TODO: pass in scriptChange instead of reservedest so\r\n             // change transaction isn't always pay-to-bitcoin-address\r\n             CScript scriptChange;\r\n-            bool failed_to_get_change_address{false};\r\n+            assert(scriptChange.empty());\r\n\r\n             // coin control: send change to custom address\r\n             if (!boost::get<CNoDestination>(&coin_control.destChange)) {\r\n@@ -2984,7 +2984,6 @@ bool CWallet::CreateTransaction(interfaces::Chain::Lock& locked_chain, const std\r\n                 // Reserve a new key pair from key pool. If it fails, provide a dummy\r\n                 // destination in case we don't need change.\r\n                 if (!CanGetAddresses(true)) {\r\n-                    failed_to_get_change_address = true;\r\n                     strFailReason = _(\"Can't generate a change-address key. No keys in the internal keypool and can't generate any keys.\").translated;\r\n                 } else {\r\n                     CTxDestination dest;\r\n@@ -2993,7 +2992,6 @@ bool CWallet::CreateTransaction(interfaces::Chain::Lock& locked_chain, const std\r\n                     if (ret) {\r\n                         scriptChange = GetScriptForDestination(dest);\r\n                     } else {\r\n-                        failed_to_get_change_address = true;\r\n                         strFailReason = _(\"Keypool ran out, please call keypoolrefill first\").translated;\r\n                     }\r\n\r\n@@ -3210,10 +3208,9 @@ bool CWallet::CreateTransaction(interfaces::Chain::Lock& locked_chain, const std\r\n             }\r\n\r\n             // Give up if change keypool ran out and we failed to find a solution without change:\r\n-            if (failed_to_get_change_address && nChangePosInOut != -1) {\r\n+            if (scriptChange.empty() && nChangePosInOut != -1) {\r\n                 return false;\r\n             }\r\n-\r\n         }\r\n\r\n         // Shuffle selected coins and fill in final vin\r\n```",
      "created_at" : "2019-10-23T10:18:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17219#issuecomment-545374547",
      "id" : 545374547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTM3NDU0Nw==",
      "updated_at" : "2019-10-23T10:19:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545374547",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2019-10-23T10:22:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17219#issuecomment-545375875",
      "id" : 545375875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0NTM3NTg3NQ==",
      "updated_at" : "2019-10-23T10:22:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545375875",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
