[
   {
      "author_association" : "MEMBER",
      "body" : "> If `/etc/bitcoin` does not exist when the systemd script is run for the first time then the directory gets created...\r\n\r\nProviding `-conf=/etc/bitcoin/bitcoin.conf` option in `ExecStart=/usr/bin/bitcoind` line of `bitcoind.service` file assumes setting up `/etc/bitcoin/bitcoin.conf` _before_ `bitcoind` service get started.\r\n\r\n> The 0710 permissions will/may prevent a non-root user from being able to list the directory...\r\n\r\nIt looks good from the security point of view. Why is this an issue?",
      "created_at" : "2019-05-11T06:59:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15995#issuecomment-491485934",
      "id" : 491485934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15995",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MTQ4NTkzNA==",
      "updated_at" : "2019-05-11T06:59:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/491485934",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It looks good from the security point of view. Why is this an issue?\r\n\r\nIt's now happened to me a couple of times where I've installed the service script and overlooked creating the config file. I then check the log messages realise it's missing and copy it into the `/etc/bitcoin` directory. This is where the problem occurs. Restarting the bitcoin service will continue to fail because the permissions on `/etc/bitcoin` are incorrect.\r\n\r\n> 2019-05-11T07:25:52Z\r\n>\r\n> ************************\r\n> EXCEPTION: N5boost10filesystem16filesystem_errorE\r\n> boost::filesystem::status: Permission denied: \"/etc/bitcoin/bitcoin.conf\"\r\n> bitcoin in AppInit()\r\n\r\nTo fix the problem the ownership of `/etc/bitcoin` has to be changed to the user the service is running as. Unlike the `StateDirectory` directory the ownership of the `ConfigurationDirectoryMode`  does not get updated automatically by systemd, from the [systemd reference]:(https://www.freedesktop.org/software/systemd/man/systemd.exec.html#ConfigurationDirectory=):\r\n\r\n> Except in case of ConfigurationDirectory=, the innermost specified directories will be owned by the user and group specified in User= and Group=. If the specified directories already exist and their owning user or group do not match the configured ones, all files and directories below the specified directories as well as the directories themselves will have their file ownership recursively changed to match what is configured.\r\n\r\nAnother possible fix would be to remove the `ConfigurationDirectoryMode` directory from the script. That way at least the service script won't create it with incorrect permissions and it will be left up to the user to do so as they see fit, most likely with themselves as the owner.\r\n\r\n\r\n\r\n",
      "created_at" : "2019-05-11T07:39:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15995#issuecomment-491488447",
      "id" : 491488447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15995",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MTQ4ODQ0Nw==",
      "updated_at" : "2019-05-11T07:39:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/491488447",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/197660?v=4",
         "events_url" : "https://api.github.com/users/sipsorcery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipsorcery/followers",
         "following_url" : "https://api.github.com/users/sipsorcery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipsorcery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipsorcery",
         "id" : 197660,
         "login" : "sipsorcery",
         "node_id" : "MDQ6VXNlcjE5NzY2MA==",
         "organizations_url" : "https://api.github.com/users/sipsorcery/orgs",
         "received_events_url" : "https://api.github.com/users/sipsorcery/received_events",
         "repos_url" : "https://api.github.com/users/sipsorcery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipsorcery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipsorcery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipsorcery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipsorcery \r\n> It's now happened to me a couple of times where I've installed the service script and overlooked creating the config file.\r\n\r\nIMO, there is nothing to fix in the software ;)",
      "created_at" : "2019-05-11T07:56:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15995#issuecomment-491489563",
      "id" : 491489563,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15995",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MTQ4OTU2Mw==",
      "updated_at" : "2019-05-11T07:56:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/491489563",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> IMO, there is nothing to fix in the software ;)\r\n\r\nPoint taken and not disputed ;). Wish I could get my memory banks serviced. I keep cleaning them with alcohol but it just seems to make it worse :(.\r\n\r\nFor any other interested parties the choices I see are:\r\n\r\n1. Leave as is and let users manually work out they need to set the ownership correctly on `/etc/bitcoin`. Once the ownership is set appropriately having systemd apply permissions on 0710 to the directory seems a good choice,\r\n\r\n2. As per this PR set the permissions on `/etc/bitcoin` to 0755 and remove the need for users to set manually set the ownership of `/etc/bitcoin/`.\r\n\r\nAs a point of reference on my ubuntu system most configuration directories including `/etc/ssh`, `/etc/systemd` and `/etc/tor` have 0755 permissions and are owned by root.\r\n\r\n\r\n\r\n",
      "created_at" : "2019-05-11T08:31:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15995#issuecomment-491491651",
      "id" : 491491651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15995",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5MTQ5MTY1MQ==",
      "updated_at" : "2019-05-11T08:31:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/491491651",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/197660?v=4",
         "events_url" : "https://api.github.com/users/sipsorcery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipsorcery/followers",
         "following_url" : "https://api.github.com/users/sipsorcery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipsorcery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipsorcery",
         "id" : 197660,
         "login" : "sipsorcery",
         "node_id" : "MDQ6VXNlcjE5NzY2MA==",
         "organizations_url" : "https://api.github.com/users/sipsorcery/orgs",
         "received_events_url" : "https://api.github.com/users/sipsorcery/received_events",
         "repos_url" : "https://api.github.com/users/sipsorcery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipsorcery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipsorcery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipsorcery"
      }
   }
]
