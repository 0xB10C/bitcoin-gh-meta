[
   {
      "author_association" : "MEMBER",
      "body" : "We assume that UTF-8 is set, e.g.\r\n\r\n```sh\r\nexport LC_ALL=C.UTF-8\r\n",
      "created_at" : "2018-12-13T17:17:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14948#issuecomment-447049325",
      "id" : 447049325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14948",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzA0OTMyNQ==",
      "updated_at" : "2018-12-13T17:17:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447049325",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The Python tests more or less require UTF-8 locale, though it shouldn't be assuming that in the unit tests. Boost is supposed to convert UTF-8 filenames from/to the filesystem locale.\r\n\r\nEdit: right, it's not able to represent those filenames, such as `fs_tests_Ã¢ÂÂ¿_Ã°ÂÂÂ` in the filesystem locale, which defaults to ASCII? The failure makes sense.",
      "created_at" : "2018-12-14T10:27:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14948#issuecomment-447282987",
      "id" : 447282987,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14948",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzI4Mjk4Nw==",
      "updated_at" : "2018-12-14T10:42:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447282987",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "So as I see there's three options here:\r\n- Force `LC_ALL=C.UTF-8` (or more specifically): this ignores filesystem locale encoding completely and forces passing of UTF-8 to the OS for filenames. This will cause issues for OSes that truly don't support UTF-8 filenames, or problems interacting with other software that does use the environment locale (the latter doesn't really matter for the test).\r\n- Remove the funny characters from the test; drawback is that UTF-8 will no longer be tested on say, Windows, or Linux with UTF locale\r\n- Accept \"codecvt to string: error\" as a valid outcome in the test. Accept that the filesystem cannot support this character, there's nothing to be done\r\n\r\nThe last one is the most compatible thing to do, I think.",
      "created_at" : "2018-12-14T12:04:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14948#issuecomment-447305576",
      "id" : 447305576,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14948",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzMwNTU3Ng==",
      "updated_at" : "2018-12-14T12:16:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447305576",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm doubtful the codecvt errors come from accessing the filesystem. Unix filesystem APIs just take 8-byte character strings and then most filesystem implementations store them without additional translation.\r\n\r\nI would guess the error is coming from the line:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/7a30e0f6c54443616fdc28b7080dcbc9b630ac77/src/test/fs_tests.cpp#L17\r\n\r\nwhich is attempting to append a `wchar_t` string to an `char` string and failing in the conversion. This might be caused by runtime local settings like @laanwj  suggests, or it could be happening as a result of `input-charset` / `exec-charset` / `wide-exec-charset` [preprocessor settings](https://gcc.gnu.org/onlinedocs/cpp/Invocation.html). But assuming this is a runtime issue and not a compile time issue, in addition to three options above we could also:\r\n\r\n4) Call `fs::path::imbue` like @ken2812221 did in #13877 so `char` <-> `wchar_t` conversions \r\ndone by `fs::path` are always utf8 <-> utf16.\r\n\r\n5) Drop the failing test line, and no longer check what happens when you try to append a `wchar_t` string to an `fs::path`. Since we don't actually use `wchar_t` strings in bitcoin code, this isn't something we need to care about, even on windows where the `fs::path` class uses `wchar_t` strings, but only internally.\r\n\r\nI'd maybe lean to option 4, which could be implemented as easily as dropping the `#ifndef WIN32` condition from ken's #13877 fix. This is nice because it would be a simplification to current code, and it seems acceptable because on unix it is left to individual applications to decide what encodings they want to use for filenames. For example, while Qt applications [use the system locale](http://doc.qt.io/qt-5/qfile.html#encodeName), glib applications [use utf8 and ignore the system locale](https://developer.gnome.org/glib/stable/glib-running.html#G_BROKEN_FILENAMES) unless `G_BROKEN_FILENAMES` is set.",
      "created_at" : "2018-12-14T20:17:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/14948#issuecomment-447447177",
      "id" : 447447177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/14948",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0NzQ0NzE3Nw==",
      "updated_at" : "2018-12-14T20:17:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447447177",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
