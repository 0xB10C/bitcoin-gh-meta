[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Some relevant info about the analysis of the cost (maintenance burden) vs benefit (supporting a better tested & simpler codebase) of these changes \r\n\r\n**pros:**\r\n- these changes add a function to the scheduler with unit test coverage\r\n- the function would only be used when running regtest\r\n- intent is for this to support easier functional testing for other features \r\n- currently, two explicit use cases \r\n\r\n**cons:**\r\n- all code adds maintenance burden \r\n- c++ code specifically to support testing should only be added when necessary \r\n- the scheduler mock is not required for functionally testing the current use cases. workarounds are possible \r\n\r\nexplanation of the two use cases & workarounds.\r\n1. #18038 uses the mock to trigger the next attempt at initial broadcast, which is scheduled for every 10 minutes. Alternatively, the `REATTEMPT_BROADCAST_INTERVAL` constant that indicates scheduler frequency could be defined as a chain param and made more frequent for regtest (thanks @MarcoFalke for the suggestion).\r\n2. In PR #16698, specifically commit baf7de22108eb9081ddc700067b72409efbc382e, the mock would allow deleting some of the c++ code (but still be testable.) In the patch right now, the scheduler periodically calls `MaybeResendWalletTxs` which calls `ResubmitWalletTransactionsToMempool` which uses `nNextResend` to track time. `nNextResend` implements a mockable time so can be tested from the functional tests. If the scheduler mock is supported, the scheduler could directly invoke the resubmit function & drop the member var to maintain time tracking. ",
      "created_at" : "2020-01-31T05:52:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#issuecomment-580593078",
      "id" : 580593078,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDU5MzA3OA==",
      "updated_at" : "2020-01-31T05:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580593078",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 58c4c19.\r\n\r\nThis seems like a generally useful test harness, and the code looks basically correct to me. I think the pointer to the scheduler is a little crass, but it isn't a bad option considering the scheduler is created as a static in init.cpp (someone can clean it up later if they make the schedule a non static).\r\n\r\nThe time delta technically could underflow, but I don't think that's the base time being subtracted from is a time point (and we're far from the unix epoch time). If this weren't just testing harness, it might be worth it to check for underflow, but since we'd basically be having to actively try to shoot ourselves in the foot during a test to get an underflow this usage is fine. \r\n\r\nGreat work!",
      "created_at" : "2020-01-31T06:09:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#issuecomment-580596981",
      "id" : 580596981,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDU5Njk4MQ==",
      "updated_at" : "2020-01-31T06:09:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580596981",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. \r\n\r\nLooks like there's an issue with the new `mockforward` unit test, as most of the [Travis instances](https://travis-ci.org/bitcoin/bitcoin/builds/644207906) are failing:\r\n```bash\r\ntest/scheduler_tests.cpp(158): Entering test case \"mockforward\"\r\ntest/scheduler_tests.cpp(188): error: in \"scheduler_tests/mockforward\": check num_tasks == 1 has failed [3 != 1]\r\ntest/scheduler_tests.cpp(191): error: in \"scheduler_tests/mockforward\": check counter == 2 has failed [0 != 2]\r\ntest/scheduler_tests.cpp(197): error: in \"scheduler_tests/mockforward\": check delta > 2*60 && delta < 3*60 has failed\r\ntest/scheduler_tests.cpp(158): Leaving test case \"mockforward\"; testing time: 6321us\r\ntest/scheduler_tests.cpp(13): Leaving test suite \"scheduler_tests\"; testing time: 146946us\r\n```",
      "created_at" : "2020-01-31T06:24:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#issuecomment-580600650",
      "id" : 580600650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDYwMDY1MA==",
      "updated_at" : "2020-01-31T06:24:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580600650",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16365](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16365.html) (Log RPC parameters (arguments) if -debug=rpcparams by LarryRuane)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-01-31T08:40:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#issuecomment-580639273",
      "id" : 580639273,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDYzOTI3Mw==",
      "updated_at" : "2020-02-05T23:26:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580639273",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "No objection, but some observations:\r\n\r\n* In light of the test failures on some platforms, we obviously need to make sure this is doing the right thing. Timestamp handling isn't obviously trivial especially in combination with condition variables. See also the numerous scheduler crashed that no one can explain: #16307, #16027, #14200, ...\r\n\r\n* \"Mocking\" code so that tests run the mocked code and production runs a different code might defeat the whole point of having the tests in the first place. Tests (especially functional tests) are supposed to test the production code (paths) as closely as possible.\r\n\r\nSo my personal preference would be to go with some minimally invasive and simple approach like the chainparam. But if everyone else likes this mock approach because it could be used for other testing needs as well, then I won't object having this merged.",
      "created_at" : "2020-01-31T09:12:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#issuecomment-580650220",
      "id" : 580650220,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDY1MDIyMA==",
      "updated_at" : "2020-01-31T09:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580650220",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373789747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373789747"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: \"mockscheduler **is** for regression testing (-regtest mode) only\"?",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-01T16:56:00Z",
      "diff_hunk" : "@@ -366,6 +369,27 @@ static UniValue setmocktime(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static UniValue mockscheduler(const JSONRPCRequest& request)\n+{\n+        RPCHelpMan{\"mockscheduler\",\n+            \"\\nBump the scheduler into the future (-regtest only)\\n\",\n+            {\n+                {\"delta_time\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"Number of seconds to forward the scheduler into the future.\" },\n+            },\n+            RPCResults{},\n+            RPCExamples{\"\"},\n+        }.Check(request);\n+\n+    if (!Params().MineBlocksOnDemand())\n+        throw std::runtime_error(\"mockscheduler for regression testing (-regtest mode) only\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373789747",
      "id" : 373789747,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4OTc0Nw==",
      "original_commit_id" : "58c4c1943e082060f38054ed4738478635ab9c31",
      "original_position" : 35,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 351893286,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373789747",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373886512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373886512"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5c9d5bed7205161d6870d199d223af37efe66179\r\n\r\nnit, space before `{`.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-02T23:56:43Z",
      "diff_hunk" : "@@ -114,6 +114,27 @@ void CScheduler::scheduleFromNow(CScheduler::Function f, int64_t deltaMilliSecon\n     schedule(f, boost::chrono::system_clock::now() + boost::chrono::milliseconds(deltaMilliSeconds));\n }\n \n+void CScheduler::MockForward(boost::chrono::seconds delta_seconds)\n+{\n+    {\n+        boost::unique_lock<boost::mutex> lock(newTaskMutex);\n+\n+        // use temp_queue to maintain updated schedule\n+        std::multimap<boost::chrono::system_clock::time_point, Function> temp_queue;\n+\n+        for (const auto& element : taskQueue){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373886512",
      "id" : 373886512,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4NjUxMg==",
      "original_commit_id" : "5c9d5bed7205161d6870d199d223af37efe66179",
      "original_position" : 12,
      "path" : "src/scheduler.cpp",
      "position" : null,
      "pull_request_review_id" : 351978107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373886512",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373886976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373886976"
         }
      },
      "author_association" : "MEMBER",
      "body" : "58c4c1943e082060f38054ed4738478635ab9c31\r\n\r\nnit, keep sorted.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-03T00:04:13Z",
      "diff_hunk" : "@@ -11,6 +11,7 @@\n class BanMan;\n class CConnman;\n class CTxMemPool;\n+class CScheduler;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373886976",
      "id" : 373886976,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4Njk3Ng==",
      "original_commit_id" : "58c4c1943e082060f38054ed4738478635ab9c31",
      "original_position" : 4,
      "path" : "src/node/context.h",
      "position" : 4,
      "pull_request_review_id" : 351978107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373886976",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373887012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373887012"
         }
      },
      "author_association" : "MEMBER",
      "body" : "58c4c1943e082060f38054ed4738478635ab9c31\r\n\r\nnit, keep sorted.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-03T00:05:01Z",
      "diff_hunk" : "@@ -5,15 +5,18 @@\n \n #include <httpserver.h>\n #include <key_io.h>\n+#include <node/context.h>\n #include <outputtype.h>\n #include <rpc/blockchain.h>\n #include <rpc/server.h>\n #include <rpc/util.h>\n #include <script/descriptor.h>\n+#include <scheduler.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373887012",
      "id" : 373887012,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4NzAxMg==",
      "original_commit_id" : "58c4c1943e082060f38054ed4738478635ab9c31",
      "original_position" : 10,
      "path" : "src/rpc/misc.cpp",
      "position" : 9,
      "pull_request_review_id" : 351978107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373887012",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373887202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373887202"
         }
      },
      "author_association" : "MEMBER",
      "body" : "58c4c1943e082060f38054ed4738478635ab9c31\r\n\r\nWhy is this included?",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-03T00:08:00Z",
      "diff_hunk" : "@@ -5,15 +5,18 @@\n \n #include <httpserver.h>\n #include <key_io.h>\n+#include <node/context.h>\n #include <outputtype.h>\n #include <rpc/blockchain.h>\n #include <rpc/server.h>\n #include <rpc/util.h>\n #include <script/descriptor.h>\n+#include <scheduler.h>\n #include <util/check.h>\n #include <util/strencodings.h>\n #include <util/system.h>\n #include <util/validation.h>\n+#include <init.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373887202",
      "id" : 373887202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4NzIwMg==",
      "original_commit_id" : "58c4c1943e082060f38054ed4738478635ab9c31",
      "original_position" : 15,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 351978107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373887202",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373887397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373887397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "58c4c1943e082060f38054ed4738478635ab9c31\r\n\r\nMaybe check `delta_time > 0`?",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-03T00:11:00Z",
      "diff_hunk" : "@@ -366,6 +369,27 @@ static UniValue setmocktime(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static UniValue mockscheduler(const JSONRPCRequest& request)\n+{\n+        RPCHelpMan{\"mockscheduler\",\n+            \"\\nBump the scheduler into the future (-regtest only)\\n\",\n+            {\n+                {\"delta_time\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"Number of seconds to forward the scheduler into the future.\" },\n+            },\n+            RPCResults{},\n+            RPCExamples{\"\"},\n+        }.Check(request);\n+\n+    if (!Params().MineBlocksOnDemand())\n+        throw std::runtime_error(\"mockscheduler for regression testing (-regtest mode) only\");\n+\n+    RPCTypeCheck(request.params, {UniValue::VNUM});\n+\n+    g_rpc_node->scheduler->MockForward(boost::chrono::seconds(request.params[0].get_int64()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373887397",
      "id" : 373887397,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4NzM5Nw==",
      "original_commit_id" : "58c4c1943e082060f38054ed4738478635ab9c31",
      "original_position" : 39,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 351978107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373887397",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373887966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373887966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ca57312e5b0dc9d28766369b963395f1690e0b4f\r\n\r\nMaybe change this to:\r\n```cpp\r\nscheduler.scheduleFromNow([&]{ scheduler.stop(false); }, 1);\r\n```\r\nand remove the sleep above.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-03T00:19:02Z",
      "diff_hunk" : "@@ -155,4 +155,46 @@ BOOST_AUTO_TEST_CASE(singlethreadedscheduler_ordered)\n     BOOST_CHECK_EQUAL(counter2, 100);\n }\n \n+BOOST_AUTO_TEST_CASE(mockforward)\n+{\n+    CScheduler scheduler;\n+\n+    int counter{0};\n+    CScheduler::Function dummy = [&counter](){counter++;};\n+\n+    // schedule jobs for 2, 5 & 8 minutes into the future\n+    int64_t min_in_milli = 60*1000;\n+    scheduler.scheduleFromNow(dummy, 2*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 5*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 8*min_in_milli);\n+\n+    // check taskQueue\n+    boost::chrono::system_clock::time_point first, last;\n+    size_t num_tasks = scheduler.getQueueInfo(first, last);\n+    BOOST_CHECK(num_tasks == 3);\n+\n+    boost::thread scheduler_thread(std::bind(&CScheduler::serviceQueue, &scheduler));\n+\n+    // bump the scheduler forward 5 minutes\n+    scheduler.MockForward(boost::chrono::seconds(5*60));\n+\n+    // finish up\n+    MicroSleep(600);\n+    scheduler.stop(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r373887966",
      "id" : 373887966,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4Nzk2Ng==",
      "original_commit_id" : "ca57312e5b0dc9d28766369b963395f1690e0b4f",
      "original_position" : 29,
      "path" : "src/test/scheduler_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 351979716,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373887966",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375038347"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375038347"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good catch. was left over from a previous iteration ",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-05T03:05:08Z",
      "diff_hunk" : "@@ -5,15 +5,18 @@\n \n #include <httpserver.h>\n #include <key_io.h>\n+#include <node/context.h>\n #include <outputtype.h>\n #include <rpc/blockchain.h>\n #include <rpc/server.h>\n #include <rpc/util.h>\n #include <script/descriptor.h>\n+#include <scheduler.h>\n #include <util/check.h>\n #include <util/strencodings.h>\n #include <util/system.h>\n #include <util/validation.h>\n+#include <init.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375038347",
      "id" : 375038347,
      "in_reply_to_id" : 373887202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzODM0Nw==",
      "original_commit_id" : "58c4c1943e082060f38054ed4738478635ab9c31",
      "original_position" : 15,
      "path" : "src/rpc/misc.cpp",
      "position" : null,
      "pull_request_review_id" : 353441995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375038347",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375039093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375039093"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "clever. thank you! \r\n\r\nlets see if travis likes it ð¤ð½",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-05T03:09:03Z",
      "diff_hunk" : "@@ -155,4 +155,46 @@ BOOST_AUTO_TEST_CASE(singlethreadedscheduler_ordered)\n     BOOST_CHECK_EQUAL(counter2, 100);\n }\n \n+BOOST_AUTO_TEST_CASE(mockforward)\n+{\n+    CScheduler scheduler;\n+\n+    int counter{0};\n+    CScheduler::Function dummy = [&counter](){counter++;};\n+\n+    // schedule jobs for 2, 5 & 8 minutes into the future\n+    int64_t min_in_milli = 60*1000;\n+    scheduler.scheduleFromNow(dummy, 2*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 5*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 8*min_in_milli);\n+\n+    // check taskQueue\n+    boost::chrono::system_clock::time_point first, last;\n+    size_t num_tasks = scheduler.getQueueInfo(first, last);\n+    BOOST_CHECK(num_tasks == 3);\n+\n+    boost::thread scheduler_thread(std::bind(&CScheduler::serviceQueue, &scheduler));\n+\n+    // bump the scheduler forward 5 minutes\n+    scheduler.MockForward(boost::chrono::seconds(5*60));\n+\n+    // finish up\n+    MicroSleep(600);\n+    scheduler.stop(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375039093",
      "id" : 375039093,
      "in_reply_to_id" : 373887966,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzOTA5Mw==",
      "original_commit_id" : "ca57312e5b0dc9d28766369b963395f1690e0b4f",
      "original_position" : 29,
      "path" : "src/test/scheduler_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 353442886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375039093",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375068638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375068638"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yay! looking good. only travis failure seemed unrelated.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-05T05:43:39Z",
      "diff_hunk" : "@@ -155,4 +155,46 @@ BOOST_AUTO_TEST_CASE(singlethreadedscheduler_ordered)\n     BOOST_CHECK_EQUAL(counter2, 100);\n }\n \n+BOOST_AUTO_TEST_CASE(mockforward)\n+{\n+    CScheduler scheduler;\n+\n+    int counter{0};\n+    CScheduler::Function dummy = [&counter](){counter++;};\n+\n+    // schedule jobs for 2, 5 & 8 minutes into the future\n+    int64_t min_in_milli = 60*1000;\n+    scheduler.scheduleFromNow(dummy, 2*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 5*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 8*min_in_milli);\n+\n+    // check taskQueue\n+    boost::chrono::system_clock::time_point first, last;\n+    size_t num_tasks = scheduler.getQueueInfo(first, last);\n+    BOOST_CHECK(num_tasks == 3);\n+\n+    boost::thread scheduler_thread(std::bind(&CScheduler::serviceQueue, &scheduler));\n+\n+    // bump the scheduler forward 5 minutes\n+    scheduler.MockForward(boost::chrono::seconds(5*60));\n+\n+    // finish up\n+    MicroSleep(600);\n+    scheduler.stop(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375068638",
      "id" : 375068638,
      "in_reply_to_id" : 373887966,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2ODYzOA==",
      "original_commit_id" : "ca57312e5b0dc9d28766369b963395f1690e0b4f",
      "original_position" : 29,
      "path" : "src/test/scheduler_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 353477476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T05:43:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375068638",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I addressed review comments & tests are now passing CI. Added checks in RPC function & scheduler function to ensure reasonable values / no underflow.\r\n\r\nThis PR has received 3 ACKs - utACK from @JeremyRubin & concept ACKs from @promag @fanquake. Would appreciate re-review ðð½",
      "created_at" : "2020-02-05T17:00:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#issuecomment-582507502",
      "id" : 582507502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjUwNzUwMg==",
      "updated_at" : "2020-02-05T17:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582507502",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re-utACK ecb0ad5",
      "created_at" : "2020-02-05T18:39:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#issuecomment-582551040",
      "id" : 582551040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjU1MTA0MA==",
      "updated_at" : "2020-02-05T18:39:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582551040",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375441938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375441938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Follow up, would be cool to skip this when !regtest and in `mockscheduler` would be `assert(Params().MineBlocksOnDemand())`.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-05T18:51:16Z",
      "diff_hunk" : "@@ -570,6 +600,7 @@ static const CRPCCommand commands[] =\n \n     /* Not shown in help */\n     { \"hidden\",             \"setmocktime\",            &setmocktime,            {\"timestamp\"}},\n+    { \"hidden\",             \"mockscheduler\",          &mockscheduler,          {\"delta_time\"}},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375441938",
      "id" : 375441938,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ0MTkzOA==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 52,
      "path" : "src/rpc/misc.cpp",
      "position" : 52,
      "pull_request_review_id" : 353957117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-05T18:54:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375441938",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375582987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375582987"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What's the problem of doing\r\n```cpp\r\ntemp_queue.emplace_hint(temp_queue.cend(), element.first - delta_seconds, element.second);\r\n```\r\nLooks fine to me since `wait_until` returns when system time is later than that absolute time.\r\n\r\nDidn't check the case for boost < 1.50.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T00:26:10Z",
      "diff_hunk" : "@@ -114,6 +114,27 @@ void CScheduler::scheduleFromNow(CScheduler::Function f, int64_t deltaMilliSecon\n     schedule(f, boost::chrono::system_clock::now() + boost::chrono::milliseconds(deltaMilliSeconds));\n }\n \n+void CScheduler::MockForward(boost::chrono::seconds delta_seconds)\n+{\n+    {\n+        boost::unique_lock<boost::mutex> lock(newTaskMutex);\n+\n+        // use temp_queue to maintain updated schedule\n+        std::multimap<boost::chrono::system_clock::time_point, Function> temp_queue;\n+\n+        for (const auto& element : taskQueue) {\n+            boost::chrono::system_clock::time_point new_time = std::max(boost::chrono::system_clock::now() + delta_seconds, element.first) - delta_seconds;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375582987",
      "id" : 375582987,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4Mjk4Nw==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 13,
      "path" : "src/scheduler.cpp",
      "position" : 13,
      "pull_request_review_id" : 354133285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T00:34:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375582987",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375584231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375584231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, you can drop `()`.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T00:30:53Z",
      "diff_hunk" : "@@ -155,4 +155,45 @@ BOOST_AUTO_TEST_CASE(singlethreadedscheduler_ordered)\n     BOOST_CHECK_EQUAL(counter2, 100);\n }\n \n+BOOST_AUTO_TEST_CASE(mockforward)\n+{\n+    CScheduler scheduler;\n+\n+    int counter{0};\n+    CScheduler::Function dummy = [&counter](){counter++;};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375584231",
      "id" : 375584231,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4NDIzMQ==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 9,
      "path" : "src/test/scheduler_tests.cpp",
      "position" : 9,
      "pull_request_review_id" : 354133285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T00:34:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375584231",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375584339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375584339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, just capture `&scheduler`.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T00:31:17Z",
      "diff_hunk" : "@@ -155,4 +155,45 @@ BOOST_AUTO_TEST_CASE(singlethreadedscheduler_ordered)\n     BOOST_CHECK_EQUAL(counter2, 100);\n }\n \n+BOOST_AUTO_TEST_CASE(mockforward)\n+{\n+    CScheduler scheduler;\n+\n+    int counter{0};\n+    CScheduler::Function dummy = [&counter](){counter++;};\n+\n+    // schedule jobs for 2, 5 & 8 minutes into the future\n+    int64_t min_in_milli = 60*1000;\n+    scheduler.scheduleFromNow(dummy, 2*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 5*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 8*min_in_milli);\n+\n+    // check taskQueue\n+    boost::chrono::system_clock::time_point first, last;\n+    size_t num_tasks = scheduler.getQueueInfo(first, last);\n+    BOOST_CHECK(num_tasks == 3);\n+\n+    boost::thread scheduler_thread(std::bind(&CScheduler::serviceQueue, &scheduler));\n+\n+    // bump the scheduler forward 5 minutes\n+    scheduler.MockForward(boost::chrono::seconds(5*60));\n+\n+    // ensure scheduler has chance to process all tasks queued for before 1 ms from now.\n+    scheduler.scheduleFromNow([&]{ scheduler.stop(false); }, 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375584339",
      "id" : 375584339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4NDMzOQ==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 28,
      "path" : "src/test/scheduler_tests.cpp",
      "position" : 28,
      "pull_request_review_id" : 354133285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T00:34:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375584339",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375588886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375588886"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm curious- is this for style or is there a difference in behavior? \r\nfrom what I can tell the behavior should be the same?\r\ndocs: \"& (implicitly capture the used automatic variables by reference)\" \r\ncompiler explorer: https://godbolt.org/z/QfeAVF",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T00:48:41Z",
      "diff_hunk" : "@@ -155,4 +155,45 @@ BOOST_AUTO_TEST_CASE(singlethreadedscheduler_ordered)\n     BOOST_CHECK_EQUAL(counter2, 100);\n }\n \n+BOOST_AUTO_TEST_CASE(mockforward)\n+{\n+    CScheduler scheduler;\n+\n+    int counter{0};\n+    CScheduler::Function dummy = [&counter](){counter++;};\n+\n+    // schedule jobs for 2, 5 & 8 minutes into the future\n+    int64_t min_in_milli = 60*1000;\n+    scheduler.scheduleFromNow(dummy, 2*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 5*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 8*min_in_milli);\n+\n+    // check taskQueue\n+    boost::chrono::system_clock::time_point first, last;\n+    size_t num_tasks = scheduler.getQueueInfo(first, last);\n+    BOOST_CHECK(num_tasks == 3);\n+\n+    boost::thread scheduler_thread(std::bind(&CScheduler::serviceQueue, &scheduler));\n+\n+    // bump the scheduler forward 5 minutes\n+    scheduler.MockForward(boost::chrono::seconds(5*60));\n+\n+    // ensure scheduler has chance to process all tasks queued for before 1 ms from now.\n+    scheduler.scheduleFromNow([&]{ scheduler.stop(false); }, 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375588886",
      "id" : 375588886,
      "in_reply_to_id" : 375584339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4ODg4Ng==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 28,
      "path" : "src/test/scheduler_tests.cpp",
      "position" : 28,
      "pull_request_review_id" : 354140279,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T00:48:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375588886",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375609579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375609579"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it's reasonable for @amitiuttarwar to just copy exactly what setmocktime is doing in this regard.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T02:14:37Z",
      "diff_hunk" : "@@ -570,6 +600,7 @@ static const CRPCCommand commands[] =\n \n     /* Not shown in help */\n     { \"hidden\",             \"setmocktime\",            &setmocktime,            {\"timestamp\"}},\n+    { \"hidden\",             \"mockscheduler\",          &mockscheduler,          {\"delta_time\"}},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375609579",
      "id" : 375609579,
      "in_reply_to_id" : 375441938,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYwOTU3OQ==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 52,
      "path" : "src/rpc/misc.cpp",
      "position" : 52,
      "pull_request_review_id" : 354164429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T02:23:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375609579",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375609928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375609928"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this is a style preference (plus it's in tests) so it's whatever.\r\n\r\nFor whatever reason, I prefer this form when it's a function that should be called multiple times (as dummy is) and the no () form when it's more akin to a std::bind for a call-once thing.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T02:16:25Z",
      "diff_hunk" : "@@ -155,4 +155,45 @@ BOOST_AUTO_TEST_CASE(singlethreadedscheduler_ordered)\n     BOOST_CHECK_EQUAL(counter2, 100);\n }\n \n+BOOST_AUTO_TEST_CASE(mockforward)\n+{\n+    CScheduler scheduler;\n+\n+    int counter{0};\n+    CScheduler::Function dummy = [&counter](){counter++;};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375609928",
      "id" : 375609928,
      "in_reply_to_id" : 375584231,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYwOTkyOA==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 9,
      "path" : "src/test/scheduler_tests.cpp",
      "position" : 9,
      "pull_request_review_id" : 354164429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T02:23:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375609928",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375611313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375611313"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think & is perfectly clear, it's just for style.\r\n\r\nI agree in principle if a lambda is multiple lines and has arguments it's usually better to explicitly capture, but I think implicit capture is totally reasonable here.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T02:23:26Z",
      "diff_hunk" : "@@ -155,4 +155,45 @@ BOOST_AUTO_TEST_CASE(singlethreadedscheduler_ordered)\n     BOOST_CHECK_EQUAL(counter2, 100);\n }\n \n+BOOST_AUTO_TEST_CASE(mockforward)\n+{\n+    CScheduler scheduler;\n+\n+    int counter{0};\n+    CScheduler::Function dummy = [&counter](){counter++;};\n+\n+    // schedule jobs for 2, 5 & 8 minutes into the future\n+    int64_t min_in_milli = 60*1000;\n+    scheduler.scheduleFromNow(dummy, 2*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 5*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 8*min_in_milli);\n+\n+    // check taskQueue\n+    boost::chrono::system_clock::time_point first, last;\n+    size_t num_tasks = scheduler.getQueueInfo(first, last);\n+    BOOST_CHECK(num_tasks == 3);\n+\n+    boost::thread scheduler_thread(std::bind(&CScheduler::serviceQueue, &scheduler));\n+\n+    // bump the scheduler forward 5 minutes\n+    scheduler.MockForward(boost::chrono::seconds(5*60));\n+\n+    // ensure scheduler has chance to process all tasks queued for before 1 ms from now.\n+    scheduler.scheduleFromNow([&]{ scheduler.stop(false); }, 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375611313",
      "id" : 375611313,
      "in_reply_to_id" : 375584339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxMTMxMw==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 28,
      "path" : "src/test/scheduler_tests.cpp",
      "position" : 28,
      "pull_request_review_id" : 354164429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T02:23:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375611313",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375611897"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375611897"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "element.first - delta_seconds may underflow, so std::max prevents underflow.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T02:26:09Z",
      "diff_hunk" : "@@ -114,6 +114,27 @@ void CScheduler::scheduleFromNow(CScheduler::Function f, int64_t deltaMilliSecon\n     schedule(f, boost::chrono::system_clock::now() + boost::chrono::milliseconds(deltaMilliSeconds));\n }\n \n+void CScheduler::MockForward(boost::chrono::seconds delta_seconds)\n+{\n+    {\n+        boost::unique_lock<boost::mutex> lock(newTaskMutex);\n+\n+        // use temp_queue to maintain updated schedule\n+        std::multimap<boost::chrono::system_clock::time_point, Function> temp_queue;\n+\n+        for (const auto& element : taskQueue) {\n+            boost::chrono::system_clock::time_point new_time = std::max(boost::chrono::system_clock::now() + delta_seconds, element.first) - delta_seconds;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375611897",
      "id" : 375611897,
      "in_reply_to_id" : 375582987,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxMTg5Nw==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 13,
      "path" : "src/scheduler.cpp",
      "position" : 13,
      "pull_request_review_id" : 354167207,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T02:26:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375611897",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag I think it's reasonable that the mockscheduler RPC doesn't have coverage presently -- @amitiuttarwar has a larger project that this testing harness was extracted from as a reviewable chunk, a later PR will be using it extensively to test rebroadcasting logic (see https://github.com/bitcoin/bitcoin/pull/18038). I think it's reasonable that the coverage in RPC tests lives there & there isn't a separate one just testing the testing rpc, but feel free to disagree.",
      "created_at" : "2020-02-06T02:32:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#issuecomment-582707742",
      "id" : 582707742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjcwNzc0Mg==",
      "updated_at" : "2020-02-06T02:32:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582707742",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375710783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375710783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, should be same, however in L163 you already explicitly capture `&counter` so I though you would like to do the same here.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T09:03:10Z",
      "diff_hunk" : "@@ -155,4 +155,45 @@ BOOST_AUTO_TEST_CASE(singlethreadedscheduler_ordered)\n     BOOST_CHECK_EQUAL(counter2, 100);\n }\n \n+BOOST_AUTO_TEST_CASE(mockforward)\n+{\n+    CScheduler scheduler;\n+\n+    int counter{0};\n+    CScheduler::Function dummy = [&counter](){counter++;};\n+\n+    // schedule jobs for 2, 5 & 8 minutes into the future\n+    int64_t min_in_milli = 60*1000;\n+    scheduler.scheduleFromNow(dummy, 2*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 5*min_in_milli);\n+    scheduler.scheduleFromNow(dummy, 8*min_in_milli);\n+\n+    // check taskQueue\n+    boost::chrono::system_clock::time_point first, last;\n+    size_t num_tasks = scheduler.getQueueInfo(first, last);\n+    BOOST_CHECK(num_tasks == 3);\n+\n+    boost::thread scheduler_thread(std::bind(&CScheduler::serviceQueue, &scheduler));\n+\n+    // bump the scheduler forward 5 minutes\n+    scheduler.MockForward(boost::chrono::seconds(5*60));\n+\n+    // ensure scheduler has chance to process all tasks queued for before 1 ms from now.\n+    scheduler.scheduleFromNow([&]{ scheduler.stop(false); }, 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r375710783",
      "id" : 375710783,
      "in_reply_to_id" : 375584339,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcxMDc4Mw==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 28,
      "path" : "src/test/scheduler_tests.cpp",
      "position" : 28,
      "pull_request_review_id" : 354288066,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T20:25:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/375710783",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r376039723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376039723"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Huh? `static const commands[]=` will get done prior to working out what chain is in use, so you'd have to do a much more serious rework to remove it from the list of rpcs entirely.",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T19:35:38Z",
      "diff_hunk" : "@@ -570,6 +600,7 @@ static const CRPCCommand commands[] =\n \n     /* Not shown in help */\n     { \"hidden\",             \"setmocktime\",            &setmocktime,            {\"timestamp\"}},\n+    { \"hidden\",             \"mockscheduler\",          &mockscheduler,          {\"delta_time\"}},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r376039723",
      "id" : 376039723,
      "in_reply_to_id" : 375441938,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAzOTcyMw==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 52,
      "path" : "src/rpc/misc.cpp",
      "position" : 52,
      "pull_request_review_id" : 354717228,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T19:35:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376039723",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks for review @promag!\r\n\r\nRE testing mockscheduler RPC- as @JeremyRubin mentioned, my next PR uses it [here](https://github.com/bitcoin/bitcoin/pull/18038/files?file-filters%5B%5D=.py#diff-5e6f5e6aab04f82ec4b58148c4bdec72R68) , so the happy path will be tested. But if you prefer separate explicit test coverage, I can add. \r\n\r\nI'll incorporate style nits if I push & invalidate current ACKs ",
      "created_at" : "2020-02-06T20:15:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#issuecomment-583089349",
      "id" : 583089349,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18037",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MzA4OTM0OQ==",
      "updated_at" : "2020-02-06T20:15:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583089349",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r376063957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376063957"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Underflow how? You mean be less than current time?",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T20:27:25Z",
      "diff_hunk" : "@@ -114,6 +114,27 @@ void CScheduler::scheduleFromNow(CScheduler::Function f, int64_t deltaMilliSecon\n     schedule(f, boost::chrono::system_clock::now() + boost::chrono::milliseconds(deltaMilliSeconds));\n }\n \n+void CScheduler::MockForward(boost::chrono::seconds delta_seconds)\n+{\n+    {\n+        boost::unique_lock<boost::mutex> lock(newTaskMutex);\n+\n+        // use temp_queue to maintain updated schedule\n+        std::multimap<boost::chrono::system_clock::time_point, Function> temp_queue;\n+\n+        for (const auto& element : taskQueue) {\n+            boost::chrono::system_clock::time_point new_time = std::max(boost::chrono::system_clock::now() + delta_seconds, element.first) - delta_seconds;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r376063957",
      "id" : 376063957,
      "in_reply_to_id" : 375582987,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA2Mzk1Nw==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 13,
      "path" : "src/scheduler.cpp",
      "position" : 13,
      "pull_request_review_id" : 354748619,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T20:27:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376063957",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r376065647"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376065647"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "if `element.first - delta_seconds < now` everything will process fine (as in the previous version you reviewed)\r\n\r\nbut if `delta_seconds > element.first` then there could be an underflow. seems highly unlikely because `element.first` is a time point, but doesn't hurt to have this guarantee",
      "commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "created_at" : "2020-02-06T20:31:12Z",
      "diff_hunk" : "@@ -114,6 +114,27 @@ void CScheduler::scheduleFromNow(CScheduler::Function f, int64_t deltaMilliSecon\n     schedule(f, boost::chrono::system_clock::now() + boost::chrono::milliseconds(deltaMilliSeconds));\n }\n \n+void CScheduler::MockForward(boost::chrono::seconds delta_seconds)\n+{\n+    {\n+        boost::unique_lock<boost::mutex> lock(newTaskMutex);\n+\n+        // use temp_queue to maintain updated schedule\n+        std::multimap<boost::chrono::system_clock::time_point, Function> temp_queue;\n+\n+        for (const auto& element : taskQueue) {\n+            boost::chrono::system_clock::time_point new_time = std::max(boost::chrono::system_clock::now() + delta_seconds, element.first) - delta_seconds;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18037#discussion_r376065647",
      "id" : 376065647,
      "in_reply_to_id" : 375582987,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA2NTY0Nw==",
      "original_commit_id" : "ecb0ad52a0f0c31a2f08e081f7ab6dfb88de3490",
      "original_position" : 13,
      "path" : "src/scheduler.cpp",
      "position" : 13,
      "pull_request_review_id" : 354750872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18037",
      "updated_at" : "2020-02-06T20:31:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376065647",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   }
]
