[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19184 (Overhaul transaction request logic by sipa)\n* #19109 (Only allow getdata of recently announced invs by sipa)\n* #17785 (p2p: Unify Send and Receive protocol versions by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-01-31T17:55:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-580840274",
      "id" : 580840274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDg0MDI3NA==",
      "updated_at" : "2020-06-19T23:29:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580840274",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373735577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373735577"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You're dereferencing `it` here after it has been incremented (see Travis failure). I think you want to use `inv.type` instead.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-01T00:02:11Z",
      "diff_hunk" : "@@ -1601,12 +1632,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             // Send stream from relay memory\n             bool push = false;\n             auto mi = mapRelay.find(inv.hash);\n+            // WTX and WITNESS_TX imply we serialize with witness\n             int nSendFlags = (inv.type == MSG_TX ? SERIALIZE_TRANSACTION_NO_WITNESS : 0);\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n             } else {\n-                auto txinfo = mempool.info(inv.hash);\n+                auto txinfo = mempool.info(inv.hash, it->type == MSG_WTX);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373735577",
      "id" : 373735577,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzczNTU3Nw==",
      "original_commit_id" : "310aafa76bc460f05ff061d24eb8ea6954a54fe4",
      "original_line" : 1641,
      "original_position" : 197,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 351841019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373735577",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373775307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373775307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, fixed.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-01T11:37:12Z",
      "diff_hunk" : "@@ -1601,12 +1632,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             // Send stream from relay memory\n             bool push = false;\n             auto mi = mapRelay.find(inv.hash);\n+            // WTX and WITNESS_TX imply we serialize with witness\n             int nSendFlags = (inv.type == MSG_TX ? SERIALIZE_TRANSACTION_NO_WITNESS : 0);\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n             } else {\n-                auto txinfo = mempool.info(inv.hash);\n+                auto txinfo = mempool.info(inv.hash, it->type == MSG_WTX);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373775307",
      "id" : 373775307,
      "in_reply_to_id" : 373735577,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3NTMwNw==",
      "original_commit_id" : "310aafa76bc460f05ff061d24eb8ea6954a54fe4",
      "original_line" : 1641,
      "original_position" : 197,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 351880462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373775307",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373775416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373775416"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I wonder if this should be sent immediately in response to a VERSION message, rather than in response to a VERACK.  It looks like the way I've done it here creates a race condition where a peer could send a txid-based inv to us before it gets this message, which I think would cause relay of that transaction to fail.\r\n\r\nhttps://travis-ci.org/bitcoin/bitcoin/jobs/644609638?utm_medium=notification&utm_source=github_status",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-01T11:39:03Z",
      "diff_hunk" : "@@ -2175,6 +2175,10 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n+        if (pfrom->nVersion >= WTXID_RELAY_VERSION) {\n+            connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::WTXIDRELAY));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373775416",
      "id" : 373775416,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3NTQxNg==",
      "original_commit_id" : "ee29e7debcb14fa335e8482888a5cc0294bb8dc8",
      "original_line" : 2180,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 351880546,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373775416",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374576703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374576703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seeing a build warning here:\r\n```\r\nnet_processing.cpp: In member function âvirtual bool PeerLogicValidation::SendMessages(CNode*)â:\r\nnet_processing.cpp:4135:42: warning: enumeral and non-enumeral type in conditional expression [-Wextra]\r\n             CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);\r\n                      ~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n```",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-04T10:04:03Z",
      "diff_hunk" : "@@ -4057,7 +4132,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n-            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374576703",
      "id" : 374576703,
      "line" : 4141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NjcwMw==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_line" : 4139,
      "original_position" : 449,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 491,
      "pull_request_review_id" : 352852514,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374576703",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374697402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374697402"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah I saw that too, but I think the code is correct?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-04T14:21:25Z",
      "diff_hunk" : "@@ -4057,7 +4132,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n-            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374697402",
      "id" : 374697402,
      "in_reply_to_id" : 374576703,
      "line" : 4141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5NzQwMg==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_line" : 4139,
      "original_position" : 449,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 491,
      "pull_request_review_id" : 353010926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374697402",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Wrote up a short BIP draft here: https://github.com/sdaftuar/bips/blob/2020-02-wtxid-relay/bip-wtxid-relay.mediawiki, which this PR implements. \r\n\r\nI'll wait for some concept ACKs here before I send to the mailing list.",
      "created_at" : "2020-02-04T14:23:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-581932930",
      "id" : 581932930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MTkzMjkzMA==",
      "updated_at" : "2020-02-04T14:23:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/581932930",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374699185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374699185"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it be a good idea to fetch `nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count()` once and use the same value for both relay expirations?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-04T14:24:25Z",
      "diff_hunk" : "@@ -3927,6 +3997,11 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                             if (ret.second) {\n                                 vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret.first));\n                             }\n+                            // Add wtxid-based lookup into mapRelay as well, so that peers can request by wtxid\n+                            auto ret2 = mapRelay.insert(std::make_pair(ret.first->second->GetWitnessHash(), ret.first->second));\n+                            if (ret2.second) {\n+                                vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret2.first));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374699185",
      "id" : 374699185,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5OTE4NQ==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_line" : 4020,
      "original_position" : 439,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374699185",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice -- will add a link to the BIP draft in the review club notes at https://bitcoincore.reviews/18044. Currently reviewing. Can someone add a `Review club` label? It helps let people know that there is a review club resource they can use.",
      "created_at" : "2020-02-04T14:38:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-581939690",
      "id" : 581939690,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MTkzOTY5MA==",
      "updated_at" : "2020-02-10T08:14:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/581939690",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Cocnept ACK. Ran standard tests. All passing. Overall agreed with the idea of using wtxid for everything. Will try to try out the huristic and report some results.   ",
      "created_at" : "2020-02-04T18:27:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-582049318",
      "id" : 582049318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjA0OTMxOA==",
      "updated_at" : "2020-02-04T18:27:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582049318",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/codeShark149/events{/privacy}",
         "followers_url" : "https://api.github.com/users/codeShark149/followers",
         "following_url" : "https://api.github.com/users/codeShark149/following{/other_user}",
         "gists_url" : "https://api.github.com/users/codeShark149/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/codeShark149",
         "id" : 36541669,
         "login" : "codeShark149",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/codeShark149/orgs",
         "received_events_url" : "https://api.github.com/users/codeShark149/received_events",
         "repos_url" : "https://api.github.com/users/codeShark149/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/codeShark149/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/codeShark149/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/codeShark149"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374846097"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374846097"
         }
      },
      "author_association" : "NONE",
      "body" : "Doesn't this comment needs update in light of the changed condition? We are now accepting txs containg witness in recentRejects.  ",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-04T18:29:58Z",
      "diff_hunk" : "@@ -2604,14 +2604,15 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                 // We will continue to reject this tx since it has rejected\n                 // parents so avoid re-requesting it from other peers.\n                 recentRejects->insert(tx.GetHash());\n+                recentRejects->insert(tx.GetWitnessHash());\n             }\n         } else {\n-            if (!tx.HasWitness() && state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n+            if (tx.HasWitness() || state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n                 // Do not use rejection cache for witness transactions or\n                 // witness-stripped transactions, as they can have been malleated.\n                 // See https://github.com/bitcoin/bitcoin/issues/8279 for details.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374846097",
      "id" : 374846097,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg0NjA5Nw==",
      "original_commit_id" : "fb1b69dba63ff9911a2520cdae8f5aab78f26ec0",
      "original_line" : 2613,
      "original_position" : 26,
      "original_start_line" : 2611,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 353203516,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374846097",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/codeShark149/events{/privacy}",
         "followers_url" : "https://api.github.com/users/codeShark149/followers",
         "following_url" : "https://api.github.com/users/codeShark149/following{/other_user}",
         "gists_url" : "https://api.github.com/users/codeShark149/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/codeShark149",
         "id" : 36541669,
         "login" : "codeShark149",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/codeShark149/orgs",
         "received_events_url" : "https://api.github.com/users/codeShark149/received_events",
         "repos_url" : "https://api.github.com/users/codeShark149/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/codeShark149/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/codeShark149/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/codeShark149"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Reference [IRC discussion](http://www.erisian.com.au/bitcoin-core-dev/log-2020-02-05.html#l-336) for further context around the VERSION/VERACK messages.",
      "created_at" : "2020-02-06T19:47:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-583078254",
      "id" : 583078254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MzA3ODI1NA==",
      "updated_at" : "2020-02-06T19:47:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583078254",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r376195717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376195717"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it's treating `MSG_WTX` as `enum GetDataMsg` and `MSG_TX | GetFetchFlags()` as `uint32_t` (match `GetFetchFlags` return type). Changing `GetFetchFlags()` to return `GetDataMsg` (and casting its result correspondingly), and making it `enum GetDataMsg : uint32_t` makes the warning go away. Actually, just saying `enum GetDataMsg : uint32_t` makes the warning go away too by the looks.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-07T03:12:30Z",
      "diff_hunk" : "@@ -4057,7 +4132,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n-            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r376195717",
      "id" : 376195717,
      "in_reply_to_id" : 374576703,
      "line" : 4141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE5NTcxNw==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_line" : 4139,
      "original_position" : 449,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 491,
      "pull_request_review_id" : 354909544,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376195717",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. First take: doing extra messages in between VERSION and VERACK sounds better to me than extending VERSION or potentially doing txid relay briefly in between VERACK and WTXIDRELAY, the code changes seem really nicely laid out, and the main thing that caught my eye looks like it's probably fixed by the WITNESS_STRIPPED addition.",
      "created_at" : "2020-02-09T19:36:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-583884102",
      "id" : 583884102,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4Mzg4NDEwMg==",
      "updated_at" : "2020-02-09T19:36:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583884102",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378570286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378570286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "How is  indexed_transaction_set::const_iterator different than txindex?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-12T23:22:17Z",
      "diff_hunk" : "@@ -690,8 +713,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const\n+    {\n+        LOCK(cs);\n+        return (mapTx.get<index_by_wtxid>().count(hash) != 0);\n+    }\n+\n     CTransactionRef get(const uint256& hash) const;\n-    TxMempoolInfo info(const uint256& hash) const;\n+    indexed_transaction_set::const_iterator get_iter_from_wtxid(const uint256& wtxid) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378570286",
      "id" : 378570286,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3MDI4Ng==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 723,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378570286",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378572903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378572903"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can we rename the function, then?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-12T23:30:34Z",
      "diff_hunk" : "@@ -954,11 +954,11 @@ class CNode\n     }\n \n \n-    void AddInventoryKnown(const CInv& inv)\n+    void AddInventoryKnown(const uint256& hash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378572903",
      "id" : 378572903,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3MjkwMw==",
      "original_commit_id" : "9377e308a7e236aa807461795cd2ccd08e6a6a8b",
      "original_line" : 957,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378572903",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378574214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378574214"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "WITNESS_TX and WTX read a little bit too close for comfort. I don't think the extra characters to write a useful name cost us much :p.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-12T23:34:54Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378574214",
      "id" : 378574214,
      "line" : 372,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3NDIxNA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 372,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378574214",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378581343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378581343"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not (this pr's) your bug, but clang complains that you're copying shared_ptrs on every iteration and you should add a &.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-12T23:58:43Z",
      "diff_hunk" : "@@ -1184,6 +1204,7 @@ void PeerLogicValidation::BlockConnected(const std::shared_ptr<const CBlock>& pb\n         LOCK(g_cs_recent_confirmed_transactions);\n         for (const auto ptx : pblock->vtx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378581343",
      "id" : 378581343,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MTM0Mw==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 1205,
      "original_position" : 127,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378581343",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378581882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378581882"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You should probably wipe this in ~CNetProcessingCleanup() like we do the other orphan fields, but, also, why the hell is that thing even there...",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-13T00:00:31Z",
      "diff_hunk" : "@@ -92,6 +94,7 @@ struct COrphanTx {\n };\n RecursiveMutex g_cs_orphans;\n std::map<uint256, COrphanTx> mapOrphanTransactions GUARDED_BY(g_cs_orphans);\n+std::map<uint256, std::map<uint256, COrphanTx>::iterator> g_orphans_by_wtxid GUARDED_BY(g_cs_orphans);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378581882",
      "id" : 378581882,
      "line" : 96,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MTg4Mg==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 96,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378581882",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378586250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378586250"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would this be any different if it were *just* orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-13T00:16:17Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378586250",
      "id" : 378586250,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4NjI1MA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 1946,
      "original_position" : 226,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378586250",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378586654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378586654"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "s/tripped/stripped/, but, more importantly, can we? Wouldn't that allow an attacker to see an 0.19 client's inv, request the tx without delay (unlike its other peers), then spam the network with the witness-stripped version, preventing relay of that transaction. At least as long as we dont ban for TX_WITNESS_STRIPPED.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-13T00:17:42Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness tripped transactions) once",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378586654",
      "id" : 378586654,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4NjY1NA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 1954,
      "original_position" : 234,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378586654",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FWIW, travis error is \" node0 2020-02-12T14:39:48.835709Z [msghand] Error: Disk space is too low! \"",
      "created_at" : "2020-02-13T00:28:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-585487309",
      "id" : 585487309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NTQ4NzMwOQ==",
      "updated_at" : "2020-02-13T00:28:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/585487309",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378851243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378851243"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Suggestions?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-13T13:14:34Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378851243",
      "id" : 378851243,
      "in_reply_to_id" : 378574214,
      "line" : 372,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1MTI0Mw==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 372,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 358204455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378851243",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378858979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378858979"
         }
      },
      "author_association" : "MEMBER",
      "body" : "From a single node's perspective, as long as you have at least 1 honest wtxid-relay peer, such an attack would not work, because the wtxid for the honest version of the transaction would not be added to your filter (only the txid), and so you would eventually request the valid version of the transaction from your honest wtxid-relay peer.\r\n\r\nCurrently we preference outbound peers for transaction download, so once we believe that some sufficient majority of listening nodes support wtxid-relay, such that the chances of having 0 or just a few wtxid-relay-outbound-peers is pretty small, then I think we can just get rid of this.  \r\n\r\nI don't think our threat model has ever really been too concerned with every node getting every transaction, anyway -- we just don't want the network as a whole to not relay a transaction altogether because of something like this.  So exactly how long we should wait before dropping this logic is debatable IMO; anyway we should defer the debate to the future when someone thinks this is ready. ",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-13T13:29:39Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness tripped transactions) once",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378858979",
      "id" : 378858979,
      "in_reply_to_id" : 378586654,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1ODk3OQ==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 1954,
      "original_position" : 234,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 358214364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378858979",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK on the BIP draft and the implementation of it\r\n\r\nI am not so sure about the 2-second delay, however, because it is not necessarily an improvement, it can also make matters worse afaict. Example: At least one of our `txid` peers is better connected than all of our `wtxid` peers. We get a `txid` inv first and wait for 2 seconds. Meanwhile, we receive the `wtxid` inv and request it, but before we get the response we also request the transaction from the  `txid` peer. I am not sure how realistic this is and it will certainly not happen frequently once large parts of the network have upgraded to `wtxid` invs. But I also think the PR is compelling enough without the 2-second delay optimization and it could be left as a follow-up so it can be discussed separately.\r\n\r\nDo you plan to add additional tests? Otherwise, I might be interested to look into that.",
      "created_at" : "2020-02-14T16:58:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-586375495",
      "id" : 586375495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NjM3NTQ5NQ==",
      "updated_at" : "2020-02-14T16:58:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/586375495",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r380426287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/380426287"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "(this is already fixed on master, so a rebase would solve it)",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-18T02:22:45Z",
      "diff_hunk" : "@@ -1184,6 +1204,7 @@ void PeerLogicValidation::BlockConnected(const std::shared_ptr<const CBlock>& pb\n         LOCK(g_cs_recent_confirmed_transactions);\n         for (const auto ptx : pblock->vtx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r380426287",
      "id" : 380426287,
      "in_reply_to_id" : 378581343,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQyNjI4Nw==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 1205,
      "original_position" : 127,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 360037046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/380426287",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK",
      "created_at" : "2020-02-18T20:03:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-587757896",
      "id" : 587757896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4Nzc1Nzg5Ng==",
      "updated_at" : "2020-02-18T20:03:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/587757896",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2020-02-25T19:46:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-591034818",
      "id" : 591034818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTAzNDgxOA==",
      "updated_at" : "2020-02-25T19:46:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591034818",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694065"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated with the `enum GetDataMsg : uint32_t` fix, thanks.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-26T18:52:58Z",
      "diff_hunk" : "@@ -4057,7 +4132,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n-            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694065",
      "id" : 384694065,
      "in_reply_to_id" : 374576703,
      "line" : 4141,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDA2NQ==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_line" : 4139,
      "original_position" : 449,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 491,
      "pull_request_review_id" : 365154543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694065",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-26T18:53:16Z",
      "diff_hunk" : "@@ -690,8 +713,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const\n+    {\n+        LOCK(cs);\n+        return (mapTx.get<index_by_wtxid>().count(hash) != 0);\n+    }\n+\n     CTransactionRef get(const uint256& hash) const;\n-    TxMempoolInfo info(const uint256& hash) const;\n+    indexed_transaction_set::const_iterator get_iter_from_wtxid(const uint256& wtxid) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694231",
      "id" : 384694231,
      "in_reply_to_id" : 378570286,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDIzMQ==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 723,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 365154772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694231",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694296"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-26T18:53:24Z",
      "diff_hunk" : "@@ -954,11 +954,11 @@ class CNode\n     }\n \n \n-    void AddInventoryKnown(const CInv& inv)\n+    void AddInventoryKnown(const uint256& hash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694296",
      "id" : 384694296,
      "in_reply_to_id" : 378572903,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDI5Ng==",
      "original_commit_id" : "9377e308a7e236aa807461795cd2ccd08e6a6a8b",
      "original_line" : 957,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 365154867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694296",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed, thanks.\r\n\r\nNot sure exactly what you're asking but it seemed easier to add an additional map, rather than change the existing data structure to support wtxid-lookup.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-26T18:54:06Z",
      "diff_hunk" : "@@ -92,6 +94,7 @@ struct COrphanTx {\n };\n RecursiveMutex g_cs_orphans;\n std::map<uint256, COrphanTx> mapOrphanTransactions GUARDED_BY(g_cs_orphans);\n+std::map<uint256, std::map<uint256, COrphanTx>::iterator> g_orphans_by_wtxid GUARDED_BY(g_cs_orphans);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694706",
      "id" : 384694706,
      "in_reply_to_id" : 378581882,
      "line" : 96,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDcwNg==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 96,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 365155345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694706",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694860"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nope, would not be different.  Fixed.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-26T18:54:23Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694860",
      "id" : 384694860,
      "in_reply_to_id" : 378586250,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDg2MA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 1946,
      "original_position" : 226,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 365155554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694860",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated to fix the comments left so far.  I also changed the 2 second delay heuristic to only delay initial request of a transaction from a txid-relay peer, and not subsequent requests -- @naumenkogs pointed out to me that the original behavior I proposed would have opened us up to an \"InvBlock\" attack if we get a bunch of inbound peers that have wtxid-relay turned on, but don't yet have any outbound peers.\r\n\r\n@fjahr Please feel free to write some tests, thank you!  As for your comment about delaying transaction relay, yes I think that is the tradeoff -- reduce bandwidth at the expense of latency. ",
      "created_at" : "2020-02-26T18:57:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-591585772",
      "id" : 591585772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTU4NTc3Mg==",
      "updated_at" : "2020-02-26T18:57:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591585772",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384862855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384862855"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This comment is slightly confusing to me. If you setting this expectation here, maybe you want to enforce the rule in the code? Track whether VERACK was not received or something.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-27T01:17:24Z",
      "diff_hunk" : "@@ -2154,10 +2197,24 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384862855",
      "id" : 384862855,
      "line" : 2196,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2Mjg1NQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 2196,
      "original_position" : 263,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 266,
      "pull_request_review_id" : 365357115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384862855",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385362270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385362270"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "54d58e7\r\n\r\n3 new pointers for `boost::multi_index::tag<index_by_wtxid>, mempoolentry_wtxid, SaltedTxidHasher`, not one for new `boost::multi_index::hashed_unique` ? ",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-27T20:47:40Z",
      "diff_hunk" : "@@ -912,8 +912,8 @@ bool CCoinsViewMemPool::GetCoin(const COutPoint &outpoint, Coin &coin) const {\n \n size_t CTxMemPool::DynamicMemoryUsage() const {\n     LOCK(cs);\n-    // Estimate the overhead of mapTx to be 12 pointers + an allocation, as no exact formula for boost::multi_index_contained is implemented.\n-    return memusage::MallocUsage(sizeof(CTxMemPoolEntry) + 12 * sizeof(void*)) * mapTx.size() + memusage::DynamicUsage(mapNextTx) + memusage::DynamicUsage(mapDeltas) + memusage::DynamicUsage(mapLinks) + memusage::DynamicUsage(vTxHashes) + cachedInnerUsage;\n+    // Estimate the overhead of mapTx to be 15 pointers + an allocation, as no exact formula for boost::multi_index_contained is implemented.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385362270",
      "id" : 385362270,
      "line" : 917,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM2MjI3MA==",
      "original_commit_id" : "1d1fddb9790cb3b9a70df5370a71ac245491b71c",
      "original_line" : 917,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 35,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385362270",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385428189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385428189"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What would be the challenges to switch mapOrphanTransactions to wtxid-only? It's just an internal structure, do we use it to interact with our peers ? (and even you can  translate backward there)",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-27T23:23:19Z",
      "diff_hunk" : "@@ -92,6 +94,7 @@ struct COrphanTx {\n };\n RecursiveMutex g_cs_orphans;\n std::map<uint256, COrphanTx> mapOrphanTransactions GUARDED_BY(g_cs_orphans);\n+std::map<uint256, std::map<uint256, COrphanTx>::iterator> g_orphans_by_wtxid GUARDED_BY(g_cs_orphans);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385428189",
      "id" : 385428189,
      "in_reply_to_id" : 378581882,
      "line" : 96,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyODE4OQ==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 96,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385428189",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385437587"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385437587"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would be okay with MSG_WTXID to mark we only deal with tx identifier not a specific new data structure, we already have a GetDataMsg for the transaction and its witness.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-27T23:54:03Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385437587",
      "id" : 385437587,
      "in_reply_to_id" : 378574214,
      "line" : 372,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzNzU4Nw==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 372,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385437587",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385439388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385439388"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "d0f03e9\r\n\r\nIs this rule a best-effort right now? At tx reception, we may have to request parent based only on the input. If so is the BIP clear enough on the 5) ? Precise also there is no current sanction of the rule by receiver as of today",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-27T23:59:43Z",
      "diff_hunk" : "@@ -230,6 +230,12 @@ extern const char *GETBLOCKTXN;\n  * @since protocol version 70014 as described by BIP 152\n  */\n extern const char *BLOCKTXN;\n+/**\n+ * Indicates that a node prefers to relay transactions via wtxid, rather than\n+ * txid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385439388",
      "id" : 385439388,
      "line" : 235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzOTM4OA==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_line" : 235,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 6,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385439388",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385441278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385441278"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "cf8c70f\r\n\r\nFor context-tracking, would be fine to even further comment, \"right now if we reject witness transactions based on their txids, relying on wtxid-based relay peers might lead to a stripped-witness tx starvation due to the low number of wtxid-relay peers at protocol deployment\"\r\n\r\nAlso, once we reach a deployment meaningful enough, should we merge together TX_WITNESS_MUTATED and TX_WITNESS_STRIPPED ?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-02-28T00:06:12Z",
      "diff_hunk" : "@@ -1942,10 +1943,16 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness stripped transactions) once\n+                // wtxid-based relay is broadly deployed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385441278",
      "id" : 385441278,
      "line" : 1945,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0MTI3OA==",
      "original_commit_id" : "6e7290f8f830fbbe49f8578f5f4f3d52613c7056",
      "original_line" : 1945,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 238,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385441278",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r387858917"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387858917"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What to do in that case?  We could disconnect the peer for violating the spec, or ignore the message and not switch to wtxid relay, but I thought trying to do wtxid-relay was the most practical, as it should mostly work (just things that were announced earlier might not be successfully requested).  Maybe it's better to not tolerate any kind of bugs though, so that implementations get all this stuff right?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-04T18:40:53Z",
      "diff_hunk" : "@@ -2154,10 +2197,24 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r387858917",
      "id" : 387858917,
      "in_reply_to_id" : 384862855,
      "line" : 2196,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1ODkxNw==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 2196,
      "original_position" : 263,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 266,
      "pull_request_review_id" : 369026275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387858917",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What taproot is making worst here than current tx-relay of segwit v0 txn ?\r\n\r\nExplained this offline, but the issue is that in a normal, non-adversarial situation where new nodes are relaying segwit transactions that violate old nodes' policy, those old nodes will be wasting bandwidth repeatedly downloading such transactions, because we have no caching of acceptance failure for segwit transactions.\r\n\r\n> Wrt to IRC discussion on multi-party transactions & tx-relay interference, at least for Lightning I can't see this as an issue, worst-case your counterparty can resign to produce another valid witness and you redownload twice ? Or is the attack finding a wtxid-collision with an invalid tx to make propagation of a valid time-sensitive tx near impossible?\r\n\r\nI think you're referencing an IRC conversation about a proposal to change wtxid-based relay to use some shorter, truncated hash instead (128 bits instead of 256 bits), which one version of the Erlay proposal called for.  I've opted not to pursue that, because the bandwidth savings seem small after Erlay.  If someone is going to advocate for truncated hashes, we can revisit the concerns from that conversation.",
      "created_at" : "2020-03-05T17:18:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-595345973",
      "id" : 595345973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTM0NTk3Mw==",
      "updated_at" : "2020-03-05T17:18:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595345973",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388444497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388444497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, you made a good observation -- our fetching of parents of orphan transactions must be by txid, rather than wtxid.  I did try to carefully word the BIP to avoid referencing this situation:\r\n\r\n> After a node has sent and received a \"wtxidrelay\" message to/from a given peer, the node is required to use the MSG_WTX inv-type when announcing transactions to that peer, or requesting announced transactions from that peer.\r\n\r\nSo the BIP says that newly announced transactions must be by wtxid.  And if your peer announces a transaction by wtxid, you must fetch it by wtxid (and not txid).  The BIP is silent on requests for transactions that are not announced -- we could make this explicit but this has never been documented behavior, and I'm not sure we should commit to a certain handling of this kind of thing anyway...  But open to suggestions.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-05T17:23:07Z",
      "diff_hunk" : "@@ -230,6 +230,12 @@ extern const char *GETBLOCKTXN;\n  * @since protocol version 70014 as described by BIP 152\n  */\n extern const char *BLOCKTXN;\n+/**\n+ * Indicates that a node prefers to relay transactions via wtxid, rather than\n+ * txid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388444497",
      "id" : 388444497,
      "in_reply_to_id" : 385439388,
      "line" : 235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ0NDQ5Nw==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_line" : 235,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 6,
      "pull_request_review_id" : 369765705,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388444497",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388445400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388445400"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In the future, I think I'd like to eventually get rid of WITNESS_STRIPPED as a reason that validation returns, because we incur non-trivial CPU usage in order to make the determination of whether a transaction might be WITNESS_STRIPPED.\r\n\r\n",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-05T17:24:42Z",
      "diff_hunk" : "@@ -1942,10 +1943,16 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness stripped transactions) once\n+                // wtxid-based relay is broadly deployed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388445400",
      "id" : 388445400,
      "in_reply_to_id" : 385441278,
      "line" : 1945,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ0NTQwMA==",
      "original_commit_id" : "6e7290f8f830fbbe49f8578f5f4f3d52613c7056",
      "original_line" : 1945,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 238,
      "pull_request_review_id" : 369766876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388445400",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388481642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388481642"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Disconnecting is too much, but ignoring the wtxid_relay message may be reasonable.\r\n\r\nAlternatively (and probably better), we can just make the comment more clear. Something like \"currently this is not enforced, because at most we get slight inefficiency if not following this rule\".\r\n\r\nAnd then the responsibility would be on the future developer to introduce the disconnect/ignore behavior if they choose to fundamentally rely on this assumption.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-05T18:31:29Z",
      "diff_hunk" : "@@ -2154,10 +2197,24 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388481642",
      "id" : 388481642,
      "in_reply_to_id" : 384862855,
      "line" : 2196,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4MTY0Mg==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 2196,
      "original_position" : 263,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 266,
      "pull_request_review_id" : 369812647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388481642",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388504010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388504010"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I would amend the BIP to make its scope explicitly restrained. Add to 5) \"Note: this rule doesn't cover cases where a peer needs to request transaction for validation purposes but don't know its wtxid yet (e.g missing parents of a wtxid-announced child)\" ? At least to avoid someone raising same concern in the future and saying we don't commit on anything wrt to this issue.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-05T19:12:18Z",
      "diff_hunk" : "@@ -230,6 +230,12 @@ extern const char *GETBLOCKTXN;\n  * @since protocol version 70014 as described by BIP 152\n  */\n extern const char *BLOCKTXN;\n+/**\n+ * Indicates that a node prefers to relay transactions via wtxid, rather than\n+ * txid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388504010",
      "id" : 388504010,
      "in_reply_to_id" : 385439388,
      "line" : 235,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUwNDAxMA==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_line" : 235,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 6,
      "pull_request_review_id" : 369840075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388504010",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388504839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388504839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes that what I understood, you're thinking about the 2 `CheckInputScripts` in what is currently `PolicyScriptChecks`?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-05T19:13:39Z",
      "diff_hunk" : "@@ -1942,10 +1943,16 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness stripped transactions) once\n+                // wtxid-based relay is broadly deployed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388504839",
      "id" : 388504839,
      "in_reply_to_id" : 385441278,
      "line" : 1945,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUwNDgzOQ==",
      "original_commit_id" : "6e7290f8f830fbbe49f8578f5f4f3d52613c7056",
      "original_line" : 1945,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 238,
      "pull_request_review_id" : 369840988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388504839",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Explained this offline, but the issue is that in a normal, non-adversarial situation where new nodes are relaying segwit transactions that violate old nodes' policy, those old nodes will be wasting bandwidth repeatedly downloading such transactions, because we have no caching of acceptance failure for segwit transactions.\r\n\r\nYes thanks for explanation, what I didn't get was with a segwit upgrade deployment, transaction download waste wasn't encumbered only in case of _adversarial_ but also just for _normal_ situation (without change any segwit v1 would be redownload at every announcement by non-upgrades nodes).\r\n\r\n> I think you're referencing an IRC conversation about a proposal to change wtxid-based relay to use some shorter, truncated hash instead (128 bits instead of 256 bits), which one version of the Erlay proposal called for. I've opted not to pursue that, because the bandwidth savings seem small after Erlay. If someone is going to advocate for truncated hashes, we can revisit the concerns from that conversation.\r\n\r\nAttack scenario is knowing a wtxid, a counterparty may find transaction identifier _collision_ for an _invalid_ transaction to stuck a time-sensitive tx in the reject filter, and keep broadcasting such malicious transaction at every block tip until timelock expires. That's not a concern for LN today (because your counterparty doesn't know your witness for your local commitment tx) but that would change with something like Eltoo (because symmetric transaction). So Eltoo-style offchain contracts + short-bit transaction identifier is a security concern, something we should document somewhere (maybe add comment around `recentRejects`)",
      "created_at" : "2020-03-05T19:23:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-595402094",
      "id" : 595402094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTQwMjA5NA==",
      "updated_at" : "2020-03-05T19:23:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595402094",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388927279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388927279"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/the filter/the recentRejects filter/ in 6e7290f to aid git grepping (in which case can drop \"reject\" in the next line).\r\n\r\nIdem for the section in `ProcessMessage()`::L2684 containing the same paragraph.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-06T14:18:39Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388927279",
      "id" : 388927279,
      "line" : 1938,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkyNzI3OQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 1938,
      "original_position" : 228,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 231,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388927279",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388954495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388954495"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Further to @ariard's comment, a code doc explaining how the number 15 is arrived at might be helpful here.",
      "commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "created_at" : "2020-03-06T15:04:34Z",
      "diff_hunk" : "@@ -912,8 +912,8 @@ bool CCoinsViewMemPool::GetCoin(const COutPoint &outpoint, Coin &coin) const {\n \n size_t CTxMemPool::DynamicMemoryUsage() const {\n     LOCK(cs);\n-    // Estimate the overhead of mapTx to be 12 pointers + an allocation, as no exact formula for boost::multi_index_contained is implemented.\n-    return memusage::MallocUsage(sizeof(CTxMemPoolEntry) + 12 * sizeof(void*)) * mapTx.size() + memusage::DynamicUsage(mapNextTx) + memusage::DynamicUsage(mapDeltas) + memusage::DynamicUsage(mapLinks) + memusage::DynamicUsage(vTxHashes) + cachedInnerUsage;\n+    // Estimate the overhead of mapTx to be 15 pointers + an allocation, as no exact formula for boost::multi_index_contained is implemented.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388954495",
      "id" : 388954495,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk1NDQ5NQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 35,
      "path" : "src/txmempool.cpp",
      "position" : 35,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-17T20:38:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388954495",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  So Eltoo-style offchain contracts + short-bit transaction identifier is a security concern, something we should document somewhere (maybe add comment around recentRejects)\r\n\r\n@ariard This PR does not include a \"short-bit transaction identifier\" so I don't think any additional documentation is needed.",
      "created_at" : "2020-03-06T19:46:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-595931094",
      "id" : 595931094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTkzMTA5NA==",
      "updated_at" : "2020-03-06T19:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595931094",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389109682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389109682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes that's right.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-06T19:46:38Z",
      "diff_hunk" : "@@ -1942,10 +1943,16 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness stripped transactions) once\n+                // wtxid-based relay is broadly deployed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389109682",
      "id" : 389109682,
      "in_reply_to_id" : 385441278,
      "line" : 1945,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEwOTY4Mg==",
      "original_commit_id" : "6e7290f8f830fbbe49f8578f5f4f3d52613c7056",
      "original_line" : 1945,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 238,
      "pull_request_review_id" : 370583227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389109682",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ariard This PR does not include a \"short-bit transaction identifier\" so I don't think any additional documentation is needed.\r\n\r\nYeah I know it's more a safeguard against someone proposing the idea in the future and this issue not being remembered.",
      "created_at" : "2020-03-07T05:35:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-596049687",
      "id" : 596049687,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NjA0OTY4Nw==",
      "updated_at" : "2020-03-07T05:35:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596049687",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389864907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389864907"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Curious why the `uint32_t` enum type is being added; good practice?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-09T17:59:55Z",
      "diff_hunk" : "@@ -358,12 +364,13 @@ const uint32_t MSG_TYPE_MASK    = 0xffffffff >> 2;\n  * These numbers are defined by the protocol. When adding a new value, be sure\n  * to mention it in the respective BIP.\n  */\n-enum GetDataMsg\n+enum GetDataMsg : uint32_t",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389864907",
      "id" : 389864907,
      "line" : 367,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg2NDkwNw==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 367,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 18,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389864907",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389956408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389956408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/microseconds/seconds/ in 068bf9f -- that said, there are several other static constexprs that are also described as `Î¼s` but expressed in `s`.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-09T20:55:40Z",
      "diff_hunk" : "@@ -69,6 +69,8 @@ static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n /** Maximum number of announced transactions from a peer */\n static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions via txids, if we have wtxid-relaying peers */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389956408",
      "id" : 389956408,
      "line" : 71,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk1NjQwOA==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 71,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389956408",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390040001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390040001"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps update the documentation L403-404 above to mention sorting the mempool by both txid and wtxid transaction hashes (and 5 criteria rather than 4, depending on how you count it).",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-10T00:56:40Z",
      "diff_hunk" : "@@ -467,6 +484,12 @@ class CTxMemPool\n         boost::multi_index::indexed_by<\n             // sorted by txid\n             boost::multi_index::hashed_unique<mempoolentry_txid, SaltedTxidHasher>,\n+            // sorted by wtxid",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390040001",
      "id" : 390040001,
      "line" : 491,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA0MDAwMQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 491,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 47,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390040001",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390362519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390362519"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Because of this confusion I am generally not a fan of mentioning the type in the comment. I don't see why it's useful since ``std::chrono::microseconds`` definition is clear enough.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-10T14:38:57Z",
      "diff_hunk" : "@@ -69,6 +69,8 @@ static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n /** Maximum number of announced transactions from a peer */\n static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions via txids, if we have wtxid-relaying peers */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390362519",
      "id" : 390362519,
      "in_reply_to_id" : 389956408,
      "line" : 71,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM2MjUxOQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 71,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 372013913,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390362519",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390368090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390368090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think MSG_WTXID is even more confusing than MSG_WTX. The suffix here represents an object being fetched. So TX or BLOCK with some type. MSG_WTXID would mean we are fetching an ID.\r\nThe only thing I can thing of is MSG_TX_BY_WTXID. But I'm also fine with MSG_WTX.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-10T14:46:01Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390368090",
      "id" : 390368090,
      "in_reply_to_id" : 378574214,
      "line" : 372,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM2ODA5MA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 372,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 372020907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390368090",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Also, I believe #18261 (the current implementation of Erlay) depends on these changes.",
      "created_at" : "2020-03-10T14:52:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-597129322",
      "id" : 597129322,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NzEyOTMyMg==",
      "updated_at" : "2020-03-10T14:52:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/597129322",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390383225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390383225"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe I've been staring at this for too long but I agree with @naumenkogs. I confused `MSG_TX` and `MSG_WTX` once during the first pass at reviewing a few weeks ago, but then I got used to it and I like its brevity. I think it's fine for now.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-10T15:05:06Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390383225",
      "id" : 390383225,
      "in_reply_to_id" : 378574214,
      "line" : 372,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MzIyNQ==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 372,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 372040091,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390383225",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392472822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392472822"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems that all call sites of `get_iter_from_wtxid` hold `cs` already. Perhaps it's better to have an `AssertLockHeld` / `EXCLUSIVE_LOCKS_REQUIRED` here instead?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-13T20:58:15Z",
      "diff_hunk" : "@@ -690,8 +713,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const\n+    {\n+        LOCK(cs);\n+        return (mapTx.get<index_by_wtxid>().count(hash) != 0);\n+    }\n+\n     CTransactionRef get(const uint256& hash) const;\n-    TxMempoolInfo info(const uint256& hash) const;\n+    txiter get_iter_from_wtxid(const uint256& wtxid) const\n+    {\n+        LOCK(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392472822",
      "id" : 392472822,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQ3MjgyMg==",
      "original_commit_id" : "1d1fddb9790cb3b9a70df5370a71ac245491b71c",
      "original_line" : 725,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392472822",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505176"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Slightly more efficient and C++11ish:\r\n\r\n```suggestion\r\n                            auto ret2 = mapRelay.emplace(ret.first->second->GetWitnessHash(), ret.first->second);\r\n```",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-13T21:59:00Z",
      "diff_hunk" : "@@ -3927,6 +3927,11 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                             if (ret.second) {\n                                 vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret.first));\n                             }\n+                            // Add wtxid-based lookup into mapRelay as well, so that peers can request by wtxid\n+                            auto ret2 = mapRelay.insert(std::make_pair(ret.first->second->GetWitnessHash(), ret.first->second));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505176",
      "id" : 392505176,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwNTE3Ng==",
      "original_commit_id" : "b91a879d2c003dd7f7eef174aa59845137eae1a7",
      "original_line" : 3931,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505176",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505319"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n                                vRelayExpiration.emplace_back(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret2.first);\r\n```",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-13T21:59:31Z",
      "diff_hunk" : "@@ -3927,6 +3927,11 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                             if (ret.second) {\n                                 vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret.first));\n                             }\n+                            // Add wtxid-based lookup into mapRelay as well, so that peers can request by wtxid\n+                            auto ret2 = mapRelay.insert(std::make_pair(ret.first->second->GetWitnessHash(), ret.first->second));\n+                            if (ret2.second) {\n+                                vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret2.first));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505319",
      "id" : 392505319,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwNTMxOQ==",
      "original_commit_id" : "b91a879d2c003dd7f7eef174aa59845137eae1a7",
      "original_line" : 3933,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505319",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505963"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    g_orphans_by_wtxid.emplace(tx->GetWitnessHash(), ret.first);\r\n```",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-13T22:01:41Z",
      "diff_hunk" : "@@ -869,6 +870,8 @@ bool AddOrphanTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRE\n     auto ret = mapOrphanTransactions.emplace(hash, COrphanTx{tx, peer, GetTime() + ORPHAN_TX_EXPIRE_TIME, g_orphan_list.size()});\n     assert(ret.second);\n     g_orphan_list.push_back(ret.first);\n+    // Allow for lookups in the orphan pool by wtxid, as well as txid\n+    g_orphans_by_wtxid.insert(std::make_pair(tx->GetWitnessHash(), ret.first));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505963",
      "id" : 392505963,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwNTk2Mw==",
      "original_commit_id" : "591931a2b0ea807f6f1392c4cde0f46e04b79696",
      "original_line" : 874,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505963",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392511089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392511089"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The comment on the next line here is outdated now.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-13T22:19:59Z",
      "diff_hunk" : "@@ -1916,12 +1916,12 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392511089",
      "id" : 392511089,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMTA4OQ==",
      "original_commit_id" : "0d3d656ab5334db15b91cc0708d7e12db32a5e0a",
      "original_line" : 1919,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392511089",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392512606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392512606"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Next line's comment is outdated here as well.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-13T22:25:30Z",
      "diff_hunk" : "@@ -2604,14 +2604,15 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                 // We will continue to reject this tx since it has rejected\n                 // parents so avoid re-requesting it from other peers.\n                 recentRejects->insert(tx.GetHash());\n+                recentRejects->insert(tx.GetWitnessHash());\n             }\n         } else {\n-            if (!tx.HasWitness() && state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n+            if (tx.HasWitness() || state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392512606",
      "id" : 392512606,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMjYwNg==",
      "original_commit_id" : "0d3d656ab5334db15b91cc0708d7e12db32a5e0a",
      "original_line" : 2610,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392512606",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392513202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392513202"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you use braces and indentation here? Combination of a line ending with ';' followed by `else` on the next line may be confusing.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-13T22:27:43Z",
      "diff_hunk" : "@@ -1356,7 +1360,8 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n \n             {\n                 LOCK(g_cs_orphans);\n-                if (mapOrphanTransactions.count(inv.hash)) return true;\n+                if (inv.type != MSG_WTX && mapOrphanTransactions.count(inv.hash)) return true;\n+                else if (inv.type == MSG_WTX && g_orphans_by_wtxid.count(inv.hash)) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392513202",
      "id" : 392513202,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMzIwMg==",
      "original_commit_id" : "44ea27c61d6466a6626fd986f2942e76c09465d8",
      "original_line" : 1364,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392513202",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392519821"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392519821"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The conditional seems superfluous here.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-13T22:55:17Z",
      "diff_hunk" : "@@ -2175,10 +2179,23 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up\n+    if (strCommand == NetMsgType::WTXIDRELAY) {\n+        if (pfrom->nVersion >= WTXID_RELAY_VERSION) {\n+            LOCK(cs_main);\n+            if (!State(pfrom->GetId())->m_wtxid_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392519821",
      "id" : 392519821,
      "line" : 2200,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxOTgyMQ==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_line" : 2200,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 270,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392519821",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-03-16T15:16:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-599593067",
      "id" : 599593067,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5OTU5MzA2Nw==",
      "updated_at" : "2020-03-16T15:16:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599593067",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393948358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393948358"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We use it to properly count the number of wtxid-relay peers.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:25:49Z",
      "diff_hunk" : "@@ -2175,10 +2179,23 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up\n+    if (strCommand == NetMsgType::WTXIDRELAY) {\n+        if (pfrom->nVersion >= WTXID_RELAY_VERSION) {\n+            LOCK(cs_main);\n+            if (!State(pfrom->GetId())->m_wtxid_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393948358",
      "id" : 393948358,
      "in_reply_to_id" : 392519821,
      "line" : 2200,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk0ODM1OA==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_line" : 2200,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 270,
      "pull_request_review_id" : 376378857,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393948358",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393950006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393950006"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see @naumenkogs's point that this is redundant, but I don't understand why @jonatack is saying this is incorrect?  TXID_RELAY_DELAY is the number of microseconds that we wait before requesting a transaction, no?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:28:57Z",
      "diff_hunk" : "@@ -69,6 +69,8 @@ static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n /** Maximum number of announced transactions from a peer */\n static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions via txids, if we have wtxid-relaying peers */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393950006",
      "id" : 393950006,
      "in_reply_to_id" : 389956408,
      "line" : 71,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1MDAwNg==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 71,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 376380913,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393950006",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393950777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393950777"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, of course.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:30:26Z",
      "diff_hunk" : "@@ -2175,10 +2179,23 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up\n+    if (strCommand == NetMsgType::WTXIDRELAY) {\n+        if (pfrom->nVersion >= WTXID_RELAY_VERSION) {\n+            LOCK(cs_main);\n+            if (!State(pfrom->GetId())->m_wtxid_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393950777",
      "id" : 393950777,
      "in_reply_to_id" : 392519821,
      "line" : 2200,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1MDc3Nw==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_line" : 2200,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 270,
      "pull_request_review_id" : 376381881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393950777",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393956494"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393956494"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:41:01Z",
      "diff_hunk" : "@@ -1356,7 +1360,8 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n \n             {\n                 LOCK(g_cs_orphans);\n-                if (mapOrphanTransactions.count(inv.hash)) return true;\n+                if (inv.type != MSG_WTX && mapOrphanTransactions.count(inv.hash)) return true;\n+                else if (inv.type == MSG_WTX && g_orphans_by_wtxid.count(inv.hash)) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393956494",
      "id" : 393956494,
      "in_reply_to_id" : 392513202,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1NjQ5NA==",
      "original_commit_id" : "44ea27c61d6466a6626fd986f2942e76c09465d8",
      "original_line" : 1364,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376388889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393956494",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393956622"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393956622"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, done.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:41:15Z",
      "diff_hunk" : "@@ -869,6 +870,8 @@ bool AddOrphanTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRE\n     auto ret = mapOrphanTransactions.emplace(hash, COrphanTx{tx, peer, GetTime() + ORPHAN_TX_EXPIRE_TIME, g_orphan_list.size()});\n     assert(ret.second);\n     g_orphan_list.push_back(ret.first);\n+    // Allow for lookups in the orphan pool by wtxid, as well as txid\n+    g_orphans_by_wtxid.insert(std::make_pair(tx->GetWitnessHash(), ret.first));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393956622",
      "id" : 393956622,
      "in_reply_to_id" : 392505963,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1NjYyMg==",
      "original_commit_id" : "591931a2b0ea807f6f1392c4cde0f46e04b79696",
      "original_line" : 874,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376389050,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393956622",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393956704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393956704"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:41:24Z",
      "diff_hunk" : "@@ -3927,6 +3927,11 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                             if (ret.second) {\n                                 vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret.first));\n                             }\n+                            // Add wtxid-based lookup into mapRelay as well, so that peers can request by wtxid\n+                            auto ret2 = mapRelay.insert(std::make_pair(ret.first->second->GetWitnessHash(), ret.first->second));\n+                            if (ret2.second) {\n+                                vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret2.first));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393956704",
      "id" : 393956704,
      "in_reply_to_id" : 392505319,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1NjcwNA==",
      "original_commit_id" : "b91a879d2c003dd7f7eef174aa59845137eae1a7",
      "original_line" : 3933,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376389153,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393956704",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393957003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957003"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:41:57Z",
      "diff_hunk" : "@@ -3927,6 +3927,11 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                             if (ret.second) {\n                                 vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret.first));\n                             }\n+                            // Add wtxid-based lookup into mapRelay as well, so that peers can request by wtxid\n+                            auto ret2 = mapRelay.insert(std::make_pair(ret.first->second->GetWitnessHash(), ret.first->second));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393957003",
      "id" : 393957003,
      "in_reply_to_id" : 392505176,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1NzAwMw==",
      "original_commit_id" : "b91a879d2c003dd7f7eef174aa59845137eae1a7",
      "original_line" : 3931,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 376389516,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957003",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393957074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957074"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:42:06Z",
      "diff_hunk" : "@@ -690,8 +713,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const\n+    {\n+        LOCK(cs);\n+        return (mapTx.get<index_by_wtxid>().count(hash) != 0);\n+    }\n+\n     CTransactionRef get(const uint256& hash) const;\n-    TxMempoolInfo info(const uint256& hash) const;\n+    txiter get_iter_from_wtxid(const uint256& wtxid) const\n+    {\n+        LOCK(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393957074",
      "id" : 393957074,
      "in_reply_to_id" : 392472822,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1NzA3NA==",
      "original_commit_id" : "1d1fddb9790cb3b9a70df5370a71ac245491b71c",
      "original_line" : 725,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 376389609,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957074",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393957303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957303"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, fixed.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:42:32Z",
      "diff_hunk" : "@@ -467,6 +484,12 @@ class CTxMemPool\n         boost::multi_index::indexed_by<\n             // sorted by txid\n             boost::multi_index::hashed_unique<mempoolentry_txid, SaltedTxidHasher>,\n+            // sorted by wtxid",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393957303",
      "id" : 393957303,
      "in_reply_to_id" : 390040001,
      "line" : 491,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1NzMwMw==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 491,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 47,
      "pull_request_review_id" : 376389931,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957303",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393957941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This was aj's proposed fix to the build warning you reported before: https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374576703",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T20:43:44Z",
      "diff_hunk" : "@@ -358,12 +364,13 @@ const uint32_t MSG_TYPE_MASK    = 0xffffffff >> 2;\n  * These numbers are defined by the protocol. When adding a new value, be sure\n  * to mention it in the respective BIP.\n  */\n-enum GetDataMsg\n+enum GetDataMsg : uint32_t",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393957941",
      "id" : 393957941,
      "in_reply_to_id" : 389864907,
      "line" : 367,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1Nzk0MQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 367,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 18,
      "pull_request_review_id" : 376390731,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393957941",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There are a couple review notes about comments that I still need to go back and look at but this is now rebased to get rid of the conflicts with master after the refactor done in #17997, and most of the non-comment review feedback has been incorporated.  \r\n\r\nI also still need to measure the memory usage of mapTx to see if the estimate I'm using is correct.  \r\n\r\nIf anyone feels like contributing a test, I think that might help get this merged.",
      "created_at" : "2020-03-17T20:46:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-600288874",
      "id" : 600288874,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMDI4ODg3NA==",
      "updated_at" : "2020-03-17T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/600288874",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393968535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393968535"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The value in the definition is expressed in seconds (albeit with microsecond precision), e.g. a delay of 2 seconds and not 2 microseconds, unless I am confused. There are several similar cases; I think this can be ignored and addressed (or not) separately.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-17T21:02:19Z",
      "diff_hunk" : "@@ -69,6 +69,8 @@ static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n /** Maximum number of announced transactions from a peer */\n static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions via txids, if we have wtxid-relaying peers */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r393968535",
      "id" : 393968535,
      "in_reply_to_id" : 389956408,
      "line" : 71,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2ODUzNQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 71,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 376402832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393968535",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r394060201"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394060201"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The comment is technically correct because it's referring to the `TXID_RELAY_DELAY` constant, not how it is computed. Compare it with how before it might have been `static const int TXID_RELAY_DELAY = 2 * 1000000`, where 2 was still a value in seconds.\r\n\r\nIt's a silly semantics discussion though. With the std::chrono types everywhere the comment could just be \"Duration of delay ...\".",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-18T01:34:44Z",
      "diff_hunk" : "@@ -69,6 +69,8 @@ static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n /** Maximum number of announced transactions from a peer */\n static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions via txids, if we have wtxid-relaying peers */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r394060201",
      "id" : 394060201,
      "in_reply_to_id" : 389956408,
      "line" : 71,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDA2MDIwMQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 71,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 376509593,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394060201",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r394200854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394200854"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> the comment could just be \"Duration of delay ...\".\r\n\r\nYes.\r\n",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-18T09:15:51Z",
      "diff_hunk" : "@@ -69,6 +69,8 @@ static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n /** Maximum number of announced transactions from a peer */\n static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions via txids, if we have wtxid-relaying peers */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r394200854",
      "id" : 394200854,
      "in_reply_to_id" : 389956408,
      "line" : 71,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwMDg1NA==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_line" : 71,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 376681058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/394200854",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r399693214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399693214"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason you've added a new function here, instead of extending `exists()` with a boolean `wtxid` parameter (in the same way that you've extended `CompareDepthAndScore()` and `info()`?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-28T18:22:37Z",
      "diff_hunk" : "@@ -693,8 +717,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r399693214",
      "id" : 399693214,
      "line" : 720,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzIxNA==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 720,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 69,
      "pull_request_review_id" : 383336881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399693214",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r399693288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399693288"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As above, I think it would be clearer if this was combined with `GetIter()`",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-28T18:23:21Z",
      "diff_hunk" : "@@ -693,8 +717,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const\n+    {\n+        LOCK(cs);\n+        return (mapTx.get<index_by_wtxid>().count(hash) != 0);\n+    }\n+\n     CTransactionRef get(const uint256& hash) const;\n-    TxMempoolInfo info(const uint256& hash) const;\n+    txiter get_iter_from_wtxid(const uint256& wtxid) const EXCLUSIVE_LOCKS_REQUIRED(cs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r399693288",
      "id" : 399693288,
      "line" : 727,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzI4OA==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 727,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 77,
      "pull_request_review_id" : 383336881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399693288",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r399693555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399693555"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a good reason not to use `txid` and `wtxid` here instead of looking them up again?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-28T18:25:32Z",
      "diff_hunk" : "@@ -2517,26 +2577,42 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n         vRecv >> ptx;\n         const CTransaction& tx = *ptx;\n \n-        CInv inv(MSG_TX, tx.GetHash());\n-        pfrom->AddInventoryKnown(inv);\n+        const uint256& txid = ptx->GetHash();\n+        const uint256& wtxid = ptx->GetWitnessHash();\n \n         LOCK2(cs_main, g_cs_orphans);\n \n+        CNodeState* nodestate = State(pfrom->GetId());\n+\n+        const uint256& hash = nodestate->m_wtxid_relay ? wtxid : txid;\n+        pfrom->AddKnownTx(hash);\n+\n         TxValidationState state;\n \n-        CNodeState* nodestate = State(pfrom->GetId());\n-        nodestate->m_tx_download.m_tx_announced.erase(inv.hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(inv.hash);\n-        EraseTxRequest(inv.hash);\n+        nodestate->m_tx_download.m_tx_announced.erase(hash);\n+        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n+        EraseTxRequest(hash);\n \n         std::list<CTransactionRef> lRemovedTxn;\n \n-        if (!AlreadyHave(inv, mempool) &&\n+        // We do the AlreadyHave() check using wtxid, rather than txid - in the\n+        // absence of witness malleation, this is strictly better, because the\n+        // recent rejects filter may contain the wtxid but will never contain\n+        // the txid of a segwit transaction that has been rejected.\n+        // In the presence of witness malleation, it's possible that by only\n+        // doing the check with wtxid, we could overlook a transaction which\n+        // was confirmed with a different witness, or exists in our mempool\n+        // with a different witness, but this has limited downside:\n+        // mempool validation does its own lookup of whether we have the txid\n+        // already; and an adversary can already relay us old transactions\n+        // (older than our recency filter) if trying to DoS us, without any need\n+        // for witness malleation.\n+        if (!AlreadyHave(CInv(MSG_WTX, wtxid), mempool) &&\n             AcceptToMemoryPool(mempool, state, ptx, &lRemovedTxn, false /* bypass_limits */, 0 /* nAbsurdFee */)) {\n             mempool.check(&::ChainstateActive().CoinsTip());\n-            RelayTransaction(tx.GetHash(), *connman);\n+            RelayTransaction(tx.GetHash(), tx.GetWitnessHash(), *connman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r399693555",
      "id" : 399693555,
      "line" : 2613,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzU1NQ==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2613,
      "original_position" : 335,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 335,
      "pull_request_review_id" : 383336881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399693555",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r399702162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399702162"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand how this is supposed to work. You add the parent's txid to the node's `m_tx_process_time` via `RequestTx()` here, but when we process it in `SendMessages()` getdata logic, we always construct a `CInv` with type `MSG_WTX`. The receiving node will fail to find the tx because it searches in the mempool for a tx with that wtxid.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-28T19:50:14Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r399702162",
      "id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcwMjE2Mg==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 383336881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399702162",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400167606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400167606"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This also happens if a buggy node sends `CInv` with `MSG_WTX` without having announced `wtxidrelay` first, or `MSG_TX` after having announced `wtxidrelay` I think.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-30T12:54:41Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400167606",
      "id" : 400167606,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2NzYwNg==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 383823095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400167606",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400169765"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400169765"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`GetHash()` and `GetWitnessHash()` are inline and just return pre-cached results anyway so it should make no practical difference. Probably clearer to use the shorter aliases though.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-30T12:58:03Z",
      "diff_hunk" : "@@ -2517,26 +2577,42 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n         vRecv >> ptx;\n         const CTransaction& tx = *ptx;\n \n-        CInv inv(MSG_TX, tx.GetHash());\n-        pfrom->AddInventoryKnown(inv);\n+        const uint256& txid = ptx->GetHash();\n+        const uint256& wtxid = ptx->GetWitnessHash();\n \n         LOCK2(cs_main, g_cs_orphans);\n \n+        CNodeState* nodestate = State(pfrom->GetId());\n+\n+        const uint256& hash = nodestate->m_wtxid_relay ? wtxid : txid;\n+        pfrom->AddKnownTx(hash);\n+\n         TxValidationState state;\n \n-        CNodeState* nodestate = State(pfrom->GetId());\n-        nodestate->m_tx_download.m_tx_announced.erase(inv.hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(inv.hash);\n-        EraseTxRequest(inv.hash);\n+        nodestate->m_tx_download.m_tx_announced.erase(hash);\n+        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n+        EraseTxRequest(hash);\n \n         std::list<CTransactionRef> lRemovedTxn;\n \n-        if (!AlreadyHave(inv, mempool) &&\n+        // We do the AlreadyHave() check using wtxid, rather than txid - in the\n+        // absence of witness malleation, this is strictly better, because the\n+        // recent rejects filter may contain the wtxid but will never contain\n+        // the txid of a segwit transaction that has been rejected.\n+        // In the presence of witness malleation, it's possible that by only\n+        // doing the check with wtxid, we could overlook a transaction which\n+        // was confirmed with a different witness, or exists in our mempool\n+        // with a different witness, but this has limited downside:\n+        // mempool validation does its own lookup of whether we have the txid\n+        // already; and an adversary can already relay us old transactions\n+        // (older than our recency filter) if trying to DoS us, without any need\n+        // for witness malleation.\n+        if (!AlreadyHave(CInv(MSG_WTX, wtxid), mempool) &&\n             AcceptToMemoryPool(mempool, state, ptx, &lRemovedTxn, false /* bypass_limits */, 0 /* nAbsurdFee */)) {\n             mempool.check(&::ChainstateActive().CoinsTip());\n-            RelayTransaction(tx.GetHash(), *connman);\n+            RelayTransaction(tx.GetHash(), tx.GetWitnessHash(), *connman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400169765",
      "id" : 400169765,
      "in_reply_to_id" : 399693555,
      "line" : 2613,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2OTc2NQ==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2613,
      "original_position" : 335,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 335,
      "pull_request_review_id" : 383825786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400169765",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400444597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400444597"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This logic of requesting unconfirmed parent transactions when an orphan is received should eventually go away, in favor of some sort of package relay scheme, where orphan transactions trigger discovery of all unconfirmed ancestors -- so I think the question is what to do in the meantime.  I think wtxid-based relay is more important than optimizing this behavior when we encounter an orphan.\r\n\r\nNote that we only just recently (#16851, merged last October) fixed things so that these requests worked for transactions that are not in mapRelay.  Also note that for transactions that are still in mapRelay, or for non-segwit transactions where txid and wtxid are the same, these requests will still work.  However this is admittedly a regression in behavior, undoing the benefit of #16851.  However given how long that behavior was broken (and that the recent fix was largely at my urging, I believe), it's hard for me to think that anyone is really too concerned with this.\r\n\r\nAnyway it is possible to improve this by keeping extra bookkeeping so that requests generated this way go out as MSG_TX, but I don't think it's worth it -- it's a lot of additional complexity for very little benefit, and I think effort spent on improving orphan transaction relay should be devoted to a p2p protocol extension that supports it directly.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-30T19:35:43Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400444597",
      "id" : 400444597,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0NDU5Nw==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 384168419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400444597",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400447324"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400447324"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is just a style choice, trying to balance different tradeoffs:\r\n- if you change a function's arguments, then you have to change all call sites, unless you use an optional argument\r\n- changing lots of call sites is not great as it adds noise to PR review\r\n- optional arguments are not great as they can make it harder to maintain code and do review in the future\r\n\r\nBut sometimes optional arguments are the easier way to go, to avoid having to embed hairy logic at a bunch of call sites to decide which function to call, which can also harm readability.  So I think it's just a balance, and I tried to strike the balance I thought made sense when I was writing all this which wasn't always the same for every example, but maybe I could have done better.  \r\n\r\nAnyway at this point I'd prefer not to make stylistic changes to this PR.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-30T19:40:57Z",
      "diff_hunk" : "@@ -693,8 +717,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400447324",
      "id" : 400447324,
      "in_reply_to_id" : 399693214,
      "line" : 720,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0NzMyNA==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 720,
      "original_position" : 69,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 69,
      "pull_request_review_id" : 384171979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400447324",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400448519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400448519"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looking at the diff, I note that the code change I have here looks clearly correct if you believe the old code was correct.  Given the lack of performance sensitivity I'm not inclined to change this.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-30T19:43:10Z",
      "diff_hunk" : "@@ -2517,26 +2577,42 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n         vRecv >> ptx;\n         const CTransaction& tx = *ptx;\n \n-        CInv inv(MSG_TX, tx.GetHash());\n-        pfrom->AddInventoryKnown(inv);\n+        const uint256& txid = ptx->GetHash();\n+        const uint256& wtxid = ptx->GetWitnessHash();\n \n         LOCK2(cs_main, g_cs_orphans);\n \n+        CNodeState* nodestate = State(pfrom->GetId());\n+\n+        const uint256& hash = nodestate->m_wtxid_relay ? wtxid : txid;\n+        pfrom->AddKnownTx(hash);\n+\n         TxValidationState state;\n \n-        CNodeState* nodestate = State(pfrom->GetId());\n-        nodestate->m_tx_download.m_tx_announced.erase(inv.hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(inv.hash);\n-        EraseTxRequest(inv.hash);\n+        nodestate->m_tx_download.m_tx_announced.erase(hash);\n+        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n+        EraseTxRequest(hash);\n \n         std::list<CTransactionRef> lRemovedTxn;\n \n-        if (!AlreadyHave(inv, mempool) &&\n+        // We do the AlreadyHave() check using wtxid, rather than txid - in the\n+        // absence of witness malleation, this is strictly better, because the\n+        // recent rejects filter may contain the wtxid but will never contain\n+        // the txid of a segwit transaction that has been rejected.\n+        // In the presence of witness malleation, it's possible that by only\n+        // doing the check with wtxid, we could overlook a transaction which\n+        // was confirmed with a different witness, or exists in our mempool\n+        // with a different witness, but this has limited downside:\n+        // mempool validation does its own lookup of whether we have the txid\n+        // already; and an adversary can already relay us old transactions\n+        // (older than our recency filter) if trying to DoS us, without any need\n+        // for witness malleation.\n+        if (!AlreadyHave(CInv(MSG_WTX, wtxid), mempool) &&\n             AcceptToMemoryPool(mempool, state, ptx, &lRemovedTxn, false /* bypass_limits */, 0 /* nAbsurdFee */)) {\n             mempool.check(&::ChainstateActive().CoinsTip());\n-            RelayTransaction(tx.GetHash(), *connman);\n+            RelayTransaction(tx.GetHash(), tx.GetWitnessHash(), *connman);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400448519",
      "id" : 400448519,
      "in_reply_to_id" : 399693555,
      "line" : 2613,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0ODUxOQ==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2613,
      "original_position" : 335,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 335,
      "pull_request_review_id" : 384173467,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400448519",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fjahr Thanks for starting work on a test in #18446!  Once things converge in the review there I'd be happy to include those commits here as well.",
      "created_at" : "2020-03-30T19:48:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-606208367",
      "id" : 606208367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNjIwODM2Nw==",
      "updated_at" : "2020-03-30T19:48:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606208367",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400535511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400535511"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I disagree with the argument \"this was broken for a long time and we only recently fixed it, so it's ok to break it again\"\r\n\r\n> it is possible to improve this by keeping extra bookkeeping ... it's a lot of additional complexity.\r\n\r\nThis doesn't seem like too much additional complexity. We store in `m_tx_process_time` whether the request should be for a txid or a wtxid, and set the GETDATA INV based on that. That's one additional bit of information, which could be a bool or a `enum GetDataMsg`.\r\n\r\n> for transactions that are still in mapRelay [...] these requests will still work\r\n\r\nOh, I hadn't realised that we'd respond to a MSG_WTX GETDATA request for a wtxid with a transaction that has that txid. The draft BIP doesn't specify that we should do that, and it seems extremely unintuitive. Could we have two `mapRelay`s - one based on txid and one based on wtxid so we don't do this?\r\n\r\n(I also think that we should remove mapRelay entirely (#17303), which depends on responding to NOTFOUNDs (#18238), which currently is broken and seems to be waiting for this PR (https://github.com/bitcoin/bitcoin/pull/18238#discussion_r398318859))",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-30T22:35:29Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400535511",
      "id" : 400535511,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUzNTUxMQ==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 384280841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400535511",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400557458"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400557458"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">I disagree with the argument \"this was broken for a long time and we only recently fixed it, so it's ok to break it again\"\r\n\r\nPlease, that is not the entirety of the argument; the substance of what is being \"broken\" -- and how significant it is -- is relevant too.  It's not like transaction relay was horribly broken until the last release.  \r\n\r\nFor context: fixing the behavior as we did was something that I suggested we do in order to make another improvement I wanted to make -- package relay -- something that we could introduce in two parts, first as a pure client-side behavior integrated with orphan handling, and then as a p2p protocol extension.  Since then, I concluded that splitting those two things up doesn't make sense, as getting the orphan handling part right is complicated enough that it isn't worth the review burden for something that would just be ripped out later (and so I think we just go straight to package relay with a p2p protocol extension).\r\n\r\nI think it'd be perfectly reasonable to just rip out this behavior of trying to request parents when we receive an orphan -- it is fundamentally unreliable and is already just an opportunistic way to improve relay in one edge case situation.  Adding complexity solely for the purpose of supporting something that flaky is something we should all be skeptical about; this part of the codebase is already very difficult for most people to understand.\r\n\r\n> Oh, I hadn't realised that we'd respond to a MSG_WTX GETDATA request for a wtxid with a transaction that has that txid. The draft BIP doesn't specify that we should do that, and it seems extremely unintuitive. Could we have two mapRelays - one based on txid and one based on wtxid so we don't do this?\r\n\r\nI don't see the downside -- the behavior I've implemented seems strictly better, though non-essential and not something I think we need to specify in a BIP as behavior we promise to maintain.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-30T23:37:02Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400557458",
      "id" : 400557458,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU1NzQ1OA==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 384306035,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400557458",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400567195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400567195"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I don't see the downside\r\n\r\nJust my opinion, but: the p2p code is already really complicated and not really well understood, adding new behaviours and having the implementation and the spec differ in ways that matter in practice and aren't obvious seems like it makes that a fair bit worse. This makes the review burden for both this PR and future p2p changes much higher, since you can't just read the BIPs to understand how things should work, or the local bits of code to see how they do work to see if a change makes sense, but you have to deeply understand how many things interact to even get started.\r\n\r\nI was going to suggest adding code to explicitly ignore INVs that come in with the wrong TX/WTX marker for the peer sending them, and to not request orphan txs' parents when we're in WTX mode -- I do agree that behaviour's not too crucial to keep even without package relay; I just don't think mixing wtxid/txid values and having functionality relying on weird undocumented special cases like that working sometimes (only while the tx is in mapRelay but not after expiry?) is okay.\r\n\r\n(Not a nack, just my opinion; I'm open to being convinced otherwise. But I think I'll go back to poking at the notfound pr rather than holding off for this one getting merged for now)",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-31T00:08:21Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400567195",
      "id" : 400567195,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU2NzE5NQ==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 384317300,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400567195",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400958023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400958023"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ajtowns My view on this is that what goes into a BIP are the essential behaviors that all implementations should abide by in order to make an idea work, but non-essential implementation details are left for projects to individually figure out.\r\n\r\nThis makes it easier for new protocol extensions to get adopted by the whole community (the fewer requirements, the better), and for our own software to stay compatible with the BIPs we claim to implement, as otherwise we'd have to constantly deprecate/redraft/repropose, as we make minor changes to our own implementation.\r\n\r\nI'd say that how we handle a getdata request for a value that we never announced is one of those non-essential behaviors -- ignoring it is certainly fair, and returning something useful is obviously better still.  No one should assume, or would assume, that this is something that *ought* to work, so I don't think any software would be relying on this.\r\n\r\nAlso, if we had a set of design docs for how our own project implements particular BIPs, I'd agree that those should reflect more exactly what our code does -- but that would be a new initiative for us.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-31T14:27:37Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r400958023",
      "id" : 400958023,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk1ODAyMw==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 384789380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400958023",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r401018724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/401018724"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find this behavior very confusing. Can you help me understand if I'm getting any of this wrong:\r\n\r\n1. We have a peer that has negotiated wtxid relay\r\n2. That peer relays us a transaction whose parents we don't have\r\n3. We want to request the parent transaction, so we put the **txid** in the `m_tx_process_time` and `m_tx_announced` for this peer (https://github.com/bitcoin/bitcoin/pull/18044/files#diff-eff7adeaec73a769788bb78858815c91R2654). That **txid** will later be added to the global `g_already_asked_for` (https://github.com/bitcoin/bitcoin/pull/18044/files#diff-eff7adeaec73a769788bb78858815c91R4151)\r\n4. In `SendMessages()` we request that transaction with a MSG_WTX GETDATA, but with the hash set to the **txid** (https://github.com/bitcoin/bitcoin/pull/18044/files#diff-eff7adeaec73a769788bb78858815c91R3990). \r\n5. The peer responds to that GETDATA with a TX because it looks in its mapRelay for transactions with a txid OR wtxid that match (https://github.com/bitcoin/bitcoin/pull/18044/files#diff-eff7adeaec73a769788bb78858815c91R1628)\r\n6. When we receive the TX, we try to remove the **wtxid** from the peer's `m_tx_announced` and `m_tx_in_flight`, and the global `g_already_asked_for` (https://github.com/bitcoin/bitcoin/pull/18044/files#diff-eff7adeaec73a769788bb78858815c91R2587-R2594)\r\n\r\nThe thing I don't understand is that we seem to be adding the txid to these per-peer and global structures, and then trying to remove the wtxid from them. Will the txid ever be cleared? Do we end up in a request loop with the peer?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-31T15:44:37Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r401018724",
      "id" : 401018724,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTAxODcyNA==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 384865504,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/401018724",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r401205210"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/401205210"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I also can't quite follow the logic here: https://github.com/bitcoin/bitcoin/pull/18044/files#diff-eff7adeaec73a769788bb78858815c91R4139-R4140\r\n\r\nIt looks to me like the **txid** has been added to `m_tx_process_time`, but when we call into `AlreadyHave(inv, m_mempool)`, the inv is a `MSG_WTX`, so we'll check in our mempool for a transaction with that **wtxid** (which we won't find). We'll then rerequest the transaction from our peer.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-03-31T20:47:44Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r401205210",
      "id" : 401205210,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIwNTIxMA==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 385092425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/401205210",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r402389444"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402389444"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@sdaftuar \"No one should assume, or would assume, that this is something that ought to work\" -- but... aren't we assuming that it will work when we send a WTX request with a txid instead of a wtxid?\r\n\r\nAside from any bugs, I think this adds three lots of technical debt:\r\n\r\n * we're replying to `GETDATA WTX <txid>` and `GETDATA TX <wtxid>` if the tx is still in mapRelay -- this will go away if/when mapRelay goes away\r\n * we're asking for `WTX <txid>` when looking for parents of orphan transactions -- if we figure out how to replace orphan handling with package relay, this will go away too; but in the meantime it means mapRelay going away breaks orphan handling, and I think it breaks orphan handling when the parent's >15m old immediately\r\n * in the functional tests, as of #18446 at least, we're still sending TX INVs/GETDATAs etc despite claiming to be of a version that supports wtxid relay\r\n\r\nOne alternative might be to embrace the ambiguity: make the BIP be \"if you signal wtxidrelay, then we'll send `INV TX wtxid` instead of `INV TX txid`, and also allow you to request txs by either `GETDATA TX txid` or `GETDATA TX wtxid`\" ?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-04-02T15:08:52Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r402389444",
      "id" : 402389444,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM4OTQ0NA==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 386522752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402389444",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r402545909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402545909"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think I'm just going to eliminate the logic for requesting orphan parents from wtxid-relay peers, as you suggested above -- I think that is the simplest approach, and should eliminate the bugs reported by @jnewbery.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-04-02T19:04:50Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r402545909",
      "id" : 402545909,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0NTkwOQ==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 386715362,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-02T19:41:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402545909",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r403953004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403953004"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems okay. I think it could make sense to explicitly skip INVs offering a TX/WTX that we'd incorrectly GETDATA as a WTX/TX (respectively) as well:\r\n\r\n```diff\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -2323,6 +2323,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\r\n             if (interruptMsgProc)\r\n                 return true;\r\n \r\n+            // ignore INVs that don't match wtxidrelay setting\r\n+            if (State(pfrom->GetId())->m_wtxid_relay) {\r\n+                if (inv.type == MSG_TX) continue;\r\n+            } else {\r\n+                if (inv.type == MSG_WTX) continue;\r\n+            }\r\n+\r\n             bool fAlreadyHave = AlreadyHave(inv, mempool);\r\n             LogPrint(BCLog::NET, \"got inv: %s  %s peer=%d\\n\", inv.ToString(), fAlreadyHave ? \"have\" : \"new\", pfrom->GetId());\r\n```\r\n\r\n[I had a go](https://github.com/bitcoin/bitcoin/pull/18446#pullrequestreview-386416835) at updating fjahr's tests, and it seems to make reasonable sense (either with or without the change I suggest here)\r\n\r\n(This still leaves us with the tech debt of our functional tests mostly testing tx relay when we'll be moving towards doing wtxid relay most of the time in the real world, but that's not really avoidable)",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-04-06T09:31:24Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r403953004",
      "id" : 403953004,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk1MzAwNA==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 388080235,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-06T09:31:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403953004",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r412306569"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/412306569"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> (This still leaves us with the tech debt of our functional tests mostly testing tx relay when we'll be moving towards doing wtxid relay most of the time in the real world, but that's not really avoidable)\r\n\r\nI think that should be addressed with this update: https://github.com/fjahr/bitcoin/commit/becdb68ab37fdcbc1dcf743b19ea8629f52677bb",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-04-21T16:28:46Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r412306569",
      "id" : 412306569,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMwNjU2OQ==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 397471139,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-21T16:28:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/412306569",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r412350247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/412350247"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think it could make sense to explicitly skip INVs offering a TX/WTX that we'd incorrectly GETDATA as a WTX/TX (respectively) as well:\r\n\r\nAnd I agree with @ajtowns , this behavior makes intuitive sense to me and it matches my interpretation of the current description in the BIP: \"After a node has sent and received a \"wtxidrelay\" message to/from a given peer, the node is required to use the MSG_WTX inv-type when announcing transactions to that peer, or requesting announced transactions from that peer.\" \r\n\r\nI think it would even be reasonable to argue about banning peers for this behavior if there is an agreement that this behavior is wrong. The node is unnecessarily spamming the network and just silently dropping the message might let it take longer until an issue with this is discovered by the node user.",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-04-21T17:28:16Z",
      "diff_hunk" : "@@ -2568,8 +2644,13 @@ bool ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vR\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n                 for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r412350247",
      "id" : 412350247,
      "in_reply_to_id" : 399702162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM1MDI0Nw==",
      "original_commit_id" : "782a0b04496738030e3e51a6bf44aa5b426870b9",
      "original_line" : 2647,
      "original_position" : 346,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 397520388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-04-21T18:23:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/412350247",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-04-29T08:46:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-621070832",
      "id" : 621070832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTA3MDgzMg==",
      "updated_at" : "2020-04-29T08:46:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621070832",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@amitiuttarwar follow-up on this https://github.com/bitcoin/bitcoin/pull/18038#discussion_r400569145, now 18038 has been merged it would be really kind to have a patch for mempool intial-broadcast reattempt support and avoid wtxid taking too much delay :)",
      "created_at" : "2020-04-30T06:28:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-621639288",
      "id" : 621639288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTYzOTI4OA==",
      "updated_at" : "2020-04-30T06:28:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621639288",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ariard yup! thanks for flagging. already working on the patch & will post it here once its ready for review ",
      "created_at" : "2020-04-30T16:06:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-621949476",
      "id" : 621949476,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMTk0OTQ3Ng==",
      "updated_at" : "2020-04-30T16:06:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/621949476",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "initial attempt here: https://github.com/amitiuttarwar/bitcoin/commits/pr18044\r\n- rebased this branch on master, turned unbroadcast set into a map of txid -> wtxid, updated logic to play nice with changes to RelayTransaction. existing tests pass\r\n- can revisit and add tests as #18807 and #18446 make progress",
      "created_at" : "2020-05-01T22:37:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-622595865",
      "id" : 622595865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjU5NTg2NQ==",
      "updated_at" : "2020-05-01T22:37:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622595865",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r440251893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440251893"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`TX` (by txid, don't send witness), `WTX_TXID` (by txid, do send witness), `WTX_WTXID` (by wtxid, do send witness)` might be clearer?",
      "commit_id" : "9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68",
      "created_at" : "2020-06-15T15:16:54Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r440251893",
      "id" : 440251893,
      "in_reply_to_id" : 378574214,
      "line" : 372,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI1MTg5Mw==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_line" : 372,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 430744865,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-15T15:16:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440251893",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> initial attempt here: [amitiuttarwar/bitcoin@`pr18044` (commits)](https://github.com/amitiuttarwar/bitcoin/commits/pr18044)\r\n> \r\n> * rebased this branch on master, turned unbroadcast set into a map of txid -> wtxid, updated logic to play nice with changes to RelayTransaction. existing tests pass\r\n> * can revisit and add tests as #18807 and #18446 make progress\r\n\r\nWhich progress are you looking for in #18446?",
      "created_at" : "2020-06-19T10:44:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-646568265",
      "id" : 646568265,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjU2ODI2NQ==",
      "updated_at" : "2020-06-19T10:44:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646568265",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sdaftuar Sorry, I may be missing context but is this work blocked somehow? How can people help bring this closer to the finish line?",
      "created_at" : "2020-06-19T11:56:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-646595546",
      "id" : 646595546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjU5NTU0Ng==",
      "updated_at" : "2020-06-19T11:56:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646595546",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fjahr Thanks for the reminder, I've gone ahead and rebased this.  There were quite a few merge conflicts, so I hope reviewers will try to review these changes from scratch!",
      "created_at" : "2020-06-19T19:08:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-646821659",
      "id" : 646821659,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjgyMTY1OQ==",
      "updated_at" : "2020-06-19T19:08:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646821659",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm seeing a few post-rebase build warnings that weren't on 9eb584e1ffefdcbf7db0c3ca592f914c9ff46f68 (macOS clang v10):\r\n\r\n```\r\nvalidation.cpp:5102:49: warning: loop variable 'elem' has type 'const std::pair<uint256, uint256> &' but is initialized with type 'std::__1::__map_iterator<std::__1::__tree_iterator<std::__1::__value_type<uint256, uint256>, std::__1::__tree_node<std::__1::__value_type<uint256, uint256>, void *> *, long> >::value_type' (aka 'pair<const uint256, uint256>') resulting in a copy [-Wrange-loop-analysis]\r\n        for (const std::pair<uint256, uint256>& elem : unbroadcast_txids) {\r\n                                                ^\r\nvalidation.cpp:5102:14: note: use non-reference type 'std::pair<uint256, uint256>' to keep the copy or type 'const std::__1::__map_iterator<std::__1::__tree_iterator<std::__1::__value_type<uint256, uint256>, std::__1::__tree_node<std::__1::__value_type<uint256, uint256>, void *> *, long> >::value_type &' (aka 'const pair<const uint256, uint256> &') to prevent copying\r\n        for (const std::pair<uint256, uint256>& elem : unbroadcast_txids) {\r\n             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n1 warning generated.\r\n```\r\n```\r\nnet_processing.cpp:835:45: warning: loop variable 'elem' has type 'const std::pair<uint256, uint256> &' but is initialized with type 'std::__1::__map_iterator<std::__1::__tree_iterator<std::__1::__value_type<uint256, uint256>, std::__1::__tree_node<std::__1::__value_type<uint256, uint256>, void *> *, long> >::value_type' (aka 'pair<const uint256, uint256>') resulting in a copy [-Wrange-loop-analysis]\r\n    for (const std::pair<uint256, uint256>& elem : unbroadcast_txids) {\r\n                                            ^\r\nnet_processing.cpp:835:10: note: use non-reference type 'std::pair<uint256, uint256>' to keep the copy or type 'const std::__1::__map_iterator<std::__1::__tree_iterator<std::__1::__value_type<uint256, uint256>, std::__1::__tree_node<std::__1::__value_type<uint256, uint256>, void *> *, long> >::value_type &' (aka 'const pair<const uint256, uint256> &') to prevent copying\r\n    for (const std::pair<uint256, uint256>& elem : unbroadcast_txids) {\r\n         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nnet_processing.cpp:838:13: warning: calling function 'RelayTransaction' requires holding mutex 'cs_main' exclusively [-Wthread-safety-analysis]\r\n            RelayTransaction(elem.first, elem.second, *connman);\r\n            ^\r\n2 warnings generated.\r\n```\r\n```\r\nnode/transaction.cpp:85:9: warning: calling function 'RelayTransaction' requires holding mutex 'cs_main' exclusively [-Wthread-safety-analysis]\r\n        RelayTransaction(hashTx, tx->GetWitnessHash(), *node.connman);\r\n        ^\r\n1 warning generated.\r\n```",
      "created_at" : "2020-06-20T01:39:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-646917516",
      "id" : 646917516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjkxNzUxNg==",
      "updated_at" : "2020-06-20T02:04:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646917516",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK a7844da61d3f9eaca9d9d35337d463c64ac541a4, I think everything looks correct.\r\n\r\n- I confirm the build warnings [above](https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-646917516), would be nice to resolve them.\r\n- Also would be nice to address [these two issues](https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392511089) regarding outdated comments.\r\n- The code should be updated with BIP number once that's merged (this PR has a couple \"BIP XXX\").",
      "created_at" : "2020-06-20T09:24:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-646968108",
      "id" : 646968108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0Njk2ODEwOA==",
      "updated_at" : "2020-06-20T09:25:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646968108",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   }
]
