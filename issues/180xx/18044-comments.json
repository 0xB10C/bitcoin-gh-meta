[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18242 (Add BIP324 encrypted p2p transport de-/serializer (only used in tests) by jonasschnelli)\n* #18238 (net_processing: Retry notfounds with more urgency by ajtowns)\n* #17997 (refactor: Remove mempool global from net by MarcoFalke)\n* #17785 (p2p: Unify Send and Receive protocol versions by hebasto)\n* #17303 (p2p: Stop relaying non-mempool txs, improve tx privacy slightly by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-01-31T17:55:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-580840274",
      "id" : 580840274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDg0MDI3NA==",
      "updated_at" : "2020-03-12T02:44:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580840274",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373735577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373735577"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You're dereferencing `it` here after it has been incremented (see Travis failure). I think you want to use `inv.type` instead.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-01T00:02:11Z",
      "diff_hunk" : "@@ -1601,12 +1632,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             // Send stream from relay memory\n             bool push = false;\n             auto mi = mapRelay.find(inv.hash);\n+            // WTX and WITNESS_TX imply we serialize with witness\n             int nSendFlags = (inv.type == MSG_TX ? SERIALIZE_TRANSACTION_NO_WITNESS : 0);\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n             } else {\n-                auto txinfo = mempool.info(inv.hash);\n+                auto txinfo = mempool.info(inv.hash, it->type == MSG_WTX);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373735577",
      "id" : 373735577,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzczNTU3Nw==",
      "original_commit_id" : "310aafa76bc460f05ff061d24eb8ea6954a54fe4",
      "original_position" : 197,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 351841019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373735577",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373775307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373775307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, fixed.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-01T11:37:12Z",
      "diff_hunk" : "@@ -1601,12 +1632,13 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             // Send stream from relay memory\n             bool push = false;\n             auto mi = mapRelay.find(inv.hash);\n+            // WTX and WITNESS_TX imply we serialize with witness\n             int nSendFlags = (inv.type == MSG_TX ? SERIALIZE_TRANSACTION_NO_WITNESS : 0);\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n             } else {\n-                auto txinfo = mempool.info(inv.hash);\n+                auto txinfo = mempool.info(inv.hash, it->type == MSG_WTX);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373775307",
      "id" : 373775307,
      "in_reply_to_id" : 373735577,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3NTMwNw==",
      "original_commit_id" : "310aafa76bc460f05ff061d24eb8ea6954a54fe4",
      "original_position" : 197,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 351880462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373775307",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373775416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373775416"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I wonder if this should be sent immediately in response to a VERSION message, rather than in response to a VERACK.  It looks like the way I've done it here creates a race condition where a peer could send a txid-based inv to us before it gets this message, which I think would cause relay of that transaction to fail.\r\n\r\nhttps://travis-ci.org/bitcoin/bitcoin/jobs/644609638?utm_medium=notification&utm_source=github_status",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-01T11:39:03Z",
      "diff_hunk" : "@@ -2175,6 +2175,10 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n+        if (pfrom->nVersion >= WTXID_RELAY_VERSION) {\n+            connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::WTXIDRELAY));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r373775416",
      "id" : 373775416,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3NTQxNg==",
      "original_commit_id" : "ee29e7debcb14fa335e8482888a5cc0294bb8dc8",
      "original_position" : 6,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 351880546,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/373775416",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374576703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374576703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seeing a build warning here:\r\n```\r\nnet_processing.cpp: In member function âvirtual bool PeerLogicValidation::SendMessages(CNode*)â:\r\nnet_processing.cpp:4135:42: warning: enumeral and non-enumeral type in conditional expression [-Wextra]\r\n             CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);\r\n                      ~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n```",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-04T10:04:03Z",
      "diff_hunk" : "@@ -4057,7 +4132,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n-            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374576703",
      "id" : 374576703,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NjcwMw==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_position" : 449,
      "path" : "src/net_processing.cpp",
      "position" : 476,
      "pull_request_review_id" : 352852514,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374576703",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374697402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374697402"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah I saw that too, but I think the code is correct?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-04T14:21:25Z",
      "diff_hunk" : "@@ -4057,7 +4132,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n-            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374697402",
      "id" : 374697402,
      "in_reply_to_id" : 374576703,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5NzQwMg==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_position" : 449,
      "path" : "src/net_processing.cpp",
      "position" : 476,
      "pull_request_review_id" : 353010926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374697402",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Wrote up a short BIP draft here: https://github.com/sdaftuar/bips/blob/2020-02-wtxid-relay/bip-wtxid-relay.mediawiki, which this PR implements. \r\n\r\nI'll wait for some concept ACKs here before I send to the mailing list.",
      "created_at" : "2020-02-04T14:23:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-581932930",
      "id" : 581932930,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MTkzMjkzMA==",
      "updated_at" : "2020-02-04T14:23:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/581932930",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374699185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374699185"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it be a good idea to fetch `nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count()` once and use the same value for both relay expirations?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-04T14:24:25Z",
      "diff_hunk" : "@@ -3927,6 +3997,11 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                             if (ret.second) {\n                                 vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret.first));\n                             }\n+                            // Add wtxid-based lookup into mapRelay as well, so that peers can request by wtxid\n+                            auto ret2 = mapRelay.insert(std::make_pair(ret.first->second->GetWitnessHash(), ret.first->second));\n+                            if (ret2.second) {\n+                                vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret2.first));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374699185",
      "id" : 374699185,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5OTE4NQ==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_position" : 439,
      "path" : "src/net_processing.cpp",
      "position" : 466,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-10T12:07:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374699185",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice -- will add a link to the BIP draft in the review club notes at https://bitcoincore.reviews/18044. Currently reviewing. Can someone add a `Review club` label? It helps let people know that there is a review club resource they can use.",
      "created_at" : "2020-02-04T14:38:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-581939690",
      "id" : 581939690,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MTkzOTY5MA==",
      "updated_at" : "2020-02-10T08:14:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/581939690",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Cocnept ACK. Ran standard tests. All passing. Overall agreed with the idea of using wtxid for everything. Will try to try out the huristic and report some results.   ",
      "created_at" : "2020-02-04T18:27:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-582049318",
      "id" : 582049318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjA0OTMxOA==",
      "updated_at" : "2020-02-04T18:27:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582049318",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/codeShark149/events{/privacy}",
         "followers_url" : "https://api.github.com/users/codeShark149/followers",
         "following_url" : "https://api.github.com/users/codeShark149/following{/other_user}",
         "gists_url" : "https://api.github.com/users/codeShark149/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/codeShark149",
         "id" : 36541669,
         "login" : "codeShark149",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/codeShark149/orgs",
         "received_events_url" : "https://api.github.com/users/codeShark149/received_events",
         "repos_url" : "https://api.github.com/users/codeShark149/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/codeShark149/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/codeShark149/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/codeShark149"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374846097"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374846097"
         }
      },
      "author_association" : "NONE",
      "body" : "Doesn't this comment needs update in light of the changed condition? We are now accepting txs containg witness in recentRejects.  ",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-04T18:29:58Z",
      "diff_hunk" : "@@ -2604,14 +2604,15 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                 // We will continue to reject this tx since it has rejected\n                 // parents so avoid re-requesting it from other peers.\n                 recentRejects->insert(tx.GetHash());\n+                recentRejects->insert(tx.GetWitnessHash());\n             }\n         } else {\n-            if (!tx.HasWitness() && state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n+            if (tx.HasWitness() || state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n                 // Do not use rejection cache for witness transactions or\n                 // witness-stripped transactions, as they can have been malleated.\n                 // See https://github.com/bitcoin/bitcoin/issues/8279 for details.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r374846097",
      "id" : 374846097,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg0NjA5Nw==",
      "original_commit_id" : "fb1b69dba63ff9911a2520cdae8f5aab78f26ec0",
      "original_position" : 26,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 353203516,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/374846097",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/codeShark149/events{/privacy}",
         "followers_url" : "https://api.github.com/users/codeShark149/followers",
         "following_url" : "https://api.github.com/users/codeShark149/following{/other_user}",
         "gists_url" : "https://api.github.com/users/codeShark149/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/codeShark149",
         "id" : 36541669,
         "login" : "codeShark149",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/codeShark149/orgs",
         "received_events_url" : "https://api.github.com/users/codeShark149/received_events",
         "repos_url" : "https://api.github.com/users/codeShark149/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/codeShark149/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/codeShark149/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/codeShark149"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Reference [IRC discussion](http://www.erisian.com.au/bitcoin-core-dev/log-2020-02-05.html#l-336) for further context around the VERSION/VERACK messages.",
      "created_at" : "2020-02-06T19:47:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-583078254",
      "id" : 583078254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MzA3ODI1NA==",
      "updated_at" : "2020-02-06T19:47:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583078254",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r376195717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376195717"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it's treating `MSG_WTX` as `enum GetDataMsg` and `MSG_TX | GetFetchFlags()` as `uint32_t` (match `GetFetchFlags` return type). Changing `GetFetchFlags()` to return `GetDataMsg` (and casting its result correspondingly), and making it `enum GetDataMsg : uint32_t` makes the warning go away. Actually, just saying `enum GetDataMsg : uint32_t` makes the warning go away too by the looks.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-07T03:12:30Z",
      "diff_hunk" : "@@ -4057,7 +4132,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n-            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r376195717",
      "id" : 376195717,
      "in_reply_to_id" : 374576703,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE5NTcxNw==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_position" : 449,
      "path" : "src/net_processing.cpp",
      "position" : 476,
      "pull_request_review_id" : 354909544,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/376195717",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. First take: doing extra messages in between VERSION and VERACK sounds better to me than extending VERSION or potentially doing txid relay briefly in between VERACK and WTXIDRELAY, the code changes seem really nicely laid out, and the main thing that caught my eye looks like it's probably fixed by the WITNESS_STRIPPED addition.",
      "created_at" : "2020-02-09T19:36:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-583884102",
      "id" : 583884102,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4Mzg4NDEwMg==",
      "updated_at" : "2020-02-09T19:36:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583884102",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378570286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378570286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "How is  indexed_transaction_set::const_iterator different than txindex?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-12T23:22:17Z",
      "diff_hunk" : "@@ -690,8 +713,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const\n+    {\n+        LOCK(cs);\n+        return (mapTx.get<index_by_wtxid>().count(hash) != 0);\n+    }\n+\n     CTransactionRef get(const uint256& hash) const;\n-    TxMempoolInfo info(const uint256& hash) const;\n+    indexed_transaction_set::const_iterator get_iter_from_wtxid(const uint256& wtxid) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378570286",
      "id" : 378570286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3MDI4Ng==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 65,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378570286",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378572903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378572903"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can we rename the function, then?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-12T23:30:34Z",
      "diff_hunk" : "@@ -954,11 +954,11 @@ class CNode\n     }\n \n \n-    void AddInventoryKnown(const CInv& inv)\n+    void AddInventoryKnown(const uint256& hash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378572903",
      "id" : 378572903,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3MjkwMw==",
      "original_commit_id" : "9377e308a7e236aa807461795cd2ccd08e6a6a8b",
      "original_position" : 5,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378572903",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378574214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378574214"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "WITNESS_TX and WTX read a little bit too close for comfort. I don't think the extra characters to write a useful name cost us much :p.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-12T23:34:54Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378574214",
      "id" : 378574214,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU3NDIxNA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 18,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378574214",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378581343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378581343"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not (this pr's) your bug, but clang complains that you're copying shared_ptrs on every iteration and you should add a &.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-12T23:58:43Z",
      "diff_hunk" : "@@ -1184,6 +1204,7 @@ void PeerLogicValidation::BlockConnected(const std::shared_ptr<const CBlock>& pb\n         LOCK(g_cs_recent_confirmed_transactions);\n         for (const auto ptx : pblock->vtx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378581343",
      "id" : 378581343,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MTM0Mw==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 127,
      "path" : "src/net_processing.cpp",
      "position" : 127,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378581343",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378581882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378581882"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You should probably wipe this in ~CNetProcessingCleanup() like we do the other orphan fields, but, also, why the hell is that thing even there...",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-13T00:00:31Z",
      "diff_hunk" : "@@ -92,6 +94,7 @@ struct COrphanTx {\n };\n RecursiveMutex g_cs_orphans;\n std::map<uint256, COrphanTx> mapOrphanTransactions GUARDED_BY(g_cs_orphans);\n+std::map<uint256, std::map<uint256, COrphanTx>::iterator> g_orphans_by_wtxid GUARDED_BY(g_cs_orphans);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378581882",
      "id" : 378581882,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MTg4Mg==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 13,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378581882",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378586250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378586250"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would this be any different if it were *just* orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-13T00:16:17Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378586250",
      "id" : 378586250,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4NjI1MA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 226,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378586250",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378586654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378586654"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "s/tripped/stripped/, but, more importantly, can we? Wouldn't that allow an attacker to see an 0.19 client's inv, request the tx without delay (unlike its other peers), then spam the network with the witness-stripped version, preventing relay of that transaction. At least as long as we dont ban for TX_WITNESS_STRIPPED.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-13T00:17:42Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness tripped transactions) once",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378586654",
      "id" : 378586654,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4NjY1NA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 234,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 357860151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378586654",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FWIW, travis error is \" node0 2020-02-12T14:39:48.835709Z [msghand] Error: Disk space is too low! \"",
      "created_at" : "2020-02-13T00:28:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-585487309",
      "id" : 585487309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NTQ4NzMwOQ==",
      "updated_at" : "2020-02-13T00:28:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/585487309",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "node_id" : "MDQ6VXNlcjY0OTI0Ng==",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378851243"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378851243"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Suggestions?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-13T13:14:34Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378851243",
      "id" : 378851243,
      "in_reply_to_id" : 378574214,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1MTI0Mw==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 18,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 358204455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378851243",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378858979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378858979"
         }
      },
      "author_association" : "MEMBER",
      "body" : "From a single node's perspective, as long as you have at least 1 honest wtxid-relay peer, such an attack would not work, because the wtxid for the honest version of the transaction would not be added to your filter (only the txid), and so you would eventually request the valid version of the transaction from your honest wtxid-relay peer.\r\n\r\nCurrently we preference outbound peers for transaction download, so once we believe that some sufficient majority of listening nodes support wtxid-relay, such that the chances of having 0 or just a few wtxid-relay-outbound-peers is pretty small, then I think we can just get rid of this.  \r\n\r\nI don't think our threat model has ever really been too concerned with every node getting every transaction, anyway -- we just don't want the network as a whole to not relay a transaction altogether because of something like this.  So exactly how long we should wait before dropping this logic is debatable IMO; anyway we should defer the debate to the future when someone thinks this is ready. ",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-13T13:29:39Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness tripped transactions) once",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r378858979",
      "id" : 378858979,
      "in_reply_to_id" : 378586654,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1ODk3OQ==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 234,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 358214364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/378858979",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK on the BIP draft and the implementation of it\r\n\r\nI am not so sure about the 2-second delay, however, because it is not necessarily an improvement, it can also make matters worse afaict. Example: At least one of our `txid` peers is better connected than all of our `wtxid` peers. We get a `txid` inv first and wait for 2 seconds. Meanwhile, we receive the `wtxid` inv and request it, but before we get the response we also request the transaction from the  `txid` peer. I am not sure how realistic this is and it will certainly not happen frequently once large parts of the network have upgraded to `wtxid` invs. But I also think the PR is compelling enough without the 2-second delay optimization and it could be left as a follow-up so it can be discussed separately.\r\n\r\nDo you plan to add additional tests? Otherwise, I might be interested to look into that.",
      "created_at" : "2020-02-14T16:58:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-586375495",
      "id" : 586375495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NjM3NTQ5NQ==",
      "updated_at" : "2020-02-14T16:58:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/586375495",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r380426287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/380426287"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "(this is already fixed on master, so a rebase would solve it)",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-18T02:22:45Z",
      "diff_hunk" : "@@ -1184,6 +1204,7 @@ void PeerLogicValidation::BlockConnected(const std::shared_ptr<const CBlock>& pb\n         LOCK(g_cs_recent_confirmed_transactions);\n         for (const auto ptx : pblock->vtx) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r380426287",
      "id" : 380426287,
      "in_reply_to_id" : 378581343,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQyNjI4Nw==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 127,
      "path" : "src/net_processing.cpp",
      "position" : 127,
      "pull_request_review_id" : 360037046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/380426287",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK",
      "created_at" : "2020-02-18T20:03:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-587757896",
      "id" : 587757896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4Nzc1Nzg5Ng==",
      "updated_at" : "2020-02-18T20:03:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/587757896",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2020-02-25T19:46:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-591034818",
      "id" : 591034818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTAzNDgxOA==",
      "updated_at" : "2020-02-25T19:46:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591034818",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694065"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated with the `enum GetDataMsg : uint32_t` fix, thanks.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-26T18:52:58Z",
      "diff_hunk" : "@@ -4057,7 +4132,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n-            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            CInv inv(state.m_wtxid_relay ? MSG_WTX : (MSG_TX | GetFetchFlags(pto)), txid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694065",
      "id" : 384694065,
      "in_reply_to_id" : 374576703,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDA2NQ==",
      "original_commit_id" : "fd2c3f257e416323dc6cc1351af65a4026057716",
      "original_position" : 449,
      "path" : "src/net_processing.cpp",
      "position" : 476,
      "pull_request_review_id" : 365154543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:52:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694065",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-26T18:53:16Z",
      "diff_hunk" : "@@ -690,8 +713,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const\n+    {\n+        LOCK(cs);\n+        return (mapTx.get<index_by_wtxid>().count(hash) != 0);\n+    }\n+\n     CTransactionRef get(const uint256& hash) const;\n-    TxMempoolInfo info(const uint256& hash) const;\n+    indexed_transaction_set::const_iterator get_iter_from_wtxid(const uint256& wtxid) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694231",
      "id" : 384694231,
      "in_reply_to_id" : 378570286,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDIzMQ==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 65,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 365154772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:53:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694231",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694296"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-26T18:53:24Z",
      "diff_hunk" : "@@ -954,11 +954,11 @@ class CNode\n     }\n \n \n-    void AddInventoryKnown(const CInv& inv)\n+    void AddInventoryKnown(const uint256& hash)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694296",
      "id" : 384694296,
      "in_reply_to_id" : 378572903,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDI5Ng==",
      "original_commit_id" : "9377e308a7e236aa807461795cd2ccd08e6a6a8b",
      "original_position" : 5,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 365154867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:53:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694296",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed, thanks.\r\n\r\nNot sure exactly what you're asking but it seemed easier to add an additional map, rather than change the existing data structure to support wtxid-lookup.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-26T18:54:06Z",
      "diff_hunk" : "@@ -92,6 +94,7 @@ struct COrphanTx {\n };\n RecursiveMutex g_cs_orphans;\n std::map<uint256, COrphanTx> mapOrphanTransactions GUARDED_BY(g_cs_orphans);\n+std::map<uint256, std::map<uint256, COrphanTx>::iterator> g_orphans_by_wtxid GUARDED_BY(g_cs_orphans);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694706",
      "id" : 384694706,
      "in_reply_to_id" : 378581882,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDcwNg==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 13,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 365155345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:54:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694706",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694860"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nope, would not be different.  Fixed.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-26T18:54:23Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384694860",
      "id" : 384694860,
      "in_reply_to_id" : 378586250,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NDg2MA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 226,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 365155554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-26T18:54:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384694860",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated to fix the comments left so far.  I also changed the 2 second delay heuristic to only delay initial request of a transaction from a txid-relay peer, and not subsequent requests -- @naumenkogs pointed out to me that the original behavior I proposed would have opened us up to an \"InvBlock\" attack if we get a bunch of inbound peers that have wtxid-relay turned on, but don't yet have any outbound peers.\r\n\r\n@fjahr Please feel free to write some tests, thank you!  As for your comment about delaying transaction relay, yes I think that is the tradeoff -- reduce bandwidth at the expense of latency. ",
      "created_at" : "2020-02-26T18:57:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-591585772",
      "id" : 591585772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTU4NTc3Mg==",
      "updated_at" : "2020-02-26T18:57:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591585772",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384862855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384862855"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This comment is slightly confusing to me. If you setting this expectation here, maybe you want to enforce the rule in the code? Track whether VERACK was not received or something.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-27T01:17:24Z",
      "diff_hunk" : "@@ -2154,10 +2197,24 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r384862855",
      "id" : 384862855,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2Mjg1NQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 263,
      "path" : "src/net_processing.cpp",
      "position" : 263,
      "pull_request_review_id" : 365357115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-27T01:38:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/384862855",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385362270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385362270"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "54d58e7\r\n\r\n3 new pointers for `boost::multi_index::tag<index_by_wtxid>, mempoolentry_wtxid, SaltedTxidHasher`, not one for new `boost::multi_index::hashed_unique` ? ",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-27T20:47:40Z",
      "diff_hunk" : "@@ -912,8 +912,8 @@ bool CCoinsViewMemPool::GetCoin(const COutPoint &outpoint, Coin &coin) const {\n \n size_t CTxMemPool::DynamicMemoryUsage() const {\n     LOCK(cs);\n-    // Estimate the overhead of mapTx to be 12 pointers + an allocation, as no exact formula for boost::multi_index_contained is implemented.\n-    return memusage::MallocUsage(sizeof(CTxMemPoolEntry) + 12 * sizeof(void*)) * mapTx.size() + memusage::DynamicUsage(mapNextTx) + memusage::DynamicUsage(mapDeltas) + memusage::DynamicUsage(mapLinks) + memusage::DynamicUsage(vTxHashes) + cachedInnerUsage;\n+    // Estimate the overhead of mapTx to be 15 pointers + an allocation, as no exact formula for boost::multi_index_contained is implemented.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385362270",
      "id" : 385362270,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM2MjI3MA==",
      "original_commit_id" : "1d1fddb9790cb3b9a70df5370a71ac245491b71c",
      "original_position" : 35,
      "path" : "src/txmempool.cpp",
      "position" : 35,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-28T00:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385362270",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385428189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385428189"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What would be the challenges to switch mapOrphanTransactions to wtxid-only? It's just an internal structure, do we use it to interact with our peers ? (and even you can  translate backward there)",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-27T23:23:19Z",
      "diff_hunk" : "@@ -92,6 +94,7 @@ struct COrphanTx {\n };\n RecursiveMutex g_cs_orphans;\n std::map<uint256, COrphanTx> mapOrphanTransactions GUARDED_BY(g_cs_orphans);\n+std::map<uint256, std::map<uint256, COrphanTx>::iterator> g_orphans_by_wtxid GUARDED_BY(g_cs_orphans);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385428189",
      "id" : 385428189,
      "in_reply_to_id" : 378581882,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyODE4OQ==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 13,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-28T00:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385428189",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385437587"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385437587"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would be okay with MSG_WTXID to mark we only deal with tx identifier not a specific new data structure, we already have a GetDataMsg for the transaction and its witness.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-27T23:54:03Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385437587",
      "id" : 385437587,
      "in_reply_to_id" : 378574214,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzNzU4Nw==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 18,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-28T00:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385437587",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385439388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385439388"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "d0f03e9\r\n\r\nIs this rule a best-effort right now? At tx reception, we may have to request parent based only on the input. If so is the BIP clear enough on the 5) ? Precise also there is no current sanction of the rule by receiver as of today",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-27T23:59:43Z",
      "diff_hunk" : "@@ -230,6 +230,12 @@ extern const char *GETBLOCKTXN;\n  * @since protocol version 70014 as described by BIP 152\n  */\n extern const char *BLOCKTXN;\n+/**\n+ * Indicates that a node prefers to relay transactions via wtxid, rather than\n+ * txid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385439388",
      "id" : 385439388,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzOTM4OA==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_position" : 6,
      "path" : "src/protocol.h",
      "position" : 6,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-28T00:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385439388",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385441278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385441278"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "cf8c70f\r\n\r\nFor context-tracking, would be fine to even further comment, \"right now if we reject witness transactions based on their txids, relying on wtxid-based relay peers might lead to a stripped-witness tx starvation due to the low number of wtxid-relay peers at protocol deployment\"\r\n\r\nAlso, once we reach a deployment meaningful enough, should we merge together TX_WITNESS_MUTATED and TX_WITNESS_STRIPPED ?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-02-28T00:06:12Z",
      "diff_hunk" : "@@ -1942,10 +1943,16 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness stripped transactions) once\n+                // wtxid-based relay is broadly deployed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r385441278",
      "id" : 385441278,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0MTI3OA==",
      "original_commit_id" : "6e7290f8f830fbbe49f8578f5f4f3d52613c7056",
      "original_position" : 25,
      "path" : "src/net_processing.cpp",
      "position" : 235,
      "pull_request_review_id" : 365986399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-02-28T00:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385441278",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r387858917"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387858917"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What to do in that case?  We could disconnect the peer for violating the spec, or ignore the message and not switch to wtxid relay, but I thought trying to do wtxid-relay was the most practical, as it should mostly work (just things that were announced earlier might not be successfully requested).  Maybe it's better to not tolerate any kind of bugs though, so that implementations get all this stuff right?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-04T18:40:53Z",
      "diff_hunk" : "@@ -2154,10 +2197,24 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r387858917",
      "id" : 387858917,
      "in_reply_to_id" : 384862855,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1ODkxNw==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 263,
      "path" : "src/net_processing.cpp",
      "position" : 263,
      "pull_request_review_id" : 369026275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-04T18:40:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/387858917",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What taproot is making worst here than current tx-relay of segwit v0 txn ?\r\n\r\nExplained this offline, but the issue is that in a normal, non-adversarial situation where new nodes are relaying segwit transactions that violate old nodes' policy, those old nodes will be wasting bandwidth repeatedly downloading such transactions, because we have no caching of acceptance failure for segwit transactions.\r\n\r\n> Wrt to IRC discussion on multi-party transactions & tx-relay interference, at least for Lightning I can't see this as an issue, worst-case your counterparty can resign to produce another valid witness and you redownload twice ? Or is the attack finding a wtxid-collision with an invalid tx to make propagation of a valid time-sensitive tx near impossible?\r\n\r\nI think you're referencing an IRC conversation about a proposal to change wtxid-based relay to use some shorter, truncated hash instead (128 bits instead of 256 bits), which one version of the Erlay proposal called for.  I've opted not to pursue that, because the bandwidth savings seem small after Erlay.  If someone is going to advocate for truncated hashes, we can revisit the concerns from that conversation.",
      "created_at" : "2020-03-05T17:18:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-595345973",
      "id" : 595345973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTM0NTk3Mw==",
      "updated_at" : "2020-03-05T17:18:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595345973",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388444497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388444497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, you made a good observation -- our fetching of parents of orphan transactions must be by txid, rather than wtxid.  I did try to carefully word the BIP to avoid referencing this situation:\r\n\r\n> After a node has sent and received a \"wtxidrelay\" message to/from a given peer, the node is required to use the MSG_WTX inv-type when announcing transactions to that peer, or requesting announced transactions from that peer.\r\n\r\nSo the BIP says that newly announced transactions must be by wtxid.  And if your peer announces a transaction by wtxid, you must fetch it by wtxid (and not txid).  The BIP is silent on requests for transactions that are not announced -- we could make this explicit but this has never been documented behavior, and I'm not sure we should commit to a certain handling of this kind of thing anyway...  But open to suggestions.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-05T17:23:07Z",
      "diff_hunk" : "@@ -230,6 +230,12 @@ extern const char *GETBLOCKTXN;\n  * @since protocol version 70014 as described by BIP 152\n  */\n extern const char *BLOCKTXN;\n+/**\n+ * Indicates that a node prefers to relay transactions via wtxid, rather than\n+ * txid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388444497",
      "id" : 388444497,
      "in_reply_to_id" : 385439388,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ0NDQ5Nw==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_position" : 6,
      "path" : "src/protocol.h",
      "position" : 6,
      "pull_request_review_id" : 369765705,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-05T17:23:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388444497",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388445400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388445400"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In the future, I think I'd like to eventually get rid of WITNESS_STRIPPED as a reason that validation returns, because we incur non-trivial CPU usage in order to make the determination of whether a transaction might be WITNESS_STRIPPED.\r\n\r\n",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-05T17:24:42Z",
      "diff_hunk" : "@@ -1942,10 +1943,16 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness stripped transactions) once\n+                // wtxid-based relay is broadly deployed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388445400",
      "id" : 388445400,
      "in_reply_to_id" : 385441278,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ0NTQwMA==",
      "original_commit_id" : "6e7290f8f830fbbe49f8578f5f4f3d52613c7056",
      "original_position" : 25,
      "path" : "src/net_processing.cpp",
      "position" : 235,
      "pull_request_review_id" : 369766876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-05T17:24:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388445400",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388481642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388481642"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Disconnecting is too much, but ignoring the wtxid_relay message may be reasonable.\r\n\r\nAlternatively (and probably better), we can just make the comment more clear. Something like \"currently this is not enforced, because at most we get slight inefficiency if not following this rule\".\r\n\r\nAnd then the responsibility would be on the future developer to introduce the disconnect/ignore behavior if they choose to fundamentally rely on this assumption.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-05T18:31:29Z",
      "diff_hunk" : "@@ -2154,10 +2197,24 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388481642",
      "id" : 388481642,
      "in_reply_to_id" : 384862855,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4MTY0Mg==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 263,
      "path" : "src/net_processing.cpp",
      "position" : 263,
      "pull_request_review_id" : 369812647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-05T18:31:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388481642",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388504010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388504010"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I would amend the BIP to make its scope explicitly restrained. Add to 5) \"Note: this rule doesn't cover cases where a peer needs to request transaction for validation purposes but don't know its wtxid yet (e.g missing parents of a wtxid-announced child)\" ? At least to avoid someone raising same concern in the future and saying we don't commit on anything wrt to this issue.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-05T19:12:18Z",
      "diff_hunk" : "@@ -230,6 +230,12 @@ extern const char *GETBLOCKTXN;\n  * @since protocol version 70014 as described by BIP 152\n  */\n extern const char *BLOCKTXN;\n+/**\n+ * Indicates that a node prefers to relay transactions via wtxid, rather than\n+ * txid.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388504010",
      "id" : 388504010,
      "in_reply_to_id" : 385439388,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUwNDAxMA==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_position" : 6,
      "path" : "src/protocol.h",
      "position" : 6,
      "pull_request_review_id" : 369840075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-05T19:12:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388504010",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388504839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388504839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes that what I understood, you're thinking about the 2 `CheckInputScripts` in what is currently `PolicyScriptChecks`?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-05T19:13:39Z",
      "diff_hunk" : "@@ -1942,10 +1943,16 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness stripped transactions) once\n+                // wtxid-based relay is broadly deployed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388504839",
      "id" : 388504839,
      "in_reply_to_id" : 385441278,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUwNDgzOQ==",
      "original_commit_id" : "6e7290f8f830fbbe49f8578f5f4f3d52613c7056",
      "original_position" : 25,
      "path" : "src/net_processing.cpp",
      "position" : 235,
      "pull_request_review_id" : 369840988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-05T19:13:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388504839",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Explained this offline, but the issue is that in a normal, non-adversarial situation where new nodes are relaying segwit transactions that violate old nodes' policy, those old nodes will be wasting bandwidth repeatedly downloading such transactions, because we have no caching of acceptance failure for segwit transactions.\r\n\r\nYes thanks for explanation, what I didn't get was with a segwit upgrade deployment, transaction download waste wasn't encumbered only in case of _adversarial_ but also just for _normal_ situation (without change any segwit v1 would be redownload at every announcement by non-upgrades nodes).\r\n\r\n> I think you're referencing an IRC conversation about a proposal to change wtxid-based relay to use some shorter, truncated hash instead (128 bits instead of 256 bits), which one version of the Erlay proposal called for. I've opted not to pursue that, because the bandwidth savings seem small after Erlay. If someone is going to advocate for truncated hashes, we can revisit the concerns from that conversation.\r\n\r\nAttack scenario is knowing a wtxid, a counterparty may find transaction identifier _collision_ for an _invalid_ transaction to stuck a time-sensitive tx in the reject filter, and keep broadcasting such malicious transaction at every block tip until timelock expires. That's not a concern for LN today (because your counterparty doesn't know your witness for your local commitment tx) but that would change with something like Eltoo (because symmetric transaction). So Eltoo-style offchain contracts + short-bit transaction identifier is a security concern, something we should document somewhere (maybe add comment around `recentRejects`)",
      "created_at" : "2020-03-05T19:23:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-595402094",
      "id" : 595402094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTQwMjA5NA==",
      "updated_at" : "2020-03-05T19:23:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595402094",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388927279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388927279"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/the filter/the recentRejects filter/ in 6e7290f to aid git grepping (in which case can drop \"reject\" in the next line).\r\n\r\nIdem for the section in `ProcessMessage()`::L2684 containing the same paragraph.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-06T14:18:39Z",
      "diff_hunk" : "@@ -1910,12 +1943,18 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388927279",
      "id" : 388927279,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkyNzI3OQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 228,
      "path" : "src/net_processing.cpp",
      "position" : 228,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-10T12:07:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388927279",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388954495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388954495"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Further to @ariard's comment, a code doc explaining how the number 15 is arrived at might be helpful here.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-06T15:04:34Z",
      "diff_hunk" : "@@ -912,8 +912,8 @@ bool CCoinsViewMemPool::GetCoin(const COutPoint &outpoint, Coin &coin) const {\n \n size_t CTxMemPool::DynamicMemoryUsage() const {\n     LOCK(cs);\n-    // Estimate the overhead of mapTx to be 12 pointers + an allocation, as no exact formula for boost::multi_index_contained is implemented.\n-    return memusage::MallocUsage(sizeof(CTxMemPoolEntry) + 12 * sizeof(void*)) * mapTx.size() + memusage::DynamicUsage(mapNextTx) + memusage::DynamicUsage(mapDeltas) + memusage::DynamicUsage(mapLinks) + memusage::DynamicUsage(vTxHashes) + cachedInnerUsage;\n+    // Estimate the overhead of mapTx to be 15 pointers + an allocation, as no exact formula for boost::multi_index_contained is implemented.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388954495",
      "id" : 388954495,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk1NDQ5NQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 35,
      "path" : "src/txmempool.cpp",
      "position" : 35,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-10T12:07:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388954495",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  So Eltoo-style offchain contracts + short-bit transaction identifier is a security concern, something we should document somewhere (maybe add comment around recentRejects)\r\n\r\n@ariard This PR does not include a \"short-bit transaction identifier\" so I don't think any additional documentation is needed.",
      "created_at" : "2020-03-06T19:46:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-595931094",
      "id" : 595931094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NTkzMTA5NA==",
      "updated_at" : "2020-03-06T19:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/595931094",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389109682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389109682"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes that's right.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-06T19:46:38Z",
      "diff_hunk" : "@@ -1942,10 +1943,16 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n-                // Do not use rejection cache for witness transactions or\n-                // witness-stripped transactions, as they can have been malleated.\n-                // See https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+            if (orphan_state.GetResult() != TxValidationResult::TX_WITNESS_STRIPPED) {\n+                // Do not add txids of witness transactions or witness-stripped\n+                // transactions to the filter, as they can have been malleated;\n+                // adding such txids to the reject filter would potentially\n+                // interfere with relay of valid transactions from peers that\n+                // do not support wtxid-based relay. See\n+                // https://github.com/bitcoin/bitcoin/issues/8279 for details.\n+                // We can remove this restriction (and always add wtxids to\n+                // the filter even for witness stripped transactions) once\n+                // wtxid-based relay is broadly deployed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389109682",
      "id" : 389109682,
      "in_reply_to_id" : 385441278,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEwOTY4Mg==",
      "original_commit_id" : "6e7290f8f830fbbe49f8578f5f4f3d52613c7056",
      "original_position" : 25,
      "path" : "src/net_processing.cpp",
      "position" : 235,
      "pull_request_review_id" : 370583227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-06T19:46:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389109682",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @ariard This PR does not include a \"short-bit transaction identifier\" so I don't think any additional documentation is needed.\r\n\r\nYeah I know it's more a safeguard against someone proposing the idea in the future and this issue not being remembered.",
      "created_at" : "2020-03-07T05:35:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-596049687",
      "id" : 596049687,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NjA0OTY4Nw==",
      "updated_at" : "2020-03-07T05:35:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596049687",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389864907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389864907"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Curious why the `uint32_t` enum type is being added; good practice?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-09T17:59:55Z",
      "diff_hunk" : "@@ -358,12 +364,13 @@ const uint32_t MSG_TYPE_MASK    = 0xffffffff >> 2;\n  * These numbers are defined by the protocol. When adding a new value, be sure\n  * to mention it in the respective BIP.\n  */\n-enum GetDataMsg\n+enum GetDataMsg : uint32_t",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389864907",
      "id" : 389864907,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg2NDkwNw==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 18,
      "path" : "src/protocol.h",
      "position" : 18,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-10T12:07:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389864907",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389956408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389956408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/microseconds/seconds/ in 068bf9f -- that said, there are several other static constexprs that are also described as `Î¼s` but expressed in `s`.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-09T20:55:40Z",
      "diff_hunk" : "@@ -69,6 +69,8 @@ static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n /** Maximum number of announced transactions from a peer */\n static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions via txids, if we have wtxid-relaying peers */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r389956408",
      "id" : 389956408,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk1NjQwOA==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 4,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-10T12:07:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/389956408",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390040001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390040001"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps update the documentation L403-404 above to mention sorting the mempool by both txid and wtxid transaction hashes (and 5 criteria rather than 4, depending on how you count it).",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-10T00:56:40Z",
      "diff_hunk" : "@@ -467,6 +484,12 @@ class CTxMemPool\n         boost::multi_index::indexed_by<\n             // sorted by txid\n             boost::multi_index::hashed_unique<mempoolentry_txid, SaltedTxidHasher>,\n+            // sorted by wtxid",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390040001",
      "id" : 390040001,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA0MDAwMQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 35,
      "path" : "src/txmempool.h",
      "position" : 35,
      "pull_request_review_id" : 353013332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-10T12:07:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390040001",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390362519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390362519"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Because of this confusion I am generally not a fan of mentioning the type in the comment. I don't see why it's useful since ``std::chrono::microseconds`` definition is clear enough.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-10T14:38:57Z",
      "diff_hunk" : "@@ -69,6 +69,8 @@ static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n /** Maximum number of announced transactions from a peer */\n static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions via txids, if we have wtxid-relaying peers */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390362519",
      "id" : 390362519,
      "in_reply_to_id" : 389956408,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM2MjUxOQ==",
      "original_commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "original_position" : 4,
      "path" : "src/net_processing.cpp",
      "position" : 4,
      "pull_request_review_id" : 372013913,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-10T14:38:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390362519",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390368090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390368090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think MSG_WTXID is even more confusing than MSG_WTX. The suffix here represents an object being fetched. So TX or BLOCK with some type. MSG_WTXID would mean we are fetching an ID.\r\nThe only thing I can thing of is MSG_TX_BY_WTXID. But I'm also fine with MSG_WTX.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-10T14:46:01Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390368090",
      "id" : 390368090,
      "in_reply_to_id" : 378574214,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM2ODA5MA==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 18,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 372020907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-10T14:46:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390368090",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Also, I believe #18261 (the current implementation of Erlay) depends on these changes.",
      "created_at" : "2020-03-10T14:52:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-597129322",
      "id" : 597129322,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5NzEyOTMyMg==",
      "updated_at" : "2020-03-10T14:52:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/597129322",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390383225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390383225"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe I've been staring at this for too long but I agree with @naumenkogs. I confused `MSG_TX` and `MSG_WTX` once during the first pass at reviewing a few weeks ago, but then I got used to it and I like its brevity. I think it's fine for now.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-10T15:05:06Z",
      "diff_hunk" : "@@ -363,7 +369,8 @@ enum GetDataMsg\n     UNDEFINED = 0,\n     MSG_TX = 1,\n     MSG_BLOCK = 2,\n-    // The following can only occur in getdata. Invs always use TX or BLOCK.\n+    MSG_WTX = 5, // Defined in BIP XXX",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r390383225",
      "id" : 390383225,
      "in_reply_to_id" : 378574214,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MzIyNQ==",
      "original_commit_id" : "cf8c70fac6df96e23c37afe1c27eaa3925996caf",
      "original_position" : 18,
      "path" : "src/protocol.h",
      "position" : 24,
      "pull_request_review_id" : 372040091,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-10T15:05:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390383225",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392472822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392472822"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems that all call sites of `get_iter_from_wtxid` hold `cs` already. Perhaps it's better to have an `AssertLockHeld` / `EXCLUSIVE_LOCKS_REQUIRED` here instead?",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-13T20:58:15Z",
      "diff_hunk" : "@@ -690,8 +713,19 @@ class CTxMemPool\n         return (mapTx.count(hash) != 0);\n     }\n \n+    bool wtxid_exists(const uint256& hash) const\n+    {\n+        LOCK(cs);\n+        return (mapTx.get<index_by_wtxid>().count(hash) != 0);\n+    }\n+\n     CTransactionRef get(const uint256& hash) const;\n-    TxMempoolInfo info(const uint256& hash) const;\n+    txiter get_iter_from_wtxid(const uint256& wtxid) const\n+    {\n+        LOCK(cs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392472822",
      "id" : 392472822,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQ3MjgyMg==",
      "original_commit_id" : "1d1fddb9790cb3b9a70df5370a71ac245491b71c",
      "original_position" : 67,
      "path" : "src/txmempool.h",
      "position" : 67,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-13T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392472822",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505176"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Slightly more efficient and C++11ish:\r\n\r\n```suggestion\r\n                            auto ret2 = mapRelay.emplace(ret.first->second->GetWitnessHash(), ret.first->second);\r\n```",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-13T21:59:00Z",
      "diff_hunk" : "@@ -3927,6 +3927,11 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                             if (ret.second) {\n                                 vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret.first));\n                             }\n+                            // Add wtxid-based lookup into mapRelay as well, so that peers can request by wtxid\n+                            auto ret2 = mapRelay.insert(std::make_pair(ret.first->second->GetWitnessHash(), ret.first->second));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505176",
      "id" : 392505176,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwNTE3Ng==",
      "original_commit_id" : "b91a879d2c003dd7f7eef174aa59845137eae1a7",
      "original_position" : 5,
      "path" : "src/net_processing.cpp",
      "position" : 464,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-13T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505176",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505319"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n                                vRelayExpiration.emplace_back(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret2.first);\r\n```",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-13T21:59:31Z",
      "diff_hunk" : "@@ -3927,6 +3927,11 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n                             if (ret.second) {\n                                 vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret.first));\n                             }\n+                            // Add wtxid-based lookup into mapRelay as well, so that peers can request by wtxid\n+                            auto ret2 = mapRelay.insert(std::make_pair(ret.first->second->GetWitnessHash(), ret.first->second));\n+                            if (ret2.second) {\n+                                vRelayExpiration.push_back(std::make_pair(nNow + std::chrono::microseconds{RELAY_TX_CACHE_TIME}.count(), ret2.first));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505319",
      "id" : 392505319,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwNTMxOQ==",
      "original_commit_id" : "b91a879d2c003dd7f7eef174aa59845137eae1a7",
      "original_position" : 7,
      "path" : "src/net_processing.cpp",
      "position" : 466,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-13T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505319",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505963"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    g_orphans_by_wtxid.emplace(tx->GetWitnessHash(), ret.first);\r\n```",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-13T22:01:41Z",
      "diff_hunk" : "@@ -869,6 +870,8 @@ bool AddOrphanTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRE\n     auto ret = mapOrphanTransactions.emplace(hash, COrphanTx{tx, peer, GetTime() + ORPHAN_TX_EXPIRE_TIME, g_orphan_list.size()});\n     assert(ret.second);\n     g_orphan_list.push_back(ret.first);\n+    // Allow for lookups in the orphan pool by wtxid, as well as txid\n+    g_orphans_by_wtxid.insert(std::make_pair(tx->GetWitnessHash(), ret.first));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392505963",
      "id" : 392505963,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwNTk2Mw==",
      "original_commit_id" : "591931a2b0ea807f6f1392c4cde0f46e04b79696",
      "original_position" : 13,
      "path" : "src/net_processing.cpp",
      "position" : 87,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-13T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392505963",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392511089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392511089"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The comment on the next line here is outdated now.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-13T22:19:59Z",
      "diff_hunk" : "@@ -1916,12 +1916,12 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n             // Has inputs but not accepted to mempool\n             // Probably non-standard or insufficient fee\n             LogPrint(BCLog::MEMPOOL, \"   removed orphan tx %s\\n\", orphanHash.ToString());\n-            if (!orphanTx.HasWitness() && orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n+            if (orphanTx.HasWitness() || orphan_state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392511089",
      "id" : 392511089,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMTA4OQ==",
      "original_commit_id" : "0d3d656ab5334db15b91cc0708d7e12db32a5e0a",
      "original_position" : 5,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-13T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392511089",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392512606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392512606"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Next line's comment is outdated here as well.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-13T22:25:30Z",
      "diff_hunk" : "@@ -2604,14 +2604,15 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                 // We will continue to reject this tx since it has rejected\n                 // parents so avoid re-requesting it from other peers.\n                 recentRejects->insert(tx.GetHash());\n+                recentRejects->insert(tx.GetWitnessHash());\n             }\n         } else {\n-            if (!tx.HasWitness() && state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {\n+            if (tx.HasWitness() || state.GetResult() != TxValidationResult::TX_WITNESS_MUTATED) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392512606",
      "id" : 392512606,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMjYwNg==",
      "original_commit_id" : "0d3d656ab5334db15b91cc0708d7e12db32a5e0a",
      "original_position" : 23,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-13T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392512606",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392513202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392513202"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you use braces and indentation here? Combination of a line ending with ';' followed by `else` on the next line may be confusing.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-13T22:27:43Z",
      "diff_hunk" : "@@ -1356,7 +1360,8 @@ bool static AlreadyHave(const CInv& inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n \n             {\n                 LOCK(g_cs_orphans);\n-                if (mapOrphanTransactions.count(inv.hash)) return true;\n+                if (inv.type != MSG_WTX && mapOrphanTransactions.count(inv.hash)) return true;\n+                else if (inv.type == MSG_WTX && g_orphans_by_wtxid.count(inv.hash)) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392513202",
      "id" : 392513202,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMzIwMg==",
      "original_commit_id" : "44ea27c61d6466a6626fd986f2942e76c09465d8",
      "original_position" : 24,
      "path" : "src/net_processing.cpp",
      "position" : 147,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-13T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392513202",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392519821"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392519821"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The conditional seems superfluous here.",
      "commit_id" : "1cdf17837b26b8dfaf1aeec4c4a1a4b73810e4a5",
      "created_at" : "2020-03-13T22:55:17Z",
      "diff_hunk" : "@@ -2175,10 +2179,23 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             nCMPCTBLOCKVersion = 1;\n             connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\n         }\n+\n         pfrom->fSuccessfullyConnected = true;\n         return true;\n     }\n \n+    // Feature negotiation of wtxidrelay should happen between VERSION and\n+    // VERACK, to avoid relay problems from switching after a connection is up\n+    if (strCommand == NetMsgType::WTXIDRELAY) {\n+        if (pfrom->nVersion >= WTXID_RELAY_VERSION) {\n+            LOCK(cs_main);\n+            if (!State(pfrom->GetId())->m_wtxid_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#discussion_r392519821",
      "id" : 392519821,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxOTgyMQ==",
      "original_commit_id" : "021c5d392b6469596ba8eaa18c9ea01dafd9fdf0",
      "original_position" : 25,
      "path" : "src/net_processing.cpp",
      "position" : 267,
      "pull_request_review_id" : 374616026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18044",
      "updated_at" : "2020-03-13T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392519821",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-03-16T15:16:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18044#issuecomment-599593067",
      "id" : 599593067,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18044",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5OTU5MzA2Nw==",
      "updated_at" : "2020-03-16T15:16:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599593067",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
