[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18044 (Use wtxid for transaction relay by sdaftuar)\n* #17812 (config, net, test: asmap functional tests and feature refinements by jonatack)\n* #17303 (p2p: Stop relaying non-mempool txs, improve tx privacy slightly by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-01-31T08:39:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-580639076",
      "id" : 580639076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDYzOTA3Ng==",
      "updated_at" : "2020-02-27T02:02:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580639076",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-02-18T02:53:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-587249206",
      "id" : 587249206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4NzI0OTIwNg==",
      "updated_at" : "2020-02-18T02:53:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/587249206",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "travis failure seems unrelated- `feature_fee_estimation.py` ",
      "created_at" : "2020-02-27T20:14:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-592155950",
      "id" : 592155950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjE1NTk1MA==",
      "updated_at" : "2020-02-27T20:14:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592155950",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It could be a crash, because node1 stops to log anything at all",
      "created_at" : "2020-02-27T20:43:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#issuecomment-592167518",
      "id" : 592167518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18038",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjE2NzUxOA==",
      "updated_at" : "2020-02-27T20:43:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592167518",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385368573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385368573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this not saved to disk? It seems that on restart this set is cleared regardless of whether the tx was sent out.",
      "commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "created_at" : "2020-02-27T21:00:46Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast\n+    std::set<uint256> m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385368573",
      "id" : 385368573,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM2ODU3Mw==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_position" : 6,
      "path" : "src/txmempool.h",
      "position" : 6,
      "pull_request_review_id" : 365993014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "updated_at" : "2020-02-28T16:34:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385368573",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795095"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The comment is incorrect, since a tx is *not* removed when it is not sent, e.g. because it was not found.",
      "commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "created_at" : "2020-02-28T16:31:36Z",
      "diff_hunk" : "@@ -1590,6 +1590,11 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n+                // Once a peer requests GETDATA for a txn, we deem initial broadcast a success",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795095",
      "id" : 385795095,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NTA5NQ==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_position" : 4,
      "path" : "src/net_processing.cpp",
      "position" : 19,
      "pull_request_review_id" : 365993014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "updated_at" : "2020-02-28T16:34:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795095",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is the tx not removed when it was initially sent out after 15 minutes, e.g. when it was removed from mapRelay and then relayed from the mempool.\r\n\r\nI think this code should go down into the `if(push)` branch",
      "commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "created_at" : "2020-02-28T16:32:32Z",
      "diff_hunk" : "@@ -1590,6 +1590,11 @@ void static ProcessGetData(CNode* pfrom, const CChainParams& chainparams, CConnm\n             if (mi != mapRelay.end()) {\n                 connman->PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::TX, *mi->second));\n                 push = true;\n+                // Once a peer requests GETDATA for a txn, we deem initial broadcast a success\n+                int num = mempool.m_unbroadcast_txids.erase(inv.hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795542",
      "id" : 385795542,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NTU0Mg==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_position" : 5,
      "path" : "src/net_processing.cpp",
      "position" : 20,
      "pull_request_review_id" : 365993014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "updated_at" : "2020-02-28T16:34:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795542",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795926"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before tx was sent out. \\n\", hash.GetHex());\r\n```",
      "commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "created_at" : "2020-02-28T16:33:19Z",
      "diff_hunk" : "@@ -416,6 +416,10 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     for (const CTxIn& txin : it->GetTx().vin)\n         mapNextTx.erase(txin.prevout);\n \n+    if (mempool.m_unbroadcast_txids.erase(hash)) {\n+        LogPrint(BCLog::NET, \"Removed %i from m_unbroadcast_txids before GETDATA was received. \\n\", hash.GetHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385795926",
      "id" : 385795926,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NTkyNg==",
      "original_commit_id" : "66ec5571ad49b68366e4607cf0b671231083757e",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : 5,
      "pull_request_review_id" : 365993014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "updated_at" : "2020-02-28T16:34:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385795926",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385818114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385818114"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "great point. originally I was thinking of doing as a follow up PR (see [here](https://gist.github.com/amitiuttarwar/b592ee410e1f02ac0d44fcbed4621dba#follow-up-prs)), but now that this unbroadcast logic is broken out into its own PR I agree it makes sense here. I'll implement.",
      "commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "created_at" : "2020-02-28T17:15:38Z",
      "diff_hunk" : "@@ -534,6 +534,10 @@ class CTxMemPool\n     const setEntries & GetMemPoolParents(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     const setEntries & GetMemPoolChildren(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n     uint64_t CalculateDescendantMaximum(txiter entry) const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+\n+    // track locally submitted transactions & periodically retry initial broadcast\n+    std::set<uint256> m_unbroadcast_txids;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18038#discussion_r385818114",
      "id" : 385818114,
      "in_reply_to_id" : 385368573,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgxODExNA==",
      "original_commit_id" : "66ddec88f59b32928495767daa548dc41558d56c",
      "original_position" : 6,
      "path" : "src/txmempool.h",
      "position" : 6,
      "pull_request_review_id" : 366556224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18038",
      "updated_at" : "2020-02-28T17:15:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385818114",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   }
]
