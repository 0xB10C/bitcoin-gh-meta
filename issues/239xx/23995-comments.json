[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the problem with #23799 was that it introduced a second outer loop `while i < test_count:` which broke the `--failfast` option. If that option was chosen and a test failed, the break would leave the inner loop, but since the condition of the outer loop was not fulfilled, the inner loop would just be started again. \r\n\r\nAs far as I can see, this problem is still there (even though I can't reproduce the \"pop from empty list\" with this branch).",
      "created_at" : "2022-01-07T14:12:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23995#issuecomment-1007436418",
      "id" : 1007436418,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23995",
      "node_id" : "IC_kwDOABII5848DEKC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007436418/reactions"
      },
      "updated_at" : "2022-01-07T14:14:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007436418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I see the same behavior as @mzumsande: `--failfast` option doesn't work, and can't reproduce \"pop from empty list\".\r\n\r\nHere is a suggested fix. (I don't know how to suggest changes on lines unchanged.) Any feedback is appreciated as it is a learning opportunity.\r\n\r\n- add `failed` attribute to `TestHandler` class\r\n\r\n```python\r\nclass TestHandler:\r\n    \"\"\"\r\n    Trigger the test scripts passed in via the list.\r\n    \"\"\"\r\n\r\n    def __init__(self, *, num_tests_parallel, tests_dir, tmpdir, test_list, flags, use_term_control, failed):\r\n        assert num_tests_parallel >= 1\r\n        self.num_jobs = num_tests_parallel\r\n        self.tests_dir = tests_dir\r\n        self.tmpdir = tmpdir\r\n        self.test_list = test_list\r\n        self.flags = flags\r\n        self.jobs = []\r\n        self.use_term_control = use_term_control\r\n        self.failed = failed\r\n\r\njob_queue = TestHandler(\r\n    num_tests_parallel=jobs,\r\n    tests_dir=tests_dir,\r\n    tmpdir=tmpdir,\r\n    test_list=test_list,\r\n    flags=flags,\r\n    use_term_control=use_term_control,\r\n    failed=False\r\n)\r\n```\r\n\r\n- modify 'failed' in case of fast fail\r\n\r\n```python\r\nif failfast:\r\n    job_queue.failed = True\r\n    logging.debug(\"Early exiting after test failure\")\r\n    break\r\n```\r\n\r\n- modify `done` method\r\n\r\n```python\r\ndef done(self):\r\n    return self.failed or (not (self.jobs or self.test_list))\r\n```\r\n\r\n",
      "created_at" : "2022-01-13T02:15:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23995#issuecomment-1011681271",
      "id" : 1011681271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23995",
      "node_id" : "IC_kwDOABII5848TQf3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1011681271/reactions"
      },
      "updated_at" : "2022-01-13T02:15:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1011681271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91135419?v=4",
         "events_url" : "https://api.github.com/users/pg156/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pg156/followers",
         "following_url" : "https://api.github.com/users/pg156/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pg156/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pg156",
         "id" : 91135419,
         "login" : "pg156",
         "node_id" : "MDQ6VXNlcjkxMTM1NDE5",
         "organizations_url" : "https://api.github.com/users/pg156/orgs",
         "received_events_url" : "https://api.github.com/users/pg156/received_events",
         "repos_url" : "https://api.github.com/users/pg156/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pg156/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pg156/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pg156"
      }
   }
]
