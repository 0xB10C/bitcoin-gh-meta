[
   {
      "author_association" : "MEMBER",
      "body" : "This is a quite exotic case. As you mention, there are much worse thing that can be done if an attacker (even temporarily) can MitM a connection.\r\n\r\nI think it may be a good idea to document this property of BanMan, but I'd prefer to be more brief.\r\nSomething like this:\r\n\r\n``\r\nBanMan can be exploited by an on-path attacker: not necessarily user's hosting ISP, but any \"critical\" ISP on the way.\r\nAn attacker would have to spoof packets to trigger honest sane nodes banning each other.\r\nThis may be used to influence the network topology.\r\n``",
      "created_at" : "2020-06-03T04:28:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19147#issuecomment-637944916",
      "id" : 637944916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19147",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzk0NDkxNg==",
      "updated_at" : "2020-06-03T04:29:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637944916",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19147#discussion_r436053295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19147"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/436053295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"unlawful\"?",
      "commit_id" : "743cb6e00a1be6e45f3ea7bc58a50640f40528db",
      "created_at" : "2020-06-05T17:12:17Z",
      "diff_hunk" : "@@ -37,6 +37,23 @@ class CSubNet;\n // dangerous, because it can cause a network split\n // between nodes running old code and nodes running\n // new code.\n+//\n+// With regards to impersonation attack, i.e a malicious\n+// actor sending us directly invalid data while IP-spoofing\n+// an address of honest reacheable peers, thus triggering an\n+// unlawful ban of those:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19147#discussion_r436053295",
      "id" : 436053295,
      "line" : 44,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA1MzI5NQ==",
      "original_commit_id" : "743cb6e00a1be6e45f3ea7bc58a50640f40528db",
      "original_line" : 44,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 8,
      "pull_request_review_id" : 425478537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19147",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-05T17:12:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/436053295",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19147#discussion_r436053503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19147"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/436053503"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Couldn't such attackers just block the connection ?",
      "commit_id" : "743cb6e00a1be6e45f3ea7bc58a50640f40528db",
      "created_at" : "2020-06-05T17:12:41Z",
      "diff_hunk" : "@@ -37,6 +37,23 @@ class CSubNet;\n // dangerous, because it can cause a network split\n // between nodes running old code and nodes running\n // new code.\n+//\n+// With regards to impersonation attack, i.e a malicious\n+// actor sending us directly invalid data while IP-spoofing\n+// an address of honest reacheable peers, thus triggering an\n+// unlawful ban of those:\n+// * if attacker is a simple IP host, it won't work as our\n+// default connections rely on TCP and being out-the-path\n+// it will miss the SYN-ACK handshake reply.\n+// * if attacker is an on-the-path infrastructure one (ISPs,\n+// Tier2 or Tier1, ...), assuming IP packets forgeability\n+// capabilities, a malicious packet can be injected, i.e\n+// a mutated block received by node 1 from node 2 therefore\n+// provoking ban of node 2 for 24h. Such threat model scenario",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19147#discussion_r436053503",
      "id" : 436053503,
      "line" : 52,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA1MzUwMw==",
      "original_commit_id" : "743cb6e00a1be6e45f3ea7bc58a50640f40528db",
      "original_line" : 52,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 16,
      "pull_request_review_id" : 425478537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19147",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-05T17:12:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/436053503",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   }
]
