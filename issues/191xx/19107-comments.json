[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19053 (refactor: replace CNode pointers by references within net_processing.{h,cpp} by theStack)\n* #18985 (bloom: use Span instead of std::vector for `insert` and `contains` [ZAP3] by jb55)\n* #18849 (The Zero Allocations project by jb55)\n* #18638 (net: Use mockable time for ping/pong, add tests by MarcoFalke)\n* #17785 (p2p: Unify Send and Receive protocol versions by hebasto)\n* #15206 (Immediately disconnect on invalid net message checksum by jonasschnelli)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-29T16:29:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636066164",
      "id" : 636066164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjA2NjE2NA==",
      "updated_at" : "2020-05-29T16:29:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636066164",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432638537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432638537"
         }
      },
      "author_association" : "MEMBER",
      "body" : "use `nullopt`?",
      "commit_id" : "c8fb75737ce02c5df00db78cd407de46ae1124d7",
      "created_at" : "2020-05-29T17:39:09Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){\n+        Reset();\n+        return boost::none;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432638537",
      "id" : 432638537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYzODUzNw==",
      "original_commit_id" : "d5db6ad764a87eb59ee513857058fabba99d106c",
      "original_line" : 723,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421157205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-29T18:34:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432638537",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432667393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432667393"
         }
      },
      "author_association" : "NONE",
      "body" : "thanks, fixed",
      "commit_id" : "c8fb75737ce02c5df00db78cd407de46ae1124d7",
      "created_at" : "2020-05-29T18:37:10Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){\n+        Reset();\n+        return boost::none;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432667393",
      "id" : 432667393,
      "in_reply_to_id" : 432638537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2NzM5Mw==",
      "original_commit_id" : "d5db6ad764a87eb59ee513857058fabba99d106c",
      "original_line" : 723,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421196259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-05-29T18:37:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432667393",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-29T22:56:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636227452",
      "id" : 636227452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjIyNzQ1Mg==",
      "updated_at" : "2020-05-29T22:56:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636227452",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
