[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18985 (bloom: use Span instead of std::vector for `insert` and `contains` [ZAP3] by jb55)\n* #18849 (The Zero Allocations project by jb55)\n* #18638 (net: Use mockable time for ping/pong, add tests by MarcoFalke)\n* #17785 (p2p: Unify Send and Receive protocol versions by hebasto)\n* #15206 (Immediately disconnect on invalid net message checksum by jonasschnelli)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-29T16:29:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636066164",
      "id" : 636066164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjA2NjE2NA==",
      "updated_at" : "2020-06-01T02:22:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636066164",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432638537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432638537"
         }
      },
      "author_association" : "MEMBER",
      "body" : "use `nullopt`?",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-05-29T17:39:09Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){\n+        Reset();\n+        return boost::none;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432638537",
      "id" : 432638537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYzODUzNw==",
      "original_commit_id" : "d5db6ad764a87eb59ee513857058fabba99d106c",
      "original_line" : 723,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421157205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-01T02:12:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432638537",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432667393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432667393"
         }
      },
      "author_association" : "NONE",
      "body" : "thanks, fixed",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-05-29T18:37:10Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){\n+        Reset();\n+        return boost::none;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432667393",
      "id" : 432667393,
      "in_reply_to_id" : 432638537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2NzM5Mw==",
      "original_commit_id" : "d5db6ad764a87eb59ee513857058fabba99d106c",
      "original_line" : 723,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421196259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-01T02:12:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432667393",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-29T22:56:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636227452",
      "id" : 636227452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjIyNzQ1Mg==",
      "updated_at" : "2020-05-29T22:56:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636227452",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Thanks for adding doxy comment on `ReceiveMsgBytes`. That clarified few doubts for me. Verified unit tests and functional tests passing. \r\nFollowing are few nonblocking comments mostly for my understanding. ",
      "created_at" : "2020-06-01T09:15:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636725289",
      "id" : 636725289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjcyNTI4OQ==",
      "updated_at" : "2020-06-01T09:15:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636725289",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433130593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433130593"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems `ReceiveMsgBytes` returns two `bool`, (the function return and `bool& complete`), and both of them will have the same value at any execution (if I am not reading wrong). Is there any specific reason to make a function return the same boolean value twice?",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-06-01T09:23:38Z",
      "diff_hunk" : "@@ -572,6 +572,16 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n }\n #undef X\n \n+/**\n+ * Receive bytes from the buffer and deserialize them into messages.\n+ *\n+ * @param[in]   pch         Socket buffer\n+ * @param[in]   nBytes      Size of the socket buffer\n+ * @param[out]  complete    Set True if a message has been deserialized and is\n+ *                          ready to be processed\n+ * @return  True if the peer should stay connected,\n+ *          False if the peer should be disconnected from.\n+ */\n bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete)\n {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433130593",
      "id" : 433130593,
      "line" : 586,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEzMDU5Mw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 586,
      "original_position" : 15,
      "original_start_line" : 582,
      "path" : "src/net.cpp",
      "position" : 15,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : 582,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-01T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433130593",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433139799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433139799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "As it is a network magic error, the error code can be a little verbose for better understanding, something like this? Especially the command and size seems redundant.\r\n```suggestion\r\n        LogPrint(BCLog::NET, \"HEADER ERROR - NETMAGIC : (%s, %u bytes), expected %s got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE chain_params.MessageStart(), hdr.GetMessageStart());\r\n```",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-06-01T09:45:39Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433139799",
      "id" : 433139799,
      "line" : 675,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEzOTc5OQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 675,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 39,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-01T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433139799",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433142401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433142401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should it be called `HEADER ERROR` given the error is due to the bigger message size? I think the error code can also be improved a little here specifying the message size is bigger the max permissible size. \r\nSomething like \r\n```suggestion\r\n        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESIZE (%s, %u bytes), size %u bigger than max message size\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.nMessageSize);\r\n```\r\n",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-06-01T09:51:52Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes)\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433142401",
      "id" : 433142401,
      "line" : 681,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0MjQwMQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 681,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 45,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-01T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433142401",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433145200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433145200"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A comment here specifying `GetMessage` can fail due to invalid header might help here. ",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-06-01T09:58:13Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433145200",
      "id" : 433145200,
      "line" : 716,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0NTIwMA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 716,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 54,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-01T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433145200",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433146912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433146912"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems like an error message here might be appropriate similar to the checksum check? ",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-06-01T10:02:32Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433146912",
      "id" : 433146912,
      "line" : 721,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0NjkxMg==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 721,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 63,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-01T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433146912",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433147490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433147490"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why remove this comment block? ",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-06-01T10:03:56Z",
      "diff_hunk" : "@@ -3536,14 +3536,6 @@ bool PeerLogicValidation::CheckIfBanned(CNode* pnode)\n bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& interruptMsgProc)\n {\n     const CChainParams& chainparams = Params();\n-    //\n-    // Message format\n-    //  (4) message start\n-    //  (12) command\n-    //  (4) size\n-    //  (4) checksum\n-    //  (x) data\n-    //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433147490",
      "id" : 433147490,
      "line" : 3546,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0NzQ5MA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 3546,
      "original_position" : 11,
      "original_start_line" : 3539,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : 3539,
      "start_side" : "LEFT",
      "updated_at" : "2020-06-01T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433147490",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433148918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433148918"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A little more info in error message might help? ",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-06-01T10:07:20Z",
      "diff_hunk" : "@@ -109,31 +109,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){\n+                    LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433148918",
      "id" : 433148918,
      "line" : 127,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0ODkxOA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 127,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : 36,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-01T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433148918",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433149066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433149066"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same comment for a little more info in the error message.",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-06-01T10:07:41Z",
      "diff_hunk" : "@@ -109,31 +109,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){\n+                    LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);\n                     return false;\n+                }\n         }\n-        else if (*p1 < ' ' || *p1 > 0x7E)\n+        else if (*p1 < ' ' || *p1 > 0x7E){\n+            LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433149066",
      "id" : 433149066,
      "line" : 132,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0OTA2Ng==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 132,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : 42,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-01T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433149066",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\nRun p2p_transport_deserializer with args ['/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer', '-runs=1', '/home/travis/build/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_seed_corpus/p2p_transport_deserializer']INFO: Seed: 2855084377\r\n\r\nINFO: Loaded 1 modules   (412040 inline 8-bit counters): 412040 [0x560bb09480d8, 0x560bb09aca60), \r\n\r\nINFO: Loaded 1 PC tables (412040 PCs): 412040 [0x560bb09aca60,0x560bb0ff62e0), \r\n\r\nINFO:      128 files found in /home/travis/build/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_seed_corpus/p2p_transport_deserializer\r\n\r\nINFO: -max_len is not provided; libFuzzer will not generate inputs larger than 1048576 bytes\r\n\r\nINFO: seed corpus: files: 128 min: 1b max: 1048576b total: 8594313b rss: 88Mb\r\n\r\np2p_transport_deserializer: test/fuzz/p2p_transport_deserializer.cpp:35: void test_one_input(const std::vector<uint8_t> &): Assertion `result' failed.\r\n\r\n==31678== ERROR: libFuzzer: deadly signal\r\n\r\n    #0 0x560bae1f1881 in __sanitizer_print_stack_trace (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x198a881)\r\n\r\n    #1 0x560bae13c9d8 in fuzzer::PrintStackTrace() (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18d59d8)\r\n\r\n    #2 0x560bae121b23 in fuzzer::Fuzzer::CrashCallback() (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18bab23)\r\n\r\n    #3 0x7f38b4a473bf  (/lib/x86_64-linux-gnu/libpthread.so.0+0x153bf)\r\n\r\n    #4 0x7f38b46ae18a in raise (/lib/x86_64-linux-gnu/libc.so.6+0x4618a)\r\n\r\n    #5 0x7f38b468d858 in abort (/lib/x86_64-linux-gnu/libc.so.6+0x25858)\r\n\r\n    #6 0x7f38b468d728  (/lib/x86_64-linux-gnu/libc.so.6+0x25728)\r\n\r\n    #7 0x7f38b469ef35 in __assert_fail (/lib/x86_64-linux-gnu/libc.so.6+0x36f35)\r\n\r\n    #8 0x560bae21b71f in test_one_input(std::vector<unsigned char, std::allocator<unsigned char> > const&) /home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer.cpp:35:13\r\n\r\n    #9 0x560baf33d9e1 in LLVMFuzzerTestOneInput /home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/fuzz.cpp:36:5\r\n\r\n    #10 0x560bae1231e1 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18bc1e1)\r\n\r\n    #11 0x560bae122925 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18bb925)\r\n\r\n    #12 0x560bae125247 in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::__Fuzzer::vector<fuzzer::SizedFile, fuzzer::fuzzer_allocator<fuzzer::SizedFile> >&) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18be247)\r\n\r\n    #13 0x560bae1255a9 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector<fuzzer::SizedFile, fuzzer::fuzzer_allocator<fuzzer::SizedFile> >&) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18be5a9)\r\n\r\n    #14 0x560bae11427e in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18ad27e)\r\n\r\n    #15 0x560bae13d0c2 in main (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18d60c2)\r\n\r\n    #16 0x7f38b468f0b2 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x270b2)\r\n\r\n    #17 0x560bae0e901d in _start (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x188201d)\r\n\r\nNOTE: libFuzzer has rudimentary signal handlers.\r\n\r\n      Combine libFuzzer with AddressSanitizer or similar for better crash reports.\r\n\r\nSUMMARY: libFuzzer: deadly signal\r\n\r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n\r\n0xfa,0xbf,0xb5,0xda,0x40,0x6e,0x6e,0x6e,0x6e,0x7f,0x6f,0x3,0x34,0x64,0x6e,0x0,0x0,0x0,0x0,0x0,0x28,0xf6,0x6e,0x6e,\r\n\r\n\\xfa\\xbf\\xb5\\xda@nnnn\\x7fo\\x034dn\\x00\\x00\\x00\\x00\\x00(\\xf6nn\r\n\r\nartifact_prefix='./'; Test unit written to ./crash-fc30b01e02b9667a2f09968f8a88c869ab056464\r\n\r\nBase64: +r+12kBubm5uf28DNGRuAAAAAAAo9m5u",
      "created_at" : "2020-06-01T10:28:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636769885",
      "id" : 636769885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjc2OTg4NQ==",
      "updated_at" : "2020-06-01T10:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636769885",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433158495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433158495"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems like a very interesting observation, especially for new reviewers. Is it possible to combine the explanation with the question below and elucidate it more clearly? It took me some time to figure out what these statements were referring to.  ",
      "commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "created_at" : "2020-06-01T10:30:48Z",
      "diff_hunk" : "@@ -134,11 +135,21 @@ def run_test(self):\n             # Unmodified message should submit okay.\n             node.p2p.send_and_ping(msg)\n \n+            # ==elucidate the confusion below==\n+            #print(len(node.p2p.build_message(msg))) # 125\n+            # => Payload size = 125 - 24 = 101\n+            # If we take 77 bytes, then there are 101 - 77 = 24 left\n+            # That's exactly the size of a header\n+            # So, bitcoind deserializes the header and rejects it for some other reason\n+            # But, if we take 78 bytes, then there are 101 - 78 = 23 left\n+            # That's not enough to fill a header, so, what happens?\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433158495",
      "id" : 433158495,
      "line" : 146,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE1ODQ5NQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 146,
      "original_position" : 22,
      "original_start_line" : 138,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : 22,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : 138,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-01T10:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433158495",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   }
]
