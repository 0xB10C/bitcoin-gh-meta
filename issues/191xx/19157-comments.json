[
   {
      "author_association" : "MEMBER",
      "body" : "> Both methods may fail to detect some deadlocks\r\n\r\nIt seems they fail to detect a deadlock, but isn't the deadlock happening good enough of an indication that something is wrong? For example running the tests and observing a reproducible timeout should be enough to hint to a deadlock, no?",
      "created_at" : "2020-06-03T13:29:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19157#issuecomment-638197523",
      "id" : 638197523,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19157",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzODE5NzUyMw==",
      "updated_at" : "2020-06-03T13:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/638197523",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Well, the `DEBUG_LOCKORDER` checks and the deadlock detection from tsan exist because deadlocks happening are not good enough to analyze the problem. A sporadic timeout on CI once per week, or worse, on the users' computers without any printouts is very difficult to analyze.\r\n\r\nDeadlocks are often elusive and not 100% repoducable. Even in the test case above most of the code is to ensure that the deadlock actually happens :)",
      "created_at" : "2020-06-03T13:42:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19157#issuecomment-638205333",
      "id" : 638205333,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19157",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzODIwNTMzMw==",
      "updated_at" : "2020-06-03T13:42:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/638205333",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-06-03T13:48:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19157#issuecomment-638209854",
      "id" : 638209854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19157",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzODIwOTg1NA==",
      "updated_at" : "2020-06-03T13:48:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/638209854",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I submitted the testcase at https://github.com/google/sanitizers/issues/1258. It looks like a bug to me.",
      "created_at" : "2020-06-03T19:21:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19157#issuecomment-638409425",
      "id" : 638409425,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19157",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzODQwOTQyNQ==",
      "updated_at" : "2020-06-03T19:21:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/638409425",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild Are you familiar with the dining philosopher's problem?",
      "created_at" : "2020-06-03T19:33:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19157#issuecomment-638415904",
      "id" : 638415904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19157",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzODQxNTkwNA==",
      "updated_at" : "2020-06-03T19:33:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/638415904",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sipa, in the context of the dining philosophers problem I propose the [resource hierarchy solution](https://en.wikipedia.org/wiki/Dining_philosophers_problem#Resource_hierarchy_solution) where all resources (mutexes) are related by order.",
      "created_at" : "2020-06-04T06:53:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19157#issuecomment-638642004",
      "id" : 638642004,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19157",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzODY0MjAwNA==",
      "updated_at" : "2020-06-04T06:53:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/638642004",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild I'm not sure that works in the presence of multiple partially overlapping sets of dependent locks.\r\n\r\nLet's say the following lock orders exist: A->B A->C B->C (which is not a deadlock). Assume A->C is grabbed first, so you assign A=1, C=2; then A->B is grabbed, assigning B=3. Now B->C is grabbed which is considered a reversal and incorrectly treated as a deadlock.",
      "created_at" : "2020-06-04T19:30:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19157#issuecomment-639070249",
      "id" : 639070249,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19157",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTA3MDI0OQ==",
      "updated_at" : "2020-06-04T19:30:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639070249",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Sorry, I should have elaborated more - by \"predefined\" I mean hardcoded in the source code (not assigned dynamically at runtime).\r\n\r\nIn the above case the developer(s) would assign A=1, B=2, C=3. Then, if the code has a bug and locks in different order, e.g. first B, then A, just executing that code path is enough to catch the problem. No need to have two contradicting executions A->B & B->A like now.\r\n\r\nI counted about 70 mutexes in the entire code base, including tests. If it turns out that this is too big to do in one go we can start with defining the order between some mutexes and assign \"wildcard\" to the rest, skipping the hierarchy check for them.",
      "created_at" : "2020-06-05T08:12:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19157#issuecomment-639328800",
      "id" : 639328800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19157",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTMyODgwMA==",
      "updated_at" : "2020-06-05T08:12:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639328800",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
