{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "This implements the follow-up suggested here: https://github.com/bitcoin/bitcoin/pull/18861#issuecomment-627630111 . Instead of checking `setInventoryTxToSend`, maintain an explicit bloom filter with the 10000 most recently announced invs (which is more than what we can relay to normal peers in 15 minutes, the limit of the relay pool already). This helps with:\r\n\r\n* Fixing the brief opportunity an attacker has to request unannounced invs just after the connection is established (pointed out by @naumenkogs).\r\n* Guaranteeing that locally resubmitted invs just before `filterInventoryKnown` rolls over can still be requested (pointed out by @luke-jr).\r\n\r\nIn a second commit the logic is also applied to the mempool, making it restricted to the same 10000 invs limit. This is arguably a bigger behavior change but a nice simplification, and I'm happy to drop it if controversial. Since BIP35 requests are already subject to restrictions (such as needing a bloom filter, and be explicitly enabled), and 10000 is quite large already, I don't think it's much of a problem, however.\r\n\r\nThis is also a step towards dropping the relay pool entirely and always relaying from the mempool directly (see #17303), but that is still blocked by dealing properly with NOTFOUNDs (see #18238).",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19109/comments",
   "created_at" : "2020-05-29T19:01:02Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19109/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/19109",
   "id" : 627474205,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19109/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NDI1MjczMDky",
   "number" : 19109,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/19109.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19109",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/19109.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19109"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Only allow getdata of recently announced invs",
   "updated_at" : "2020-05-29T19:03:24Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19109",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
      "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipa/followers",
      "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipa",
      "id" : 548488,
      "login" : "sipa",
      "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
      "organizations_url" : "https://api.github.com/users/sipa/orgs",
      "received_events_url" : "https://api.github.com/users/sipa/received_events",
      "repos_url" : "https://api.github.com/users/sipa/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipa"
   }
}
