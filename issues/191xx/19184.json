{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "This replaces the transaction request logic with an encapsulated class that maintains all the state surrounding it. By keeping it stand alone, it can be easily tested (using included unit tests and fuzz tests).\r\n\r\nThe new logic implements is close in spirit to the current one, but much easier to specify I think:\r\n* Always prefer outbound peers over inbound peers, as long as any are available.\r\n* Don't download from inbound peers during the first 2 s after announcement, to give time for announcements from outbound peers to come in.\r\n* The peer who is the very first to announce a txid is preferred (compared to other inbounds or other outbounds), so that chains of dependent transactions announced by one peer will generally not be split out to other peers.\r\n* After the peer that announces a txid first, requests go to uniformly selected peers (outbounds first; inbounds that are past their 2 s delay afterwards), to minimize the impact an attacker can have (as attackers can easily race the network and be first).\r\n* A txid is never requested twice from the same peer, as long as other candidates remain.\r\n* Transactions are requested from new candidates as soon as old requests expire, or NOTFOUND is received, or invalid transactions are received (i.e. this includes the functionality added by, and replaces, #18238).\r\n\r\nOne significant change is the removal of the in-flight limit of 100 txids. I think this limit is not exactly desirable (e.g. when a txid is only announced by one peer, we should request it, regardless of how many other txids we're already waiting for), and with the changes to handle NOTFOUND immediately, there is less problems with high limits. I have some ideas about introducing a way to *bias* away from highly loaded peers, but I think this can be done later.\r\n\r\nThe implementation is non-trivial, in an attempt to keep both memory usage and performance acceptable under adverserial conditions. I encourage reviewers to first read the specification on top of the src/txrequest.h file, or the \"naive reimplementation\" in the src/test/fuzz/txrequest.cpp fuzz test, as there is reasonable evidence that the actual code implements the exact same behavior.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19184/comments",
   "created_at" : "2020-06-06T02:27:22Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19184/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/19184",
   "id" : 632144498,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "description" : null,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19184/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDExOlB1bGxSZXF1ZXN0NDI4OTI2MjA4",
   "number" : 19184,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/19184.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19184",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/19184.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19184"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Overhaul transaction request logic",
   "updated_at" : "2020-06-06T03:17:32Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19184",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
      "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipa/followers",
      "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipa",
      "id" : 548488,
      "login" : "sipa",
      "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
      "organizations_url" : "https://api.github.com/users/sipa/orgs",
      "received_events_url" : "https://api.github.com/users/sipa/received_events",
      "repos_url" : "https://api.github.com/users/sipa/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipa"
   }
}
