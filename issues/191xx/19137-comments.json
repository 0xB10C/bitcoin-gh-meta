[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20271 (doc: Document that wallet salvage is experimental by MarcoFalke)\n* #20267 (Disable and fix tests for when BDB is not compiled by achow101)\n* #20202 (wallet: Make BDB support optional by achow101)\n* #19078 (test: Add salvage test for wallet tool by MarcoFalke)\n* #18788 (tests: Update more tests to work with descriptor wallets by achow101)\n* #16546 (External signer support - Wallet Box edition by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-02T01:16:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-637210666",
      "id" : 637210666,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzIxMDY2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-31T05:11:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637210666",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-06-02T06:40:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-637311651",
      "id" : 637311651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzMxMTY1MQ==",
      "updated_at" : "2020-06-02T06:40:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637311651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-02T16:09:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-637654808",
      "id" : 637654808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNzY1NDgwOA==",
      "updated_at" : "2020-06-02T16:09:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637654808",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Can you add a sanity check to the test? E.g. a `getaddressinfo` call.",
      "created_at" : "2020-06-08T11:24:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-640543096",
      "id" : 640543096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MDU0MzA5Ng==",
      "updated_at" : "2020-06-08T11:24:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/640543096",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-17T10:01:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-645279086",
      "id" : 645279086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTI3OTA4Ng==",
      "updated_at" : "2020-06-17T10:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645279086",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-18T15:24:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-646094428",
      "id" : 646094428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjA5NDQyOA==",
      "updated_at" : "2020-06-18T15:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646094428",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r442510191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442510191"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (7ea3df8ccd13096088538fb4602208eae0831c13)\r\n\r\nWould suggest moving this to src/wallet/dump.cpp similar to src/wallet/salvage.cpp so the dump /load functionality be accessed other places outside the wallet tool, like by RPCs, the GUI, and c++ unit tests. Way arguments passed and errors are returned might have to change a little, though",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-18T21:22:48Z",
      "diff_hunk" : "@@ -183,6 +183,79 @@ static bool DumpWallet(std::shared_ptr<CWallet> wallet)\n     return ret;\n }\n \n+static bool CreateFromDump(const std::string& name, const fs::path& wallet_path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r442510191",
      "id" : 442510191,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUxMDE5MQ==",
      "original_commit_id" : "7ea3df8ccd13096088538fb4602208eae0831c13",
      "original_line" : 186,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 433656956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442510191",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r442574059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442574059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've moved it to a new file.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-19T00:46:50Z",
      "diff_hunk" : "@@ -183,6 +183,79 @@ static bool DumpWallet(std::shared_ptr<CWallet> wallet)\n     return ret;\n }\n \n+static bool CreateFromDump(const std::string& name, const fs::path& wallet_path)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r442574059",
      "id" : 442574059,
      "in_reply_to_id" : 442510191,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU3NDA1OQ==",
      "original_commit_id" : "7ea3df8ccd13096088538fb4602208eae0831c13",
      "original_line" : 186,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 433734927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442574059",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r443120133"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443120133"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there any reason to support stdout?\r\n\r\nI'd find it easier to force this setting for both settings and it would simplify reasoning about arbitrary code execution. IIRC in bash simply catting a file can execute arbitrary commands.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-20T10:27:10Z",
      "diff_hunk" : "@@ -26,12 +26,15 @@ static void SetupWalletToolArgs()\n \n     gArgs.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     gArgs.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n+    gArgs.AddArg(\"-dumpfile=<file name>\", \"When used with 'dump', writes out the records to this file instead of printing to stdout. When used with 'createfromdump', loads the records into a new wallet.\", ArgsManager::ALLOW_STRING, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r443120133",
      "id" : 443120133,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEyMDEzMw==",
      "original_commit_id" : "348be8dafe6642ff2084f8ebfd3471b7c4ed7508",
      "original_line" : 29,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 434419042,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443120133",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r443777592"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443777592"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed the output to stdout.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-22T19:27:23Z",
      "diff_hunk" : "@@ -26,12 +26,15 @@ static void SetupWalletToolArgs()\n \n     gArgs.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     gArgs.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n+    gArgs.AddArg(\"-dumpfile=<file name>\", \"When used with 'dump', writes out the records to this file instead of printing to stdout. When used with 'createfromdump', loads the records into a new wallet.\", ArgsManager::ALLOW_STRING, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r443777592",
      "id" : 443777592,
      "in_reply_to_id" : 443120133,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NzU5Mg==",
      "original_commit_id" : "348be8dafe6642ff2084f8ebfd3471b7c4ed7508",
      "original_line" : 29,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 435211281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443777592",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Maybe there should be a checksum at the end of the file to detect corruption.\r\n\r\nI'm not sure if that's really useful or practical. We are writing to the wallet file as we read the records so a checksum wouldn't be able to be computed until all records have been read and written to the file, at which point it's too late for a checksum to be useful.\r\n\r\n> Maybe there should be a magic string or version number at the beginning in case we want to extend the format in the future and prevent current parsing function from trying to read it\r\n\r\nI've added a line at the beginning to identify the file with the magic string `BITCOIN_CORE_WALLET_DUMP` and a version number.",
      "created_at" : "2020-06-22T19:29:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-647727895",
      "id" : 647727895,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NzcyNzg5NQ==",
      "updated_at" : "2020-06-22T19:29:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/647727895",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447154380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447154380"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove `;` at end of line.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-29T18:02:14Z",
      "diff_hunk" : "@@ -211,6 +211,56 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump');",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447154380",
      "id" : 447154380,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE1NDM4MA==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 219,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 439379277,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447154380",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447155606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447155606"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is getting caught in lint-python-utf8-encoding for not specifying `encoding=\"utf8\"`.\r\n```suggestion\r\n        with open(wallet_dump, 'r', encoding=\"utf8\") as f:\r\n```\r\n\r\nSame with the other `with open`s below (lines 244, 250, 255, and 260).",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-29T18:04:28Z",
      "diff_hunk" : "@@ -211,6 +211,56 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump');\n+\n+        self.log.info('Checking basic dump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet.dump\")\n+        self.assert_tool_output('', '-wallet=todump', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        with open(wallet_dump, 'r') as f:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447155606",
      "id" : 447155606,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE1NTYwNg==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 225,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 439379277,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447155606",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447166733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447166733"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "not your line but, s/wheter/whether/ if you have to touch-up",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-29T18:24:52Z",
      "diff_hunk" : "@@ -93,53 +93,66 @@ std::shared_ptr<BerkeleyEnvironment> GetWalletEnv(const fs::path& wallet_path, s\n /** Return wheter a BDB wallet database is currently loaded. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447166733",
      "id" : 447166733,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE2NjczMw==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 93,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.h",
      "position" : null,
      "pull_request_review_id" : 439394340,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447166733",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249011"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-29T20:56:38Z",
      "diff_hunk" : "@@ -211,6 +211,56 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump');",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249011",
      "id" : 447249011,
      "in_reply_to_id" : 447154380,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI0OTAxMQ==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 219,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 439494256,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249011",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249073"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-29T20:56:46Z",
      "diff_hunk" : "@@ -211,6 +211,56 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump');\n+\n+        self.log.info('Checking basic dump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet.dump\")\n+        self.assert_tool_output('', '-wallet=todump', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        with open(wallet_dump, 'r') as f:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249073",
      "id" : 447249073,
      "in_reply_to_id" : 447155606,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI0OTA3Mw==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 225,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 439494344,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249073",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249331"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think that'd be better to fix in one of the prerequisite PRs or a followup to this whole PR stack.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-06-29T20:57:20Z",
      "diff_hunk" : "@@ -93,53 +93,66 @@ std::shared_ptr<BerkeleyEnvironment> GetWalletEnv(const fs::path& wallet_path, s\n /** Return wheter a BDB wallet database is currently loaded. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r447249331",
      "id" : 447249331,
      "in_reply_to_id" : 447166733,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI0OTMzMQ==",
      "original_commit_id" : "abd8925e047112971f3df0cdda0868acca2e29e6",
      "original_line" : 93,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.h",
      "position" : null,
      "pull_request_review_id" : 439494708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447249331",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-01T14:25:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-652450661",
      "id" : 652450661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjQ1MDY2MQ==",
      "updated_at" : "2020-07-01T14:25:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652450661",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-05T22:38:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-653947745",
      "id" : 653947745,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1Mzk0Nzc0NQ==",
      "updated_at" : "2020-07-05T22:38:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653947745",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-08T23:41:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-655813093",
      "id" : 655813093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NTgxMzA5Mw==",
      "updated_at" : "2020-07-08T23:41:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655813093",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r452388016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452388016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4d7d60a710f38a7bd2d9b8fb5da92186f2ad64ee: `ret` is already `false`",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-07-09T17:47:22Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    tfm::format(dump_file, \"%s,1\\n\", DUMP_MAGIC);\n+\n+    if (ret) {\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                ret = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r452388016",
      "id" : 452388016,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM4ODAxNg==",
      "original_commit_id" : "4d7d60a710f38a7bd2d9b8fb5da92186f2ad64ee",
      "original_line" : 51,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 445837897,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452388016",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r452399561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452399561"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm. That should be a break. Fixed.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-07-09T18:08:54Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    tfm::format(dump_file, \"%s,1\\n\", DUMP_MAGIC);\n+\n+    if (ret) {\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                ret = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r452399561",
      "id" : 452399561,
      "in_reply_to_id" : 452388016,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM5OTU2MQ==",
      "original_commit_id" : "4d7d60a710f38a7bd2d9b8fb5da92186f2ad64ee",
      "original_line" : 51,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 445852958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452399561",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not sure about the path issue. I just use our fs module to try to get the absolute path.\r\n\r\nAlso updated the OP.",
      "created_at" : "2020-07-09T18:09:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-656274176",
      "id" : 656274176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjI3NDE3Ng==",
      "updated_at" : "2020-07-09T18:09:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656274176",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-07-30T16:25:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-666505782",
      "id" : 666505782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjUwNTc4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T16:25:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666505782",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-08-14T15:03:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-674117865",
      "id" : 674117865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDExNzg2NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T15:03:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674117865",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r480299273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/480299273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: `DUMP_VERSION`",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-08-31T18:08:38Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    tfm::format(dump_file, \"%s,1\\n\", DUMP_MAGIC);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r480299273",
      "id" : 480299273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI5OTI3Mw==",
      "original_commit_id" : "4e631d278abec3801ddf245450cb8b362d4d2607",
      "original_line" : 38,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 478830735,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/480299273",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I wonder if we should include a warning either in the output or in the dumpfile itself that the file should not be shared.\r\n\r\nI suppose we should. I would prefer to just output it on stdout rather than put it in the file.",
      "created_at" : "2020-08-31T23:14:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684090845",
      "id" : 684090845,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDA5MDg0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T23:14:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684090845",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@achow101 that sounds fine. Can you quickly add that in before I merge please.",
      "created_at" : "2020-08-31T23:33:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684101944",
      "id" : 684101944,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDEwMTk0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T23:33:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684101944",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag do you have a proposed use-case for piping a wallet dump? That seems a little dangerous to me.",
      "created_at" : "2020-08-31T23:46:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684105921",
      "id" : 684105921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDEwNTkyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T23:46:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684105921",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Compress or encrypt or grep ð ",
      "created_at" : "2020-08-31T23:49:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684106734",
      "id" : 684106734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDEwNjczNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T23:49:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684106734",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think it should be left for a followup but in that case I think it should be done in a way that you have to explicitly choose to pass to stdout. I think many users may accidentally type \"dump\" without realizing they need to configure -dumpfile, and have their whole wallet just dumped to their terminal.",
      "created_at" : "2020-09-01T00:04:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684111211",
      "id" : 684111211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDExMTIxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T00:04:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684111211",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yeah that's fine, like `-dumpfile -` or something.",
      "created_at" : "2020-09-01T00:09:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684112844",
      "id" : 684112844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDExMjg0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T00:09:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684112844",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r480632428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/480632428"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-09-01T02:38:26Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    tfm::format(dump_file, \"%s,1\\n\", DUMP_MAGIC);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r480632428",
      "id" : 480632428,
      "in_reply_to_id" : 480299273,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDYzMjQyOA==",
      "original_commit_id" : "4e631d278abec3801ddf245450cb8b362d4d2607",
      "original_line" : 38,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 479361570,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/480632428",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added the warning and a checksum to the dumpfile.",
      "created_at" : "2020-09-01T02:38:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684158119",
      "id" : 684158119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDE1ODExOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T02:38:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684158119",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Re-utACK 7e845b87c18719274c1db3c9d04fbf99407716c0",
      "created_at" : "2020-09-01T10:44:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684761162",
      "id" : 684761162,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDc2MTE2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T10:44:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684761162",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Spurious Travis failure reported in #19853 and intentionally not restarted.\r\n\r\nAlso:\r\n```\r\nwallet/wallettool.cpp:134:33: warning: loop variable 'warning' of type 'const bilingual_str' creates a copy from type 'const bilingual_str' [-Wrange-loop-analysis]\r\n                for (const auto warning : warnings) {\r\n                                ^\r\nwallet/wallettool.cpp:134:22: note: use reference type 'const bilingual_str &' to prevent copying\r\n                for (const auto warning : warnings) {\r\n                     ^~~~~~~~~~~~~~~~~~~~\r\n1 warning generated.\r\n```",
      "created_at" : "2020-09-01T12:31:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684818114",
      "id" : 684818114,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDgxODExNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T12:44:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684818114",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sjors I don't think that was caused by this PR.",
      "created_at" : "2020-09-01T16:15:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-684973008",
      "id" : 684973008,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDk3MzAwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-01T16:15:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684973008",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482009780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482009780"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could check if open is successful and add corresponding test.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-09-02T11:52:09Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482009780",
      "id" : 482009780,
      "line" : 27,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAwOTc4MA==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 27,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 27,
      "pull_request_review_id" : 480742588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482009780",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482228428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482228428"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure how that would be tested. The `open` occurs after file existence has been checked for, so the only thing it would error on is some system thing.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-09-02T17:07:30Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482228428",
      "id" : 482228428,
      "in_reply_to_id" : 482009780,
      "line" : 27,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIyODQyOA==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 27,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 27,
      "pull_request_review_id" : 481029049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482228428",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482243457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482243457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a check that `open` doesn't fail.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-09-02T17:27:35Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482243457",
      "id" : 482243457,
      "in_reply_to_id" : 482009780,
      "line" : 27,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI0MzQ1Nw==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 27,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 27,
      "pull_request_review_id" : 481044114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482243457",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482266130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482266130"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can test by creating a directory and removing write access, then try to create the dump there.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-09-02T18:06:49Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482266130",
      "id" : 482266130,
      "in_reply_to_id" : 482009780,
      "line" : 27,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI2NjEzMA==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 27,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 27,
      "pull_request_review_id" : 481125569,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482266130",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482614513"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482614513"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Like\r\n```py\r\nself.assert_raises_tool_error('Unable to open /root/cant_write for writing', '-wallet=todump', '-dumpfile=/root/cant_write', 'dump')\r\n```",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-09-03T00:24:09Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r482614513",
      "id" : 482614513,
      "in_reply_to_id" : 482009780,
      "line" : 27,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjYxNDUxMw==",
      "original_commit_id" : "b9cb50ed299c55cf03093654e0af8dc98edf6d60",
      "original_line" : 27,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 27,
      "pull_request_review_id" : 481398822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482614513",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I wonder if the content should have the dump timestamp, at the end like `timestamp,...`?",
      "created_at" : "2020-09-03T00:26:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-686156813",
      "id" : 686156813,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NjE1NjgxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-03T00:26:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686156813",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I wonder if the content should have the dump timestamp, at the end like `timestamp,...`?\r\n\r\nI don't think that's necessary. The file itself will have a creation timestamp and I think that's good enough.\r\n\r\nIf we do want this, we can add it later. Records can be added after the checksum and `createfromdump` will ignore them.",
      "created_at" : "2020-09-03T15:51:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-686585184",
      "id" : 686585184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NjU4NTE4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-03T15:51:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686585184",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-07T00:50:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-687954412",
      "id" : 687954412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Nzk1NDQxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-07T00:50:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687954412",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This will need to have a format option to specify bdb or sqlite. I'll work on that next week.",
      "created_at" : "2020-10-15T22:22:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-709620942",
      "id" : 709620942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTYyMDk0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-15T22:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709620942",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Great, I'll try migrating some BDB descriptor wallets to Sqlite once that's ready.",
      "created_at" : "2020-10-16T09:14:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-709928840",
      "id" : 709928840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwOTkyODg0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-16T09:14:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/709928840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated with a `-format` option added to `createfromdump`",
      "created_at" : "2020-10-18T18:49:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-711371247",
      "id" : 711371247,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMTM3MTI0Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-18T18:49:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/711371247",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Apparently this fails to dump/restore the wallet unique id.\r\n\r\nThe wallet id is not something we are actually using and supporting. It is a byproduct of BDB. Instead of forcing this wallet logic and database type agnostic tool to have to understand BDB, we should make the wallet id actually supported with #20205. I'm not adding BDB id stuff to this PR, it's out of scope and a layer violation.",
      "created_at" : "2020-10-21T16:12:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-713689400",
      "id" : 713689400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxMzY4OTQwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-21T16:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/713689400",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509792246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509792246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"tests: Test bitcoin-wallet dump and createfromdump\" (35442fa568583c0da2c687966e49b3742f403870)\r\n\r\nLooking at the `CreateFromDump` implementation it seems like the wallet will be created but empty if there is a checksum error or other import error. It would be good if there was a check at this point to verify if the created wallets are loadable if they are supposed to be loadable or not loadable if they are not supposed be loadable.\r\n\r\n",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-21T23:27:23Z",
      "diff_hunk" : "@@ -212,6 +212,92 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump')\n+\n+        self.log.info('Checking basic dump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=todump', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            dump_data = f.read()\n+        # Check the dump magic\n+        assert dump_data.startswith('BITCOIN_CORE_WALLET_DUMP,1')\n+\n+        self.log.info('Checking that a dumpfile cannot be overwritten')\n+        self.assert_raises_tool_error('File {} already exists. If you are sure this is what you want, move it out of the way first.'.format(wallet_dump),  '-wallet=todump2', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        self.log.info('Checking createfromdump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'createfromdump')\n+        non_exist_dump = os.path.join(self.nodes[0].datadir, \"wallet.nodump\")\n+        self.assert_raises_tool_error('No wallet file format provided. To use createfromdump, -format=<format> must be provided.', '-wallet=todump', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        self.assert_raises_tool_error('Unknown wallet file format \"notaformat\" provided. Please provide one of \"bdb\" or \"sqlite\".', '-wallet=todump', '-format=notaformat', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        self.assert_raises_tool_error('Dump file {} does not exist.'.format(non_exist_dump), '-wallet=todump', '-format=bdb', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        wallet_path = os.path.join(self.nodes[0].datadir, 'regtest/wallets/todump2')\n+        self.assert_raises_tool_error('Error: Wallet File {} exists already'.format(wallet_path), '-wallet=todump2', '-format=bdb', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+\n+        self.log.info('Checking createfromdump')\n+        self.assert_tool_output('', '-wallet=load', '-format=bdb', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-rt.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=load', '-dumpfile={}'.format(wallet_dump), 'dump')\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            assert_equal(dump_data, f.read())\n+        orig_dump = dump_data\n+        wallet_dat = os.path.join(self.nodes[0].datadir, \"regtest/wallets/load\", \"wallet.dat\")\n+        with open(wallet_dat, 'rb') as f:\n+            f.seek(12, 0)\n+            file_magic = f.read(4)\n+            assert file_magic == b'\\x00\\x05\\x31\\x62' or file_magic == b'\\x62\\x31\\x05\\x00'\n+        self.assert_tool_output('', '-wallet=load-sqlite', '-format=sqlite', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-rt-sqlite.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=load-sqlite', '-dumpfile={}'.format(wallet_dump), 'dump')\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            assert_equal(dump_data, f.read())\n+        wallet_dat = os.path.join(self.nodes[0].datadir, \"regtest/wallets/load-sqlite\", \"wallet.dat\")\n+        with open(wallet_dat, 'rb') as f:\n+            file_magic = f.read(16)\n+            assert file_magic == b'SQLite format 3\\x00'\n+\n+        self.log.info('Checking createfromdump handling of magic and versions')\n+        bad_ver_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_ver1.dump\")\n+        dump_data = 'BITCOIN_CORE_WALLET_DUMP,0\\n' + dump_data[27:] # Change the version number\n+        with open(bad_ver_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version 0', '-wallet=load1', '-format=bdb', '-dumpfile={}'.format(bad_ver_wallet_dump), 'createfromdump')\n+        bad_ver_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_ver2.dump\")\n+        dump_data = 'BITCOIN_CORE_WALLET_DUMP,2\\n' + dump_data[27:] # Change the version number\n+        with open(bad_ver_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version 2', '-wallet=load2', '-format=bdb', '-dumpfile={}'.format(bad_ver_wallet_dump), 'createfromdump')\n+        bad_magic_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_magic.dump\")\n+        dump_data = 'not_the_right_magic,1\\n' + dump_data[27:]\n+        with open(bad_magic_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile identifier record is incorrect. Got \"not_the_right_magic\", expected \"BITCOIN_CORE_WALLET_DUMP\".', '-wallet=load3', '-format=bdb', '-dumpfile={}'.format(bad_magic_wallet_dump), 'createfromdump')\n+\n+        self.log.info('Checking createfromdump handling of checksums')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum1.dump\")\n+        checksum = dump_data[-65:-1]\n+        dump_data = orig_dump[:-65] + \"1\" * 64 + \"\\n\"\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile checksum does not match. Computed {}, expected {}'.format(checksum, \"1\" * 64), '-wallet=load4', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum2.dump\")\n+        dump_data = orig_dump[:-75]\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Missing checksum', '-wallet=load5', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum3.dump\")\n+        dump_data = orig_dump[:-65] + \"2\" * 10\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile checksum does not match. Computed {}, expected {}{}'.format(checksum, \"2\" * 10, \"0\" * 54), '-wallet=load6', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509792246",
      "id" : 509792246,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5MjI0Ng==",
      "original_commit_id" : "35442fa568583c0da2c687966e49b3742f403870",
      "original_line" : 298,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 514259089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509792246",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509792748"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509792748"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (6137750082dd28bf38bbb2922d6d040d4e854643)\r\n\r\n`ret` should be set to false if the Write call fails",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-21T23:28:58Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509792748",
      "id" : 509792748,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5Mjc0OA==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 218,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514259089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509792748",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509794068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509794068"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (6137750082dd28bf38bbb2922d6d040d4e854643)\r\n\r\nIdeally, it would probably be preferable to delete the half created wallet than to just leave it behind. \r\n\r\nI think you could add `if (!ret) wallet->Delete()` after `Wallet->Close()` below with Delete method implementations that just delete the main datafile after the database is closed.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-21T23:33:22Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509794068",
      "id" : 509794068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5NDA2OA==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 243,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514259089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509794068",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509797552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509797552"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be preferable to do that but deleting things was non-trivial enough that I didn't want to spend the effort to figure it out.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-21T23:45:08Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509797552",
      "id" : 509797552,
      "in_reply_to_id" : 509794068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5NzU1Mg==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 243,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514265298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509797552",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509803825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509803825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> It would be preferable to do that but deleting things was non-trivial enough that I didn't want to spend the effort to figure it out.\r\n\r\nSure. I don't know, but I'd expect a simple implementation like the following to be adequate and safe:\r\n\r\n```c++\r\nassert(!m_db);\r\nfs::remove(m_file_path);\r\nfs::remove(m_dir_path);\r\n```",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T00:05:49Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509803825",
      "id" : 509803825,
      "in_reply_to_id" : 509794068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMzgyNQ==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 243,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514272411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509803825",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854140"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a check that the file exists (or doesn't for failure cases).",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T03:13:00Z",
      "diff_hunk" : "@@ -212,6 +212,92 @@ def test_salvage(self):\n \n         self.assert_tool_output('', '-wallet=salvage', 'salvage')\n \n+    def test_dump_createfromdump(self):\n+        self.start_node(0, ['-wallet=todump', '-wallet=todump2'])\n+        self.stop_node(0)\n+\n+        self.log.info('Checking dump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use dump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'dump')\n+\n+        self.log.info('Checking basic dump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=todump', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            dump_data = f.read()\n+        # Check the dump magic\n+        assert dump_data.startswith('BITCOIN_CORE_WALLET_DUMP,1')\n+\n+        self.log.info('Checking that a dumpfile cannot be overwritten')\n+        self.assert_raises_tool_error('File {} already exists. If you are sure this is what you want, move it out of the way first.'.format(wallet_dump),  '-wallet=todump2', '-dumpfile={}'.format(wallet_dump), 'dump')\n+\n+        self.log.info('Checking createfromdump arguments')\n+        self.assert_raises_tool_error('No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.', '-wallet=todump', 'createfromdump')\n+        non_exist_dump = os.path.join(self.nodes[0].datadir, \"wallet.nodump\")\n+        self.assert_raises_tool_error('No wallet file format provided. To use createfromdump, -format=<format> must be provided.', '-wallet=todump', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        self.assert_raises_tool_error('Unknown wallet file format \"notaformat\" provided. Please provide one of \"bdb\" or \"sqlite\".', '-wallet=todump', '-format=notaformat', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        self.assert_raises_tool_error('Dump file {} does not exist.'.format(non_exist_dump), '-wallet=todump', '-format=bdb', '-dumpfile={}'.format(non_exist_dump), 'createfromdump')\n+        wallet_path = os.path.join(self.nodes[0].datadir, 'regtest/wallets/todump2')\n+        self.assert_raises_tool_error('Error: Wallet File {} exists already'.format(wallet_path), '-wallet=todump2', '-format=bdb', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+\n+        self.log.info('Checking createfromdump')\n+        self.assert_tool_output('', '-wallet=load', '-format=bdb', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-rt.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=load', '-dumpfile={}'.format(wallet_dump), 'dump')\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            assert_equal(dump_data, f.read())\n+        orig_dump = dump_data\n+        wallet_dat = os.path.join(self.nodes[0].datadir, \"regtest/wallets/load\", \"wallet.dat\")\n+        with open(wallet_dat, 'rb') as f:\n+            f.seek(12, 0)\n+            file_magic = f.read(4)\n+            assert file_magic == b'\\x00\\x05\\x31\\x62' or file_magic == b'\\x62\\x31\\x05\\x00'\n+        self.assert_tool_output('', '-wallet=load-sqlite', '-format=sqlite', '-dumpfile={}'.format(wallet_dump), 'createfromdump')\n+        wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-rt-sqlite.dump\")\n+        self.assert_tool_output('The dumpfile may contain private keys. To ensure the safety of your Bitcoin, do not share the dumpfile.\\n', '-wallet=load-sqlite', '-dumpfile={}'.format(wallet_dump), 'dump')\n+        with open(wallet_dump, 'r', encoding='utf8') as f:\n+            assert_equal(dump_data, f.read())\n+        wallet_dat = os.path.join(self.nodes[0].datadir, \"regtest/wallets/load-sqlite\", \"wallet.dat\")\n+        with open(wallet_dat, 'rb') as f:\n+            file_magic = f.read(16)\n+            assert file_magic == b'SQLite format 3\\x00'\n+\n+        self.log.info('Checking createfromdump handling of magic and versions')\n+        bad_ver_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_ver1.dump\")\n+        dump_data = 'BITCOIN_CORE_WALLET_DUMP,0\\n' + dump_data[27:] # Change the version number\n+        with open(bad_ver_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version 0', '-wallet=load1', '-format=bdb', '-dumpfile={}'.format(bad_ver_wallet_dump), 'createfromdump')\n+        bad_ver_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_ver2.dump\")\n+        dump_data = 'BITCOIN_CORE_WALLET_DUMP,2\\n' + dump_data[27:] # Change the version number\n+        with open(bad_ver_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version 2', '-wallet=load2', '-format=bdb', '-dumpfile={}'.format(bad_ver_wallet_dump), 'createfromdump')\n+        bad_magic_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_magic.dump\")\n+        dump_data = 'not_the_right_magic,1\\n' + dump_data[27:]\n+        with open(bad_magic_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile identifier record is incorrect. Got \"not_the_right_magic\", expected \"BITCOIN_CORE_WALLET_DUMP\".', '-wallet=load3', '-format=bdb', '-dumpfile={}'.format(bad_magic_wallet_dump), 'createfromdump')\n+\n+        self.log.info('Checking createfromdump handling of checksums')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum1.dump\")\n+        checksum = dump_data[-65:-1]\n+        dump_data = orig_dump[:-65] + \"1\" * 64 + \"\\n\"\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile checksum does not match. Computed {}, expected {}'.format(checksum, \"1\" * 64), '-wallet=load4', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum2.dump\")\n+        dump_data = orig_dump[:-75]\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Missing checksum', '-wallet=load5', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')\n+        bad_sum_wallet_dump = os.path.join(self.nodes[0].datadir, \"wallet-bad_sum3.dump\")\n+        dump_data = orig_dump[:-65] + \"2\" * 10\n+        with open(bad_sum_wallet_dump, 'w+', encoding='utf8') as f:\n+            f.write(dump_data)\n+        self.assert_raises_tool_error('Error: Dumpfile checksum does not match. Computed {}, expected {}{}'.format(checksum, \"2\" * 10, \"0\" * 54), '-wallet=load6', '-format=bdb', '-dumpfile={}'.format(bad_sum_wallet_dump), 'createfromdump')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854140",
      "id" : 509854140,
      "in_reply_to_id" : 509792246,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1NDE0MA==",
      "original_commit_id" : "35442fa568583c0da2c687966e49b3742f403870",
      "original_line" : 298,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "test/functional/tool_wallet.py",
      "position" : null,
      "pull_request_review_id" : 514329903,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854140",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854162"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T03:13:06Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854162",
      "id" : 509854162,
      "in_reply_to_id" : 509792748,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1NDE2Mg==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 218,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514329928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854162",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854321"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added wallet removal.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T03:13:48Z",
      "diff_hunk" : "@@ -78,3 +78,167 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n     wallet->Close();\n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {\n+        error = strprintf(_(\"Error: Wallet File %s exists already\"), wallet_path.string());\n+        return false;\n+    }\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        batch->Write(ss_key, ss_value);\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509854321",
      "id" : 509854321,
      "in_reply_to_id" : 509794068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1NDMyMQ==",
      "original_commit_id" : "6137750082dd28bf38bbb2922d6d040d4e854643",
      "original_line" : 243,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514330123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509854321",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509868556"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509868556"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "1) Because `ret` overshadows another variable in the parent scope the function will return `true` and the error won't be shown to the user.\r\n\r\n2) even if we return `false` and show an error the dumpfile is still not complete, which could lead to broken backups if user misses an error. I suggest we remove the file if something goes wrong. So if the dumpfile exists it's always a complete dump.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T04:10:29Z",
      "diff_hunk" : "@@ -0,0 +1,253 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+    if (dump_file.fail()) {\n+        error = strprintf(_(\"Unable to open %s for writing\"), path.string());\n+        return false;\n+    }\n+\n+    CHashWriter hasher(0, 0);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    std::string line = strprintf(\"%s,%u\\n\", DUMP_MAGIC, DUMP_VERSION);\n+    dump_file.write(line.data(), line.size());\n+    hasher.write(line.data(), line.size());\n+\n+    if (ret) {\n+\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                break;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509868556",
      "id" : 509868556,
      "line" : 62,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg2ODU1Ng==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 62,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 62,
      "pull_request_review_id" : 514345983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509868556",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509869271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509869271"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: What's similar about `info`, `salvage` and `dump`? Can we make it a one-level switch instead?\r\n",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T04:14:06Z",
      "diff_hunk" : "@@ -112,7 +113,7 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             WalletShowInfo(wallet_instance.get());\n             wallet_instance->Close();\n         }\n-    } else if (command == \"info\" || command == \"salvage\") {\n+    } else if (command == \"info\" || command == \"salvage\" || command == \"dump\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509869271",
      "id" : 509869271,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg2OTI3MQ==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 116,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 514345983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509869271",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509876468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509876468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: not necessary as `MakeDatabase` with `options.require_create = true` will guarantee it doesn't exist.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T04:44:43Z",
      "diff_hunk" : "@@ -0,0 +1,253 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+    if (dump_file.fail()) {\n+        error = strprintf(_(\"Unable to open %s for writing\"), path.string());\n+        return false;\n+    }\n+\n+    CHashWriter hasher(0, 0);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    std::string line = strprintf(\"%s,%u\\n\", DUMP_MAGIC, DUMP_VERSION);\n+    dump_file.write(line.data(), line.size());\n+    hasher.write(line.data(), line.size());\n+\n+    if (ret) {\n+\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                break;\n+            }\n+            std::string key_str = HexStr(ss_key);\n+            std::string value_str = HexStr(ss_value);\n+            line = strprintf(\"%s,%s\\n\", key_str, value_str);\n+            dump_file.write(line.data(), line.size());\n+            hasher.write(line.data(), line.size());\n+        }\n+    }\n+\n+    // Write the hash\n+    tfm::format(dump_file, \"checksum,%s\\n\", HexStr(hasher.GetHash()));\n+\n+    batch->CloseCursor();\n+    batch.reset();\n+\n+    // Close the wallet after we're done with it. The caller won't be doing this\n+    wallet->Close();\n+    return ret;\n+}\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509876468",
      "id" : 509876468,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg3NjQ2OA==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 125,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514345983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509876468",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887594"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1. Stopped shadowing.\r\n2. Removing the dump file if `!ret`.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T05:26:02Z",
      "diff_hunk" : "@@ -0,0 +1,253 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+    if (dump_file.fail()) {\n+        error = strprintf(_(\"Unable to open %s for writing\"), path.string());\n+        return false;\n+    }\n+\n+    CHashWriter hasher(0, 0);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    std::string line = strprintf(\"%s,%u\\n\", DUMP_MAGIC, DUMP_VERSION);\n+    dump_file.write(line.data(), line.size());\n+    hasher.write(line.data(), line.size());\n+\n+    if (ret) {\n+\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                break;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887594",
      "id" : 509887594,
      "in_reply_to_id" : 509868556,
      "line" : 62,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg4NzU5NA==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 62,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 62,
      "pull_request_review_id" : 514368898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887594",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887762"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed this `else if`. I think this is a left over of when `info` and `salvage` shared wallet opening code.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T05:26:35Z",
      "diff_hunk" : "@@ -112,7 +113,7 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             WalletShowInfo(wallet_instance.get());\n             wallet_instance->Close();\n         }\n-    } else if (command == \"info\" || command == \"salvage\") {\n+    } else if (command == \"info\" || command == \"salvage\" || command == \"dump\") {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887762",
      "id" : 509887762,
      "in_reply_to_id" : 509869271,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg4Nzc2Mg==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 116,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 514369103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887762",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887805"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-22T05:26:43Z",
      "diff_hunk" : "@@ -0,0 +1,253 @@\n+// Copyright (c) 2020 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/translation.h>\n+#include <wallet/wallet.h>\n+\n+static const std::string DUMP_MAGIC = \"BITCOIN_CORE_WALLET_DUMP\";\n+uint32_t DUMP_VERSION = 1;\n+\n+bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use dump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    fs::path path = dump_filename;\n+    path = fs::absolute(path);\n+    if (fs::exists(path)) {\n+        error = strprintf(_(\"File %s already exists. If you are sure this is what you want, move it out of the way first.\"), path.string());\n+        return false;\n+    }\n+    fsbridge::ofstream dump_file;\n+    dump_file.open(path);\n+    if (dump_file.fail()) {\n+        error = strprintf(_(\"Unable to open %s for writing\"), path.string());\n+        return false;\n+    }\n+\n+    CHashWriter hasher(0, 0);\n+\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+\n+    bool ret = true;\n+    if (!batch->StartCursor()) {\n+        error = _(\"Error: Couldn't create cursor into database\");\n+        ret = false;\n+    }\n+\n+    // Write out a magic string with version\n+    std::string line = strprintf(\"%s,%u\\n\", DUMP_MAGIC, DUMP_VERSION);\n+    dump_file.write(line.data(), line.size());\n+    hasher.write(line.data(), line.size());\n+\n+    if (ret) {\n+\n+        // Read the records\n+        while (true) {\n+            CDataStream ss_key(SER_DISK, CLIENT_VERSION);\n+            CDataStream ss_value(SER_DISK, CLIENT_VERSION);\n+            bool complete;\n+            bool ret = batch->ReadAtCursor(ss_key, ss_value, complete);\n+            if (complete) {\n+                break;\n+            } else if (!ret) {\n+                error = _(\"Error reading next record from wallet database\");\n+                break;\n+            }\n+            std::string key_str = HexStr(ss_key);\n+            std::string value_str = HexStr(ss_value);\n+            line = strprintf(\"%s,%s\\n\", key_str, value_str);\n+            dump_file.write(line.data(), line.size());\n+            hasher.write(line.data(), line.size());\n+        }\n+    }\n+\n+    // Write the hash\n+    tfm::format(dump_file, \"checksum,%s\\n\", HexStr(hasher.GetHash()));\n+\n+    batch->CloseCursor();\n+    batch.reset();\n+\n+    // Close the wallet after we're done with it. The caller won't be doing this\n+    wallet->Close();\n+    return ret;\n+}\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    if (fs::exists(wallet_path)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509887805",
      "id" : 509887805,
      "in_reply_to_id" : 509876468,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg4NzgwNQ==",
      "original_commit_id" : "f7a5bf729cfa5a134bc6dd02a97f793d64107d4e",
      "original_line" : 125,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : null,
      "pull_request_review_id" : 514369144,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/509887805",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK 225cfa9f0c44798ab42c27d161670c5ee74902a3\r\nCI failure seems unrelated",
      "created_at" : "2020-10-23T03:49:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-714891534",
      "id" : 714891534,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNDg5MTUzNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-23T03:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/714891534",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1466284?v=4",
         "events_url" : "https://api.github.com/users/S3RK/events{/privacy}",
         "followers_url" : "https://api.github.com/users/S3RK/followers",
         "following_url" : "https://api.github.com/users/S3RK/following{/other_user}",
         "gists_url" : "https://api.github.com/users/S3RK/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/S3RK",
         "id" : 1466284,
         "login" : "S3RK",
         "node_id" : "MDQ6VXNlcjE0NjYyODQ=",
         "organizations_url" : "https://api.github.com/users/S3RK/orgs",
         "received_events_url" : "https://api.github.com/users/S3RK/received_events",
         "repos_url" : "https://api.github.com/users/S3RK/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/S3RK/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/S3RK"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r510719813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510719813"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This doesn't seem to affect the `create` command, but the `createfromdump` command? Should that be mentioned?",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-23T08:27:01Z",
      "diff_hunk" : "@@ -26,12 +26,16 @@ static void SetupWalletToolArgs(ArgsManager& argsman)\n \n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dumpfile=<file name>\", \"When used with 'dump', writes out the records to this file. When used with 'createfromdump', loads the records into a new wallet.\", ArgsManager::ALLOW_STRING, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-debug=<category>\", \"Output debugging information (default: 0).\", ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-format=<format>\", \"The format of the wallet file to create. Either \\\"bdb\\\" or \\\"sqlite\\\".\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r510719813",
      "id" : 510719813,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcxOTgxMw==",
      "original_commit_id" : "225cfa9f0c44798ab42c27d161670c5ee74902a3",
      "original_line" : 31,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/bitcoin-wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 515449842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/510719813",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r511007422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511007422"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a mention.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-10-23T16:39:52Z",
      "diff_hunk" : "@@ -26,12 +26,16 @@ static void SetupWalletToolArgs(ArgsManager& argsman)\n \n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-wallet=<wallet-name>\", \"Specify wallet name\", ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dumpfile=<file name>\", \"When used with 'dump', writes out the records to this file. When used with 'createfromdump', loads the records into a new wallet.\", ArgsManager::ALLOW_STRING, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-debug=<category>\", \"Output debugging information (default: 0).\", ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-format=<format>\", \"The format of the wallet file to create. Either \\\"bdb\\\" or \\\"sqlite\\\".\", ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r511007422",
      "id" : 511007422,
      "in_reply_to_id" : 510719813,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAwNzQyMg==",
      "original_commit_id" : "225cfa9f0c44798ab42c27d161670c5ee74902a3",
      "original_line" : 31,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/bitcoin-wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 515833612,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511007422",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tACK eff678b",
      "created_at" : "2020-10-26T11:07:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-716477601",
      "id" : 716477601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxNjQ3NzYwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-26T11:07:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716477601",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-11-01T23:57:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-720173054",
      "id" : 720173054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDE3MzA1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-01T23:57:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720173054",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516779603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516779603"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (fd1f2380cf736df25a27c2607f745ae248c73933)\r\n\r\nThis seems all right for now, but we should think about how to improve usability in the future because this is inconsistent with other ways wallets are created. Other ways to create wallets either default to BDB format or choose format based on a _descriptors/no descriptors_ option, not a _BDB/SQLite_ format option. Also, dumping and recreating a wallet in the original format may be a challenge here, since both wallet formats look like directories with `wallet.dat` files, and you can't tell them apart without opening them or looking for external clues. This `-format` option could also lead to creation of less well tested BDB+descriptor or SQLite+no-descriptor wallet types.\r\n\r\nI think:\r\n\r\n- Ideally best format would be detected automatically and there should be no need to have a `-format` option.\r\n- If `-format` option is kept it should give either a warning or an error if an unusual BDB+descriptor or SQLite+no-descriptor wallet is created.\r\n- If `-format` option is kept, wallet `wallet-tool create` command should either respect it or explicitly disallow it, not ignore it. More ideally a `-descriptors`/-`nodescriptors` option would be used to choose the format, so `wallet-tool create` command would be consistent with other ways wallets are created",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-11-03T16:03:57Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516779603",
      "id" : 516779603,
      "line" : 113,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc3OTYwMw==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 113,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 113,
      "pull_request_review_id" : 522647530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516779603",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516795262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516795262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallettool: Add createfromdump command\" (fd1f2380cf736df25a27c2607f745ae248c73933)\r\n\r\n- I think code probably should call wallet.reset() before this point. `wallet->Close` is called above, but it seems like Close for BDB only flushes the database, so the environment might not get freed until after fs::remove_all, and lead to later attempted writes.\r\n- Alternately this could use a different approach and call a WalletDatabase::Remove method that just removes the known wallet files and empty directory (https://github.com/bitcoin/bitcoin/pull/19137#discussion_r509803825) instead of calling `fs::remove_all`. Even though `remove_all` should be safe because of the `options.require_create = true` line above, a selective remove would seem more safe than a recursive one",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-11-03T16:26:11Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        if (!batch->Write(ss_key, ss_value)) {\n+            error = strprintf(_(\"Error: Unable to write record to new wallet\"));\n+            ret = false;\n+            break;\n+        }\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();\n+    }\n+\n+    batch.reset();\n+\n+    dump_file.close();\n+    wallet->Close();\n+\n+    // Remove the wallet dir if we have a failure\n+    if (!ret) {\n+        fs::remove_all(wallet_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516795262",
      "id" : 516795262,
      "line" : 255,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc5NTI2Mg==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 255,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 255,
      "pull_request_review_id" : 522647530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516795262",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516863717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516863717"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a reset.",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-11-03T18:12:05Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");\n+        return false;\n+    }\n+    DatabaseFormat data_format;\n+    if (file_format == \"bdb\") {\n+        data_format = DatabaseFormat::BERKELEY;\n+    } else if (file_format == \"sqlite\") {\n+        data_format = DatabaseFormat::SQLITE;\n+    } else {\n+        error = strprintf(_(\"Unknown wallet file format \\\"%s\\\" provided. Please provide one of \\\"bdb\\\" or \\\"sqlite\\\".\"), file_format);\n+        return false;\n+    }\n+\n+    fs::path dump_path = dump_filename;\n+    dump_path = fs::absolute(dump_path);\n+    if (!fs::exists(dump_path)) {\n+        error = strprintf(_(\"Dump file %s does not exist.\"), dump_path.string());\n+        return false;\n+    }\n+    fsbridge::ifstream dump_file(dump_path);\n+\n+    DatabaseOptions options;\n+    DatabaseStatus status;\n+    options.require_create = true;\n+    options.require_format = data_format;\n+    std::unique_ptr<WalletDatabase> database = MakeDatabase(wallet_path, options, status, error);\n+    if (!database) return false;\n+\n+    // dummy chain interface\n+    std::shared_ptr<CWallet> wallet(new CWallet(nullptr /* chain */, name, std::move(database)), WalletToolReleaseWallet);\n+    LOCK(wallet->cs_wallet);\n+    bool first_run = true;\n+    DBErrors load_wallet_ret = wallet->LoadWallet(first_run);\n+    if (load_wallet_ret != DBErrors::LOAD_OK) {\n+        error = strprintf(_(\"Error creating %s\"), name);\n+        return false;\n+    }\n+\n+    // Get the database handle\n+    WalletDatabase& db = wallet->GetDatabase();\n+    std::unique_ptr<DatabaseBatch> batch = db.MakeBatch();\n+    batch->TxnBegin();\n+\n+    // Compute the checksum\n+    CHashWriter hasher(0, 0);\n+    uint256 checksum;\n+\n+    // Read the records from the dump file and write them to the database\n+    bool ret = true;\n+    bool first = true;\n+    while (dump_file.good()) {\n+        std::string key;\n+        std::getline(dump_file, key, ',');\n+        std::string value;\n+        std::getline(dump_file, value, '\\n');\n+\n+        if (key == \"checksum\") {\n+            std::vector<unsigned char> parsed_checksum = ParseHex(value);\n+            std::copy(parsed_checksum.begin(), parsed_checksum.end(), checksum.begin());\n+            break;\n+        }\n+\n+        std::string line = strprintf(\"%s,%s\\n\", key, value);\n+        hasher.write(line.data(), line.size());\n+\n+        if (key.empty() || value.empty()) {\n+            continue;\n+        }\n+\n+        // Check magic for first record\n+        if (first) {\n+            if (key != DUMP_MAGIC) {\n+                error = strprintf(_(\"Error: Dumpfile identifier record is incorrect. Got \\\"%s\\\", expected \\\"%s\\\".\"), key, DUMP_MAGIC);\n+                ret = false;\n+                break;\n+            }\n+            // Check the version number (value of first record)\n+            uint32_t ver;\n+            if (!ParseUInt32(value, &ver)) {\n+                error =strprintf(_(\"Error: Unable to parse version %u as a uint32_t\"), value);\n+                ret = false;\n+                break;\n+            }\n+            if (ver != DUMP_VERSION) {\n+                error = strprintf(_(\"Error: Dumpfile version is not supported. This version of bitcoin-wallet only supports version 1 dumpfiles. Got dumpfile with version %s\"), value);\n+                ret = false;\n+                break;\n+            }\n+            first = false;\n+            continue;\n+        }\n+\n+        if (!IsHex(key)) {\n+            error = strprintf(_(\"Error: Got key that was not hex: %s\"), key);\n+            ret = false;\n+            break;\n+        }\n+        if (!IsHex(value)) {\n+            error = strprintf(_(\"Error: Got value that was not hex: %s\"), value);\n+            ret = false;\n+            break;\n+        }\n+\n+        std::vector<unsigned char> k = ParseHex(key);\n+        std::vector<unsigned char> v = ParseHex(value);\n+\n+        CDataStream ss_key(k, SER_DISK, CLIENT_VERSION);\n+        CDataStream ss_value(v, SER_DISK, CLIENT_VERSION);\n+\n+        if (!batch->Write(ss_key, ss_value)) {\n+            error = strprintf(_(\"Error: Unable to write record to new wallet\"));\n+            ret = false;\n+            break;\n+        }\n+    }\n+\n+    if (ret) {\n+        uint256 comp_checksum = hasher.GetHash();\n+        if (checksum.IsNull()) {\n+            error = _(\"Error: Missing checksum\");\n+            ret = false;\n+        } else if (checksum != comp_checksum) {\n+            error = strprintf(_(\"Error: Dumpfile checksum does not match. Computed %s, expected %s\"), HexStr(comp_checksum), HexStr(checksum));\n+            ret = false;\n+        }\n+    }\n+\n+    if (ret) {\n+        batch->TxnCommit();\n+    } else {\n+        batch->TxnAbort();\n+    }\n+\n+    batch.reset();\n+\n+    dump_file.close();\n+    wallet->Close();\n+\n+    // Remove the wallet dir if we have a failure\n+    if (!ret) {\n+        fs::remove_all(wallet_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r516863717",
      "id" : 516863717,
      "in_reply_to_id" : 516795262,
      "line" : 255,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg2MzcxNw==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 255,
      "original_position" : 167,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 255,
      "pull_request_review_id" : 522758585,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-03T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/516863717",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and updated the tests.",
      "created_at" : "2020-11-03T18:12:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#issuecomment-721294197",
      "id" : 721294197,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19137",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTI5NDE5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-03T18:12:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721294197",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526240887"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526240887"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe it should be included in the dump? (Can allow overriding still if user desires to do so)",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-11-18T16:47:12Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526240887",
      "id" : 526240887,
      "in_reply_to_id" : 516779603,
      "line" : 113,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI0MDg4Nw==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 113,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 113,
      "pull_request_review_id" : 533647214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-18T16:47:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526240887",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526319192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526319192"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526240887\r\n\r\n> Maybe it should be included in the dump? (Can allow overriding still if user desires to do so)\r\n\r\n:+1:\r\n\r\nLike that idea",
      "commit_id" : "7f5adfaf6f7b706ea5182d592a1bddb638172b58",
      "created_at" : "2020-11-18T18:18:41Z",
      "diff_hunk" : "@@ -87,3 +87,171 @@ bool DumpWallet(std::shared_ptr<CWallet> wallet, bilingual_str& error)\n \n     return ret;\n }\n+\n+// The standard wallet deleter function blocks on the validation interface\n+// queue, which doesn't exist for the bitcoin-wallet. Define our own\n+// deleter here.\n+static void WalletToolReleaseWallet(CWallet* wallet)\n+{\n+    wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n+    wallet->Close();\n+    delete wallet;\n+}\n+\n+bool CreateFromDump(const std::string& name, const fs::path& wallet_path, bilingual_str& error)\n+{\n+    // Get the dumpfile\n+    std::string dump_filename = gArgs.GetArg(\"-dumpfile\", \"\");\n+    if (dump_filename.empty()) {\n+        error = _(\"No dump file provided. To use createfromdump, -dumpfile=<filename> must be provided.\");\n+        return false;\n+    }\n+\n+    // Get the data file format\n+    std::string file_format = gArgs.GetArg(\"-format\", \"\");\n+    if (file_format.empty()) {\n+        error = _(\"No wallet file format provided. To use createfromdump, -format=<format> must be provided.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19137#discussion_r526319192",
      "id" : 526319192,
      "in_reply_to_id" : 516779603,
      "line" : 113,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMxOTE5Mg==",
      "original_commit_id" : "fd1f2380cf736df25a27c2607f745ae248c73933",
      "original_line" : 113,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/dump.cpp",
      "position" : 113,
      "pull_request_review_id" : 533747927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19137",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-18T18:18:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/526319192",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
