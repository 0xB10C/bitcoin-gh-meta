[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25364#discussion_r896523568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25364"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/896523568"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I am wondering if it helps if there was a local `create_transaction` helper? As this is creating a simple chain of txs, the vout could be hardcoded to `0` in the helper, also the node could be hardcoded to `self.nodes[0]`, as there is only one node.\r\n\r\nSo you'd call `self.create_transaction(coinbase_txid[0], self.ms_address, amount=49, privkey=self.nodes[0].PRIV_KEYS[0][1])` here.\r\n\r\nThe benefit would be less code and less symbols in this scope.\r\n\r\nThoughts?",
      "commit_id" : "b02411d2ddf8c010fc4e9d9ec27cae3a73e895a9",
      "created_at" : "2022-06-14T08:22:50Z",
      "diff_hunk" : "@@ -82,31 +82,59 @@ def run_test(self):\n         self.lastblocktime = int(time.time()) + self.lastblockheight\n \n         self.log.info(f\"Test 1: NULLDUMMY compliant base transactions should be accepted to mempool and mined before activation [{COINBASE_MATURITY + 3}]\")\n-        test1txs = [create_transaction(self.nodes[0], coinbase_txid[0], self.ms_address, amount=49)]\n+        input = {\"txid\": coinbase_txid[0], \"vout\": 0}\n+        output = {self.ms_address: 49}\n+        rawtx = self.nodes[0].createrawtransaction([input], output)\n+        signedtx = self.nodes[0].signrawtransactionwithkey(hexstring=rawtx, privkeys=[self.nodes[0].PRIV_KEYS[0][1]])\n+        test1txs = [tx_from_hex(signedtx[\"hex\"])]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25364#discussion_r896523568",
      "id" : 896523568,
      "line" : 89,
      "node_id" : "PRRC_kwDOABII5841b90w",
      "original_commit_id" : "b02411d2ddf8c010fc4e9d9ec27cae3a73e895a9",
      "original_line" : 89,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/feature_nulldummy.py",
      "position" : 66,
      "pull_request_review_id" : 1005439394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25364",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/896523568/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-14T08:23:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/896523568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, thanks for working on disentangling more tests from the wallet.",
      "created_at" : "2022-06-14T09:40:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25364#issuecomment-1154955025",
      "id" : 1154955025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25364",
      "node_id" : "IC_kwDOABII585E1zcR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1154955025/reactions"
      },
      "updated_at" : "2022-06-14T09:40:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1154955025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25364#discussion_r896810126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25364"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/896810126"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree that a lot of symbols are reused and the code could be minimised.\r\nAdded a helper function for creating transactions.",
      "commit_id" : "a8fe321baebd404410ae5e0fca7a5c39b0da41fc",
      "created_at" : "2022-06-14T13:20:17Z",
      "diff_hunk" : "@@ -82,31 +82,59 @@ def run_test(self):\n         self.lastblocktime = int(time.time()) + self.lastblockheight\n \n         self.log.info(f\"Test 1: NULLDUMMY compliant base transactions should be accepted to mempool and mined before activation [{COINBASE_MATURITY + 3}]\")\n-        test1txs = [create_transaction(self.nodes[0], coinbase_txid[0], self.ms_address, amount=49)]\n+        input = {\"txid\": coinbase_txid[0], \"vout\": 0}\n+        output = {self.ms_address: 49}\n+        rawtx = self.nodes[0].createrawtransaction([input], output)\n+        signedtx = self.nodes[0].signrawtransactionwithkey(hexstring=rawtx, privkeys=[self.nodes[0].PRIV_KEYS[0][1]])\n+        test1txs = [tx_from_hex(signedtx[\"hex\"])]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25364#discussion_r896810126",
      "id" : 896810126,
      "in_reply_to_id" : 896523568,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841dDyO",
      "original_commit_id" : "b02411d2ddf8c010fc4e9d9ec27cae3a73e895a9",
      "original_line" : 89,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/feature_nulldummy.py",
      "position" : null,
      "pull_request_review_id" : 1005852244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25364",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/896810126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-14T13:23:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/896810126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/21211904?v=4",
         "events_url" : "https://api.github.com/users/ayush933/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ayush933/followers",
         "following_url" : "https://api.github.com/users/ayush933/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ayush933/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ayush933",
         "id" : 21211904,
         "login" : "ayush933",
         "node_id" : "MDQ6VXNlcjIxMjExOTA0",
         "organizations_url" : "https://api.github.com/users/ayush933/orgs",
         "received_events_url" : "https://api.github.com/users/ayush933/received_events",
         "repos_url" : "https://api.github.com/users/ayush933/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ayush933/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ayush933/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ayush933"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25364#discussion_r896815956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25364"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/896815956"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this needed? In the previous commit you didn't have to pass in the scriptPubKey for coinbase spends with the deterministic keys.",
      "commit_id" : "a8fe321baebd404410ae5e0fca7a5c39b0da41fc",
      "created_at" : "2022-06-14T13:25:09Z",
      "diff_hunk" : "@@ -55,58 +60,87 @@ def set_test_params(self):\n             '-par=1',  # Use only one script thread to get the exact reject reason for testing\n         ]]\n \n-    def skip_test_if_missing_module(self):\n-        self.skip_if_no_wallet()\n+    def create_transaction(self, *, txid, inAmount=None, spk=None, rs=None, ws=None, addr, amount, privkey):\n+        input = {\"txid\": txid, \"vout\": 0}\n+        if inAmount is not None:\n+            input[\"amount\"] = inAmount\n+        if spk is not None:\n+            input[\"scriptPubKey\"] = spk\n+        if rs is not None:\n+            input[\"redeemScript\"] = rs\n+        if ws is not None:\n+            input[\"witnessScript\"] = ws\n+        output = {addr: amount}\n+        rawtx = self.nodes[0].createrawtransaction([input], output)\n+        signedtx = self.nodes[0].signrawtransactionwithkey(rawtx, [privkey], [input])\n+        return tx_from_hex(signedtx[\"hex\"])\n \n     def run_test(self):\n-        self.nodes[0].createwallet(wallet_name='wmulti', disable_private_keys=True)\n-        wmulti = self.nodes[0].get_wallet_rpc('wmulti')\n-        w0 = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n-        self.address = w0.getnewaddress()\n-        self.pubkey = w0.getaddressinfo(self.address)['pubkey']\n-        self.ms_address = wmulti.addmultisigaddress(1, [self.pubkey])['address']\n-        self.wit_address = w0.getnewaddress(address_type='p2sh-segwit')\n-        self.wit_ms_address = wmulti.addmultisigaddress(1, [self.pubkey], '', 'p2sh-segwit')['address']\n-        if not self.options.descriptors:\n-            # Legacy wallets need to import these so that they are watched by the wallet. This is unnecessary (and does not need to be tested) for descriptor wallets\n-            wmulti.importaddress(self.ms_address)\n-            wmulti.importaddress(self.wit_ms_address)\n+        self.address = getnewdestination()[2]\n+        eckey = ECKey()\n+        eckey.generate()\n+        self.privkey = bytes_to_wif(eckey.get_bytes())\n+        self.pubkey = eckey.get_pubkey().get_bytes().hex()\n+        cms = self.nodes[0].createmultisig(1, [self.pubkey])\n+        wms = self.nodes[0].createmultisig(1, [self.pubkey], 'p2sh-segwit')\n+        self.ms_address = cms[\"address\"]\n+        self.wit_address = getnewdestination(address_type='p2sh-segwit')[2]\n+        self.wit_ms_address = wms['address']\n \n         self.coinbase_blocks = self.generate(self.nodes[0], 2)  # block height = 2\n         coinbase_txid = []\n+        block_hash = []\n         for i in self.coinbase_blocks:\n-            coinbase_txid.append(self.nodes[0].getblock(i)['tx'][0])\n+            block = self.nodes[0].getblock(i)\n+            coinbase_txid.append(block['tx'][0])\n+            block_hash.append(block[\"hash\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25364#discussion_r896815956",
      "id" : 896815956,
      "line" : 96,
      "node_id" : "PRRC_kwDOABII5841dFNU",
      "original_commit_id" : "a8fe321baebd404410ae5e0fca7a5c39b0da41fc",
      "original_line" : 96,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "test/functional/feature_nulldummy.py",
      "position" : 76,
      "pull_request_review_id" : 1005860569,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25364",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/896815956/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-14T13:25:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/896815956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
