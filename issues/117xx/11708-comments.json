[
   {
      "author_association" : "MEMBER",
      "body" : "NACK, redeemScript + scriptPubKey are sufficient information to know whether you are talking about P2SH-P2WSH, P2SH, P2WSH. Having one more \"witness script\" is just redundant information which can go wrong.\r\n\r\nIf you enter the witness script in \"redeemScript\" field, you can easily find out in code if it mean P2SH or Witness by comparing with the scriptPubKey, there is no ambiguity.\r\n",
      "created_at" : "2017-11-17T05:21:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345148386",
      "id" : 345148386,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T05:23:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345148386",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "@NicolasDorier How so? The redeemscript only contains a hash of the witness script in the case of P2SH-P2WSH, which is not sufficient to sign with.\n\nIt would be possible to require passing only the witness script, and automatically also add the v0 P2WSH redeemscript (and any future versions?). But just the redeemscript is not enough.",
      "created_at" : "2017-11-17T05:35:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345150004",
      "id" : 345150004,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T05:35:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345150004",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Indeed, IMO its much cleaner implementation and user experience to have the witnessScript provided in addition to the redeemScript, not only because that avoids the ambiguous witness version issue in a nice way but also because then it is clear to the user which script the redeemScript actually refers to (because the redeemScript output of other RPCs in general would refer to the wrapper P2SH redeemScript not the witnessScript which would introduce confusion).",
      "created_at" : "2017-11-17T06:18:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345155716",
      "id" : 345155716,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T06:20:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345155716",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151760982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151760982"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Watch out with the indentation,... the `\\\"` result in one char. It may look unaligned in the source code but is aligned in the help output.",
      "commit_id" : "a594fe6348fe889d0ee0070743ab9bb8d761be18",
      "created_at" : "2017-11-17T18:48:26Z",
      "diff_hunk" : "@@ -2808,17 +2808,18 @@ UniValue listunspent(const JSONRPCRequest& request)\n             \"\\nResult\\n\"\n             \"[                   (array of json object)\\n\"\n             \"  {\\n\"\n-            \"    \\\"txid\\\" : \\\"txid\\\",          (string) the transaction id \\n\"\n-            \"    \\\"vout\\\" : n,               (numeric) the vout value\\n\"\n-            \"    \\\"address\\\" : \\\"address\\\",    (string) the bitcoin address\\n\"\n-            \"    \\\"account\\\" : \\\"account\\\",    (string) DEPRECATED. The associated account, or \\\"\\\" for the default account\\n\"\n-            \"    \\\"scriptPubKey\\\" : \\\"key\\\",   (string) the script key\\n\"\n-            \"    \\\"amount\\\" : x.xxx,         (numeric) the transaction output amount in \" + CURRENCY_UNIT + \"\\n\"\n-            \"    \\\"confirmations\\\" : n,      (numeric) The number of confirmations\\n\"\n-            \"    \\\"redeemScript\\\" : n        (string) The redeemScript if scriptPubKey is P2SH\\n\"\n-            \"    \\\"spendable\\\" : xxx,        (bool) Whether we have the private keys to spend this output\\n\"\n-            \"    \\\"solvable\\\" : xxx,         (bool) Whether we know how to spend this output, ignoring the lack of keys\\n\"\n-            \"    \\\"safe\\\" : xxx              (bool) Whether this output is considered safe to spend. Unconfirmed transactions\\n\"\n+            \"    \\\"txid\\\" : \\\"txid\\\",            (string) the transaction id \\n\"\n+            \"    \\\"vout\\\" : n,                   (numeric) the vout value\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151760982",
      "id" : 151760982,
      "original_commit_id" : "9e5c9ebe0231d9030eaccc336560e3898cd61b7b",
      "original_position" : 16,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 77526827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2017-11-18T09:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151760982",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151789014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151789014"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: replace 32 with `sizeof()`?",
      "commit_id" : "a594fe6348fe889d0ee0070743ab9bb8d761be18",
      "created_at" : "2017-11-17T21:04:34Z",
      "diff_hunk" : "@@ -2923,6 +2924,26 @@ UniValue listunspent(const JSONRPCRequest& request)\n                 CScript redeemScript;\n                 if (pwallet->GetCScript(hash, redeemScript)) {\n                     entry.push_back(Pair(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end())));\n+                    CTxDestination witness_destination;\n+                    if(redeemScript.IsPayToWitnessScriptHash() && ExtractDestination(redeemScript, witness_destination)) {\n+                        const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(witness_destination);\n+                        CScriptID id;\n+                        CRIPEMD160().Write(whash.begin(), 32).Finalize(id.begin());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151789014",
      "id" : 151789014,
      "original_commit_id" : "9e5c9ebe0231d9030eaccc336560e3898cd61b7b",
      "original_position" : 38,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 77560641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2017-11-18T09:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151789014",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Can you add a test?",
      "created_at" : "2017-11-17T21:10:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345366064",
      "id" : 345366064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T21:10:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345366064",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jonasschnelli yep will do, see TODO section :) Just trying to work out the cleanest way to test it wrt all the existing tests in segwit.py",
      "created_at" : "2017-11-17T22:57:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#issuecomment-345388311",
      "id" : 345388311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11708",
      "updated_at" : "2017-11-17T22:57:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345388311",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151832181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151832181"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: the `whash.size()` should also go here... :P",
      "commit_id" : "a594fe6348fe889d0ee0070743ab9bb8d761be18",
      "created_at" : "2017-11-18T07:42:13Z",
      "diff_hunk" : "@@ -2923,6 +2924,26 @@ UniValue listunspent(const JSONRPCRequest& request)\n                 CScript redeemScript;\n                 if (pwallet->GetCScript(hash, redeemScript)) {\n                     entry.push_back(Pair(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end())));\n+                    CTxDestination witness_destination;\n+                    if(redeemScript.IsPayToWitnessScriptHash() && ExtractDestination(redeemScript, witness_destination)) {\n+                        const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(witness_destination);\n+                        CScriptID id;\n+                        CRIPEMD160().Write(whash.begin(), whash.size()).Finalize(id.begin());\n+                        CScript witnessScript;\n+                        if (pwallet->GetCScript(id, witnessScript)) {\n+                            entry.push_back(Pair(\"witnessScript\", HexStr(witnessScript.begin(), witnessScript.end())));\n+                        }\n+                    }\n+                }\n+            }\n+\n+            if (scriptPubKey.IsPayToWitnessScriptHash()) {\n+                const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(address);\n+                CScriptID id;\n+                CRIPEMD160().Write(whash.begin(), 32).Finalize(id.begin());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151832181",
      "id" : 151832181,
      "original_commit_id" : "a0b90c9edf7f3b0d7cbcad79533c4ff257610fa9",
      "original_position" : 50,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 77610319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2017-11-18T09:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151832181",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151832339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151832339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Heh missed that, thanks :P ",
      "commit_id" : "a594fe6348fe889d0ee0070743ab9bb8d761be18",
      "created_at" : "2017-11-18T07:52:49Z",
      "diff_hunk" : "@@ -2923,6 +2924,26 @@ UniValue listunspent(const JSONRPCRequest& request)\n                 CScript redeemScript;\n                 if (pwallet->GetCScript(hash, redeemScript)) {\n                     entry.push_back(Pair(\"redeemScript\", HexStr(redeemScript.begin(), redeemScript.end())));\n+                    CTxDestination witness_destination;\n+                    if(redeemScript.IsPayToWitnessScriptHash() && ExtractDestination(redeemScript, witness_destination)) {\n+                        const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(witness_destination);\n+                        CScriptID id;\n+                        CRIPEMD160().Write(whash.begin(), whash.size()).Finalize(id.begin());\n+                        CScript witnessScript;\n+                        if (pwallet->GetCScript(id, witnessScript)) {\n+                            entry.push_back(Pair(\"witnessScript\", HexStr(witnessScript.begin(), witnessScript.end())));\n+                        }\n+                    }\n+                }\n+            }\n+\n+            if (scriptPubKey.IsPayToWitnessScriptHash()) {\n+                const WitnessV0ScriptHash& whash = boost::get<WitnessV0ScriptHash>(address);\n+                CScriptID id;\n+                CRIPEMD160().Write(whash.begin(), 32).Finalize(id.begin());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11708#discussion_r151832339",
      "id" : 151832339,
      "in_reply_to_id" : 151832181,
      "original_commit_id" : "a0b90c9edf7f3b0d7cbcad79533c4ff257610fa9",
      "original_position" : 50,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 77610476,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11708",
      "updated_at" : "2017-11-18T09:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/151832339",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   }
]
