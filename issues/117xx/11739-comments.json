[
   {
      "author_association" : "MEMBER",
      "body" : "Forgot to flag this: there is one mainnet block that violated P2SH, and one testnet block as well.  For now I carved out both, but perhaps we could consider migration to a new testnet (4?) instead and drop the testnet exception?  Seems like it might be cleaner to have a new testnet that always has P2SH and segwit from genesis....  Does anyone think this would be worth proposing?",
      "created_at" : "2017-11-20T20:36:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-345823546",
      "id" : 345823546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2017-11-20T20:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/345823546",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r152248328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152248328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixup nit: in commit 3a76e3c962516cdf7d577aa3dcbe0251b94e5355: You probably meant to use ```if (fStrictPayToScriptHash) { flags |= SCRIPT_VERIFY_P2SH; }```, as BIP16Height was removed and thus fails to compile.",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2017-11-21T11:31:09Z",
      "diff_hunk" : "@@ -1611,7 +1611,18 @@ static ThresholdConditionCache warningcache[VERSIONBITS_NUM_BITS];\n static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consensus::Params& consensusparams) {\n     AssertLockHeld(cs_main);\n \n-    unsigned int flags = SCRIPT_VERIFY_NONE;\n+\n+    // BIP16 didn't become active until Apr 1 2012\n+    // However, only one historical block violated the P2SH rules, so for simplicity, always leave P2SH\n+    // on except for the one violating block.\n+    bool fStrictPayToScriptHash = true;\n+\n+    if (pindex->phashBlock != nullptr && (*(pindex->phashBlock) == uint256S(\"0x00000000000002dc756eebf4f49723ed8d30cc28a5f108eb94b1ba88ac4f9c22\") ||\n+                (*(pindex->phashBlock) == uint256S(\"0x00000000dd30457c001f4095d208cc1296b0eed002427aa599874af7a432b105\")))) { // testnet block!\n+        fStrictPayToScriptHash = false;\n+    }\n+\n+    unsigned int flags = fStrictPayToScriptHash ? SCRIPT_VERIFY_P2SH : SCRIPT_VERIFY_NONE;\n \n     // Start enforcing P2SH (BIP16)\n     if (pindex->nHeight >= consensusparams.BIP16Height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r152248328",
      "id" : 152248328,
      "original_commit_id" : "3a76e3c962516cdf7d577aa3dcbe0251b94e5355",
      "original_position" : 19,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 78079355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/152248328",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. At a code level not so interesting, I suppose (except for maybe the P2SH backdating), but it's generally a nice property for us to, over time, enforce soft forks like SegWit universally.\n\nOn November 20, 2017 12:32:05 PM PST, Suhas Daftuar <notifications@github.com> wrote:\n>As discussed at the IRC meeting back in October\n>(https://botbot.me/freenode/bitcoin-core-dev/2017-10-12/?msg=92231929&page=2),\n>I had looked into the feasibility of enforcing P2SH and\n>SCRIPT_VERIFY_WITNESS back to the genesis block.\n>\n>The P2SH change is pretty straightforward -- there was only one\n>historical block on mainnet that violated the rule, so I carved out an\n>exception to it, similar to the way we have exceptions for the BIP30\n>violators.\n>\n>The segwit change is not entirely as clear.  The code changes\n>themselves are relatively straightforward: we can just always turn on\n>SCRIPT_VERIFY_WITNESS whenever P2SH is active.  However conceptually,\n>this amounts to splitting up BIP141 into two parts, the part that\n>implements new script rules, and the part that handles witness\n>commitments in blocks.  \n>\n>Arguably though the script rules are really defined in BIP 143 anyway,\n>and so this really amounts to backdating BIP 143 -- script rules for v0\n>segwit outputs -- back to genesis.  So maybe conceptually this isn't so\n>bad...\n>\n>I don't feel strongly about this change in either direction; I started\n>working on it because I was searching for a way to simplify the way we\n>understand and implement the consensus rules around segwit, but I'm not\n>yet sure whether I think this achieves anything toward that goal.\n>\n>ping @TheBlueMatt \n>You can view, comment on, or merge this pull request online at:\n>\n>  https://github.com/bitcoin/bitcoin/pull/11739\n>\n>-- Commit Summary --\n>\n>  * Use P2SH consensus rules for all blocks\n>  * Separate NULLDUMMY enforcement from SEGWIT enforcement\n>  * Always enforce SCRIPT_VERIFY_WITNESS with P2SH\n>  * [qa] Remove some pre-activation segwit tests\n> * scripted-diff: rename IsWitnessEnabled -> IsWitnessCommitmentEnabled\n>\n>-- File Changes --\n>\n>    M src/chainparams.cpp (3)\n>    M src/consensus/params.h (2)\n>    M src/miner.cpp (2)\n>    M src/net_processing.cpp (8)\n>    M src/validation.cpp (49)\n>    M src/validation.h (5)\n>    M src/wallet/rpcwallet.cpp (2)\n>    M test/functional/p2p-segwit.py (2)\n>    M test/functional/segwit.py (8)\n>\n>-- Patch Links --\n>\n>https://github.com/bitcoin/bitcoin/pull/11739.patch\n>https://github.com/bitcoin/bitcoin/pull/11739.diff\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/11739\n",
      "created_at" : "2017-11-22T00:10:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-346202002",
      "id" : 346202002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2017-11-22T00:10:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346202002",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "The code changes here don't look as bad as I would have expected. I'd prefer to encapsulate the exception block hashes in chainparams, though.",
      "created_at" : "2017-11-22T01:44:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-346217588",
      "id" : 346217588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2017-11-22T01:44:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346217588",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK!   as far as testnet, restarting with a new testnet would be fine, but there are a bunch of very interesting test cases in testnet we should consider extracting. One possibility would be to instrument the codebase to call the gprof things to record branch coverage data at each block; an then make a list of testnet blocks that increased cover.  Seems like a real pain though.",
      "created_at" : "2017-11-23T01:36:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-346515145",
      "id" : 346515145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2017-11-23T01:36:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/346515145",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nits addressed.",
      "created_at" : "2017-12-05T22:21:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-349461292",
      "id" : 349461292,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2017-12-05T22:21:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349461292",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r155841721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155841721"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why not assert pindex->phashBlock? No properly-constructed CBlockIndex should have that unset, no?",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2017-12-08T18:24:32Z",
      "diff_hunk" : "@@ -1608,16 +1608,28 @@ class WarningBitsConditionChecker : public AbstractThresholdConditionChecker\n // Protected by cs_main\n static ThresholdConditionCache warningcache[VERSIONBITS_NUM_BITS];\n \n+static bool IsScriptWitnessEnabled(const Consensus::Params& params)\n+{\n+    return params.vDeployments[Consensus::DEPLOYMENT_SEGWIT].nTimeout != 0;\n+}\n+\n static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consensus::Params& consensusparams) {\n     AssertLockHeld(cs_main);\n \n     unsigned int flags = SCRIPT_VERIFY_NONE;\n \n-    // Start enforcing P2SH (BIP16)\n-    if (pindex->nHeight >= consensusparams.BIP16Height) {\n+    // BIP16 didn't become active until Apr 1 2012\n+    // However, only one historical block violated the P2SH rules, so for simplicity, always leave P2SH\n+    // on except for the one violating block.\n+    if (!(pindex->phashBlock != nullptr && (*(pindex->phashBlock) == consensusparams.BIP16Exception))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r155841721",
      "id" : 155841721,
      "original_commit_id" : "ad3e97a109541bb644dc1cb5e264a2954926bcac",
      "original_position" : 28,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 82233951,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/155841721",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r156143962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156143962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's unset when invoked via TestBlockValidity() (eg for mining).",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2017-12-11T17:35:43Z",
      "diff_hunk" : "@@ -1608,16 +1608,28 @@ class WarningBitsConditionChecker : public AbstractThresholdConditionChecker\n // Protected by cs_main\n static ThresholdConditionCache warningcache[VERSIONBITS_NUM_BITS];\n \n+static bool IsScriptWitnessEnabled(const Consensus::Params& params)\n+{\n+    return params.vDeployments[Consensus::DEPLOYMENT_SEGWIT].nTimeout != 0;\n+}\n+\n static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consensus::Params& consensusparams) {\n     AssertLockHeld(cs_main);\n \n     unsigned int flags = SCRIPT_VERIFY_NONE;\n \n-    // Start enforcing P2SH (BIP16)\n-    if (pindex->nHeight >= consensusparams.BIP16Height) {\n+    // BIP16 didn't become active until Apr 1 2012\n+    // However, only one historical block violated the P2SH rules, so for simplicity, always leave P2SH\n+    // on except for the one violating block.\n+    if (!(pindex->phashBlock != nullptr && (*(pindex->phashBlock) == consensusparams.BIP16Exception))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r156143962",
      "id" : 156143962,
      "in_reply_to_id" : 155841721,
      "original_commit_id" : "ad3e97a109541bb644dc1cb5e264a2954926bcac",
      "original_position" : 28,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 82574582,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156143962",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r156453789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156453789"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, that sounds like a bug in TBV, but that's for a separate PR, I suppose.",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2017-12-12T18:26:37Z",
      "diff_hunk" : "@@ -1608,16 +1608,28 @@ class WarningBitsConditionChecker : public AbstractThresholdConditionChecker\n // Protected by cs_main\n static ThresholdConditionCache warningcache[VERSIONBITS_NUM_BITS];\n \n+static bool IsScriptWitnessEnabled(const Consensus::Params& params)\n+{\n+    return params.vDeployments[Consensus::DEPLOYMENT_SEGWIT].nTimeout != 0;\n+}\n+\n static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consensus::Params& consensusparams) {\n     AssertLockHeld(cs_main);\n \n     unsigned int flags = SCRIPT_VERIFY_NONE;\n \n-    // Start enforcing P2SH (BIP16)\n-    if (pindex->nHeight >= consensusparams.BIP16Height) {\n+    // BIP16 didn't become active until Apr 1 2012\n+    // However, only one historical block violated the P2SH rules, so for simplicity, always leave P2SH\n+    // on except for the one violating block.\n+    if (!(pindex->phashBlock != nullptr && (*(pindex->phashBlock) == consensusparams.BIP16Exception))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r156453789",
      "id" : 156453789,
      "in_reply_to_id" : 155841721,
      "original_commit_id" : "ad3e97a109541bb644dc1cb5e264a2954926bcac",
      "original_position" : 28,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 82933114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/156453789",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Concept ACK",
      "created_at" : "2017-12-20T16:32:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-353112588",
      "id" : 353112588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2017-12-20T16:32:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/353112588",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r160814301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160814301"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Use P2SH consensus rules for all blocks\"\r\n\r\nMaybe check BIP16Exception.IsNull() to be a little more strict. Could also remove unnecessary nesting and negatives:\r\n\r\n```c++\r\nif (consensusparams.BIP16Exception.IsNull() ||\r\n    pindex->phashBlock == nullptr ||\r\n    *pindex->phashBlock != consensusparams.BIP16Exception)\r\n```",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-10T22:17:46Z",
      "diff_hunk" : "@@ -1613,8 +1613,10 @@ static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consens\n \n     unsigned int flags = SCRIPT_VERIFY_NONE;\n \n-    // Start enforcing P2SH (BIP16)\n-    if (pindex->nHeight >= consensusparams.BIP16Height) {\n+    // BIP16 didn't become active until Apr 1 2012\n+    // However, only one historical block violated the P2SH rules, so for simplicity, always leave P2SH\n+    // on except for the one violating block.\n+    if (!(pindex->phashBlock != nullptr && (*(pindex->phashBlock) == consensusparams.BIP16Exception))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r160814301",
      "id" : 160814301,
      "original_commit_id" : "df7fad0a0b0f02ab2193673bf16ebffc5318778d",
      "original_position" : 9,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 87999236,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160814301",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r160814900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160814900"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[qa] Remove some pre-activation segwit tests\"\r\n\r\nShould actually remove",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-10T22:20:32Z",
      "diff_hunk" : "@@ -1905,7 +1905,7 @@ def run_test(self):\n         self.test_unnecessary_witness_before_segwit_activation()\n         self.test_witness_tx_relay_before_segwit_activation()\n         self.test_block_relay(segwit_activated=False)\n-        self.test_p2sh_witness(segwit_activated=False)\n+        #self.test_p2sh_witness(segwit_activated=False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r160814900",
      "id" : 160814900,
      "original_commit_id" : "1f4efbceec8258c9c3db7069ddc666851aaf9f78",
      "original_position" : 5,
      "path" : "test/functional/p2p-segwit.py",
      "position" : null,
      "pull_request_review_id" : 87999236,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160814900",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r160814922"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160814922"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"[qa] Remove some pre-activation segwit tests\"\r\n\r\nNote: TODO",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-10T22:20:39Z",
      "diff_hunk" : "@@ -189,17 +189,13 @@ def run_test(self):\n \n         # TODO: An old node would see these txs without witnesses and be able to mine them\n \n-        self.log.info(\"Verify unsigned bare witness txs in versionbits-setting blocks are valid before the fork\")\n-        self.success_mine(self.nodes[2], wit_ids[NODE_2][WIT_V0][1], False) #block 428\n-        self.success_mine(self.nodes[2], wit_ids[NODE_2][WIT_V1][1], False) #block 429\n+        # TODO: verify spending a segwit v0 output is invalid before the fork",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r160814922",
      "id" : 160814922,
      "original_commit_id" : "1f4efbceec8258c9c3db7069ddc666851aaf9f78",
      "original_position" : 7,
      "path" : "test/functional/segwit.py",
      "position" : null,
      "pull_request_review_id" : 87999236,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160814922",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK",
      "created_at" : "2018-01-11T20:49:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-357056736",
      "id" : 357056736,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2018-01-11T20:49:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/357056736",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed @ryanofsky's comments.  However I think I will need to rebase in order to for the new test I wrote to work...",
      "created_at" : "2018-01-22T20:04:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-359547921",
      "id" : 359547921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2018-01-22T20:04:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359547921",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163130953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163130953"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, please, I always found checks to pindex->phashBlock == nullptr ugly and expensive to maintain documented (perhaps we can repeat the \"pindex->phashBlock can be null if called by CreateNewBlock/TestBlockValidity\" comment from the beginning and unify it with the comment for fEnforceBIP30, to more easily delete them all later when they're not needed). There's the assert you want below, just needs to be moved to the top once the special cases are dealt with more explicitly.\r\nBut, yeah, that's for a separate PR.\r\n",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-23T02:43:21Z",
      "diff_hunk" : "@@ -1608,16 +1608,28 @@ class WarningBitsConditionChecker : public AbstractThresholdConditionChecker\n // Protected by cs_main\n static ThresholdConditionCache warningcache[VERSIONBITS_NUM_BITS];\n \n+static bool IsScriptWitnessEnabled(const Consensus::Params& params)\n+{\n+    return params.vDeployments[Consensus::DEPLOYMENT_SEGWIT].nTimeout != 0;\n+}\n+\n static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consensus::Params& consensusparams) {\n     AssertLockHeld(cs_main);\n \n     unsigned int flags = SCRIPT_VERIFY_NONE;\n \n-    // Start enforcing P2SH (BIP16)\n-    if (pindex->nHeight >= consensusparams.BIP16Height) {\n+    // BIP16 didn't become active until Apr 1 2012\n+    // However, only one historical block violated the P2SH rules, so for simplicity, always leave P2SH\n+    // on except for the one violating block.\n+    if (!(pindex->phashBlock != nullptr && (*(pindex->phashBlock) == consensusparams.BIP16Exception))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163130953",
      "id" : 163130953,
      "in_reply_to_id" : 155841721,
      "original_commit_id" : "ad3e97a109541bb644dc1cb5e264a2954926bcac",
      "original_position" : 28,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 90695022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163130953",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1008458?v=4",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and fixed the last commit to work with latest master.  Previous version of these commits is at https://github.com/sdaftuar/bitcoin/commits/11739.1",
      "created_at" : "2018-01-23T17:44:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-359872028",
      "id" : 359872028,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2018-01-23T17:44:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359872028",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jtimon Agreed -- I sent an [email to the bitcoin-dev](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-January/015588.html) list recently with a link to the [draft BIP text](https://github.com/sdaftuar/bips/blob/p2sh-v0segwit-from-genesis/bip-sdaftuar-p2sh-v0segwit-from-genesis.mediawiki). ",
      "created_at" : "2018-01-23T17:51:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-359874023",
      "id" : 359874023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2018-01-23T17:51:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359874023",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163395305"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163395305"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand this comment. What does 'before the fork' mean if segwit is active since genesis?",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-23T22:18:43Z",
      "diff_hunk" : "@@ -189,17 +189,13 @@ def run_test(self):\n \n         # TODO: An old node would see these txs without witnesses and be able to mine them\n \n-        self.log.info(\"Verify unsigned bare witness txs in versionbits-setting blocks are valid before the fork\")\n-        self.success_mine(self.nodes[2], wit_ids[NODE_2][WIT_V0][1], False) #block 428\n-        self.success_mine(self.nodes[2], wit_ids[NODE_2][WIT_V1][1], False) #block 429\n+        # TODO: verify spending a segwit v0 output is invalid before the fork",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163395305",
      "id" : 163395305,
      "in_reply_to_id" : 160814922,
      "original_commit_id" : "1f4efbceec8258c9c3db7069ddc666851aaf9f78",
      "original_position" : 7,
      "path" : "test/functional/segwit.py",
      "position" : null,
      "pull_request_review_id" : 91002988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163395305",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163397109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163397109"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could also change the name of the local variable here:\r\n\r\n`fWitnessEnabled` -> `witness_commitment_enabled`",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-23T22:26:28Z",
      "diff_hunk" : "@@ -857,7 +857,7 @@ void PeerLogicValidation::NewPoWValidBlock(const CBlockIndex *pindex, const std:\n         return;\n     nHighestFastAnnounce = pindex->nHeight;\n \n-    bool fWitnessEnabled = IsWitnessEnabled(pindex->pprev, Params().GetConsensus());\n+    bool fWitnessEnabled = IsWitnessCommitmentEnabled(pindex->pprev, Params().GetConsensus());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163397109",
      "id" : 163397109,
      "original_commit_id" : "b782474f54c0386f4385bb56e6639bd6dd243048",
      "original_position" : 14,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 91002988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163397109",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163397184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163397184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: prefer the BIP constants in numeric order (ie BIP 16 above BIP 34). Same for params.h below.",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-23T22:26:45Z",
      "diff_hunk" : "@@ -75,9 +75,9 @@ class CMainParams : public CChainParams {\n     CMainParams() {\n         strNetworkID = \"main\";\n         consensus.nSubsidyHalvingInterval = 210000;\n-        consensus.BIP16Height = 173805; // 00000000000000ce80a7e057163a4db1d5ad7b20fb6f598c9597b9665c8fb0d4 - April 1, 2012\n         consensus.BIP34Height = 227931;\n         consensus.BIP34Hash = uint256S(\"0x000000000000024b89b42a942fe0d9fea3bb44ab7bd1b19115dd6a759c0808b8\");\n+        consensus.BIP16Exception = uint256S(\"0x00000000000002dc756eebf4f49723ed8d30cc28a5f108eb94b1ba88ac4f9c22\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163397184",
      "id" : 163397184,
      "original_commit_id" : "b782474f54c0386f4385bb56e6639bd6dd243048",
      "original_position" : 7,
      "path" : "src/chainparams.cpp",
      "position" : 7,
      "pull_request_review_id" : 91005193,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163397184",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163408445"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163408445"
         }
      },
      "author_association" : "MEMBER",
      "body" : "comment says p2sh-p2wsh, but the second output below is just a p2sh as far as I can tell.",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-23T23:20:13Z",
      "diff_hunk" : "@@ -271,6 +271,50 @@ def test_unnecessary_witness_before_segwit_activation(self):\n         self.utxo.pop(0)\n         self.utxo.append(UTXO(tx4.sha256, 0, tx4.vout[0].nValue))\n \n+    # This test was added after segwit-activation:\n+    # Version 0 witness outputs are unspendable before segwit activates\n+    def test_v0_outputs_arent_spendable(self):\n+        self.log.info(\"Testing that v0 witness program outputs aren't spendable pre-activation\")\n+\n+        assert(len(self.utxo))\n+\n+        # Create two outputs, a p2wsh and p2sh-p2wsh",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163408445",
      "id" : 163408445,
      "original_commit_id" : "b782474f54c0386f4385bb56e6639bd6dd243048",
      "original_position" : 11,
      "path" : "test/functional/p2p-segwit.py",
      "position" : null,
      "pull_request_review_id" : 91018268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163408445",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK up to 4e2b90d21690059dc496a17d2aee9fe11ce3a8b2.\r\n\r\nI don't think the final commit adds any value and can be removed from this PR.",
      "created_at" : "2018-01-23T23:25:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-359966771",
      "id" : 359966771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2018-01-23T23:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/359966771",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163411447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163411447"
         }
      },
      "author_association" : "MEMBER",
      "body" : "strange. The P2SH output can't be spent either. If I change the `test_witness_block()` call to a `test_transaction_acceptance()` call below, I see the following log:\r\n\r\n`(mandatory-script-verify-flag-failed (Operation not valid with the current stack size) (code 16))`",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-23T23:34:47Z",
      "diff_hunk" : "@@ -271,6 +271,50 @@ def test_unnecessary_witness_before_segwit_activation(self):\n         self.utxo.pop(0)\n         self.utxo.append(UTXO(tx4.sha256, 0, tx4.vout[0].nValue))\n \n+    # This test was added after segwit-activation:\n+    # Version 0 witness outputs are unspendable before segwit activates\n+    def test_v0_outputs_arent_spendable(self):\n+        self.log.info(\"Testing that v0 witness program outputs aren't spendable pre-activation\")\n+\n+        assert(len(self.utxo))\n+\n+        # Create two outputs, a p2wsh and p2sh-p2wsh",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163411447",
      "id" : 163411447,
      "in_reply_to_id" : 163408445,
      "original_commit_id" : "b782474f54c0386f4385bb56e6639bd6dd243048",
      "original_position" : 11,
      "path" : "test/functional/p2p-segwit.py",
      "position" : null,
      "pull_request_review_id" : 91021172,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163411447",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163895526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163895526"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed -- I forgot to stick the p2sh redeem script in the scriptsig (and also inadvertently made this a p2sh, rather than p2sh-p2wsh).",
      "commit_id" : "33203e1e3152d4306e65c7d8f43f36d957eb032c",
      "created_at" : "2018-01-25T16:31:02Z",
      "diff_hunk" : "@@ -271,6 +271,50 @@ def test_unnecessary_witness_before_segwit_activation(self):\n         self.utxo.pop(0)\n         self.utxo.append(UTXO(tx4.sha256, 0, tx4.vout[0].nValue))\n \n+    # This test was added after segwit-activation:\n+    # Version 0 witness outputs are unspendable before segwit activates\n+    def test_v0_outputs_arent_spendable(self):\n+        self.log.info(\"Testing that v0 witness program outputs aren't spendable pre-activation\")\n+\n+        assert(len(self.utxo))\n+\n+        # Create two outputs, a p2wsh and p2sh-p2wsh",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#discussion_r163895526",
      "id" : 163895526,
      "in_reply_to_id" : 163408445,
      "original_commit_id" : "b782474f54c0386f4385bb56e6639bd6dd243048",
      "original_position" : 11,
      "path" : "test/functional/p2p-segwit.py",
      "position" : null,
      "pull_request_review_id" : 91584659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11739",
      "updated_at" : "2018-01-25T16:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/163895526",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Github thought this needed to be rebased, so I did, though there were no conflicts to be resolved.\r\nOriginal unsquashed version is https://github.com/sdaftuar/bitcoin/commits/11739.2.",
      "created_at" : "2018-01-25T16:38:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11739#issuecomment-360523691",
      "id" : 360523691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11739",
      "updated_at" : "2018-01-25T16:38:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/360523691",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
