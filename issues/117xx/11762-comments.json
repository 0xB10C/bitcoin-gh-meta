[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "utACK 9f857d5.\r\n\r\nAre these random picks? For instance, `CTxMemPool::CalculateMemPoolAncestors` can assert the lock too right?",
      "created_at" : "2017-11-27T16:29:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#issuecomment-347237975",
      "id" : 347237975,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11762",
      "updated_at" : "2017-11-27T16:29:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347237975",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Why would we need the runtime check when there is a compile time check?",
      "created_at" : "2017-11-27T17:44:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#issuecomment-347263671",
      "id" : 347263671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11762",
      "updated_at" : "2017-11-27T17:44:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347263671",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag No, these are not random picks. They were the ones I could find, verify manually and passes both `make check` + `test/functional/test_runner.py` with nothing but trivial changes :-)\r\n\r\nThe lock in `CTxMemPool::UpdateTransactionsFromBlock` you suggested could also be removed but that would require more fine grained locking in the corresponding tests. If you have time then please post a diff of that locking change and I'll make it part of this PR :-)",
      "created_at" : "2017-11-27T19:27:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#issuecomment-347298049",
      "id" : 347298049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11762",
      "updated_at" : "2017-11-27T19:27:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347298049",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke I replaced the `LOCK(Ã¢ÂÂ¦);` with `AssertLockHeld(Ã¢ÂÂ¦);` to make it easy to verify also for reviewers not building with Clang thread safety analysis warnings enabled. Should I remove them? :-)",
      "created_at" : "2017-11-27T19:29:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#issuecomment-347298583",
      "id" : 347298583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11762",
      "updated_at" : "2017-11-27T19:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347298583",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag Do you have any additional suggestions beyond `CTxMemPool::CalculateMemPoolAncestors(Ã¢ÂÂ¦)`? :-)",
      "created_at" : "2017-11-27T19:35:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#issuecomment-347300371",
      "id" : 347300371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11762",
      "updated_at" : "2017-11-27T19:35:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347300371",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think it is fine to leave them for now, but it seems arbitrary to add run time checks to a subset of methods that already have the compile time check. I know that not everyone compiles with clang, but at least for releases we do and I am sure some developers build with clang, so it should be noticed quickly.",
      "created_at" : "2017-11-27T19:36:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#issuecomment-347300814",
      "id" : 347300814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11762",
      "updated_at" : "2017-11-27T19:36:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347300814",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I wasn't suggesting to remove more locks. Maybe these changes are preferable in small PR's.",
      "created_at" : "2017-11-27T21:07:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#issuecomment-347328077",
      "id" : 347328077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11762",
      "updated_at" : "2017-11-27T21:07:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347328077",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added the `removeConflicts(Ã¢ÂÂ¦) EXCLUSIVE_LOCKS_REQUIRED(Ã¢ÂÂ¦)` annotation to `txmempool.h`. \r\n\r\n@promag Would you mind re-reviewing? ",
      "created_at" : "2017-11-27T22:47:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#issuecomment-347354676",
      "id" : 347354676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11762",
      "updated_at" : "2017-11-27T22:47:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347354676",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11762#discussion_r153635124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11762"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153635124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Adding this only in the .cpp means that the lock requirement will only be enforced for other functions in this file.\r\n\r\nI realize that it can't be added in the header as-is due to the circular dependency, but that needs to be fixed somehow.",
      "commit_id" : "efc69c81f027180d7ad06b040d532fce0edf60cb",
      "created_at" : "2017-11-28T21:55:35Z",
      "diff_hunk" : "@@ -522,13 +522,13 @@ bool CWalletDB::IsKeyType(const std::string& strType)\n             strType == \"mkey\" || strType == \"ckey\");\n }\n \n-DBErrors CWalletDB::LoadWallet(CWallet* pwallet)\n+DBErrors CWalletDB::LoadWallet(CWallet* pwallet) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#discussion_r153635124",
      "id" : 153635124,
      "original_commit_id" : "dc6cd0bc106b04964d7e6f55c530f366371268f0",
      "original_position" : 5,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 5,
      "pull_request_review_id" : 79670392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11762",
      "updated_at" : "2017-11-29T20:11:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153635124",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11762#discussion_r153635363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11762"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153635363"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need for the dupe here, header is enough.",
      "commit_id" : "efc69c81f027180d7ad06b040d532fce0edf60cb",
      "created_at" : "2017-11-28T21:56:36Z",
      "diff_hunk" : "@@ -539,10 +539,10 @@ void CTxMemPool::removeForReorg(const CCoinsViewCache *pcoins, unsigned int nMem\n     RemoveStaged(setAllRemoves, false, MemPoolRemovalReason::REORG);\n }\n \n-void CTxMemPool::removeConflicts(const CTransaction &tx)\n+void CTxMemPool::removeConflicts(const CTransaction &tx) EXCLUSIVE_LOCKS_REQUIRED(cs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#discussion_r153635363",
      "id" : 153635363,
      "original_commit_id" : "dc6cd0bc106b04964d7e6f55c530f366371268f0",
      "original_position" : 5,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 79670670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11762",
      "updated_at" : "2017-11-29T20:11:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153635363",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11762#discussion_r153902570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11762"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153902570"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@theuni Yes, I'd like to put the annotation in the header file but I need help with resolving the circular dependency. What would be the cleanest way to solve it? :-)",
      "commit_id" : "efc69c81f027180d7ad06b040d532fce0edf60cb",
      "created_at" : "2017-11-29T20:13:56Z",
      "diff_hunk" : "@@ -522,13 +522,13 @@ bool CWalletDB::IsKeyType(const std::string& strType)\n             strType == \"mkey\" || strType == \"ckey\");\n }\n \n-DBErrors CWalletDB::LoadWallet(CWallet* pwallet)\n+DBErrors CWalletDB::LoadWallet(CWallet* pwallet) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11762#discussion_r153902570",
      "id" : 153902570,
      "in_reply_to_id" : 153635124,
      "original_commit_id" : "dc6cd0bc106b04964d7e6f55c530f366371268f0",
      "original_position" : 5,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 5,
      "pull_request_review_id" : 79982298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11762",
      "updated_at" : "2017-11-29T20:13:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153902570",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
