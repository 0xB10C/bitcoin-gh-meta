[
   {
      "author_association" : "MEMBER",
      "body" : "I'm glad to see someone working on this!\r\n\r\nOne prior proposal was to put _all_ inbound into one timing bucket, and keep per-peer timing for each outbound with the rationale that the attacker doesn't control our outbounds but could potentially control any inbounds.\r\n\r\nIf we found that to be too slow we could quantize inbound network groups into a small number of buckets (e.g. 4, by computing  hasher(seed, netgroup)&3 or similar) and have timers per that so even when an attacker goes and gets a lot of groups his speedup has a small bound\r\n\r\nI think probably we shouldn't be too afraid of slowing down propagation-- the changes to add delays at all were a massive slowdown and generated basically no notice.\r\n\r\nAlso related to this we might want to track the rate of novel transactions being accepted for a particular peer and up-delay really slow peers (like send every Nth time it would otherwise send).  The rational being that relay of novel transactions blinds tracking (since we won't relay something a peer gave to us back to them) and also lazy tracking stuff tends not to relay anything.   Delaying tx relay to a peer that never sends anything would hardly hurt propagation in the network, but at least might force attackers to be a bit more useful.\r\n",
      "created_at" : "2018-05-21T19:19:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13298#issuecomment-390754861",
      "id" : 390754861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13298",
      "updated_at" : "2018-05-21T19:35:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390754861",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/13298#discussion_r189687756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13298"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189687756"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think for IPv6 this could be a slightly far-fetched memory exhaustion DOS.",
      "commit_id" : "2b74996e379cd54dffea1004ed478d93f1a2b596",
      "created_at" : "2018-05-21T19:21:21Z",
      "diff_hunk" : "@@ -2864,8 +2864,24 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t PoissonNextSend(int64_t nNow, int average_interval_seconds) {\n-    return nNow + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+int64_t CConnman::PoissonNextSendTo(int64_t now, int average_interval_seconds, CNode* pto)\n+{\n+    assert(pto);\n+    uint64_t net_group = pto->nKeyedNetGroup;\n+    std::pair<int, uint64_t> key{average_interval_seconds, net_group};\n+    LOCK(cs_group_next_sends);\n+    std::map<std::pair<int, uint64_t>, int64_t>::iterator group_next_send = group_next_sends.find(key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13298#discussion_r189687756",
      "id" : 189687756,
      "original_commit_id" : "2b74996e379cd54dffea1004ed478d93f1a2b596",
      "original_position" : 12,
      "path" : "src/net.cpp",
      "position" : 12,
      "pull_request_review_id" : 121915848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13298",
      "updated_at" : "2018-05-21T19:21:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/189687756",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   }
]
