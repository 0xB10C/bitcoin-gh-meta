{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "This changeset renders and flushes log messages in a dedicated thread, preventing the originating thread from blocking (or failing) on fwrite, fflush, or the various string manipulations done on log messages. Originating threads push log messages into a buffer that is continually flushed. \r\n\r\nI haven't yet benchmarked the effect of this changeset, but [previous work](https://github.com/bitcoinfibre/bitcoinfibre/commit/6b6a3aef0663775b63bac7d0aa07ec5fc4eb9fc9) seems to indicate that this may have performance benefits.\r\n\r\nI'll get back with benchmarks if the approach here seems reasonable.\r\n\r\nOpen questions:\r\n- Do we want this behavior by default? I think so, given that it seems safer and more performant than doing log processing synchronously with Important Stuff.\r\n- Do we want to allow an opt-out configuration option that makes log processing synchronous again?\r\n- The ring buffer implementation allows either overwriting existing data or blocking when at full capacity. In the case of logging, I've set it to block and wait for capacity instead of dropping messages. Does this seem right?\r\n\r\nFuture work:\r\n- Reconcile this change with https://github.com/bitcoin/bitcoin/pull/13168 in case that's merged first (I have a patch)\r\n- Even when logging is disabled, buffer debug logs without flushing and then handle SIGSEGV et al by flushing the log buffer (idea being to give the user crash diagnostics).\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13200/comments",
   "created_at" : "2018-05-09T14:51:21Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13200/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/13200",
   "id" : 321602963,
   "labels" : [
      {
         "color" : "5319e7",
         "default" : false,
         "id" : 241832923,
         "name" : "Utils/log/libs",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13200/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 13200,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/13200.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/13200",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/13200.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/13200"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Process logs in a separate thread",
   "updated_at" : "2018-05-09T18:20:27Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13200",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
      "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jamesob/followers",
      "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jamesob",
      "id" : 73197,
      "login" : "jamesob",
      "organizations_url" : "https://api.github.com/users/jamesob/orgs",
      "received_events_url" : "https://api.github.com/users/jamesob/received_events",
      "repos_url" : "https://api.github.com/users/jamesob/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jamesob"
   }
}
