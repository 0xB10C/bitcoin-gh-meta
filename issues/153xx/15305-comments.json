[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252845092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252845092"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wouldn't it make more sense to move this check into `AbortNode` otherwise it seems that this is a flag to indicate the node should be aborted as opposed to a flag that indicates the nodes has been aborted via `AbortNode`.",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-01-31T21:21:20Z",
      "diff_hunk" : "@@ -2551,6 +2553,9 @@ bool CChainState::ActivateBestChainStep(CValidationState& state, const CChainPar\n             // This is likely a fatal error, but keep the mempool consistent,\n             // just in case. Only remove from the mempool in this case.\n             UpdateMempoolForReorg(disconnectpool, false);\n+            if (!g_abort_node) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252845092",
      "id" : 252845092,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Mjg0NTA5Mg==",
      "original_commit_id" : "5331e2a4d5f098f205ca786a96665c184ca019d5",
      "original_position" : 20,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 198820607,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252845092",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252846134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252846134"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be nice to limit the scope of this context to the minimum required (right after the wait_until). (Compare other uses of `with node.assert_debug_log(expected_msgs=reason):`)",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-01-31T21:24:27Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+        pass\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"\n+\n+        # Deleting the undo file will result in reorg failure\n+        os.unlink(undo_file)\n+\n+        # Connecting to a node with a more work chain will trigger a reorg\n+        # attempt\n+        self.nodes[1].generate(4)\n+        connect_nodes(self.nodes[0], 1)\n+\n+        # Check that node0 aborted\n+        self.nodes[0].assert_debug_log(\"Failed to disconnect block\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252846134",
      "id" : 252846134,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Mjg0NjEzNA==",
      "original_commit_id" : "5331e2a4d5f098f205ca786a96665c184ca019d5",
      "original_position" : 42,
      "path" : "test/functional/feature_abortnode.py",
      "position" : null,
      "pull_request_review_id" : 198821879,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252846134",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252847627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252847627"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So I was thinking that I didn't want to add a place to the code where we might call into AbortNode twice, but since I haven't analyzed exactly what happens in that case I wasn't sure I wanted to change any existing behavior if we're doing that somewhere already.\r\n\r\nIf everyone is comfortable with globally ensuring that AbortNode() enforces the 1 abort call limit, then I can move this in there, or otherwise perhaps I could just rename this variable to be a bit clearer?",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-01-31T21:28:43Z",
      "diff_hunk" : "@@ -2551,6 +2553,9 @@ bool CChainState::ActivateBestChainStep(CValidationState& state, const CChainPar\n             // This is likely a fatal error, but keep the mempool consistent,\n             // just in case. Only remove from the mempool in this case.\n             UpdateMempoolForReorg(disconnectpool, false);\n+            if (!g_abort_node) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252847627",
      "id" : 252847627,
      "in_reply_to_id" : 252845092,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Mjg0NzYyNw==",
      "original_commit_id" : "5331e2a4d5f098f205ca786a96665c184ca019d5",
      "original_position" : 20,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 198823671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252847627",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252849665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252849665"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure I understand exactly how this is supposed to be used, but can you take a look at the fixup I just pushed and let me know if this is what you have in mind?",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-01-31T21:35:08Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+        pass\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"\n+\n+        # Deleting the undo file will result in reorg failure\n+        os.unlink(undo_file)\n+\n+        # Connecting to a node with a more work chain will trigger a reorg\n+        # attempt\n+        self.nodes[1].generate(4)\n+        connect_nodes(self.nodes[0], 1)\n+\n+        # Check that node0 aborted\n+        self.nodes[0].assert_debug_log(\"Failed to disconnect block\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252849665",
      "id" : 252849665,
      "in_reply_to_id" : 252846134,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Mjg0OTY2NQ==",
      "original_commit_id" : "5331e2a4d5f098f205ca786a96665c184ca019d5",
      "original_position" : 42,
      "path" : "test/functional/feature_abortnode.py",
      "position" : null,
      "pull_request_review_id" : 198826242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252849665",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252852842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252852842"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is like a context manager that checks what lines get appended to the debug log during its use. And the shortest use seems to me \r\n\r\n```py\r\n        with self.nodes[0].assert_debug_log(\"Failed to disconnect block\"):\r\n            connect_nodes(self.nodes[0], 1)\r\n\r\n            # Check that node0 aborted\r\n            self.log.info(\"Waiting for crash\")\r\n            wait_until(lambda: self.nodes[0].is_node_stopped(), timeout=60)\r\n        #Exits here and checks debug log for error string\r\n```\r\n",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-01-31T21:44:16Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+        pass\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"\n+\n+        # Deleting the undo file will result in reorg failure\n+        os.unlink(undo_file)\n+\n+        # Connecting to a node with a more work chain will trigger a reorg\n+        # attempt\n+        self.nodes[1].generate(4)\n+        connect_nodes(self.nodes[0], 1)\n+\n+        # Check that node0 aborted\n+        self.nodes[0].assert_debug_log(\"Failed to disconnect block\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r252852842",
      "id" : 252852842,
      "in_reply_to_id" : 252846134,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Mjg1Mjg0Mg==",
      "original_commit_id" : "5331e2a4d5f098f205ca786a96665c184ca019d5",
      "original_position" : 42,
      "path" : "test/functional/feature_abortnode.py",
      "position" : null,
      "pull_request_review_id" : 198829937,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252852842",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r253144465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253144465"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This fails for me with:\r\n\r\n```\r\nAssertionError: [node 0] Expected message \"F\" does not partially match log:\r\n\r\n - 2019-02-01T18:00:39.595725Z Received a POST request for / from 127.0.0.1:41758\r\n - 2019-02-01T18:00:39.595784Z ThreadRPCServer method=addnode user=__cookie__\r\n - 2019-02-01T18:00:39.595808Z trying connection 127.0.0.1:11153 lastseen=0.0hrs\r\n - 2019-02-01T18:00:39.596518Z Added connection peer=0\r\n - 2019-02-01T18:00:39.596544Z sending version (114 bytes) peer=0\r\n - 2019-02-01T18:00:39.596611Z send version message: version 70015, blocks=3, us=[::]:0, peer=0\r\n - 2019-02-01T18:00:39.598387Z Received a POST request for / from 127.0.0.1:41758\r\n - 2019-02-01T18:00:39.598441Z ThreadRPCServer method=getpeerinfo user=__cookie__\r\n - 2019-02-01T18:00:39.645960Z received: version (114 bytes) peer=0\r\n - 2019-02-01T18:00:39.646044Z sending verack (0 bytes) peer=0\r\n - 2019-02-01T18:00:39.646189Z sending getaddr (0 bytes) peer=0\r\n - 2019-02-01T18:00:39.646257Z receive version message: /Satoshi:0.17.99(testnode1)/: version 70015, blocks=4, us=[::]:0, peer=0\r\n - 2019-02-01T18:00:39.646287Z added time data, samples 2, offset +0 (+0 minutes)\r\n - 2019-02-01T18:00:39.646307Z received: verack (0 bytes) peer=0\r\n - 2019-02-01T18:00:39.646319Z New outbound peer connected: version: 70015, blocks=4, peer=0\r\n - 2019-02-01T18:00:39.646326Z sending sendheaders (0 bytes) peer=0\r\n - 2019-02-01T18:00:39.646355Z sending sendcmpct (9 bytes) peer=0\r\n - 2019-02-01T18:00:39.646390Z sending sendcmpct (9 bytes) peer=0\r\n - 2019-02-01T18:00:39.646439Z sending ping (8 bytes) peer=0\r\n - 2019-02-01T18:00:39.646505Z initial getheaders (2) to peer=0 (startheight:4)\r\n - 2019-02-01T18:00:39.646522Z sending getheaders (133 bytes) peer=0\r\n - 2019-02-01T18:00:39.646634Z sending feefilter (8 bytes) peer=0\r\n - 2019-02-01T18:00:39.650027Z Received a POST request for / from 127.0.0.1:41758\r\n - 2019-02-01T18:00:39.650092Z ThreadRPCServer method=getpeerinfo user=__cookie__\r\n - 2019-02-01T18:00:39.650672Z received: sendheaders (0 bytes) peer=0\r\n - 2019-02-01T18:00:39.650721Z received: sendcmpct (9 bytes) peer=0\r\n - 2019-02-01T18:00:39.650737Z received: sendcmpct (9 bytes) peer=0\r\n - 2019-02-01T18:00:39.650751Z received: ping (8 bytes) peer=0\r\n - 2019-02-01T18:00:39.650763Z sending pong (8 bytes) peer=0\r\n - 2019-02-01T18:00:39.650825Z received: getheaders (165 bytes) peer=0\r\n - 2019-02-01T18:00:39.650841Z getheaders 1 to end from peer=0\r\n - 2019-02-01T18:00:39.650854Z sending headers (244 bytes) peer=0\r\n - 2019-02-01T18:00:39.650895Z received: feefilter (8 bytes) peer=0\r\n - 2019-02-01T18:00:39.650907Z received: feefilter of 0.00001000 BTC/kB from peer=0\r\n - 2019-02-01T18:00:39.650934Z received: pong (8 bytes) peer=0\r\n - 2019-02-01T18:00:39.650950Z received: headers (325 bytes) peer=0\r\n - 2019-02-01T18:00:39.651028Z Requesting block 031ddb2a71a0787d38ffcf11ac71c785003a4a4d05a79b6edac7f2e7c86728a6 from  peer=0\r\n - 2019-02-01T18:00:39.651035Z Requesting block 24466befe557061e633ff435931ce3d802ce50fbe93199b55a9b3d689e12b346 from  peer=0\r\n - 2019-02-01T18:00:39.651042Z Requesting block 72dc4f648af86c3051f264f161d5ca18283adbe9b2b16eed8763ed4594173a73 from  peer=0\r\n - 2019-02-01T18:00:39.651048Z Requesting block 22046fc9668cae25c57f70a4b02f8599320a259f63564de4d7cf15648cdd9910 from  peer=0\r\n - 2019-02-01T18:00:39.651054Z Downloading blocks toward 22046fc9668cae25c57f70a4b02f8599320a259f63564de4d7cf15648cdd9910 (4) via headers direct fetch\r\n",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-01T18:03:24Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+        pass\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"\n+\n+        # Deleting the undo file will result in reorg failure\n+        os.unlink(undo_file)\n+\n+        # Connecting to a node with a more work chain will trigger a reorg\n+        # attempt\n+        self.nodes[1].generate(4)\n+        with self.nodes[0].assert_debug_log(\"Failed to disconnect block\"):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r253144465",
      "id" : 253144465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzE0NDQ2NQ==",
      "original_commit_id" : "06e19c76d6381751a4eb49d619787868089ddcce",
      "original_position" : 39,
      "path" : "test/functional/feature_abortnode.py",
      "position" : null,
      "pull_request_review_id" : 199196990,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253144465",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r253144652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253144652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could be fixed with \r\n\r\n```diff\r\ndiff --git a/test/functional/feature_abortnode.py b/test/functional/feature_abortnode.py\r\nindex ad1b0cd8ca..9b5b3a67d1 100755\r\n--- a/test/functional/feature_abortnode.py\r\n+++ b/test/functional/feature_abortnode.py\r\n@@ -36,12 +36,11 @@ class AbortNodeTest(BitcoinTestFramework):\r\n         # Connecting to a node with a more work chain will trigger a reorg\r\n         # attempt\r\n         self.nodes[1].generate(4)\r\n-        with self.nodes[0].assert_debug_log(\"Failed to disconnect block\"):\r\n+        with self.nodes[0].assert_debug_log([\"Failed to disconnect block\"]):\r\n             connect_nodes(self.nodes[0], 1)\r\n-\r\n-        # Check that node0 aborted\r\n-        self.log.info(\"Waiting for crash\")\r\n-        wait_until(lambda: self.nodes[0].is_node_stopped(), timeout=60)\r\n+            # Check that node0 aborted\r\n+            self.log.info(\"Waiting for crash\")\r\n+            wait_until(lambda: self.nodes[0].is_node_stopped(), timeout=60)\r\n         self.log.info(\"Node crashed - now verifying restart fails\")\r\n         self.nodes[0].assert_start_raises_init_error()\r\n \r\n",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-01T18:04:11Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+        pass\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"\n+\n+        # Deleting the undo file will result in reorg failure\n+        os.unlink(undo_file)\n+\n+        # Connecting to a node with a more work chain will trigger a reorg\n+        # attempt\n+        self.nodes[1].generate(4)\n+        with self.nodes[0].assert_debug_log(\"Failed to disconnect block\"):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r253144652",
      "id" : 253144652,
      "in_reply_to_id" : 253144465,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzE0NDY1Mg==",
      "original_commit_id" : "06e19c76d6381751a4eb49d619787868089ddcce",
      "original_position" : 39,
      "path" : "test/functional/feature_abortnode.py",
      "position" : null,
      "pull_request_review_id" : 199197259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253144652",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2019-02-02T11:14:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#issuecomment-459956895",
      "id" : 459956895,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15305",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1OTk1Njg5NQ==",
      "updated_at" : "2019-03-08T16:01:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/459956895",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. The test seems a little fragile (an unrelated change to rename undo files or merge them into block files would break it), but I don't see a better way to do it.",
      "created_at" : "2019-02-02T22:17:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#issuecomment-460003940",
      "id" : 460003940,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15305",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDAwMzk0MA==",
      "updated_at" : "2019-02-02T22:17:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460003940",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r253653314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253653314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`pass` redundant?",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-04T21:29:23Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+        pass",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r253653314",
      "id" : 253653314,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzY1MzMxNA==",
      "original_commit_id" : "06e19c76d6381751a4eb49d619787868089ddcce",
      "original_position" : 26,
      "path" : "test/functional/feature_abortnode.py",
      "position" : null,
      "pull_request_review_id" : 199816047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253653314",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @MarcoFalke I took your change to the test, hopefully it passes travis now.  If it's too flaky though I'll just drop it from this PR.",
      "created_at" : "2019-02-05T18:07:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#issuecomment-460742036",
      "id" : 460742036,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15305",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDc0MjAzNg==",
      "updated_at" : "2019-02-05T18:07:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460742036",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r253981651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253981651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed in latest commit.",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-05T18:07:27Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+        pass",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r253981651",
      "id" : 253981651,
      "in_reply_to_id" : 253653314,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1Mzk4MTY1MQ==",
      "original_commit_id" : "06e19c76d6381751a4eb49d619787868089ddcce",
      "original_position" : 26,
      "path" : "test/functional/feature_abortnode.py",
      "position" : null,
      "pull_request_review_id" : 200223234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253981651",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254024905"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254024905"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think it is worth the burden of having this undocumented global in the source code to ease today's review of the diff at the cost of all future review of the overall code.\r\n\r\nI'd prefer to be consistent by allowing AbortNode to be called multiple times and then either overwriting the warning string or keeping the previous one, but special casing the reorg warning to not overwrite any previous warnings seems arbitrary.",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-05T20:02:06Z",
      "diff_hunk" : "@@ -2551,6 +2553,9 @@ bool CChainState::ActivateBestChainStep(CValidationState& state, const CChainPar\n             // This is likely a fatal error, but keep the mempool consistent,\n             // just in case. Only remove from the mempool in this case.\n             UpdateMempoolForReorg(disconnectpool, false);\n+            if (!g_abort_node) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254024905",
      "id" : 254024905,
      "in_reply_to_id" : 252845092,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDAyNDkwNQ==",
      "original_commit_id" : "5331e2a4d5f098f205ca786a96665c184ca019d5",
      "original_position" : 20,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 200276241,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254024905",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254030440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254030440"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps I should get rid of the call to `AbortNode` in DisconnectTip, and then do away with this new global and unconditionally call AbortNode in ABCStep?  That would result in a behavior change for invalidateblock and certain failures in RewindBlockIndex, but that might actually be desirable anyway.\r\n",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-05T20:18:17Z",
      "diff_hunk" : "@@ -2551,6 +2553,9 @@ bool CChainState::ActivateBestChainStep(CValidationState& state, const CChainPar\n             // This is likely a fatal error, but keep the mempool consistent,\n             // just in case. Only remove from the mempool in this case.\n             UpdateMempoolForReorg(disconnectpool, false);\n+            if (!g_abort_node) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254030440",
      "id" : 254030440,
      "in_reply_to_id" : 252845092,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDAzMDQ0MA==",
      "original_commit_id" : "5331e2a4d5f098f205ca786a96665c184ca019d5",
      "original_position" : 20,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 200282919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254030440",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated this PR to get rid of the g_abort_node global, and instead change DisconnectTip to no longer call AbortNode itself, and instead leave it to the caller to decide how to handle failures.\r\n\r\nThis slightly changes the behavior of invalidateblock and RewindBlockIndex -- I believe it's an improvement but reviewers should take note.",
      "created_at" : "2019-02-05T21:14:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#issuecomment-460806105",
      "id" : 460806105,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15305",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDgwNjEwNQ==",
      "updated_at" : "2019-02-05T21:14:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460806105",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The appveyor test failure appears to be an unrelated, long-standing bug in the `wallet_txn_doublespend.py` test (fixed in #15360).",
      "created_at" : "2019-02-07T00:05:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#issuecomment-461238665",
      "id" : 461238665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15305",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MTIzODY2NQ==",
      "updated_at" : "2019-02-07T00:05:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/461238665",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254715399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254715399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to not generate 4 here instead?",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-07T14:55:53Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"\n+\n+        # Deleting the undo file will result in reorg failure\n+        os.unlink(undo_file)\n+\n+        # Connecting to a node with a more work chain will trigger a reorg\n+        # attempt\n+        self.nodes[1].generate(3)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254715399",
      "id" : 254715399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDcxNTM5OQ==",
      "original_commit_id" : "be155578b23d84874a949433e4738dece12928c7",
      "original_position" : 37,
      "path" : "test/functional/feature_abortnode.py",
      "position" : 36,
      "pull_request_review_id" : 201129474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254715399",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254715652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254715652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should use `os.path.join`.\r\n\r\nnit, could inline this below\r\n```py\r\nos.unlink(os.path.join(datadir, 'regtest', 'blocks', 'rev00000.dat'))\r\n```",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-07T14:56:26Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254715652",
      "id" : 254715652,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDcxNTY1Mg==",
      "original_commit_id" : "be155578b23d84874a949433e4738dece12928c7",
      "original_position" : 30,
      "path" : "test/functional/feature_abortnode.py",
      "position" : null,
      "pull_request_review_id" : 201129474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254715652",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254715799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254715799"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, double new line.",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-07T14:56:44Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254715799",
      "id" : 254715799,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDcxNTc5OQ==",
      "original_commit_id" : "be155578b23d84874a949433e4738dece12928c7",
      "original_position" : 16,
      "path" : "test/functional/feature_abortnode.py",
      "position" : 16,
      "pull_request_review_id" : 201129474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254715799",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254715844"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254715844"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, double new line.",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-07T14:56:49Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"\n+\n+        # Deleting the undo file will result in reorg failure\n+        os.unlink(undo_file)\n+\n+        # Connecting to a node with a more work chain will trigger a reorg\n+        # attempt\n+        self.nodes[1].generate(3)\n+        with self.nodes[0].assert_debug_log([\"Failed to disconnect block\"]):\n+            connect_nodes(self.nodes[0], 1)\n+            self.nodes[1].generate(1)\n+\n+            # Check that node0 aborted\n+            self.log.info(\"Waiting for crash\")\n+            wait_until(lambda: self.nodes[0].is_node_stopped(), timeout=60)\n+        self.log.info(\"Node crashed - now verifying restart fails\")\n+        self.nodes[0].assert_start_raises_init_error()\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r254715844",
      "id" : 254715844,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDcxNTg0NA==",
      "original_commit_id" : "be155578b23d84874a949433e4738dece12928c7",
      "original_position" : 47,
      "path" : "test/functional/feature_abortnode.py",
      "position" : 46,
      "pull_request_review_id" : 201129474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254715844",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r255177862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255177862"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes-- if you generate 4 here, then the call to connect_nodes() afterward can trigger a crash on node0 before the function returns, which causes problems for the test. ",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-08T18:03:33Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"\n+\n+        # Deleting the undo file will result in reorg failure\n+        os.unlink(undo_file)\n+\n+        # Connecting to a node with a more work chain will trigger a reorg\n+        # attempt\n+        self.nodes[1].generate(3)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r255177862",
      "id" : 255177862,
      "in_reply_to_id" : 254715399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTE3Nzg2Mg==",
      "original_commit_id" : "be155578b23d84874a949433e4738dece12928c7",
      "original_position" : 37,
      "path" : "test/functional/feature_abortnode.py",
      "position" : 36,
      "pull_request_review_id" : 201711401,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255177862",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r255193515"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255193515"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in latest commit.",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-08T18:45:46Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+        undo_file = datadir + \"/regtest/blocks/rev00000.dat\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r255193515",
      "id" : 255193515,
      "in_reply_to_id" : 254715652,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTE5MzUxNQ==",
      "original_commit_id" : "be155578b23d84874a949433e4738dece12928c7",
      "original_position" : 30,
      "path" : "test/functional/feature_abortnode.py",
      "position" : null,
      "pull_request_review_id" : 201731025,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255193515",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r255193649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255193649"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not seeing the extra new-line in our style guide, nor does it seem to be failing our style linter?  Leaving as-is.",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-02-08T18:46:08Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r255193649",
      "id" : 255193649,
      "in_reply_to_id" : 254715799,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTE5MzY0OQ==",
      "original_commit_id" : "be155578b23d84874a949433e4738dece12928c7",
      "original_position" : 16,
      "path" : "test/functional/feature_abortnode.py",
      "position" : 16,
      "pull_request_review_id" : 201731198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-08T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255193649",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2019-02-14T05:03:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#issuecomment-463490863",
      "id" : 463490863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15305",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MzQ5MDg2Mw==",
      "updated_at" : "2019-03-08T16:12:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/463490863",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r268534825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268534825"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: Is the lambda needed here?",
      "commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "created_at" : "2019-03-25T08:50:56Z",
      "diff_hunk" : "@@ -0,0 +1,48 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2019 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test bitcoind aborts if can't disconnect a block.\n+\n+- Start a single node and generate 3 blocks.\n+- Delete the undo data.\n+- Mine a fork that requires disconnecting the tip.\n+- Verify that bitcoind AbortNode's.\n+\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import wait_until, get_datadir_path, connect_nodes\n+import os\n+\n+class AbortNodeTest(BitcoinTestFramework):\n+\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+        # We'll connect the nodes later\n+\n+    def run_test(self):\n+        self.nodes[0].generate(3)\n+        datadir = get_datadir_path(self.options.tmpdir, 0)\n+\n+        # Deleting the undo file will result in reorg failure\n+        os.unlink(os.path.join(datadir, 'regtest', 'blocks', 'rev00000.dat'))\n+\n+        # Connecting to a node with a more work chain will trigger a reorg\n+        # attempt.\n+        self.nodes[1].generate(3)\n+        with self.nodes[0].assert_debug_log([\"Failed to disconnect block\"]):\n+            connect_nodes(self.nodes[0], 1)\n+            self.nodes[1].generate(1)\n+\n+            # Check that node0 aborted\n+            self.log.info(\"Waiting for crash\")\n+            wait_until(lambda: self.nodes[0].is_node_stopped(), timeout=60)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15305#discussion_r268534825",
      "id" : 268534825,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODUzNDgyNQ==",
      "original_commit_id" : "daf67ad1d3cd6de67776fa26d49e6b1ba66aae7d",
      "original_position" : 43,
      "path" : "test/functional/feature_abortnode.py",
      "position" : 43,
      "pull_request_review_id" : 218201156,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15305",
      "updated_at" : "2019-03-25T08:50:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268534825",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
