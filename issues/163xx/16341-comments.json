[
   {
      "author_association" : "MEMBER",
      "body" : "In the coming days I will try to squash together some of these commits so there aren't so many of them. I just wanted to get this open now for people to begin reviewing the changes.",
      "created_at" : "2019-07-05T03:01:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-508614075",
      "id" : 508614075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODYxNDA3NQ==",
      "updated_at" : "2019-07-05T03:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508614075",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16798](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16798.html) (Refactor rawtransaction_util's SignTransaction to separate prevtx parsing by achow101)\n* [#16698](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16698.html) ([WIP] Mempool: rework rebroadcast logic to improve privacy by amitiuttarwar)\n* [#16440](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16440.html) (BIP-322: Generic signed message format by kallewoof)\n* [#16251](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16251.html) (Improve signrawtransaction error reporting by ajtowns)\n* [#16037](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16037.html) (rpc: Enable wallet import on pruned nodes by promag)\n* [#15931](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15931.html) (Remove GetDepthInMainChain dependency on locked chain interface by ariard)\n* [#15294](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15294.html) ([moveonly] wallet: Extract RipeMd160 by Empact)\n* [#14942](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14942.html) (wallet: Make scan / abort status private to CWallet by Empact)\n* [#14384](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14384.html) (Fire TransactionRemovedFromMempool callbacks from mempool by l2a5b1)\n* [#14144](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14144.html) (Refactoring: Clarify code using encrypted_batch in CWallet by domob1812)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-07-05T04:41:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-508627166",
      "id" : 508627166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODYyNzE2Ng==",
      "updated_at" : "2019-09-03T21:41:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508627166",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812193"
         }
      },
      "author_association" : "NONE",
      "body" : "I'm very suspect at this line. We are assigning a dereference pointer. \r\nI think we should prefer `is_mine = &m_wallet->IsMine(dest);`",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-05T23:55:04Z",
      "diff_hunk" : "@@ -170,7 +193,7 @@ class WalletImpl : public Wallet\n             *name = it->second.name;\n         }\n         if (is_mine) {\n-            *is_mine = IsMine(*m_wallet, dest);\n+            *is_mine = m_wallet->IsMine(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812193",
      "id" : 300812193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMjE5Mw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 85,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 50,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812193",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812273"
         }
      },
      "author_association" : "NONE",
      "body" : "This name doesn't indicate a boolean return value. ð¤ Why not isPubKey()?",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-05T23:56:39Z",
      "diff_hunk" : "@@ -78,14 +78,14 @@ class Wallet\n     //! Get wallet name.\n     virtual std::string getWalletName() = 0;\n \n-    // Get key from pool.\n-    virtual bool getKeyFromPool(bool internal, CPubKey& pub_key) = 0;\n+    // Get a new address.\n+    virtual bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) = 0;\n \n     //! Get public key.\n-    virtual bool getPubKey(const CKeyID& address, CPubKey& pub_key) = 0;\n+    virtual bool getPubKey(const CScript& script, const CKeyID& address, CPubKey& pub_key) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812273",
      "id" : 300812273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMjI3Mw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 11,
      "path" : "src/interfaces/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812273",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812837"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812837"
         }
      },
      "author_association" : "NONE",
      "body" : "Include `redeemScript.size()` size in the logging so we can debug easier ",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T00:08:28Z",
      "diff_hunk" : "@@ -83,23 +137,23 @@ bool CBasicKeyStore::GetKey(const CKeyID &address, CKey &keyOut) const\n     return false;\n }\n \n-bool CBasicKeyStore::AddCScript(const CScript& redeemScript)\n+bool FillableSigningProvider::AddCScript(const CScript& redeemScript)\n {\n     if (redeemScript.size() > MAX_SCRIPT_ELEMENT_SIZE)\n-        return error(\"CBasicKeyStore::AddCScript(): redeemScripts > %i bytes are invalid\", MAX_SCRIPT_ELEMENT_SIZE);\n+        return error(\"FillableSigningProvider::AddCScript(): redeemScripts > %i bytes are invalid\", MAX_SCRIPT_ELEMENT_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812837",
      "id" : 300812837,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMjgzNw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 144,
      "path" : "src/script/signingprovider.cpp",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812837",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812883"
         }
      },
      "author_association" : "NONE",
      "body" : "Can we use BYTE to be more informative of the type",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T00:09:19Z",
      "diff_hunk" : "@@ -0,0 +1,37 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_SCRIPT_KEYORIGIN_H\n+#define BITCOIN_SCRIPT_KEYORIGIN_H\n+\n+#include <serialize.h>\n+#include <streams.h>\n+#include <vector>\n+\n+struct KeyOriginInfo\n+{\n+    unsigned char fingerprint[4]; //!< First 32 bits of the Hash160 of the public key at the root of the path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812883",
      "id" : 300812883,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMjg4Mw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 14,
      "path" : "src/script/keyorigin.h",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812883",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300813241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300813241"
         }
      },
      "author_association" : "NONE",
      "body" : "`provider` should be checked before dereferencing ",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T00:17:04Z",
      "diff_hunk" : "@@ -3083,7 +3097,8 @@ static UniValue listunspent(const JSONRPCRequest& request)\n         entry.pushKV(\"spendable\", out.fSpendable);\n         entry.pushKV(\"solvable\", out.fSolvable);\n         if (out.fSolvable) {\n-            auto descriptor = InferDescriptor(scriptPubKey, *pwallet);\n+            const SigningProvider* provider = pwallet->GetSigningProvider(scriptPubKey);\n+            auto descriptor = InferDescriptor(scriptPubKey, *provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300813241",
      "id" : 300813241,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMzI0MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 320,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300813241",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300813882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300813882"
         }
      },
      "author_association" : "NONE",
      "body" : "Please add space around operators ",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T00:31:41Z",
      "diff_hunk" : "@@ -1661,71 +1311,48 @@ bool CWallet::DummySignTx(CMutableTransaction &txNew, const std::vector<CTxOut>\n     return true;\n }\n \n-bool CWallet::ImportScripts(const std::set<CScript> scripts)\n+bool CWallet::ImportScripts(const std::set<CScript> scripts, int64_t time)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : scripts) {\n-        if (!HaveCScript(CScriptID(entry)) && !AddCScriptWithDB(batch, entry)) {\n-            return false;\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportScripts(scripts, time);\n }\n \n bool CWallet::ImportPrivKeys(const std::map<CKeyID, CKey>& privkey_map, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : privkey_map) {\n-        const CKey& key = entry.second;\n-        CPubKey pubkey = key.GetPubKey();\n-        const CKeyID& id = entry.first;\n-        assert(key.VerifyPubKey(pubkey));\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-        // If the private key is not present in the wallet, insert it.\n-        if (!HaveKey(id) && !AddKeyPubKeyWithDB(batch, key, pubkey)) {\n-            return false;\n-        }\n-        UpdateTimeFirstKey(timestamp);\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPrivKeys(privkey_map, timestamp);\n }\n \n bool CWallet::ImportPubKeys(const std::vector<CKeyID>& ordered_pubkeys, const std::map<CKeyID, CPubKey>& pubkey_map, const std::map<CKeyID, std::pair<CPubKey, KeyOriginInfo>>& key_origins, const bool add_keypool, const bool internal, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : key_origins) {\n-        AddKeyOriginWithDB(batch, entry.second.first, entry.second.second);\n-    }\n-    for (const CKeyID& id : ordered_pubkeys) {\n-        auto entry = pubkey_map.find(id);\n-        if (entry == pubkey_map.end()) {\n-            continue;\n-        }\n-        const CPubKey& pubkey = entry->second;\n-        CPubKey temp;\n-        if (!GetPubKey(id, temp) && !AddWatchOnlyWithDB(batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n-            return false;\n-        }\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-\n-        // Add to keypool only works with pubkeys\n-        if (add_keypool) {\n-            AddKeypoolPubkeyWithDB(pubkey, internal, batch);\n-            NotifyCanGetAddressesChanged();\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPubKeys(ordered_pubkeys, pubkey_map, key_origins, add_keypool, internal, timestamp);\n }\n \n bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScript>& script_pub_keys, const bool have_solving_data, const bool internal, const int64_t timestamp)\n {\n+    auto spk_man =GetLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300813882",
      "id" : 300813882,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMzg4Mg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 695,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300813882",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818049"
         }
      },
      "author_association" : "NONE",
      "body" : "Could be void since we always return true.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T03:02:04Z",
      "diff_hunk" : "@@ -32,37 +92,31 @@ void CBasicKeyStore::ImplicitlyLearnRelatedKeyScripts(const CPubKey& pubkey)\n     }\n }\n \n-bool CBasicKeyStore::GetPubKey(const CKeyID &address, CPubKey &vchPubKeyOut) const\n+bool FillableSigningProvider::GetPubKey(const CKeyID &address, CPubKey &vchPubKeyOut) const\n {\n     CKey key;\n     if (!GetKey(address, key)) {\n-        LOCK(cs_KeyStore);\n-        WatchKeyMap::const_iterator it = mapWatchKeys.find(address);\n-        if (it != mapWatchKeys.end()) {\n-            vchPubKeyOut = it->second;\n-            return true;\n-        }\n         return false;\n     }\n     vchPubKeyOut = key.GetPubKey();\n     return true;\n }\n \n-bool CBasicKeyStore::AddKeyPubKey(const CKey& key, const CPubKey &pubkey)\n+bool FillableSigningProvider::AddKeyPubKey(const CKey& key, const CPubKey &pubkey)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818049",
      "id" : 300818049,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODA0OQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 106,
      "path" : "src/script/signingprovider.cpp",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818049",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818112"
         }
      },
      "author_association" : "NONE",
      "body" : "Looks like we could remove error and use empty string `\"\"`  below. ",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T03:05:57Z",
      "diff_hunk" : "@@ -140,14 +140,37 @@ class WalletImpl : public Wallet\n     void abortRescan() override { m_wallet->AbortRescan(); }\n     bool backupWallet(const std::string& filename) override { return m_wallet->BackupWallet(filename); }\n     std::string getWalletName() override { return m_wallet->GetName(); }\n-    bool getKeyFromPool(bool internal, CPubKey& pub_key) override\n+    bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) override\n     {\n-        return m_wallet->GetKeyFromPool(pub_key, internal);\n+        LOCK(m_wallet->cs_wallet);\n+        std::string error;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818112",
      "id" : 300818112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODExMg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 45,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818112",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818241"
         }
      },
      "author_association" : "NONE",
      "body" : "Is this done as an optimization? I'd prefer:\r\n```\r\nvoid CWallet::SetCrypted()\r\n{ \r\n    LOCK(cs_wallet);\r\n    fUseCrypto = true;\r\n}\r\n```",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T03:14:11Z",
      "diff_hunk" : "@@ -4560,31 +3942,141 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n     return groups;\n }\n \n-bool CWallet::GetKeyOrigin(const CKeyID& keyID, KeyOriginInfo& info) const\n+bool CWallet::SetCrypted()\n {\n-    CKeyMetadata meta;\n+    LOCK(cs_wallet);\n+    if (fUseCrypto)\n+        return true;\n+    fUseCrypto = true;\n+    return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818241",
      "id" : 300818241,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODI0MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 1491,
      "path" : "src/wallet/wallet.cpp",
      "position" : 1522,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818241",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818321"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please try to understand the code you're commenting on.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T03:18:57Z",
      "diff_hunk" : "@@ -170,7 +193,7 @@ class WalletImpl : public Wallet\n             *name = it->second.name;\n         }\n         if (is_mine) {\n-            *is_mine = IsMine(*m_wallet, dest);\n+            *is_mine = m_wallet->IsMine(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818321",
      "id" : 300818321,
      "in_reply_to_id" : 300812193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODMyMQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 85,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 50,
      "pull_request_review_id" : 258575305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818321",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818335"
         }
      },
      "author_association" : "MEMBER",
      "body" : "C++11 does not have such a type.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T03:19:45Z",
      "diff_hunk" : "@@ -0,0 +1,37 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_SCRIPT_KEYORIGIN_H\n+#define BITCOIN_SCRIPT_KEYORIGIN_H\n+\n+#include <serialize.h>\n+#include <streams.h>\n+#include <vector>\n+\n+struct KeyOriginInfo\n+{\n+    unsigned char fingerprint[4]; //!< First 32 bits of the Hash160 of the public key at the root of the path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818335",
      "id" : 300818335,
      "in_reply_to_id" : 300812883,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODMzNQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 14,
      "path" : "src/script/keyorigin.h",
      "position" : null,
      "pull_request_review_id" : 258575318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818335",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819296"
         }
      },
      "author_association" : "NONE",
      "body" : "@sipa: Clarifying what you're referring to would be both constructive and polite :)",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:12:08Z",
      "diff_hunk" : "@@ -170,7 +193,7 @@ class WalletImpl : public Wallet\n             *name = it->second.name;\n         }\n         if (is_mine) {\n-            *is_mine = IsMine(*m_wallet, dest);\n+            *is_mine = m_wallet->IsMine(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819296",
      "id" : 300819296,
      "in_reply_to_id" : 300812193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTI5Ng==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 85,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 50,
      "pull_request_review_id" : 258576343,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819296",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/33569?v=4",
         "events_url" : "https://api.github.com/users/dandv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dandv/followers",
         "following_url" : "https://api.github.com/users/dandv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dandv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dandv",
         "id" : 33569,
         "login" : "dandv",
         "node_id" : "MDQ6VXNlcjMzNTY5",
         "organizations_url" : "https://api.github.com/users/dandv/orgs",
         "received_events_url" : "https://api.github.com/users/dandv/received_events",
         "repos_url" : "https://api.github.com/users/dandv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dandv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dandv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dandv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819341"
         }
      },
      "author_association" : "NONE",
      "body" : "The old `get...Key` returning `bool` smells: either the pubKey is a boolean, or `getPubKey` has a side effect of getting the key somewhere else instead of as a result. Could this PR fix that by renaming it to `isPubKey()`?",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:14:54Z",
      "diff_hunk" : "@@ -78,14 +78,14 @@ class Wallet\n     //! Get wallet name.\n     virtual std::string getWalletName() = 0;\n \n-    // Get key from pool.\n-    virtual bool getKeyFromPool(bool internal, CPubKey& pub_key) = 0;\n+    // Get a new address.\n+    virtual bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) = 0;\n \n     //! Get public key.\n-    virtual bool getPubKey(const CKeyID& address, CPubKey& pub_key) = 0;\n+    virtual bool getPubKey(const CScript& script, const CKeyID& address, CPubKey& pub_key) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819341",
      "id" : 300819341,
      "in_reply_to_id" : 300812273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTM0MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 11,
      "path" : "src/interfaces/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 258576394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819341",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/33569?v=4",
         "events_url" : "https://api.github.com/users/dandv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dandv/followers",
         "following_url" : "https://api.github.com/users/dandv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dandv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dandv",
         "id" : 33569,
         "login" : "dandv",
         "node_id" : "MDQ6VXNlcjMzNTY5",
         "organizations_url" : "https://api.github.com/users/dandv/orgs",
         "received_events_url" : "https://api.github.com/users/dandv/received_events",
         "repos_url" : "https://api.github.com/users/dandv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dandv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dandv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dandv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819367"
         }
      },
      "author_association" : "NONE",
      "body" : "Such key code would certainly benefit from linting.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:16:24Z",
      "diff_hunk" : "@@ -1661,71 +1311,48 @@ bool CWallet::DummySignTx(CMutableTransaction &txNew, const std::vector<CTxOut>\n     return true;\n }\n \n-bool CWallet::ImportScripts(const std::set<CScript> scripts)\n+bool CWallet::ImportScripts(const std::set<CScript> scripts, int64_t time)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : scripts) {\n-        if (!HaveCScript(CScriptID(entry)) && !AddCScriptWithDB(batch, entry)) {\n-            return false;\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportScripts(scripts, time);\n }\n \n bool CWallet::ImportPrivKeys(const std::map<CKeyID, CKey>& privkey_map, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : privkey_map) {\n-        const CKey& key = entry.second;\n-        CPubKey pubkey = key.GetPubKey();\n-        const CKeyID& id = entry.first;\n-        assert(key.VerifyPubKey(pubkey));\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-        // If the private key is not present in the wallet, insert it.\n-        if (!HaveKey(id) && !AddKeyPubKeyWithDB(batch, key, pubkey)) {\n-            return false;\n-        }\n-        UpdateTimeFirstKey(timestamp);\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPrivKeys(privkey_map, timestamp);\n }\n \n bool CWallet::ImportPubKeys(const std::vector<CKeyID>& ordered_pubkeys, const std::map<CKeyID, CPubKey>& pubkey_map, const std::map<CKeyID, std::pair<CPubKey, KeyOriginInfo>>& key_origins, const bool add_keypool, const bool internal, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : key_origins) {\n-        AddKeyOriginWithDB(batch, entry.second.first, entry.second.second);\n-    }\n-    for (const CKeyID& id : ordered_pubkeys) {\n-        auto entry = pubkey_map.find(id);\n-        if (entry == pubkey_map.end()) {\n-            continue;\n-        }\n-        const CPubKey& pubkey = entry->second;\n-        CPubKey temp;\n-        if (!GetPubKey(id, temp) && !AddWatchOnlyWithDB(batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n-            return false;\n-        }\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-\n-        // Add to keypool only works with pubkeys\n-        if (add_keypool) {\n-            AddKeypoolPubkeyWithDB(pubkey, internal, batch);\n-            NotifyCanGetAddressesChanged();\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPubKeys(ordered_pubkeys, pubkey_map, key_origins, add_keypool, internal, timestamp);\n }\n \n bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScript>& script_pub_keys, const bool have_solving_data, const bool internal, const int64_t timestamp)\n {\n+    auto spk_man =GetLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819367",
      "id" : 300819367,
      "in_reply_to_id" : 300813882,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTM2Nw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 695,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258576422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819367",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/33569?v=4",
         "events_url" : "https://api.github.com/users/dandv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dandv/followers",
         "following_url" : "https://api.github.com/users/dandv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dandv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dandv",
         "id" : 33569,
         "login" : "dandv",
         "node_id" : "MDQ6VXNlcjMzNTY5",
         "organizations_url" : "https://api.github.com/users/dandv/orgs",
         "received_events_url" : "https://api.github.com/users/dandv/received_events",
         "repos_url" : "https://api.github.com/users/dandv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dandv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dandv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dandv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Everyone commenting here, note that this PR is a work in progress, and is built on top of multiple open PRs.\r\n\r\nFor now we should try and keep the discussion here at a Concept ACK/NACK & design level, rather than individual nit-picks and code review.\r\n\r\nIf you would like to review the code, please do so in the open base PRs. That will not only save the concept level discussion here from being drowned out in inline comments, but will also prevent duplicate review. i.e What you're commenting on here might have already been addressed/pointed out in the base PRs.",
      "created_at" : "2019-07-06T04:28:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-508896117",
      "id" : 508896117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODg5NjExNw==",
      "updated_at" : "2019-07-06T04:28:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508896117",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819626"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This line is merely changing how `IsMine` is called. In order to avoid difficulties for reviewers, the existing code (the assignment itself) is not being changed.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:31:00Z",
      "diff_hunk" : "@@ -170,7 +193,7 @@ class WalletImpl : public Wallet\n             *name = it->second.name;\n         }\n         if (is_mine) {\n-            *is_mine = IsMine(*m_wallet, dest);\n+            *is_mine = m_wallet->IsMine(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819626",
      "id" : 300819626,
      "in_reply_to_id" : 300812193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTYyNg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 85,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 50,
      "pull_request_review_id" : 258576720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819626",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I am trying to avoid changing existing code as much as possible in order to avoid additional review burden. Feel free to change this later, but changing it here is out of scope for this PR.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:32:32Z",
      "diff_hunk" : "@@ -78,14 +78,14 @@ class Wallet\n     //! Get wallet name.\n     virtual std::string getWalletName() = 0;\n \n-    // Get key from pool.\n-    virtual bool getKeyFromPool(bool internal, CPubKey& pub_key) = 0;\n+    // Get a new address.\n+    virtual bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) = 0;\n \n     //! Get public key.\n-    virtual bool getPubKey(const CKeyID& address, CPubKey& pub_key) = 0;\n+    virtual bool getPubKey(const CScript& script, const CKeyID& address, CPubKey& pub_key) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819651",
      "id" : 300819651,
      "in_reply_to_id" : 300812273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTY1MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 11,
      "path" : "src/interfaces/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 258576752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819681"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is part of a scripted diff. Such a change would both not part of the script and be unrelated to this PR.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:33:40Z",
      "diff_hunk" : "@@ -83,23 +137,23 @@ bool CBasicKeyStore::GetKey(const CKeyID &address, CKey &keyOut) const\n     return false;\n }\n \n-bool CBasicKeyStore::AddCScript(const CScript& redeemScript)\n+bool FillableSigningProvider::AddCScript(const CScript& redeemScript)\n {\n     if (redeemScript.size() > MAX_SCRIPT_ELEMENT_SIZE)\n-        return error(\"CBasicKeyStore::AddCScript(): redeemScripts > %i bytes are invalid\", MAX_SCRIPT_ELEMENT_SIZE);\n+        return error(\"FillableSigningProvider::AddCScript(): redeemScripts > %i bytes are invalid\", MAX_SCRIPT_ELEMENT_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819681",
      "id" : 300819681,
      "in_reply_to_id" : 300812837,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTY4MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 144,
      "path" : "src/script/signingprovider.cpp",
      "position" : null,
      "pull_request_review_id" : 258576788,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819681",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is existing code and is merely a rename. Changing what it returns is out of scope for this PR.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:34:53Z",
      "diff_hunk" : "@@ -32,37 +92,31 @@ void CBasicKeyStore::ImplicitlyLearnRelatedKeyScripts(const CPubKey& pubkey)\n     }\n }\n \n-bool CBasicKeyStore::GetPubKey(const CKeyID &address, CPubKey &vchPubKeyOut) const\n+bool FillableSigningProvider::GetPubKey(const CKeyID &address, CPubKey &vchPubKeyOut) const\n {\n     CKey key;\n     if (!GetKey(address, key)) {\n-        LOCK(cs_KeyStore);\n-        WatchKeyMap::const_iterator it = mapWatchKeys.find(address);\n-        if (it != mapWatchKeys.end()) {\n-            vchPubKeyOut = it->second;\n-            return true;\n-        }\n         return false;\n     }\n     vchPubKeyOut = key.GetPubKey();\n     return true;\n }\n \n-bool CBasicKeyStore::AddKeyPubKey(const CKey& key, const CPubKey &pubkey)\n+bool FillableSigningProvider::AddKeyPubKey(const CKey& key, const CPubKey &pubkey)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819703",
      "id" : 300819703,
      "in_reply_to_id" : 300818049,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTcwMw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 106,
      "path" : "src/script/signingprovider.cpp",
      "position" : null,
      "pull_request_review_id" : 258576815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819703",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819762"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is moved code and I will not be changing it in order to avoid overburdening reviewers with ensuring that behavior hasn't changed.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:36:06Z",
      "diff_hunk" : "@@ -4560,31 +3942,141 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n     return groups;\n }\n \n-bool CWallet::GetKeyOrigin(const CKeyID& keyID, KeyOriginInfo& info) const\n+bool CWallet::SetCrypted()\n {\n-    CKeyMetadata meta;\n+    LOCK(cs_wallet);\n+    if (fUseCrypto)\n+        return true;\n+    fUseCrypto = true;\n+    return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819762",
      "id" : 300819762,
      "in_reply_to_id" : 300818241,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTc2Mg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 1491,
      "path" : "src/wallet/wallet.cpp",
      "position" : 1522,
      "pull_request_review_id" : 258576853,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819762",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, `GetNewAddress` takes a reference which `\"\"` is not.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:39:57Z",
      "diff_hunk" : "@@ -140,14 +140,37 @@ class WalletImpl : public Wallet\n     void abortRescan() override { m_wallet->AbortRescan(); }\n     bool backupWallet(const std::string& filename) override { return m_wallet->BackupWallet(filename); }\n     std::string getWalletName() override { return m_wallet->GetName(); }\n-    bool getKeyFromPool(bool internal, CPubKey& pub_key) override\n+    bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) override\n     {\n-        return m_wallet->GetKeyFromPool(pub_key, internal);\n+        LOCK(m_wallet->cs_wallet);\n+        std::string error;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819836",
      "id" : 300819836,
      "in_reply_to_id" : 300818112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTgzNg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 45,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 258576934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819836",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300820287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300820287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:59:53Z",
      "diff_hunk" : "@@ -3083,7 +3097,8 @@ static UniValue listunspent(const JSONRPCRequest& request)\n         entry.pushKV(\"spendable\", out.fSpendable);\n         entry.pushKV(\"solvable\", out.fSolvable);\n         if (out.fSolvable) {\n-            auto descriptor = InferDescriptor(scriptPubKey, *pwallet);\n+            const SigningProvider* provider = pwallet->GetSigningProvider(scriptPubKey);\n+            auto descriptor = InferDescriptor(scriptPubKey, *provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300820287",
      "id" : 300820287,
      "in_reply_to_id" : 300813241,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgyMDI4Nw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 320,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258577357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300820287",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300820289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300820289"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-07-06T04:59:59Z",
      "diff_hunk" : "@@ -1661,71 +1311,48 @@ bool CWallet::DummySignTx(CMutableTransaction &txNew, const std::vector<CTxOut>\n     return true;\n }\n \n-bool CWallet::ImportScripts(const std::set<CScript> scripts)\n+bool CWallet::ImportScripts(const std::set<CScript> scripts, int64_t time)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : scripts) {\n-        if (!HaveCScript(CScriptID(entry)) && !AddCScriptWithDB(batch, entry)) {\n-            return false;\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportScripts(scripts, time);\n }\n \n bool CWallet::ImportPrivKeys(const std::map<CKeyID, CKey>& privkey_map, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : privkey_map) {\n-        const CKey& key = entry.second;\n-        CPubKey pubkey = key.GetPubKey();\n-        const CKeyID& id = entry.first;\n-        assert(key.VerifyPubKey(pubkey));\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-        // If the private key is not present in the wallet, insert it.\n-        if (!HaveKey(id) && !AddKeyPubKeyWithDB(batch, key, pubkey)) {\n-            return false;\n-        }\n-        UpdateTimeFirstKey(timestamp);\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPrivKeys(privkey_map, timestamp);\n }\n \n bool CWallet::ImportPubKeys(const std::vector<CKeyID>& ordered_pubkeys, const std::map<CKeyID, CPubKey>& pubkey_map, const std::map<CKeyID, std::pair<CPubKey, KeyOriginInfo>>& key_origins, const bool add_keypool, const bool internal, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : key_origins) {\n-        AddKeyOriginWithDB(batch, entry.second.first, entry.second.second);\n-    }\n-    for (const CKeyID& id : ordered_pubkeys) {\n-        auto entry = pubkey_map.find(id);\n-        if (entry == pubkey_map.end()) {\n-            continue;\n-        }\n-        const CPubKey& pubkey = entry->second;\n-        CPubKey temp;\n-        if (!GetPubKey(id, temp) && !AddWatchOnlyWithDB(batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n-            return false;\n-        }\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-\n-        // Add to keypool only works with pubkeys\n-        if (add_keypool) {\n-            AddKeypoolPubkeyWithDB(pubkey, internal, batch);\n-            NotifyCanGetAddressesChanged();\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPubKeys(ordered_pubkeys, pubkey_map, key_origins, add_keypool, internal, timestamp);\n }\n \n bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScript>& script_pub_keys, const bool have_solving_data, const bool internal, const int64_t timestamp)\n {\n+    auto spk_man =GetLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300820289",
      "id" : 300820289,
      "in_reply_to_id" : 300813882,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgyMDI4OQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 695,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258577359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300820289",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, this abstraction is definitely the right path for the wallet to take IMO as we work toward descriptor wallets.",
      "created_at" : "2019-07-07T03:03:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-508967793",
      "id" : 508967793,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODk2Nzc5Mw==",
      "updated_at" : "2019-07-07T03:03:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508967793",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Approach ACK.\r\n\r\nTo make some of the commits easier to review, instead of having one commit that adds a function to `LegacyScriptPubKeyMan` (e.g. `LegacyScriptPubKeyMan::LoadKey`), one commit that deletes it from CWallet (`Remove unused functions and switch CWallet to use ScriptPubKeyMan`) and one commit that moves the call over (`Implement actually loading everything into LegacyScriptPubKeyMan`), try to combine those. That lets you get rid of the CI Skip commits, and makes it easier to verify move-only parts with `--color-moved=dimmed-zebra`.\r\n\r\nIn other words, start with empty `(Legacy)ScriptPubKeyMan` and then migrate one function per commit into it.\r\n\r\nAre you sure you want to move `WalletFeature` and `WalletFlags` into `LegacyScriptPubKeyMan`? I would prefer to keep these settings global to the wallet. It does make sense for each `ScriptPubKeyMan` to have its own `IsLocked()` state, so that brings up the question what to do if a single one fails to unlock. But I'd rather not add RPC methods to unlock specific `PubKeyMan`s in a given wallet.\r\n\r\nI brainstormed how to apply this to hardware wallets: https://github.com/bitcoin/bitcoin/pull/14912#issuecomment-510520757. The unsollicited keypool topup in `GetReservedDestination` is annoying in that context. Can `ScriptPubKeyMan` have a flag to opt out of that? ",
      "created_at" : "2019-07-11T14:56:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-510521262",
      "id" : 510521262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDUyMTI2Mg==",
      "updated_at" : "2019-07-11T15:12:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510521262",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> To make some of the commits easier to review, instead of having one commit that adds a function to `LegacyScriptPubKeyMan` (e.g. `LegacyScriptPubKeyMan::LoadKey`), one commit that deletes it from CWallet (`Remove unused functions and switch CWallet to use ScriptPubKeyMan`) and one commit that moves the call over (`Implement actually loading everything into LegacyScriptPubKeyMan`), try to combine those. That lets you get rid of the CI Skip commits, and makes it easier to verify move-only parts with `--color-moved=dimmed-zebra`.\r\n> \r\n> In other words, start with empty `(Legacy)ScriptPubKeyMan` and then migrate one function per commit into it.\r\n\r\nDoing that will cause the entirety of the PR to fail all tests (so all need ci skip) except for the very last commit. If other reviewers want that, I could reorganize it.\r\n\r\n> Are you sure you want to move `WalletFeature` and `WalletFlags` into `LegacyScriptPubKeyMan`? I would prefer to keep these settings global to the wallet.\r\n\r\nThey are global to the wallet. They are moved to `walletutil.h`. Both `LegacyScriptPubKeyMan` and `CWallet` require access to both of these enums, but having `scriptpubkeyman` including `wallet.h` would be a circular dependency, so I moved it to `walletutil.h`.\r\n\r\n> It does make sense for each `ScriptPubKeyMan` to have its own `IsLocked()` state, so that brings up the question what to do if a single one fails to unlock.\r\n\r\nI guess it should fail to unlock everything? That would indicate some corruption has occurred.\r\n\r\n> But I'd rather not add RPC methods to unlock specific `PubKeyMan`s in a given wallet.\r\n\r\nAgreed.\r\n\r\n> The unsollicited keypool topup in `GetReservedDestination` is annoying in that context. Can `ScriptPubKeyMan` have a flag to opt out of that?\\\r\n\r\nI suppose it should actually be in `LegacyScriptPubKeyMan::GetReservedDestination` rather than `CWallet`'s. However, `TopUp` can just do nothing and that won't effect this behavior. Every `ScriptPubKeyMan` needs to implement `TopUp` anyways.\r\n\r\n",
      "created_at" : "2019-07-11T17:57:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-510589619",
      "id" : 510589619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDU4OTYxOQ==",
      "updated_at" : "2019-07-11T17:57:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510589619",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">> In other words, start with empty `(Legacy)ScriptPubKeyMan` and then migrate one function per commit into it.\r\n\r\n> Doing that will cause the entirety of the PR to fail all tests (so all need ci skip) except for the very last commit. If other reviewers want that, I could reorganize it.\r\n\r\nWhy would any of the test fail if `ScriptPubKeyMan` is just an empty shell, and/or a bunch of NOOP functions?\r\n\r\n>> The unsollicited keypool topup in GetReservedDestination is annoying in that context. Can ScriptPubKeyMan have a flag to opt out of that?\r\n\r\n> I suppose it should actually be in `LegacyScriptPubKeyMan::GetReservedDestination` rather than `CWallet`'s. However, `TopUp` can just do nothing and that won't effect this behavior. Every `ScriptPubKeyMan` needs to implement `TopUp` anyways.\r\n\r\nIn the context of a hardware wallet I want `TopUp` to fetch keys from the device. But it should only try that if the user explicitly calls `topupkeypool` (and the UI equivalent). Problem is that `TopUp` doesn't know where it's called from.",
      "created_at" : "2019-07-12T14:18:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-510903836",
      "id" : 510903836,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDkwMzgzNg==",
      "updated_at" : "2019-07-12T14:18:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510903836",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The PRs this depended on have been merged. I don't foresee making large changes to this anymore, so this is no longer WIP.\r\n\r\nPlease review!",
      "created_at" : "2019-07-26T19:51:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-515578355",
      "id" : 515578355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTU3ODM1NQ==",
      "updated_at" : "2019-07-26T19:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515578355",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-07-30T05:11:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-516264429",
      "id" : 516264429,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNjI2NDQyOQ==",
      "updated_at" : "2019-07-30T05:11:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/516264429",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-07-31T08:03:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-516743076",
      "id" : 516743076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNjc0MzA3Ng==",
      "updated_at" : "2019-07-31T08:03:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/516743076",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-01T04:41:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-517116473",
      "id" : 517116473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzExNjQ3Mw==",
      "updated_at" : "2019-08-01T04:41:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517116473",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-02T13:20:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-517698146",
      "id" : 517698146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzY5ODE0Ng==",
      "updated_at" : "2019-08-02T13:20:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517698146",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310624791"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310624791"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The nice thing about the way it was done before is that if this expr returns false it would get short circuited and `CreateSig` wouldn't be called too.\r\n\r\nNow it's the opposite. which I think makes less sense when we know that CreateSig is more work than that simple expr, so it might do CreateSig just to fail that if afterwards.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T14:12:17Z",
      "diff_hunk" : "@@ -144,8 +144,10 @@ static bool SignStep(const SigningProvider& provider, const BaseSignatureCreator\n         ret.push_back(valtype()); // workaround CHECKMULTISIG bug\n         for (size_t i = 1; i < vSolutions.size() - 1; ++i) {\n             CPubKey pubkey = CPubKey(vSolutions[i]);\n-            if (ret.size() < required + 1 && CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n-                ret.push_back(std::move(sig));\n+            if (CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n+                if (ret.size() < required + 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310624791",
      "id" : 310624791,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDYyNDc5MQ==",
      "original_commit_id" : "ca02ac2532ce106d372d420dd2b94ad15e730971",
      "original_position" : 7,
      "path" : "src/script/sign.cpp",
      "position" : 10,
      "pull_request_review_id" : 270793127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310624791",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310639109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310639109"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "shouldn't this be `return sh;`?",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T14:40:35Z",
      "diff_hunk" : "@@ -78,22 +78,30 @@ CTxDestination AddAndGetDestinationForScript(FillableSigningProvider& keystore,\n {\n     // Add script to keystore\n     keystore.AddCScript(script);\n+    ScriptHash sh = ScriptHash(script);\n     // Note that scripts over 520 bytes are not yet supported.\n     switch (type) {\n-    case OutputType::LEGACY:\n-        return ScriptHash(script);\n+    case OutputType::LEGACY: {\n+        keystore.AddCScript(GetScriptForDestination(sh));\n+        return sh;\n+    }\n     case OutputType::P2SH_SEGWIT:\n     case OutputType::BECH32: {\n         CTxDestination witdest = WitnessV0ScriptHash(script);\n         CScript witprog = GetScriptForDestination(witdest);\n         // Check if the resulting program is solvable (i.e. doesn't use an uncompressed key)\n-        if (!IsSolvable(keystore, witprog)) return ScriptHash(script);\n+        if (!IsSolvable(keystore, witprog)) {\n+            keystore.AddCScript(GetScriptForDestination(sh));\n+            return ScriptHash(script);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310639109",
      "id" : 310639109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDYzOTEwOQ==",
      "original_commit_id" : "ca02ac2532ce106d372d420dd2b94ad15e730971",
      "original_position" : 21,
      "path" : "src/outputtype.cpp",
      "position" : null,
      "pull_request_review_id" : 270811579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310639109",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310643788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310643788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is necessary for `LegacyScriptPubKeyMan::CanProvide` to pass. That uses the `DUMMY_SIGNATURE_CREATOR` which creates dummy signatures without checking whether the `SigningProvider` has the private keys (as it should). However, in `CanProvide`, we want to make sure that we do actually have the private keys, and if the dummy signing returns us dummy signatures that correspond to keys that we don't have, `CanProvide` will fail. So we need it to give us all of the signatures (by putting them in the `sigdata`) so that `CanProvide` can check for whether it actually could sign.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T14:49:58Z",
      "diff_hunk" : "@@ -144,8 +144,10 @@ static bool SignStep(const SigningProvider& provider, const BaseSignatureCreator\n         ret.push_back(valtype()); // workaround CHECKMULTISIG bug\n         for (size_t i = 1; i < vSolutions.size() - 1; ++i) {\n             CPubKey pubkey = CPubKey(vSolutions[i]);\n-            if (ret.size() < required + 1 && CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n-                ret.push_back(std::move(sig));\n+            if (CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n+                if (ret.size() < required + 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310643788",
      "id" : 310643788,
      "in_reply_to_id" : 310624791,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDY0Mzc4OA==",
      "original_commit_id" : "ca02ac2532ce106d372d420dd2b94ad15e730971",
      "original_position" : 7,
      "path" : "src/script/sign.cpp",
      "position" : 10,
      "pull_request_review_id" : 270817769,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310643788",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310651218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310651218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, done.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T15:05:06Z",
      "diff_hunk" : "@@ -78,22 +78,30 @@ CTxDestination AddAndGetDestinationForScript(FillableSigningProvider& keystore,\n {\n     // Add script to keystore\n     keystore.AddCScript(script);\n+    ScriptHash sh = ScriptHash(script);\n     // Note that scripts over 520 bytes are not yet supported.\n     switch (type) {\n-    case OutputType::LEGACY:\n-        return ScriptHash(script);\n+    case OutputType::LEGACY: {\n+        keystore.AddCScript(GetScriptForDestination(sh));\n+        return sh;\n+    }\n     case OutputType::P2SH_SEGWIT:\n     case OutputType::BECH32: {\n         CTxDestination witdest = WitnessV0ScriptHash(script);\n         CScript witprog = GetScriptForDestination(witdest);\n         // Check if the resulting program is solvable (i.e. doesn't use an uncompressed key)\n-        if (!IsSolvable(keystore, witprog)) return ScriptHash(script);\n+        if (!IsSolvable(keystore, witprog)) {\n+            keystore.AddCScript(GetScriptForDestination(sh));\n+            return ScriptHash(script);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310651218",
      "id" : 310651218,
      "in_reply_to_id" : 310639109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDY1MTIxOA==",
      "original_commit_id" : "ca02ac2532ce106d372d420dd2b94ad15e730971",
      "original_position" : 21,
      "path" : "src/outputtype.cpp",
      "position" : null,
      "pull_request_review_id" : 270827605,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310651218",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310653358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310653358"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "is checking that `spk_man` isn't null needed here assuming you already call `spk_man->cs_KeyStore` which is a deference?",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T15:09:34Z",
      "diff_hunk" : "@@ -90,11 +92,12 @@ static std::shared_ptr<CWallet> LoadWallet(const std::string& name, const fs::pa\n \n static void WalletShowInfo(CWallet* wallet_instance)\n {\n-    LOCK(wallet_instance->cs_wallet);\n+    auto spk_man = wallet_instance->GetLegacyScriptPubKeyMan();\n+    LOCK2(wallet_instance->cs_wallet, spk_man->cs_KeyStore);\n \n     tfm::format(std::cout, \"Wallet info\\n===========\\n\");\n     tfm::format(std::cout, \"Encrypted: %s\\n\", wallet_instance->IsCrypted() ? \"yes\" : \"no\");\n-    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", wallet_instance->GetHDChain().seed_id.IsNull() ? \"no\" : \"yes\");\n+    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", (spk_man && spk_man->GetHDChain().seed_id.IsNull()) ? \"no\" : \"yes\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310653358",
      "id" : 310653358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDY1MzM1OA==",
      "original_commit_id" : "12a411b8a7f77753ec35241d73697f6bbcc77ec1",
      "original_position" : 31,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 270830418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310653358",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310656799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310656799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit. snake case for the function arguments?",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T15:16:25Z",
      "diff_hunk" : "@@ -147,9 +147,8 @@ static void TxInErrorToJSON(const CTxIn& txin, UniValue& vErrorsRet, const std::\n     vErrorsRet.push_back(entry);\n }\n \n-UniValue SignTransaction(CMutableTransaction& mtx, const UniValue& prevTxsUnival, FillableSigningProvider* keystore, std::map<COutPoint, Coin>& coins, bool is_temp_keystore, const UniValue& hashType)\n+void ParsePrevouts(const UniValue& prevTxsUnival, FillableSigningProvider* keystore, std::map<COutPoint, Coin>& coins)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310656799",
      "id" : 310656799,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDY1Njc5OQ==",
      "original_commit_id" : "12a411b8a7f77753ec35241d73697f6bbcc77ec1",
      "original_position" : 5,
      "path" : "src/rpc/rawtransaction_util.cpp",
      "position" : 5,
      "pull_request_review_id" : 270834809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310656799",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310658586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310658586"
         }
      },
      "author_association" : "MEMBER",
      "body" : "&& short-circuits; it doesn't evaluate its right hand is the left hand was false.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T15:20:12Z",
      "diff_hunk" : "@@ -90,11 +92,12 @@ static std::shared_ptr<CWallet> LoadWallet(const std::string& name, const fs::pa\n \n static void WalletShowInfo(CWallet* wallet_instance)\n {\n-    LOCK(wallet_instance->cs_wallet);\n+    auto spk_man = wallet_instance->GetLegacyScriptPubKeyMan();\n+    LOCK2(wallet_instance->cs_wallet, spk_man->cs_KeyStore);\n \n     tfm::format(std::cout, \"Wallet info\\n===========\\n\");\n     tfm::format(std::cout, \"Encrypted: %s\\n\", wallet_instance->IsCrypted() ? \"yes\" : \"no\");\n-    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", wallet_instance->GetHDChain().seed_id.IsNull() ? \"no\" : \"yes\");\n+    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", (spk_man && spk_man->GetHDChain().seed_id.IsNull()) ? \"no\" : \"yes\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310658586",
      "id" : 310658586,
      "in_reply_to_id" : 310653358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDY1ODU4Ng==",
      "original_commit_id" : "12a411b8a7f77753ec35241d73697f6bbcc77ec1",
      "original_position" : 31,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 270837156,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310658586",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310660927"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310660927"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes. My point was that he deferences it a few lines above when he acquires a lock. ",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T15:24:55Z",
      "diff_hunk" : "@@ -90,11 +92,12 @@ static std::shared_ptr<CWallet> LoadWallet(const std::string& name, const fs::pa\n \n static void WalletShowInfo(CWallet* wallet_instance)\n {\n-    LOCK(wallet_instance->cs_wallet);\n+    auto spk_man = wallet_instance->GetLegacyScriptPubKeyMan();\n+    LOCK2(wallet_instance->cs_wallet, spk_man->cs_KeyStore);\n \n     tfm::format(std::cout, \"Wallet info\\n===========\\n\");\n     tfm::format(std::cout, \"Encrypted: %s\\n\", wallet_instance->IsCrypted() ? \"yes\" : \"no\");\n-    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", wallet_instance->GetHDChain().seed_id.IsNull() ? \"no\" : \"yes\");\n+    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", (spk_man && spk_man->GetHDChain().seed_id.IsNull()) ? \"no\" : \"yes\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310660927",
      "id" : 310660927,
      "in_reply_to_id" : 310653358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDY2MDkyNw==",
      "original_commit_id" : "12a411b8a7f77753ec35241d73697f6bbcc77ec1",
      "original_position" : 31,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 270840064,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310660927",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2167860?v=4",
         "events_url" : "https://api.github.com/users/elichai/events{/privacy}",
         "followers_url" : "https://api.github.com/users/elichai/followers",
         "following_url" : "https://api.github.com/users/elichai/following{/other_user}",
         "gists_url" : "https://api.github.com/users/elichai/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/elichai",
         "id" : 2167860,
         "login" : "elichai",
         "node_id" : "MDQ6VXNlcjIxNjc4NjA=",
         "organizations_url" : "https://api.github.com/users/elichai/orgs",
         "received_events_url" : "https://api.github.com/users/elichai/received_events",
         "repos_url" : "https://api.github.com/users/elichai/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/elichai/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/elichai/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/elichai"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310663427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310663427"
         }
      },
      "author_association" : "MEMBER",
      "body" : "wallettool looks to be broken when there are other `ScriptPubKeyMan` classes. I'll investigate in the Descriptor wallets PR.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T15:30:06Z",
      "diff_hunk" : "@@ -90,11 +92,12 @@ static std::shared_ptr<CWallet> LoadWallet(const std::string& name, const fs::pa\n \n static void WalletShowInfo(CWallet* wallet_instance)\n {\n-    LOCK(wallet_instance->cs_wallet);\n+    auto spk_man = wallet_instance->GetLegacyScriptPubKeyMan();\n+    LOCK2(wallet_instance->cs_wallet, spk_man->cs_KeyStore);\n \n     tfm::format(std::cout, \"Wallet info\\n===========\\n\");\n     tfm::format(std::cout, \"Encrypted: %s\\n\", wallet_instance->IsCrypted() ? \"yes\" : \"no\");\n-    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", wallet_instance->GetHDChain().seed_id.IsNull() ? \"no\" : \"yes\");\n+    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", (spk_man && spk_man->GetHDChain().seed_id.IsNull()) ? \"no\" : \"yes\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310663427",
      "id" : 310663427,
      "in_reply_to_id" : 310653358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDY2MzQyNw==",
      "original_commit_id" : "12a411b8a7f77753ec35241d73697f6bbcc77ec1",
      "original_position" : 31,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 270843247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310663427",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310674086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310674086"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This change to using `spk_man` here is not actually needed. I've changed it to use `CWallet::IsHDEnabled`",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-05T15:53:31Z",
      "diff_hunk" : "@@ -90,11 +92,12 @@ static std::shared_ptr<CWallet> LoadWallet(const std::string& name, const fs::pa\n \n static void WalletShowInfo(CWallet* wallet_instance)\n {\n-    LOCK(wallet_instance->cs_wallet);\n+    auto spk_man = wallet_instance->GetLegacyScriptPubKeyMan();\n+    LOCK2(wallet_instance->cs_wallet, spk_man->cs_KeyStore);\n \n     tfm::format(std::cout, \"Wallet info\\n===========\\n\");\n     tfm::format(std::cout, \"Encrypted: %s\\n\", wallet_instance->IsCrypted() ? \"yes\" : \"no\");\n-    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", wallet_instance->GetHDChain().seed_id.IsNull() ? \"no\" : \"yes\");\n+    tfm::format(std::cout, \"HD (hd seed available): %s\\n\", (spk_man && spk_man->GetHDChain().seed_id.IsNull()) ? \"no\" : \"yes\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r310674086",
      "id" : 310674086,
      "in_reply_to_id" : 310653358,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxMDY3NDA4Ng==",
      "original_commit_id" : "12a411b8a7f77753ec35241d73697f6bbcc77ec1",
      "original_position" : 31,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 270856879,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/310674086",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Found a bug (try in QT):\r\n1. create a wallet `blank` wallet with private keys disabled\r\n2. see that new address button in receive screen is disabled, as it should\r\n3. close QT and start again, load the wallet\r\n4. see that new address button is enabled *and creates addresses* (panic)\r\n\r\nMaybe `Always try to sign for all pubkeys in multisig` can be its own PR?\r\n\r\nI didn't pay precise attention to which methods are private / public / etc, because that's easy to change later as required.\r\n\r\nShameless plug for #12134 so we can test for accidental breakage of serialization. The existing test passes on top of this PR, but it only checks that a default \"master\" wallet can still be opened in earlier versions).",
      "created_at" : "2019-08-13T13:03:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-520825537",
      "id" : 520825537,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMDgyNTUzNw==",
      "updated_at" : "2019-08-13T13:03:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/520825537",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r316826832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/316826832"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Always try to sign for all pubkeys in multisig\" (d0b41dc26a74e158bd22259aed50869c9676e3fd)\r\n\r\nI'm not deeply familiar with this code, and I found the explanation a little hard to follow, but in case it helps anyone else, the key seems to be that calling CreateSig unconditionally is needed to fill sigdata. I can confirm that `rpc_psbt.py` test fails without this change.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-22T18:33:32Z",
      "diff_hunk" : "@@ -144,8 +144,10 @@ static bool SignStep(const SigningProvider& provider, const BaseSignatureCreator\n         ret.push_back(valtype()); // workaround CHECKMULTISIG bug\n         for (size_t i = 1; i < vSolutions.size() - 1; ++i) {\n             CPubKey pubkey = CPubKey(vSolutions[i]);\n-            if (ret.size() < required + 1 && CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n-                ret.push_back(std::move(sig));\n+            if (CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n+                if (ret.size() < required + 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r316826832",
      "id" : 316826832,
      "in_reply_to_id" : 310624791,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjgyNjgzMg==",
      "original_commit_id" : "ca02ac2532ce106d372d420dd2b94ad15e730971",
      "original_position" : 7,
      "path" : "src/script/sign.cpp",
      "position" : 10,
      "pull_request_review_id" : 278610269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/316826832",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r316833572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/316833572"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Add function callbacks for wallet flags and versions and wallet database\" (bae5b518ec507d071a54ce4810dd24b016bcfe12)\r\n\r\nThis could just say `using ScriptPubKeyMan::ScriptPubKeyMan` to inherit the parent constructor instead of repeating it all. Even at the end of this PR, this constructor is empty except for some member initializations which would be better to do at the points of declaration.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-22T18:49:53Z",
      "diff_hunk" : "@@ -85,7 +116,9 @@ class ScriptPubKeyMan\n class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProvider\n {\n public:\n-    LegacyScriptPubKeyMan() {}\n+    LegacyScriptPubKeyMan(FlagSetFunc is_set_func, FlagFunc set_flag_func, FlagFuncWithDB unset_flag_func, VersionFunc feature_sup_func, NameFunc wallet_name_func, SetVersionFunc set_version_func, std::shared_ptr<WalletDatabase> database)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r316833572",
      "id" : 316833572,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNjgzMzU3Mg==",
      "original_commit_id" : "bae5b518ec507d071a54ce4810dd24b016bcfe12",
      "original_position" : 51,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 278610269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/316833572",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318143710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318143710"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I also found this explanation difficult. Is there any way to succinctly say the desired effect, and put it in a comment in the code?",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T15:21:32Z",
      "diff_hunk" : "@@ -144,8 +144,10 @@ static bool SignStep(const SigningProvider& provider, const BaseSignatureCreator\n         ret.push_back(valtype()); // workaround CHECKMULTISIG bug\n         for (size_t i = 1; i < vSolutions.size() - 1; ++i) {\n             CPubKey pubkey = CPubKey(vSolutions[i]);\n-            if (ret.size() < required + 1 && CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n-                ret.push_back(std::move(sig));\n+            if (CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n+                if (ret.size() < required + 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318143710",
      "id" : 318143710,
      "in_reply_to_id" : 310624791,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE0MzcxMA==",
      "original_commit_id" : "ca02ac2532ce106d372d420dd2b94ad15e730971",
      "original_position" : 7,
      "path" : "src/script/sign.cpp",
      "position" : 10,
      "pull_request_review_id" : 280277366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318143710",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318147258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318147258"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please add a short comment on what this is in charge of and what it's not.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T15:27:30Z",
      "diff_hunk" : "@@ -0,0 +1,137 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_WALLET_SCRIPTPUBKEYMAN_H\n+#define BITCOIN_WALLET_SCRIPTPUBKEYMAN_H\n+\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <wallet/crypter.h>\n+#include <wallet/ismine.h>\n+#include <wallet/walletdb.h>\n+\n+#include <boost/signals2/signal.hpp>\n+\n+enum class OutputType;\n+\n+class ScriptPubKeyMan",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318147258",
      "id" : 318147258,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE0NzI1OA==",
      "original_commit_id" : "e892a72f22c3359a12085f0e93d519acaa711bcd",
      "original_position" : 18,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : 134,
      "pull_request_review_id" : 280277366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318147258",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318149544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318149544"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/output_types/OUTPUT_TYPES/",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T15:31:34Z",
      "diff_hunk" : "@@ -27,6 +28,8 @@ enum class OutputType {\n     CHANGE_AUTO,\n };\n \n+const std::array<OutputType, 3> output_types = {OutputType::LEGACY, OutputType::P2SH_SEGWIT, OutputType::BECH32};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318149544",
      "id" : 318149544,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE0OTU0NA==",
      "original_commit_id" : "8a8e141fe93bf887630df9681daa9cd8b2500f55",
      "original_position" : 12,
      "path" : "src/outputtype.h",
      "position" : null,
      "pull_request_review_id" : 280277366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318149544",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318153110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318153110"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment on how these are indexed?",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T15:38:14Z",
      "diff_hunk" : "@@ -833,6 +834,11 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     //! Fetches a key from the keypool\n     bool GetKeyFromPool(CPubKey &key, bool internal = false);\n \n+    std::map<OutputType, std::shared_ptr<ScriptPubKeyMan>> m_external_spk_managers;\n+    std::map<OutputType, std::shared_ptr<ScriptPubKeyMan>> m_internal_spk_managers;\n+\n+    std::map<uint256, std::shared_ptr<ScriptPubKeyMan>> m_spk_managers;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318153110",
      "id" : 318153110,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE1MzExMA==",
      "original_commit_id" : "7a27857f91ad585f82bb784faf092e8fe7e30946",
      "original_position" : 15,
      "path" : "src/wallet/wallet.h",
      "position" : 293,
      "pull_request_review_id" : 280277366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318153110",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318155569"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318155569"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> m_internal_spk_managers[OutputType::LEGACY]\r\n\r\nPlease leave a comment noting that any output type is the same in this context.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T15:42:52Z",
      "diff_hunk" : "@@ -4935,3 +4935,32 @@ bool CWallet::AddCryptedKeyInner(const CPubKey &vchPubKey, const std::vector<uns\n     ImplicitlyLearnRelatedKeyScripts(vchPubKey);\n     return true;\n }\n+\n+std::shared_ptr<LegacyScriptPubKeyMan> CWallet::GetLegacyScriptPubKeyMan()\n+{\n+    SetupLegacyScriptPubKeyMan();\n+    return std::dynamic_pointer_cast<LegacyScriptPubKeyMan>(m_internal_spk_managers[OutputType::LEGACY]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318155569",
      "id" : 318155569,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE1NTU2OQ==",
      "original_commit_id" : "7a27857f91ad585f82bb784faf092e8fe7e30946",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : 1737,
      "pull_request_review_id" : 280277366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318155569",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318158886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318158886"
         }
      },
      "author_association" : "MEMBER",
      "body" : "we have the list of output types, let's just iterate through them here to build this",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T15:49:15Z",
      "diff_hunk" : "@@ -4935,3 +4935,32 @@ bool CWallet::AddCryptedKeyInner(const CPubKey &vchPubKey, const std::vector<uns\n     ImplicitlyLearnRelatedKeyScripts(vchPubKey);\n     return true;\n }\n+\n+std::shared_ptr<LegacyScriptPubKeyMan> CWallet::GetLegacyScriptPubKeyMan()\n+{\n+    SetupLegacyScriptPubKeyMan();\n+    return std::dynamic_pointer_cast<LegacyScriptPubKeyMan>(m_internal_spk_managers[OutputType::LEGACY]);\n+}\n+\n+void CWallet::SetupLegacyScriptPubKeyMan()\n+{\n+    if (m_internal_spk_managers.empty() && m_external_spk_managers.empty() && m_spk_managers.empty()) {\n+        auto spk_manager = std::shared_ptr<ScriptPubKeyMan>(new LegacyScriptPubKeyMan());\n+        m_internal_spk_managers[OutputType::LEGACY] = spk_manager;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318158886",
      "id" : 318158886,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE1ODg4Ng==",
      "original_commit_id" : "7a27857f91ad585f82bb784faf092e8fe7e30946",
      "original_position" : 15,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 280277366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318158886",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318159265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318159265"
         }
      },
      "author_association" : "MEMBER",
      "body" : "we have the list of output types, let's just iterate through them here to assert these",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T15:49:58Z",
      "diff_hunk" : "@@ -4935,3 +4935,32 @@ bool CWallet::AddCryptedKeyInner(const CPubKey &vchPubKey, const std::vector<uns\n     ImplicitlyLearnRelatedKeyScripts(vchPubKey);\n     return true;\n }\n+\n+std::shared_ptr<LegacyScriptPubKeyMan> CWallet::GetLegacyScriptPubKeyMan()\n+{\n+    SetupLegacyScriptPubKeyMan();\n+    return std::dynamic_pointer_cast<LegacyScriptPubKeyMan>(m_internal_spk_managers[OutputType::LEGACY]);\n+}\n+\n+void CWallet::SetupLegacyScriptPubKeyMan()\n+{\n+    if (m_internal_spk_managers.empty() && m_external_spk_managers.empty() && m_spk_managers.empty()) {\n+        auto spk_manager = std::shared_ptr<ScriptPubKeyMan>(new LegacyScriptPubKeyMan());\n+        m_internal_spk_managers[OutputType::LEGACY] = spk_manager;\n+        m_internal_spk_managers[OutputType::P2SH_SEGWIT] = spk_manager;\n+        m_internal_spk_managers[OutputType::BECH32] = spk_manager;\n+        m_external_spk_managers[OutputType::LEGACY] = spk_manager;\n+        m_external_spk_managers[OutputType::P2SH_SEGWIT] = spk_manager;\n+        m_external_spk_managers[OutputType::BECH32] = spk_manager;\n+        m_spk_managers[spk_manager->GetID()] = spk_manager;\n+    }\n+    // These all need to exist and be the same\n+    assert(m_internal_spk_managers.count(OutputType::LEGACY) > 0);\n+    std::shared_ptr<ScriptPubKeyMan> spk_man = m_internal_spk_managers.at(OutputType::LEGACY);\n+    assert(m_internal_spk_managers.at(OutputType::P2SH_SEGWIT) == spk_man);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318159265",
      "id" : 318159265,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE1OTI2NQ==",
      "original_commit_id" : "7a27857f91ad585f82bb784faf092e8fe7e30946",
      "original_position" : 26,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 280277366,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318159265",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318190081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318190081"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Refactor rawtransaction_util's SignTransaction to have previous tx parsing be separate\" (b49bbb939be92a67ff77c3f7bca5bb94dd141906)\r\n\r\n> nit. snake case for the function arguments?\r\n\r\nBetter in a separate PR, this PR is huge already and the change would make this commit a lot harder to follow.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T16:55:37Z",
      "diff_hunk" : "@@ -147,9 +147,8 @@ static void TxInErrorToJSON(const CTxIn& txin, UniValue& vErrorsRet, const std::\n     vErrorsRet.push_back(entry);\n }\n \n-UniValue SignTransaction(CMutableTransaction& mtx, const UniValue& prevTxsUnival, FillableSigningProvider* keystore, std::map<COutPoint, Coin>& coins, bool is_temp_keystore, const UniValue& hashType)\n+void ParsePrevouts(const UniValue& prevTxsUnival, FillableSigningProvider* keystore, std::map<COutPoint, Coin>& coins)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318190081",
      "id" : 318190081,
      "in_reply_to_id" : 310656799,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE5MDA4MQ==",
      "original_commit_id" : "12a411b8a7f77753ec35241d73697f6bbcc77ec1",
      "original_position" : 5,
      "path" : "src/rpc/rawtransaction_util.cpp",
      "position" : 5,
      "pull_request_review_id" : 280336299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318190081",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318192477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318192477"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Implement GetSigningProvider in LegacyScriptPubKeyMan\" (a31374df794d709cf8acfbafc7d5b57f74b1d75a)\r\n\r\nNot important, but this should never be null so a reference makes more sense than a pointer in this class",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T17:01:11Z",
      "diff_hunk" : "@@ -167,4 +167,20 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     uint256 GetID() const override;\n };\n \n+/** Wraps a LegacyScriptPubKeyMan so that it can be returned in a new unique_ptr */\n+class LegacySigningProvider : public SigningProvider\n+{\n+private:\n+    const LegacyScriptPubKeyMan* spk_man;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318192477",
      "id" : 318192477,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE5MjQ3Nw==",
      "original_commit_id" : "a31374df794d709cf8acfbafc7d5b57f74b1d75a",
      "original_position" : 8,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 280336299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318192477",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318193983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318193983"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Implement function to connect ScriptPubKeyMan's NotifyCanGetAddessesChanged and NotifyWatchOnlyChanged to CWallet's\" (7b57deac879499e4b0ee99f1efc320600907bc59)\r\n\r\n`const auto&` instead of `auto` would avoid copying and incrementing / decrementing shared_ptr atomic reference counts, would also make it clear that the std::pair is not changing",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-27T17:04:49Z",
      "diff_hunk" : "@@ -5032,3 +5033,11 @@ void CWallet::SetupLegacyScriptPubKeyMan()\n     assert(m_external_spk_managers.at(OutputType::BECH32) == spk_man);\n     assert(m_spk_managers.size() == 1);\n }\n+\n+void CWallet::ConnectScriptPubKeyManNotifiers()\n+{\n+    for (auto spk_man_pair : m_spk_managers) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r318193983",
      "id" : 318193983,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxODE5Mzk4Mw==",
      "original_commit_id" : "7b57deac879499e4b0ee99f1efc320600907bc59",
      "original_position" : 15,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 280336299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/318193983",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-30T01:40:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-526421707",
      "id" : 526421707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjQyMTcwNw==",
      "updated_at" : "2019-08-30T01:40:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526421707",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319628054"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319628054"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Implement GetKeyOrigin in LegacyScriptPubKeyMan\" (b893f0d053f1b5be1229d4fb77ced46b222f9993)\r\n\r\nIt's unclear why this change is in this commit. Is it supposed to be part of the next one\r\n93322bf756fd8991fb445e327c878e2695fe9ca9?",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T18:24:52Z",
      "diff_hunk" : "@@ -123,6 +123,7 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n {\n \n     LOCK(testWallet.cs_wallet);\n+    testWallet.SetupLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319628054",
      "id" : 319628054,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTYyODA1NA==",
      "original_commit_id" : "b893f0d053f1b5be1229d4fb77ced46b222f9993",
      "original_position" : 4,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 282184583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319628054",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Suggestion just to see what others think: Split up this PR into a couple PRs, first of which is the non-test-breaking changes, the 2nd all the breaking changes+test fixes at the end?",
      "created_at" : "2019-08-30T18:43:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-526707694",
      "id" : 526707694,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjcwNzY5NA==",
      "updated_at" : "2019-08-30T18:43:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526707694",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Suggestion just to see what others think: Split up this PR into a couple PRs, first of which is the non-test-breaking changes, the 2nd all the breaking changes+test fixes at the end?\r\n\r\nI definitely would not want this because it would temporarily add a huge amount of duplicate code to the wallet. If this needs to be broken up to be reviewed (and I don't think it does), I'd either go with sjors approach moving things gradually, or just have one giant move-only commit followed by the actual code changes.",
      "created_at" : "2019-08-30T18:48:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-526709057",
      "id" : 526709057,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjcwOTA1Nw==",
      "updated_at" : "2019-08-30T18:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526709057",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Or, in case I misunderstood, if you are just talking about splitting the first 9 commits into their own PR (the commits before the \"Implement...\" commits and the \"ci skip\" commits), that seems perfectly fine and would help a little.",
      "created_at" : "2019-08-30T18:52:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-526710335",
      "id" : 526710335,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjcxMDMzNQ==",
      "updated_at" : "2019-08-30T18:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526710335",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319653872"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319653872"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I added a comment.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:49:13Z",
      "diff_hunk" : "@@ -144,8 +144,10 @@ static bool SignStep(const SigningProvider& provider, const BaseSignatureCreator\n         ret.push_back(valtype()); // workaround CHECKMULTISIG bug\n         for (size_t i = 1; i < vSolutions.size() - 1; ++i) {\n             CPubKey pubkey = CPubKey(vSolutions[i]);\n-            if (ret.size() < required + 1 && CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n-                ret.push_back(std::move(sig));\n+            if (CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n+                if (ret.size() < required + 1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319653872",
      "id" : 319653872,
      "in_reply_to_id" : 310624791,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1Mzg3Mg==",
      "original_commit_id" : "ca02ac2532ce106d372d420dd2b94ad15e730971",
      "original_position" : 7,
      "path" : "src/script/sign.cpp",
      "position" : 10,
      "pull_request_review_id" : 282218618,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319653872",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319653909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319653909"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:49:21Z",
      "diff_hunk" : "@@ -85,7 +116,9 @@ class ScriptPubKeyMan\n class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProvider\n {\n public:\n-    LegacyScriptPubKeyMan() {}\n+    LegacyScriptPubKeyMan(FlagSetFunc is_set_func, FlagFunc set_flag_func, FlagFuncWithDB unset_flag_func, VersionFunc feature_sup_func, NameFunc wallet_name_func, SetVersionFunc set_version_func, std::shared_ptr<WalletDatabase> database)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319653909",
      "id" : 319653909,
      "in_reply_to_id" : 316833572,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1MzkwOQ==",
      "original_commit_id" : "bae5b518ec507d071a54ce4810dd24b016bcfe12",
      "original_position" : 51,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 282218681,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319653909",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319653940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319653940"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:49:28Z",
      "diff_hunk" : "@@ -167,4 +167,20 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     uint256 GetID() const override;\n };\n \n+/** Wraps a LegacyScriptPubKeyMan so that it can be returned in a new unique_ptr */\n+class LegacySigningProvider : public SigningProvider\n+{\n+private:\n+    const LegacyScriptPubKeyMan* spk_man;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319653940",
      "id" : 319653940,
      "in_reply_to_id" : 318192477,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1Mzk0MA==",
      "original_commit_id" : "a31374df794d709cf8acfbafc7d5b57f74b1d75a",
      "original_position" : 8,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 282218727,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319653940",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319653992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319653992"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed all of these iterations to `const auto&`",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:49:38Z",
      "diff_hunk" : "@@ -5032,3 +5033,11 @@ void CWallet::SetupLegacyScriptPubKeyMan()\n     assert(m_external_spk_managers.at(OutputType::BECH32) == spk_man);\n     assert(m_spk_managers.size() == 1);\n }\n+\n+void CWallet::ConnectScriptPubKeyManNotifiers()\n+{\n+    for (auto spk_man_pair : m_spk_managers) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319653992",
      "id" : 319653992,
      "in_reply_to_id" : 318193983,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1Mzk5Mg==",
      "original_commit_id" : "7b57deac879499e4b0ee99f1efc320600907bc59",
      "original_position" : 15,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 282218794,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319653992",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654014"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:49:43Z",
      "diff_hunk" : "@@ -0,0 +1,137 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_WALLET_SCRIPTPUBKEYMAN_H\n+#define BITCOIN_WALLET_SCRIPTPUBKEYMAN_H\n+\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <wallet/crypter.h>\n+#include <wallet/ismine.h>\n+#include <wallet/walletdb.h>\n+\n+#include <boost/signals2/signal.hpp>\n+\n+enum class OutputType;\n+\n+class ScriptPubKeyMan",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654014",
      "id" : 319654014,
      "in_reply_to_id" : 318147258,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1NDAxNA==",
      "original_commit_id" : "e892a72f22c3359a12085f0e93d519acaa711bcd",
      "original_position" : 18,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : 134,
      "pull_request_review_id" : 282218827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654014",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654040"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654040"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:49:48Z",
      "diff_hunk" : "@@ -27,6 +28,8 @@ enum class OutputType {\n     CHANGE_AUTO,\n };\n \n+const std::array<OutputType, 3> output_types = {OutputType::LEGACY, OutputType::P2SH_SEGWIT, OutputType::BECH32};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654040",
      "id" : 319654040,
      "in_reply_to_id" : 318149544,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1NDA0MA==",
      "original_commit_id" : "8a8e141fe93bf887630df9681daa9cd8b2500f55",
      "original_position" : 12,
      "path" : "src/outputtype.h",
      "position" : null,
      "pull_request_review_id" : 282218863,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654040",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:49:55Z",
      "diff_hunk" : "@@ -4935,3 +4935,32 @@ bool CWallet::AddCryptedKeyInner(const CPubKey &vchPubKey, const std::vector<uns\n     ImplicitlyLearnRelatedKeyScripts(vchPubKey);\n     return true;\n }\n+\n+std::shared_ptr<LegacyScriptPubKeyMan> CWallet::GetLegacyScriptPubKeyMan()\n+{\n+    SetupLegacyScriptPubKeyMan();\n+    return std::dynamic_pointer_cast<LegacyScriptPubKeyMan>(m_internal_spk_managers[OutputType::LEGACY]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654069",
      "id" : 319654069,
      "in_reply_to_id" : 318155569,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1NDA2OQ==",
      "original_commit_id" : "7a27857f91ad585f82bb784faf092e8fe7e30946",
      "original_position" : 8,
      "path" : "src/wallet/wallet.cpp",
      "position" : 1737,
      "pull_request_review_id" : 282218902,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654069",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654084"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:49:58Z",
      "diff_hunk" : "@@ -4935,3 +4935,32 @@ bool CWallet::AddCryptedKeyInner(const CPubKey &vchPubKey, const std::vector<uns\n     ImplicitlyLearnRelatedKeyScripts(vchPubKey);\n     return true;\n }\n+\n+std::shared_ptr<LegacyScriptPubKeyMan> CWallet::GetLegacyScriptPubKeyMan()\n+{\n+    SetupLegacyScriptPubKeyMan();\n+    return std::dynamic_pointer_cast<LegacyScriptPubKeyMan>(m_internal_spk_managers[OutputType::LEGACY]);\n+}\n+\n+void CWallet::SetupLegacyScriptPubKeyMan()\n+{\n+    if (m_internal_spk_managers.empty() && m_external_spk_managers.empty() && m_spk_managers.empty()) {\n+        auto spk_manager = std::shared_ptr<ScriptPubKeyMan>(new LegacyScriptPubKeyMan());\n+        m_internal_spk_managers[OutputType::LEGACY] = spk_manager;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654084",
      "id" : 319654084,
      "in_reply_to_id" : 318158886,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1NDA4NA==",
      "original_commit_id" : "7a27857f91ad585f82bb784faf092e8fe7e30946",
      "original_position" : 15,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 282218928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654084",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654232"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:50:31Z",
      "diff_hunk" : "@@ -4935,3 +4935,32 @@ bool CWallet::AddCryptedKeyInner(const CPubKey &vchPubKey, const std::vector<uns\n     ImplicitlyLearnRelatedKeyScripts(vchPubKey);\n     return true;\n }\n+\n+std::shared_ptr<LegacyScriptPubKeyMan> CWallet::GetLegacyScriptPubKeyMan()\n+{\n+    SetupLegacyScriptPubKeyMan();\n+    return std::dynamic_pointer_cast<LegacyScriptPubKeyMan>(m_internal_spk_managers[OutputType::LEGACY]);\n+}\n+\n+void CWallet::SetupLegacyScriptPubKeyMan()\n+{\n+    if (m_internal_spk_managers.empty() && m_external_spk_managers.empty() && m_spk_managers.empty()) {\n+        auto spk_manager = std::shared_ptr<ScriptPubKeyMan>(new LegacyScriptPubKeyMan());\n+        m_internal_spk_managers[OutputType::LEGACY] = spk_manager;\n+        m_internal_spk_managers[OutputType::P2SH_SEGWIT] = spk_manager;\n+        m_internal_spk_managers[OutputType::BECH32] = spk_manager;\n+        m_external_spk_managers[OutputType::LEGACY] = spk_manager;\n+        m_external_spk_managers[OutputType::P2SH_SEGWIT] = spk_manager;\n+        m_external_spk_managers[OutputType::BECH32] = spk_manager;\n+        m_spk_managers[spk_manager->GetID()] = spk_manager;\n+    }\n+    // These all need to exist and be the same\n+    assert(m_internal_spk_managers.count(OutputType::LEGACY) > 0);\n+    std::shared_ptr<ScriptPubKeyMan> spk_man = m_internal_spk_managers.at(OutputType::LEGACY);\n+    assert(m_internal_spk_managers.at(OutputType::P2SH_SEGWIT) == spk_man);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654232",
      "id" : 319654232,
      "in_reply_to_id" : 318159265,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1NDIzMg==",
      "original_commit_id" : "7a27857f91ad585f82bb784faf092e8fe7e30946",
      "original_position" : 26,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 282219135,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654232",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654309"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah. Moved it",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:50:42Z",
      "diff_hunk" : "@@ -123,6 +123,7 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n {\n \n     LOCK(testWallet.cs_wallet);\n+    testWallet.SetupLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319654309",
      "id" : 319654309,
      "in_reply_to_id" : 319628054,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1NDMwOQ==",
      "original_commit_id" : "b893f0d053f1b5be1229d4fb77ced46b222f9993",
      "original_position" : 4,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 282219206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319654309",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319655153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319655153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-30T19:53:49Z",
      "diff_hunk" : "@@ -833,6 +834,11 @@ class CWallet final : public FillableSigningProvider, private interfaces::Chain:\n     //! Fetches a key from the keypool\n     bool GetKeyFromPool(CPubKey &key, bool internal = false);\n \n+    std::map<OutputType, std::shared_ptr<ScriptPubKeyMan>> m_external_spk_managers;\n+    std::map<OutputType, std::shared_ptr<ScriptPubKeyMan>> m_internal_spk_managers;\n+\n+    std::map<uint256, std::shared_ptr<ScriptPubKeyMan>> m_spk_managers;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319655153",
      "id" : 319655153,
      "in_reply_to_id" : 318153110,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTY1NTE1Mw==",
      "original_commit_id" : "7a27857f91ad585f82bb784faf092e8fe7e30946",
      "original_position" : 15,
      "path" : "src/wallet/wallet.h",
      "position" : 293,
      "pull_request_review_id" : 282220349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-30T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319655153",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and addressed comments.\r\n\r\nWill look at the bug @Sjors reported next.",
      "created_at" : "2019-08-30T20:12:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-526733789",
      "id" : 526733789,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjczMzc4OQ==",
      "updated_at" : "2019-08-30T20:12:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526733789",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The bug @Sjors found should be fixed now.",
      "created_at" : "2019-08-30T20:52:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-526746214",
      "id" : 526746214,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNjc0NjIxNA==",
      "updated_at" : "2019-08-30T20:52:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/526746214",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319716775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319716775"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this commit deserves its own PR anyway; as does any refactor that's a prequisite for the main PR.",
      "commit_id" : "a3a65ecdf98d3540a2f1e8406c4d0244880f22c1",
      "created_at" : "2019-08-31T08:43:57Z",
      "diff_hunk" : "@@ -147,9 +147,8 @@ static void TxInErrorToJSON(const CTxIn& txin, UniValue& vErrorsRet, const std::\n     vErrorsRet.push_back(entry);\n }\n \n-UniValue SignTransaction(CMutableTransaction& mtx, const UniValue& prevTxsUnival, FillableSigningProvider* keystore, std::map<COutPoint, Coin>& coins, bool is_temp_keystore, const UniValue& hashType)\n+void ParsePrevouts(const UniValue& prevTxsUnival, FillableSigningProvider* keystore, std::map<COutPoint, Coin>& coins)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r319716775",
      "id" : 319716775,
      "in_reply_to_id" : 310656799,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTcxNjc3NQ==",
      "original_commit_id" : "12a411b8a7f77753ec35241d73697f6bbcc77ec1",
      "original_position" : 5,
      "path" : "src/rpc/rawtransaction_util.cpp",
      "position" : 5,
      "pull_request_review_id" : 282298536,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-08-31T09:03:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319716775",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I split cce926c into #16798\r\n\r\nI'm unsure about splitting the other two \"unrelated\" commits since they don't actually do anything useful outside of this PR.\r\n\r\nd2d43ab is purely to avoid a circular dependency, and d9ea846 is only to fix a side effect of this PR.\r\n\r\nAlso reordered the first several commits so the \"unrelated\" commits come first.",
      "created_at" : "2019-09-03T19:54:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-527613139",
      "id" : 527613139,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNzYxMzEzOQ==",
      "updated_at" : "2019-09-03T20:11:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/527613139",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
