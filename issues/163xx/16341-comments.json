[
   {
      "author_association" : "MEMBER",
      "body" : "In the coming days I will try to squash together some of these commits so there aren't so many of them. I just wanted to get this open now for people to begin reviewing the changes.",
      "created_at" : "2019-07-05T03:01:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-508614075",
      "id" : 508614075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODYxNDA3NQ==",
      "updated_at" : "2019-07-05T03:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508614075",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16475](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16475.html) (wallet: Enumerate walletdb keys by MarcoFalke)\n* [#16451](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16451.html) (Remove CMerkleTx by jnewbery)\n* [#16440](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16440.html) (BIP-322: Generic signed message format by kallewoof)\n* [#16251](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16251.html) (Improve signrawtransaction error reporting by ajtowns)\n* [#16224](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16224.html) (gui: Bilingual GUI error messages by hebasto)\n* [#16037](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16037.html) (rpc: Early fail import(wallet,multi) when a required block is pruned by promag)\n* [#15931](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15931.html) (Remove GetDepthInMainChain dependency on locked chain interface by ariard)\n* [#15845](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15845.html) (wallet: Fast rescan with BIP157 block filters by MarcoFalke)\n* [#15761](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15761.html) (Replace -upgradewallet startup option with upgradewallet RPC by achow101)\n* [#15713](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15713.html) (refactor: Replace chain relayTransactions/submitMemoryPool by higher method by ariard)\n* [#15294](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15294.html) ([moveonly] wallet: Extract RipeMd160 by Empact)\n* [#14942](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14942.html) (wallet: Make scan / abort status private to CWallet by Empact)\n* [#14707](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14707.html) ([RPC] Include coinbase transactions in receivedby RPCs by andrewtoth)\n* [#14384](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14384.html) (Fire TransactionRemovedFromMempool callbacks from mempool by l2a5b1)\n* [#14144](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14144.html) (Refactoring: Clarify code using encrypted_batch in CWallet by domob1812)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-07-05T04:41:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-508627166",
      "id" : 508627166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODYyNzE2Ng==",
      "updated_at" : "2019-07-29T03:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508627166",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812193"
         }
      },
      "author_association" : "NONE",
      "body" : "I'm very suspect at this line. We are assigning a dereference pointer. \r\nI think we should prefer `is_mine = &m_wallet->IsMine(dest);`",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-05T23:55:04Z",
      "diff_hunk" : "@@ -170,7 +193,7 @@ class WalletImpl : public Wallet\n             *name = it->second.name;\n         }\n         if (is_mine) {\n-            *is_mine = IsMine(*m_wallet, dest);\n+            *is_mine = m_wallet->IsMine(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812193",
      "id" : 300812193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMjE5Mw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 85,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 50,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812193",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812273"
         }
      },
      "author_association" : "NONE",
      "body" : "This name doesn't indicate a boolean return value. ð¤ Why not isPubKey()?",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-05T23:56:39Z",
      "diff_hunk" : "@@ -78,14 +78,14 @@ class Wallet\n     //! Get wallet name.\n     virtual std::string getWalletName() = 0;\n \n-    // Get key from pool.\n-    virtual bool getKeyFromPool(bool internal, CPubKey& pub_key) = 0;\n+    // Get a new address.\n+    virtual bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) = 0;\n \n     //! Get public key.\n-    virtual bool getPubKey(const CKeyID& address, CPubKey& pub_key) = 0;\n+    virtual bool getPubKey(const CScript& script, const CKeyID& address, CPubKey& pub_key) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812273",
      "id" : 300812273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMjI3Mw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 11,
      "path" : "src/interfaces/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812273",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812837"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812837"
         }
      },
      "author_association" : "NONE",
      "body" : "Include `redeemScript.size()` size in the logging so we can debug easier ",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T00:08:28Z",
      "diff_hunk" : "@@ -83,23 +137,23 @@ bool CBasicKeyStore::GetKey(const CKeyID &address, CKey &keyOut) const\n     return false;\n }\n \n-bool CBasicKeyStore::AddCScript(const CScript& redeemScript)\n+bool FillableSigningProvider::AddCScript(const CScript& redeemScript)\n {\n     if (redeemScript.size() > MAX_SCRIPT_ELEMENT_SIZE)\n-        return error(\"CBasicKeyStore::AddCScript(): redeemScripts > %i bytes are invalid\", MAX_SCRIPT_ELEMENT_SIZE);\n+        return error(\"FillableSigningProvider::AddCScript(): redeemScripts > %i bytes are invalid\", MAX_SCRIPT_ELEMENT_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812837",
      "id" : 300812837,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMjgzNw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 144,
      "path" : "src/script/signingprovider.cpp",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812837",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812883"
         }
      },
      "author_association" : "NONE",
      "body" : "Can we use BYTE to be more informative of the type",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T00:09:19Z",
      "diff_hunk" : "@@ -0,0 +1,37 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_SCRIPT_KEYORIGIN_H\n+#define BITCOIN_SCRIPT_KEYORIGIN_H\n+\n+#include <serialize.h>\n+#include <streams.h>\n+#include <vector>\n+\n+struct KeyOriginInfo\n+{\n+    unsigned char fingerprint[4]; //!< First 32 bits of the Hash160 of the public key at the root of the path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300812883",
      "id" : 300812883,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMjg4Mw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 14,
      "path" : "src/script/keyorigin.h",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300812883",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300813241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300813241"
         }
      },
      "author_association" : "NONE",
      "body" : "`provider` should be checked before dereferencing ",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T00:17:04Z",
      "diff_hunk" : "@@ -3083,7 +3097,8 @@ static UniValue listunspent(const JSONRPCRequest& request)\n         entry.pushKV(\"spendable\", out.fSpendable);\n         entry.pushKV(\"solvable\", out.fSolvable);\n         if (out.fSolvable) {\n-            auto descriptor = InferDescriptor(scriptPubKey, *pwallet);\n+            const SigningProvider* provider = pwallet->GetSigningProvider(scriptPubKey);\n+            auto descriptor = InferDescriptor(scriptPubKey, *provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300813241",
      "id" : 300813241,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMzI0MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 320,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300813241",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300813882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300813882"
         }
      },
      "author_association" : "NONE",
      "body" : "Please add space around operators ",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T00:31:41Z",
      "diff_hunk" : "@@ -1661,71 +1311,48 @@ bool CWallet::DummySignTx(CMutableTransaction &txNew, const std::vector<CTxOut>\n     return true;\n }\n \n-bool CWallet::ImportScripts(const std::set<CScript> scripts)\n+bool CWallet::ImportScripts(const std::set<CScript> scripts, int64_t time)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : scripts) {\n-        if (!HaveCScript(CScriptID(entry)) && !AddCScriptWithDB(batch, entry)) {\n-            return false;\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportScripts(scripts, time);\n }\n \n bool CWallet::ImportPrivKeys(const std::map<CKeyID, CKey>& privkey_map, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : privkey_map) {\n-        const CKey& key = entry.second;\n-        CPubKey pubkey = key.GetPubKey();\n-        const CKeyID& id = entry.first;\n-        assert(key.VerifyPubKey(pubkey));\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-        // If the private key is not present in the wallet, insert it.\n-        if (!HaveKey(id) && !AddKeyPubKeyWithDB(batch, key, pubkey)) {\n-            return false;\n-        }\n-        UpdateTimeFirstKey(timestamp);\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPrivKeys(privkey_map, timestamp);\n }\n \n bool CWallet::ImportPubKeys(const std::vector<CKeyID>& ordered_pubkeys, const std::map<CKeyID, CPubKey>& pubkey_map, const std::map<CKeyID, std::pair<CPubKey, KeyOriginInfo>>& key_origins, const bool add_keypool, const bool internal, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : key_origins) {\n-        AddKeyOriginWithDB(batch, entry.second.first, entry.second.second);\n-    }\n-    for (const CKeyID& id : ordered_pubkeys) {\n-        auto entry = pubkey_map.find(id);\n-        if (entry == pubkey_map.end()) {\n-            continue;\n-        }\n-        const CPubKey& pubkey = entry->second;\n-        CPubKey temp;\n-        if (!GetPubKey(id, temp) && !AddWatchOnlyWithDB(batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n-            return false;\n-        }\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-\n-        // Add to keypool only works with pubkeys\n-        if (add_keypool) {\n-            AddKeypoolPubkeyWithDB(pubkey, internal, batch);\n-            NotifyCanGetAddressesChanged();\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPubKeys(ordered_pubkeys, pubkey_map, key_origins, add_keypool, internal, timestamp);\n }\n \n bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScript>& script_pub_keys, const bool have_solving_data, const bool internal, const int64_t timestamp)\n {\n+    auto spk_man =GetLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300813882",
      "id" : 300813882,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxMzg4Mg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 695,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300813882",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818049"
         }
      },
      "author_association" : "NONE",
      "body" : "Could be void since we always return true.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T03:02:04Z",
      "diff_hunk" : "@@ -32,37 +92,31 @@ void CBasicKeyStore::ImplicitlyLearnRelatedKeyScripts(const CPubKey& pubkey)\n     }\n }\n \n-bool CBasicKeyStore::GetPubKey(const CKeyID &address, CPubKey &vchPubKeyOut) const\n+bool FillableSigningProvider::GetPubKey(const CKeyID &address, CPubKey &vchPubKeyOut) const\n {\n     CKey key;\n     if (!GetKey(address, key)) {\n-        LOCK(cs_KeyStore);\n-        WatchKeyMap::const_iterator it = mapWatchKeys.find(address);\n-        if (it != mapWatchKeys.end()) {\n-            vchPubKeyOut = it->second;\n-            return true;\n-        }\n         return false;\n     }\n     vchPubKeyOut = key.GetPubKey();\n     return true;\n }\n \n-bool CBasicKeyStore::AddKeyPubKey(const CKey& key, const CPubKey &pubkey)\n+bool FillableSigningProvider::AddKeyPubKey(const CKey& key, const CPubKey &pubkey)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818049",
      "id" : 300818049,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODA0OQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 106,
      "path" : "src/script/signingprovider.cpp",
      "position" : null,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818049",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818112"
         }
      },
      "author_association" : "NONE",
      "body" : "Looks like we could remove error and use empty string `\"\"`  below. ",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T03:05:57Z",
      "diff_hunk" : "@@ -140,14 +140,37 @@ class WalletImpl : public Wallet\n     void abortRescan() override { m_wallet->AbortRescan(); }\n     bool backupWallet(const std::string& filename) override { return m_wallet->BackupWallet(filename); }\n     std::string getWalletName() override { return m_wallet->GetName(); }\n-    bool getKeyFromPool(bool internal, CPubKey& pub_key) override\n+    bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) override\n     {\n-        return m_wallet->GetKeyFromPool(pub_key, internal);\n+        LOCK(m_wallet->cs_wallet);\n+        std::string error;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818112",
      "id" : 300818112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODExMg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 45,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818112",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818241"
         }
      },
      "author_association" : "NONE",
      "body" : "Is this done as an optimization? I'd prefer:\r\n```\r\nvoid CWallet::SetCrypted()\r\n{ \r\n    LOCK(cs_wallet);\r\n    fUseCrypto = true;\r\n}\r\n```",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T03:14:11Z",
      "diff_hunk" : "@@ -4560,31 +3942,141 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n     return groups;\n }\n \n-bool CWallet::GetKeyOrigin(const CKeyID& keyID, KeyOriginInfo& info) const\n+bool CWallet::SetCrypted()\n {\n-    CKeyMetadata meta;\n+    LOCK(cs_wallet);\n+    if (fUseCrypto)\n+        return true;\n+    fUseCrypto = true;\n+    return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818241",
      "id" : 300818241,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODI0MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 1491,
      "path" : "src/wallet/wallet.cpp",
      "position" : 1529,
      "pull_request_review_id" : 258567976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818241",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1562849?v=4",
         "events_url" : "https://api.github.com/users/fqlx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fqlx/followers",
         "following_url" : "https://api.github.com/users/fqlx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fqlx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fqlx",
         "id" : 1562849,
         "login" : "fqlx",
         "node_id" : "MDQ6VXNlcjE1NjI4NDk=",
         "organizations_url" : "https://api.github.com/users/fqlx/orgs",
         "received_events_url" : "https://api.github.com/users/fqlx/received_events",
         "repos_url" : "https://api.github.com/users/fqlx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fqlx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fqlx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fqlx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818321"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please try to understand the code you're commenting on.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T03:18:57Z",
      "diff_hunk" : "@@ -170,7 +193,7 @@ class WalletImpl : public Wallet\n             *name = it->second.name;\n         }\n         if (is_mine) {\n-            *is_mine = IsMine(*m_wallet, dest);\n+            *is_mine = m_wallet->IsMine(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818321",
      "id" : 300818321,
      "in_reply_to_id" : 300812193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODMyMQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 85,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 50,
      "pull_request_review_id" : 258575305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818321",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818335"
         }
      },
      "author_association" : "MEMBER",
      "body" : "C++11 does not have such a type.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T03:19:45Z",
      "diff_hunk" : "@@ -0,0 +1,37 @@\n+// Copyright (c) 2019 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_SCRIPT_KEYORIGIN_H\n+#define BITCOIN_SCRIPT_KEYORIGIN_H\n+\n+#include <serialize.h>\n+#include <streams.h>\n+#include <vector>\n+\n+struct KeyOriginInfo\n+{\n+    unsigned char fingerprint[4]; //!< First 32 bits of the Hash160 of the public key at the root of the path",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300818335",
      "id" : 300818335,
      "in_reply_to_id" : 300812883,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxODMzNQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 14,
      "path" : "src/script/keyorigin.h",
      "position" : null,
      "pull_request_review_id" : 258575318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300818335",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819296"
         }
      },
      "author_association" : "NONE",
      "body" : "@sipa: Clarifying what you're referring to would be both constructive and polite :)",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:12:08Z",
      "diff_hunk" : "@@ -170,7 +193,7 @@ class WalletImpl : public Wallet\n             *name = it->second.name;\n         }\n         if (is_mine) {\n-            *is_mine = IsMine(*m_wallet, dest);\n+            *is_mine = m_wallet->IsMine(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819296",
      "id" : 300819296,
      "in_reply_to_id" : 300812193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTI5Ng==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 85,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 50,
      "pull_request_review_id" : 258576343,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819296",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/33569?v=4",
         "events_url" : "https://api.github.com/users/dandv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dandv/followers",
         "following_url" : "https://api.github.com/users/dandv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dandv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dandv",
         "id" : 33569,
         "login" : "dandv",
         "node_id" : "MDQ6VXNlcjMzNTY5",
         "organizations_url" : "https://api.github.com/users/dandv/orgs",
         "received_events_url" : "https://api.github.com/users/dandv/received_events",
         "repos_url" : "https://api.github.com/users/dandv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dandv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dandv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dandv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819341"
         }
      },
      "author_association" : "NONE",
      "body" : "The old `get...Key` returning `bool` smells: either the pubKey is a boolean, or `getPubKey` has a side effect of getting the key somewhere else instead of as a result. Could this PR fix that by renaming it to `isPubKey()`?",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:14:54Z",
      "diff_hunk" : "@@ -78,14 +78,14 @@ class Wallet\n     //! Get wallet name.\n     virtual std::string getWalletName() = 0;\n \n-    // Get key from pool.\n-    virtual bool getKeyFromPool(bool internal, CPubKey& pub_key) = 0;\n+    // Get a new address.\n+    virtual bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) = 0;\n \n     //! Get public key.\n-    virtual bool getPubKey(const CKeyID& address, CPubKey& pub_key) = 0;\n+    virtual bool getPubKey(const CScript& script, const CKeyID& address, CPubKey& pub_key) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819341",
      "id" : 300819341,
      "in_reply_to_id" : 300812273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTM0MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 11,
      "path" : "src/interfaces/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 258576394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819341",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/33569?v=4",
         "events_url" : "https://api.github.com/users/dandv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dandv/followers",
         "following_url" : "https://api.github.com/users/dandv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dandv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dandv",
         "id" : 33569,
         "login" : "dandv",
         "node_id" : "MDQ6VXNlcjMzNTY5",
         "organizations_url" : "https://api.github.com/users/dandv/orgs",
         "received_events_url" : "https://api.github.com/users/dandv/received_events",
         "repos_url" : "https://api.github.com/users/dandv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dandv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dandv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dandv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819367"
         }
      },
      "author_association" : "NONE",
      "body" : "Such key code would certainly benefit from linting.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:16:24Z",
      "diff_hunk" : "@@ -1661,71 +1311,48 @@ bool CWallet::DummySignTx(CMutableTransaction &txNew, const std::vector<CTxOut>\n     return true;\n }\n \n-bool CWallet::ImportScripts(const std::set<CScript> scripts)\n+bool CWallet::ImportScripts(const std::set<CScript> scripts, int64_t time)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : scripts) {\n-        if (!HaveCScript(CScriptID(entry)) && !AddCScriptWithDB(batch, entry)) {\n-            return false;\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportScripts(scripts, time);\n }\n \n bool CWallet::ImportPrivKeys(const std::map<CKeyID, CKey>& privkey_map, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : privkey_map) {\n-        const CKey& key = entry.second;\n-        CPubKey pubkey = key.GetPubKey();\n-        const CKeyID& id = entry.first;\n-        assert(key.VerifyPubKey(pubkey));\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-        // If the private key is not present in the wallet, insert it.\n-        if (!HaveKey(id) && !AddKeyPubKeyWithDB(batch, key, pubkey)) {\n-            return false;\n-        }\n-        UpdateTimeFirstKey(timestamp);\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPrivKeys(privkey_map, timestamp);\n }\n \n bool CWallet::ImportPubKeys(const std::vector<CKeyID>& ordered_pubkeys, const std::map<CKeyID, CPubKey>& pubkey_map, const std::map<CKeyID, std::pair<CPubKey, KeyOriginInfo>>& key_origins, const bool add_keypool, const bool internal, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : key_origins) {\n-        AddKeyOriginWithDB(batch, entry.second.first, entry.second.second);\n-    }\n-    for (const CKeyID& id : ordered_pubkeys) {\n-        auto entry = pubkey_map.find(id);\n-        if (entry == pubkey_map.end()) {\n-            continue;\n-        }\n-        const CPubKey& pubkey = entry->second;\n-        CPubKey temp;\n-        if (!GetPubKey(id, temp) && !AddWatchOnlyWithDB(batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n-            return false;\n-        }\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-\n-        // Add to keypool only works with pubkeys\n-        if (add_keypool) {\n-            AddKeypoolPubkeyWithDB(pubkey, internal, batch);\n-            NotifyCanGetAddressesChanged();\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPubKeys(ordered_pubkeys, pubkey_map, key_origins, add_keypool, internal, timestamp);\n }\n \n bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScript>& script_pub_keys, const bool have_solving_data, const bool internal, const int64_t timestamp)\n {\n+    auto spk_man =GetLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819367",
      "id" : 300819367,
      "in_reply_to_id" : 300813882,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTM2Nw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 695,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258576422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819367",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/33569?v=4",
         "events_url" : "https://api.github.com/users/dandv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dandv/followers",
         "following_url" : "https://api.github.com/users/dandv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dandv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dandv",
         "id" : 33569,
         "login" : "dandv",
         "node_id" : "MDQ6VXNlcjMzNTY5",
         "organizations_url" : "https://api.github.com/users/dandv/orgs",
         "received_events_url" : "https://api.github.com/users/dandv/received_events",
         "repos_url" : "https://api.github.com/users/dandv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dandv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dandv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dandv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Everyone commenting here, note that this PR is a work in progress, and is built on top of multiple open PRs.\r\n\r\nFor now we should try and keep the discussion here at a Concept ACK/NACK & design level, rather than individual nit-picks and code review.\r\n\r\nIf you would like to review the code, please do so in the open base PRs. That will not only save the concept level discussion here from being drowned out in inline comments, but will also prevent duplicate review. i.e What you're commenting on here might have already been addressed/pointed out in the base PRs.",
      "created_at" : "2019-07-06T04:28:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-508896117",
      "id" : 508896117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODg5NjExNw==",
      "updated_at" : "2019-07-06T04:28:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508896117",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819626"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This line is merely changing how `IsMine` is called. In order to avoid difficulties for reviewers, the existing code (the assignment itself) is not being changed.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:31:00Z",
      "diff_hunk" : "@@ -170,7 +193,7 @@ class WalletImpl : public Wallet\n             *name = it->second.name;\n         }\n         if (is_mine) {\n-            *is_mine = IsMine(*m_wallet, dest);\n+            *is_mine = m_wallet->IsMine(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819626",
      "id" : 300819626,
      "in_reply_to_id" : 300812193,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTYyNg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 85,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 50,
      "pull_request_review_id" : 258576720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819626",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I am trying to avoid changing existing code as much as possible in order to avoid additional review burden. Feel free to change this later, but changing it here is out of scope for this PR.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:32:32Z",
      "diff_hunk" : "@@ -78,14 +78,14 @@ class Wallet\n     //! Get wallet name.\n     virtual std::string getWalletName() = 0;\n \n-    // Get key from pool.\n-    virtual bool getKeyFromPool(bool internal, CPubKey& pub_key) = 0;\n+    // Get a new address.\n+    virtual bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) = 0;\n \n     //! Get public key.\n-    virtual bool getPubKey(const CKeyID& address, CPubKey& pub_key) = 0;\n+    virtual bool getPubKey(const CScript& script, const CKeyID& address, CPubKey& pub_key) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819651",
      "id" : 300819651,
      "in_reply_to_id" : 300812273,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTY1MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 11,
      "path" : "src/interfaces/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 258576752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819651",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819681"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is part of a scripted diff. Such a change would both not part of the script and be unrelated to this PR.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:33:40Z",
      "diff_hunk" : "@@ -83,23 +137,23 @@ bool CBasicKeyStore::GetKey(const CKeyID &address, CKey &keyOut) const\n     return false;\n }\n \n-bool CBasicKeyStore::AddCScript(const CScript& redeemScript)\n+bool FillableSigningProvider::AddCScript(const CScript& redeemScript)\n {\n     if (redeemScript.size() > MAX_SCRIPT_ELEMENT_SIZE)\n-        return error(\"CBasicKeyStore::AddCScript(): redeemScripts > %i bytes are invalid\", MAX_SCRIPT_ELEMENT_SIZE);\n+        return error(\"FillableSigningProvider::AddCScript(): redeemScripts > %i bytes are invalid\", MAX_SCRIPT_ELEMENT_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819681",
      "id" : 300819681,
      "in_reply_to_id" : 300812837,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTY4MQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 144,
      "path" : "src/script/signingprovider.cpp",
      "position" : null,
      "pull_request_review_id" : 258576788,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819681",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is existing code and is merely a rename. Changing what it returns is out of scope for this PR.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:34:53Z",
      "diff_hunk" : "@@ -32,37 +92,31 @@ void CBasicKeyStore::ImplicitlyLearnRelatedKeyScripts(const CPubKey& pubkey)\n     }\n }\n \n-bool CBasicKeyStore::GetPubKey(const CKeyID &address, CPubKey &vchPubKeyOut) const\n+bool FillableSigningProvider::GetPubKey(const CKeyID &address, CPubKey &vchPubKeyOut) const\n {\n     CKey key;\n     if (!GetKey(address, key)) {\n-        LOCK(cs_KeyStore);\n-        WatchKeyMap::const_iterator it = mapWatchKeys.find(address);\n-        if (it != mapWatchKeys.end()) {\n-            vchPubKeyOut = it->second;\n-            return true;\n-        }\n         return false;\n     }\n     vchPubKeyOut = key.GetPubKey();\n     return true;\n }\n \n-bool CBasicKeyStore::AddKeyPubKey(const CKey& key, const CPubKey &pubkey)\n+bool FillableSigningProvider::AddKeyPubKey(const CKey& key, const CPubKey &pubkey)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819703",
      "id" : 300819703,
      "in_reply_to_id" : 300818049,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTcwMw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 106,
      "path" : "src/script/signingprovider.cpp",
      "position" : null,
      "pull_request_review_id" : 258576815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819703",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819762"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is moved code and I will not be changing it in order to avoid overburdening reviewers with ensuring that behavior hasn't changed.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:36:06Z",
      "diff_hunk" : "@@ -4560,31 +3942,141 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n     return groups;\n }\n \n-bool CWallet::GetKeyOrigin(const CKeyID& keyID, KeyOriginInfo& info) const\n+bool CWallet::SetCrypted()\n {\n-    CKeyMetadata meta;\n+    LOCK(cs_wallet);\n+    if (fUseCrypto)\n+        return true;\n+    fUseCrypto = true;\n+    return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819762",
      "id" : 300819762,
      "in_reply_to_id" : 300818241,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTc2Mg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 1491,
      "path" : "src/wallet/wallet.cpp",
      "position" : 1529,
      "pull_request_review_id" : 258576853,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819762",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, `GetNewAddress` takes a reference which `\"\"` is not.",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:39:57Z",
      "diff_hunk" : "@@ -140,14 +140,37 @@ class WalletImpl : public Wallet\n     void abortRescan() override { m_wallet->AbortRescan(); }\n     bool backupWallet(const std::string& filename) override { return m_wallet->BackupWallet(filename); }\n     std::string getWalletName() override { return m_wallet->GetName(); }\n-    bool getKeyFromPool(bool internal, CPubKey& pub_key) override\n+    bool getNewAddress(const OutputType type, const std::string label, CTxDestination& dest) override\n     {\n-        return m_wallet->GetKeyFromPool(pub_key, internal);\n+        LOCK(m_wallet->cs_wallet);\n+        std::string error;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300819836",
      "id" : 300819836,
      "in_reply_to_id" : 300818112,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgxOTgzNg==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 45,
      "path" : "src/interfaces/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 258576934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300819836",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300820287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300820287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:59:53Z",
      "diff_hunk" : "@@ -3083,7 +3097,8 @@ static UniValue listunspent(const JSONRPCRequest& request)\n         entry.pushKV(\"spendable\", out.fSpendable);\n         entry.pushKV(\"solvable\", out.fSolvable);\n         if (out.fSolvable) {\n-            auto descriptor = InferDescriptor(scriptPubKey, *pwallet);\n+            const SigningProvider* provider = pwallet->GetSigningProvider(scriptPubKey);\n+            auto descriptor = InferDescriptor(scriptPubKey, *provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300820287",
      "id" : 300820287,
      "in_reply_to_id" : 300813241,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgyMDI4Nw==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 320,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258577357,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300820287",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300820289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300820289"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "737705fd5e228b71b24cceb94b265a4385672c8c",
      "created_at" : "2019-07-06T04:59:59Z",
      "diff_hunk" : "@@ -1661,71 +1311,48 @@ bool CWallet::DummySignTx(CMutableTransaction &txNew, const std::vector<CTxOut>\n     return true;\n }\n \n-bool CWallet::ImportScripts(const std::set<CScript> scripts)\n+bool CWallet::ImportScripts(const std::set<CScript> scripts, int64_t time)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : scripts) {\n-        if (!HaveCScript(CScriptID(entry)) && !AddCScriptWithDB(batch, entry)) {\n-            return false;\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportScripts(scripts, time);\n }\n \n bool CWallet::ImportPrivKeys(const std::map<CKeyID, CKey>& privkey_map, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : privkey_map) {\n-        const CKey& key = entry.second;\n-        CPubKey pubkey = key.GetPubKey();\n-        const CKeyID& id = entry.first;\n-        assert(key.VerifyPubKey(pubkey));\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-        // If the private key is not present in the wallet, insert it.\n-        if (!HaveKey(id) && !AddKeyPubKeyWithDB(batch, key, pubkey)) {\n-            return false;\n-        }\n-        UpdateTimeFirstKey(timestamp);\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPrivKeys(privkey_map, timestamp);\n }\n \n bool CWallet::ImportPubKeys(const std::vector<CKeyID>& ordered_pubkeys, const std::map<CKeyID, CPubKey>& pubkey_map, const std::map<CKeyID, std::pair<CPubKey, KeyOriginInfo>>& key_origins, const bool add_keypool, const bool internal, const int64_t timestamp)\n {\n-    WalletBatch batch(*database);\n-    for (const auto& entry : key_origins) {\n-        AddKeyOriginWithDB(batch, entry.second.first, entry.second.second);\n-    }\n-    for (const CKeyID& id : ordered_pubkeys) {\n-        auto entry = pubkey_map.find(id);\n-        if (entry == pubkey_map.end()) {\n-            continue;\n-        }\n-        const CPubKey& pubkey = entry->second;\n-        CPubKey temp;\n-        if (!GetPubKey(id, temp) && !AddWatchOnlyWithDB(batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n-            return false;\n-        }\n-        mapKeyMetadata[id].nCreateTime = timestamp;\n-\n-        // Add to keypool only works with pubkeys\n-        if (add_keypool) {\n-            AddKeypoolPubkeyWithDB(pubkey, internal, batch);\n-            NotifyCanGetAddressesChanged();\n-        }\n+    auto spk_man =GetLegacyScriptPubKeyMan();\n+    if (!spk_man) {\n+        return false;\n     }\n-    return true;\n+    LOCK(spk_man->cs_KeyStore);\n+    return GetLegacyScriptPubKeyMan()->ImportPubKeys(ordered_pubkeys, pubkey_map, key_origins, add_keypool, internal, timestamp);\n }\n \n bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScript>& script_pub_keys, const bool have_solving_data, const bool internal, const int64_t timestamp)\n {\n+    auto spk_man =GetLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#discussion_r300820289",
      "id" : 300820289,
      "in_reply_to_id" : 300813882,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMwMDgyMDI4OQ==",
      "original_commit_id" : "1404f8ca2888592ee5072a343e77acba2b3809ed",
      "original_position" : 695,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 258577359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16341",
      "updated_at" : "2019-07-29T14:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/300820289",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, this abstraction is definitely the right path for the wallet to take IMO as we work toward descriptor wallets.",
      "created_at" : "2019-07-07T03:03:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-508967793",
      "id" : 508967793,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODk2Nzc5Mw==",
      "updated_at" : "2019-07-07T03:03:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508967793",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Approach ACK.\r\n\r\nTo make some of the commits easier to review, instead of having one commit that adds a function to `LegacyScriptPubKeyMan` (e.g. `LegacyScriptPubKeyMan::LoadKey`), one commit that deletes it from CWallet (`Remove unused functions and switch CWallet to use ScriptPubKeyMan`) and one commit that moves the call over (`Implement actually loading everything into LegacyScriptPubKeyMan`), try to combine those. That lets you get rid of the CI Skip commits, and makes it easier to verify move-only parts with `--color-moved=dimmed-zebra`.\r\n\r\nIn other words, start with empty `(Legacy)ScriptPubKeyMan` and then migrate one function per commit into it.\r\n\r\nAre you sure you want to move `WalletFeature` and `WalletFlags` into `LegacyScriptPubKeyMan`? I would prefer to keep these settings global to the wallet. It does make sense for each `ScriptPubKeyMan` to have its own `IsLocked()` state, so that brings up the question what to do if a single one fails to unlock. But I'd rather not add RPC methods to unlock specific `PubKeyMan`s in a given wallet.\r\n\r\nI brainstormed how to apply this to hardware wallets: https://github.com/bitcoin/bitcoin/pull/14912#issuecomment-510520757. The unsollicited keypool topup in `GetReservedDestination` is annoying in that context. Can `ScriptPubKeyMan` have a flag to opt out of that? ",
      "created_at" : "2019-07-11T14:56:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-510521262",
      "id" : 510521262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDUyMTI2Mg==",
      "updated_at" : "2019-07-11T15:12:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510521262",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> To make some of the commits easier to review, instead of having one commit that adds a function to `LegacyScriptPubKeyMan` (e.g. `LegacyScriptPubKeyMan::LoadKey`), one commit that deletes it from CWallet (`Remove unused functions and switch CWallet to use ScriptPubKeyMan`) and one commit that moves the call over (`Implement actually loading everything into LegacyScriptPubKeyMan`), try to combine those. That lets you get rid of the CI Skip commits, and makes it easier to verify move-only parts with `--color-moved=dimmed-zebra`.\r\n> \r\n> In other words, start with empty `(Legacy)ScriptPubKeyMan` and then migrate one function per commit into it.\r\n\r\nDoing that will cause the entirety of the PR to fail all tests (so all need ci skip) except for the very last commit. If other reviewers want that, I could reorganize it.\r\n\r\n> Are you sure you want to move `WalletFeature` and `WalletFlags` into `LegacyScriptPubKeyMan`? I would prefer to keep these settings global to the wallet.\r\n\r\nThey are global to the wallet. They are moved to `walletutil.h`. Both `LegacyScriptPubKeyMan` and `CWallet` require access to both of these enums, but having `scriptpubkeyman` including `wallet.h` would be a circular dependency, so I moved it to `walletutil.h`.\r\n\r\n> It does make sense for each `ScriptPubKeyMan` to have its own `IsLocked()` state, so that brings up the question what to do if a single one fails to unlock.\r\n\r\nI guess it should fail to unlock everything? That would indicate some corruption has occurred.\r\n\r\n> But I'd rather not add RPC methods to unlock specific `PubKeyMan`s in a given wallet.\r\n\r\nAgreed.\r\n\r\n> The unsollicited keypool topup in `GetReservedDestination` is annoying in that context. Can `ScriptPubKeyMan` have a flag to opt out of that?\\\r\n\r\nI suppose it should actually be in `LegacyScriptPubKeyMan::GetReservedDestination` rather than `CWallet`'s. However, `TopUp` can just do nothing and that won't effect this behavior. Every `ScriptPubKeyMan` needs to implement `TopUp` anyways.\r\n\r\n",
      "created_at" : "2019-07-11T17:57:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-510589619",
      "id" : 510589619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDU4OTYxOQ==",
      "updated_at" : "2019-07-11T17:57:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510589619",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">> In other words, start with empty `(Legacy)ScriptPubKeyMan` and then migrate one function per commit into it.\r\n\r\n> Doing that will cause the entirety of the PR to fail all tests (so all need ci skip) except for the very last commit. If other reviewers want that, I could reorganize it.\r\n\r\nWhy would any of the test fail if `ScriptPubKeyMan` is just an empty shell, and/or a bunch of NOOP functions?\r\n\r\n>> The unsollicited keypool topup in GetReservedDestination is annoying in that context. Can ScriptPubKeyMan have a flag to opt out of that?\r\n\r\n> I suppose it should actually be in `LegacyScriptPubKeyMan::GetReservedDestination` rather than `CWallet`'s. However, `TopUp` can just do nothing and that won't effect this behavior. Every `ScriptPubKeyMan` needs to implement `TopUp` anyways.\r\n\r\nIn the context of a hardware wallet I want `TopUp` to fetch keys from the device. But it should only try that if the user explicitly calls `topupkeypool` (and the UI equivalent). Problem is that `TopUp` doesn't know where it's called from.",
      "created_at" : "2019-07-12T14:18:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-510903836",
      "id" : 510903836,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDkwMzgzNg==",
      "updated_at" : "2019-07-12T14:18:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510903836",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The PRs this depended on have been merged. I don't foresee making large changes to this anymore, so this is no longer WIP.\r\n\r\nPlease review!",
      "created_at" : "2019-07-26T19:51:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-515578355",
      "id" : 515578355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16341",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTU3ODM1NQ==",
      "updated_at" : "2019-07-26T19:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515578355",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
