[
   {
      "body" : "I think you missed something. There are three directories that matter:\r\n* $DATADIR/blocks (raw blocks)\r\n* $DATADIR/blocks/index (LevelDB database with information about raw blocks)\r\n* $DATADIR/chainstate (LevelDB database that holds the UTXO set)\r\n\r\nThe first is high-bandwidth, low IO. The second has hardly any activity at all. The third is where all activity happens, and is critical for performance.\r\n\r\nYou should not separate the blocks from the blocks/index directory, as things may get ugly if they're out of sync. You can however put the chainstate on a faster/smaller device.",
      "created_at" : "2017-07-25T00:53:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10922#issuecomment-317596359",
      "id" : 317596359,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10922",
      "updated_at" : "2017-07-25T00:54:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317596359",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Hi @sipa, thank you very much for the prompt follow up.  Per your feedback, I have updated the doc to explicitly call out that chainstate folder must also stay on a fast (internal) disk.  The \"file-partition.md\" notes I made should describe:\r\n\r\n- Installing $datadir to local internal disk (so \"chainstate\" will never need to move).\r\n- Start/stop bitcoind (though maybe this isn't necessary).\r\n- Move the \"index\" files up one folder level. \r\n- Move the \"blocks\" folder off the internal disk.\r\n- Go to the new external \"blocks\" folder and soft-link back to the new \"index\" location.\r\n- Go to the original internal drive \"data\" location and link the now external \"blocks\" folder.\r\n\r\nAgain, the \"chainstate\" folder remains on the internal disk and never needs to move.\r\n\r\nAgain these \"file-partition.md\" notes are not the direct route I took, but (if correct) might save _the next person_ considerable delay in initial blockchain synchronization.\r\n\r\nTo your point even though these low-capacity/high-IOfrequency LevelDb and high-capacity/low-IOfrequency blockchain files are physically separated on separate disks, _they are kept in sync via the soft links_ created.\r\n\r\n_Maybe ultimately a more natural configuration of these files would be to have the \"index\" folder up a level to start with._  That's what makes moving these folders confusing in my opinion.\r\n\r\nThank you again very much for the prompt feedback, very flattering, thanks.",
      "created_at" : "2017-07-25T01:14:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10922#issuecomment-317599566",
      "id" : 317599566,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10922",
      "updated_at" : "2017-07-25T15:42:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317599566",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/29764807?v=4",
         "events_url" : "https://api.github.com/users/jimhashhq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimhashhq/followers",
         "following_url" : "https://api.github.com/users/jimhashhq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimhashhq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimhashhq",
         "id" : 29764807,
         "login" : "jimhashhq",
         "organizations_url" : "https://api.github.com/users/jimhashhq/orgs",
         "received_events_url" : "https://api.github.com/users/jimhashhq/received_events",
         "repos_url" : "https://api.github.com/users/jimhashhq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimhashhq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimhashhq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimhashhq"
      }
   },
   {
      "body" : "\"file-partition.md\"has been updated to highlight the need to keep \"chainstate\" folder on a fast (internal) drive in addition to \"index\" files as per @sipa.  Thanks @fanquake for adding the label.   This issue seems also related to \"installation\" and/or \"configuration\"; I did not see either of these as bitcoin project label categories, was thinking they might prove useful as well.  Thank you both for your guidance.",
      "created_at" : "2017-07-25T15:57:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10922#issuecomment-317784348",
      "id" : 317784348,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10922",
      "updated_at" : "2017-07-25T15:57:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317784348",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/29764807?v=4",
         "events_url" : "https://api.github.com/users/jimhashhq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimhashhq/followers",
         "following_url" : "https://api.github.com/users/jimhashhq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimhashhq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimhashhq",
         "id" : 29764807,
         "login" : "jimhashhq",
         "organizations_url" : "https://api.github.com/users/jimhashhq/orgs",
         "received_events_url" : "https://api.github.com/users/jimhashhq/received_events",
         "repos_url" : "https://api.github.com/users/jimhashhq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimhashhq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimhashhq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimhashhq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10922#discussion_r130450125"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10922"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130450125"
         }
      },
      "body" : "Instead of killing the process, you should use `bitcoin-cli stop`. ",
      "commit_id" : "3c0377db483c50c5a9aecfc4684d6329951a1c7c",
      "created_at" : "2017-07-31T20:16:47Z",
      "diff_hunk" : "@@ -0,0 +1,53 @@\n+# File Partition:\n+Since the blockchain is around ~140GB, storage of large files on an external drive is convenient.  If this is not done properly, the external drive will also contain high i/o-frequency LevelDB index files, protracting time for initial blockchain synchronization. This document describes how partition datadir files between the high-frequency/low-capacity \"index\" files and the low-frequency/high-capacity \"blocks\" files. Examples are given for macOS, but Linux / Windows should be similar. These instructions result in the following physical folder rearrangement:\n+\n+| Original Location       | New Location | Capacity Needs | i/o Frequency  |\n+| ----------------------- | ------------ | -------------- | -------------- |\n+| ${datadir}/blocks/index | ${datadir}   | low            | high           |\n+| ${datadir}/blocks       | ${EXTERAL}   | high           | low            |\n+| ${datadir}/chainstate   | n/a          | low            | high           |\n+\n+Note: the chainstate folder will not move if these instructions are followed closely.  Like the index folder, chainstate contains very high frequency LevelDB files and must remain on a fast (internal) disk if reasonable syncronization time is to be expected.\n+\n+Change \"coinadm\" in the following as appropriate for your Bitcoin administrative account.\n+\n+1) Start bitcoind with --datadir pointing to your internal drive:\n+\n+        bitcoind -daemon -conf=macos-bitcoin.conf -datadir=/Users/coinadm/local/bitcoin/data\n+\n+Let it run for a few minutes, or long enough that it has started syncho-\n+   nizing.  Either tail the debug.log, or watch the blocks folder:\n+   \n+        ls -l /Users/coinadm/local/bitcoin/data/blocks/blk00000.dat\n+        -rw-------  1 coinadm  staff  134191893 Jul 27 11:31 /Users/coinadm/local/data/blocks/blk00000.dat\n+\n+2) Stop bitcoind, so that we can rearrange some datadir folders:\n+\n+       kill -QUIT `cat /Volumes/WD-Passport-Mac/bitcoin/data/bitcoind.pid`",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10922#discussion_r130450125",
      "id" : 130450125,
      "original_commit_id" : "3c0377db483c50c5a9aecfc4684d6329951a1c7c",
      "original_position" : 26,
      "path" : "doc/file-partition.md",
      "position" : 26,
      "pull_request_review_id" : 53327684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10922",
      "updated_at" : "2017-07-31T20:17:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130450125",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10922#discussion_r130450219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10922"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130450219"
         }
      },
      "body" : "What's with the muptiple languages here?",
      "commit_id" : "3c0377db483c50c5a9aecfc4684d6329951a1c7c",
      "created_at" : "2017-07-31T20:17:11Z",
      "diff_hunk" : "@@ -0,0 +1,53 @@\n+# File Partition:\n+Since the blockchain is around ~140GB, storage of large files on an external drive is convenient.  If this is not done properly, the external drive will also contain high i/o-frequency LevelDB index files, protracting time for initial blockchain synchronization. This document describes how partition datadir files between the high-frequency/low-capacity \"index\" files and the low-frequency/high-capacity \"blocks\" files. Examples are given for macOS, but Linux / Windows should be similar. These instructions result in the following physical folder rearrangement:\n+\n+| Original Location       | New Location | Capacity Needs | i/o Frequency  |\n+| ----------------------- | ------------ | -------------- | -------------- |\n+| ${datadir}/blocks/index | ${datadir}   | low            | high           |\n+| ${datadir}/blocks       | ${EXTERAL}   | high           | low            |\n+| ${datadir}/chainstate   | n/a          | low            | high           |\n+\n+Note: the chainstate folder will not move if these instructions are followed closely.  Like the index folder, chainstate contains very high frequency LevelDB files and must remain on a fast (internal) disk if reasonable syncronization time is to be expected.\n+\n+Change \"coinadm\" in the following as appropriate for your Bitcoin administrative account.\n+\n+1) Start bitcoind with --datadir pointing to your internal drive:\n+\n+        bitcoind -daemon -conf=macos-bitcoin.conf -datadir=/Users/coinadm/local/bitcoin/data\n+\n+Let it run for a few minutes, or long enough that it has started syncho-\n+   nizing.  Either tail the debug.log, or watch the blocks folder:\n+   \n+        ls -l /Users/coinadm/local/bitcoin/data/blocks/blk00000.dat\n+        -rw-------  1 coinadm  staff  134191893 Jul 27 11:31 /Users/coinadm/local/data/blocks/blk00000.dat\n+\n+2) Stop bitcoind, so that we can rearrange some datadir folders:\n+\n+       kill -QUIT `cat /Volumes/WD-Passport-Mac/bitcoin/data/bitcoind.pid`\n+\n+3) Move the \"index\" folder up one level (so that it may remain on the internal drive). Like the \n+      \n+          mv -f /Users/coinadm/local/bitcoin/data/blocks/index /Users/coinadm/local/bitcoin/data/\n+\n+4) Next, move the Bitcoin blockchain blocks folder off the internal drive:\n+   \n+          mkdir /Volumes/WD-Passport-Mac/bitcoin \n+          mv -f /Users/coinadm/local/bitcoin/data/blocks /Volumes/WD-Passport-Mac/bitcoin \n+\n+Finally, set up soft links to restore the original folder structure:\n+   \n+| Folder Name              | Link Name           |\n+| ------------------------ | ------------------- |\n+| ${EXTERNAL}/blocks/index | ${datadir}/../index |\n+| ${datadir}/blocks        | ${EXTERAL}/blocks   |\n+\n+5) Replace the original index folder location with a soft link:\n+      \n+          ln -s /Users/coinadm/local/bitcoin/index /Volumes/WD-Passport-Mac/bitcoin/blocks/index \n+\n+6) Replace the original index folder location with a soft link:\n+      \n+          ln -s /Volumes/WD-Passport-Mac/bitcoin/blocks /Users/coinadm/local/bitcoin/data/blocks\n+\n+ Ã¦Â³Â¨Ã¦ÂÂ - Nota - Note - Ã Â¤Â§Ã Â¥ÂÃ Â¤Â¯Ã Â¤Â¾Ã Â¤Â¨ Ã Â¤Â¦Ã Â¥ÂÃ Â¤Â - Ã¯Â»Â¢Ã¯Â»Â Ã¯ÂºÂ£Ã¯Â»Â®Ã¯Â»ÂÃ¯ÂºÂ - ÃÂ¼ÃÂµÃÂÃÂºÃÂ° ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10922#discussion_r130450219",
      "id" : 130450219,
      "original_commit_id" : "3c0377db483c50c5a9aecfc4684d6329951a1c7c",
      "original_position" : 52,
      "path" : "doc/file-partition.md",
      "position" : 52,
      "pull_request_review_id" : 53327684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10922",
      "updated_at" : "2017-07-31T20:17:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/130450219",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
