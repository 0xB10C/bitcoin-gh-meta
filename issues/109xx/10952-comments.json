[
   {
      "body" : "So you still need to write a default key unless we're going to bump the wallet version again for this, because otherwise you'll make it backwards incompatible with software without this patch.\r\n\r\nOtherwise, Concept ACK!",
      "created_at" : "2017-07-29T21:37:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-318861268",
      "id" : 318861268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-07-29T21:37:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318861268",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "How about bump the wallet version again? If there are any other wallet changes that need a version bump, we could do them all at the same time.",
      "created_at" : "2017-07-29T21:56:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-318862222",
      "id" : 318862222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-07-29T21:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318862222",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "I would be fine with that but I think it might be easier to get this bugfix merged without it.",
      "created_at" : "2017-07-30T00:41:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-318869295",
      "id" : 318869295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-07-30T00:41:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318869295",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Sounds like maybe something that we should look into for 15, then, though I'd really like to look into the source of the corruption here, rather than patching over it.",
      "created_at" : "2017-07-30T14:36:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-318905869",
      "id" : 318905869,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-07-30T14:36:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318905869",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@gmaxwell I added `WriteDefaultKey` back in so that a default key will be written to maintain backwards compatibility. The key will not be read in.",
      "created_at" : "2017-07-31T18:18:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-319152439",
      "id" : 319152439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-07-31T18:18:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/319152439",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "I really dont think this is the right way to fix this issue. Can we instead ensure that, if the wallet has keys but vchDefaultKey is invalid, an error is printed like \"your wallet is corrupted, seems you disk is silently corrupting things\", and then make sure -salvagewallet is able to properly recover from this state?",
      "created_at" : "2017-08-03T16:15:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320017634",
      "id" : 320017634,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-03T16:15:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320017634",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I have updated this with a few changes.\r\n\r\nI removed the defaultkey writing again. New wallets will no longer have a default key. If a defaultkey is found in the wallet, it must be valid, otherwise it will exit with a wallet corruption error.\r\n\r\nIt turns out that `-salvagewallet` may have been the cause of all of these issues. `-salvagewallet` apparently does not write a default key to the wallet, which with an encrypted wallet and with HD enabled, will cause the aforementioned runtime exception and crash. If a user does have a corrupted default key, then `-salvagewallet` will remove it, as it did in the past.",
      "created_at" : "2017-08-03T23:44:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320118820",
      "id" : 320118820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-03T23:44:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320118820",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131300813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131300813"
         }
      },
      "body" : "Can you call `walletInstance->TopUpKeyPool();` here instead of this entire section? No need to waste a key and an address book entry for this.",
      "commit_id" : "31577609cf5c3c24d383166aa698aa1242d7d1e8",
      "created_at" : "2017-08-04T02:30:17Z",
      "diff_hunk" : "@@ -3958,11 +3947,13 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n             if (!walletInstance->SetHDMasterKey(masterPubKey))\n                 throw std::runtime_error(std::string(__func__) + \": Storing master key failed\");\n         }\n-        CPubKey newDefaultKey;\n-        if (walletInstance->GetKeyFromPool(newDefaultKey, false)) {\n-            walletInstance->SetDefaultKey(newDefaultKey);\n-            if (!walletInstance->SetAddressBook(walletInstance->vchDefaultKey.GetID(), \"\", \"receive\")) {\n-                InitError(_(\"Cannot write default address\") += \"\\n\");\n+\n+        // Generate an address for the address book and to fill the keypool\n+        CPubKey key;\n+        if (walletInstance->GetKeyFromPool(key, false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131300813",
      "id" : 131300813,
      "original_commit_id" : "8f3ea174a717cfea2bfd3abcd12b63651cb74c4a",
      "original_position" : 60,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 54268014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952",
      "updated_at" : "2017-08-04T06:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131300813",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131301391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131301391"
         }
      },
      "body" : "\"defaultkey\" is not part of `IsKeyType`, so this failure will just be a non-critical warning upon loading. I assume that's intentional?",
      "commit_id" : "31577609cf5c3c24d383166aa698aa1242d7d1e8",
      "created_at" : "2017-08-04T02:36:50Z",
      "diff_hunk" : "@@ -452,7 +447,13 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         }\n         else if (strType == \"defaultkey\")\n         {\n-            ssValue >> pwallet->vchDefaultKey;\n+            CPubKey vchPubKey;\n+            ssKey >> vchPubKey;\n+            if (!vchPubKey.IsValid())\n+            {\n+                strErr = \"Error reading wallet database: Default Key corrupt\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131301391",
      "id" : 131301391,
      "original_commit_id" : "8f3ea174a717cfea2bfd3abcd12b63651cb74c4a",
      "original_position" : 21,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 54268014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952",
      "updated_at" : "2017-08-04T06:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131301391",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131301415"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131301415"
         }
      },
      "body" : "Code style nit: `{` on the same like as `if`.",
      "commit_id" : "31577609cf5c3c24d383166aa698aa1242d7d1e8",
      "created_at" : "2017-08-04T02:37:09Z",
      "diff_hunk" : "@@ -452,7 +447,13 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         }\n         else if (strType == \"defaultkey\")\n         {\n-            ssValue >> pwallet->vchDefaultKey;\n+            CPubKey vchPubKey;\n+            ssKey >> vchPubKey;\n+            if (!vchPubKey.IsValid())\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131301415",
      "id" : 131301415,
      "original_commit_id" : "8f3ea174a717cfea2bfd3abcd12b63651cb74c4a",
      "original_position" : 20,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 54268014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952",
      "updated_at" : "2017-08-04T06:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131301415",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131305282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131305282"
         }
      },
      "body" : "Done",
      "commit_id" : "31577609cf5c3c24d383166aa698aa1242d7d1e8",
      "created_at" : "2017-08-04T03:27:01Z",
      "diff_hunk" : "@@ -3958,11 +3947,13 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n             if (!walletInstance->SetHDMasterKey(masterPubKey))\n                 throw std::runtime_error(std::string(__func__) + \": Storing master key failed\");\n         }\n-        CPubKey newDefaultKey;\n-        if (walletInstance->GetKeyFromPool(newDefaultKey, false)) {\n-            walletInstance->SetDefaultKey(newDefaultKey);\n-            if (!walletInstance->SetAddressBook(walletInstance->vchDefaultKey.GetID(), \"\", \"receive\")) {\n-                InitError(_(\"Cannot write default address\") += \"\\n\");\n+\n+        // Generate an address for the address book and to fill the keypool\n+        CPubKey key;\n+        if (walletInstance->GetKeyFromPool(key, false)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131305282",
      "id" : 131305282,
      "original_commit_id" : "8f3ea174a717cfea2bfd3abcd12b63651cb74c4a",
      "original_position" : 60,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 54272914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952",
      "updated_at" : "2017-08-04T06:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131305282",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131305293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131305293"
         }
      },
      "body" : "Done",
      "commit_id" : "31577609cf5c3c24d383166aa698aa1242d7d1e8",
      "created_at" : "2017-08-04T03:27:07Z",
      "diff_hunk" : "@@ -452,7 +447,13 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         }\n         else if (strType == \"defaultkey\")\n         {\n-            ssValue >> pwallet->vchDefaultKey;\n+            CPubKey vchPubKey;\n+            ssKey >> vchPubKey;\n+            if (!vchPubKey.IsValid())\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131305293",
      "id" : 131305293,
      "original_commit_id" : "8f3ea174a717cfea2bfd3abcd12b63651cb74c4a",
      "original_position" : 20,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 54272923,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952",
      "updated_at" : "2017-08-04T06:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131305293",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131305419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131305419"
         }
      },
      "body" : "It should be a critical warning and exit with an error. I have fixed this.",
      "commit_id" : "31577609cf5c3c24d383166aa698aa1242d7d1e8",
      "created_at" : "2017-08-04T03:28:59Z",
      "diff_hunk" : "@@ -452,7 +447,13 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         }\n         else if (strType == \"defaultkey\")\n         {\n-            ssValue >> pwallet->vchDefaultKey;\n+            CPubKey vchPubKey;\n+            ssKey >> vchPubKey;\n+            if (!vchPubKey.IsValid())\n+            {\n+                strErr = \"Error reading wallet database: Default Key corrupt\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131305419",
      "id" : 131305419,
      "original_commit_id" : "8f3ea174a717cfea2bfd3abcd12b63651cb74c4a",
      "original_position" : 21,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 54273057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952",
      "updated_at" : "2017-08-04T06:43:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131305419",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "AssertionError in wallet-hd:\r\n\r\n```py\r\nAssertionError: not(m/0'/0'/0' == m/0'/0'/1')",
      "created_at" : "2017-08-04T06:17:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320166041",
      "id" : 320166041,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-04T06:17:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320166041",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Can this be tagged for 0.15.0? It's a bug fix for a problem with `-salvagewallet` which would result in further corruption and unusability of people's wallets.",
      "created_at" : "2017-08-04T23:42:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320375371",
      "id" : 320375371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-04T23:42:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320375371",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "Tagged for 0.15, as it fixes a bug when using `-savagewallet` with encrypted wallets.",
      "created_at" : "2017-08-05T02:26:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320389495",
      "id" : 320389495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-05T02:26:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320389495",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Because one of the two cases of corruption in the wild was that the default key was simply deleted, can you also add a if(wallet version < x && !have_default_key)... in the load?\n\nOn August 4, 2017 2:17:43 AM EDT, MarcoFalke <notifications@github.com> wrote:\n>AssertionError in wallet-hd:\n>\n>```py\n>AssertionError: not(m/0'/0'/0' == m/0'/0'/1')\n>\n>-- \n>You are receiving this because you commented.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320166041\n",
      "created_at" : "2017-08-06T20:56:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320532162",
      "id" : 320532162,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-06T20:56:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320532162",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt What for?",
      "created_at" : "2017-08-07T00:18:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320542271",
      "id" : 320542271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T00:18:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320542271",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "@achow101 because its a trivial check and its a type of corruption we've seen in wallets on the wild...it costs nothing to add a check for it.",
      "created_at" : "2017-08-07T01:09:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320545613",
      "id" : 320545613,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T01:09:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320545613",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt The current code requires that if a default key is present, it must be valid. Do you think an extra check is needed to verify that it hasn't been accidentally deleted?",
      "created_at" : "2017-08-07T01:16:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320546207",
      "id" : 320546207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T01:16:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320546207",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Considering that we've seen it in the wild and its clear indication that\nthere is something wrong with your hardware/wallet storage, I'd say it\nwould be prudent.\n\nOn 08/06/17 21:16, Pieter Wuille wrote:\n> @TheBlueMatt <https://github.com/thebluematt> The current code requires\n> that if a default key is present, it must be valid. Do you think an\n> extra check is needed to verify that it hasn't been accidentally deleted?\n> \n> Ã¢ÂÂ\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320546207>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAnoHoggbwbRS_yma0eQ6gmvVwaxu4YJks5sVmV0gaJpZM4OnMtA>.\n> \n",
      "created_at" : "2017-08-07T01:20:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320546526",
      "id" : 320546526,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T01:20:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320546526",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt I meant what do you want it to check for and error on and why do that check? That below a certain version number you must have a valid default key? If that is the case, that isn't possible since this PR does not change the version number, thus all wallets will have to have a valid default key.\r\n\r\nFurthermore, I believe the corruption that we are seeing in the wild is a result of `-savagewallet` not passing the default key through to the new wallet file, not because of hardware corruption or the like.",
      "created_at" : "2017-08-07T01:36:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320548013",
      "id" : 320548013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T01:37:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320548013",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "Ahh, OK, I missed the salvagewallet-possible-culprit. PR looks good\nas-is to me.\n\nOn 08/06/17 21:36, Andrew Chow wrote:\n> @TheBlueMatt <https://github.com/thebluematt> I meant what do you want\n> it to check for and error on? That below a certain version number you\n> must have a valid default key? If that is the case, that isn't possible\n> since this PR does not change the version number, thus all wallets will\n> have to have a valid default key.\n> \n> Furthermore, I believe the corruption that we are seeing in the wild is\n> a result of |-savagewallet| not passing the default key through to the\n> new wallet file, not because of hardware corruption or the like.\n> \n> Ã¢ÂÂ\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320548013>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAnoHh7moN-GrfZywt97DqoUu2eT-Mc6ks5sVmoVgaJpZM4OnMtA>.\n> \n",
      "created_at" : "2017-08-07T01:44:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320548896",
      "id" : 320548896,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T01:44:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320548896",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Nit: please also remove the `\"defaultkey\"` parsing in `walletdb.cpp` `ReadKeyValue`\r\n\r\nutACK otherwise",
      "created_at" : "2017-08-07T08:20:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320600282",
      "id" : 320600282,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T08:20:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320600282",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj That was left in due address @TheBlueMatt's concerns about warning users about possible corruption. It was modified so that the default key must either exist and be valid or not exist at all. The reason for this is that if it exists and is not valid, then corruption has occurred and the user will be warned accordingly. ",
      "created_at" : "2017-08-07T08:40:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320604893",
      "id" : 320604893,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T08:40:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320604893",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "body" : "That's true, could have used a comment, it now looks a bit silly just throwing away the result. But I agree.",
      "created_at" : "2017-08-07T08:42:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320605366",
      "id" : 320605366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T08:42:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320605366",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I tested this with an old wallet and got \"Error: Error loading wallet.dat: Wallet corrupted\", will check why.",
      "created_at" : "2017-08-07T10:40:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#issuecomment-320630763",
      "id" : 320630763,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10952",
      "updated_at" : "2017-08-07T10:40:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/320630763",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131637416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131637416"
         }
      },
      "body" : "This should be `ssValue >> vchPubKey`. Otherwise this will fail for every wallet with a default key record!\r\n(when you change this, please add a comment too why we're parsing here and throwing away the result)",
      "commit_id" : "31577609cf5c3c24d383166aa698aa1242d7d1e8",
      "created_at" : "2017-08-07T12:06:05Z",
      "diff_hunk" : "@@ -452,7 +447,12 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n         }\n         else if (strType == \"defaultkey\")\n         {\n-            ssValue >> pwallet->vchDefaultKey;\n+            CPubKey vchPubKey;\n+            ssKey >> vchPubKey;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10952#discussion_r131637416",
      "id" : 131637416,
      "original_commit_id" : "31577609cf5c3c24d383166aa698aa1242d7d1e8",
      "original_position" : 18,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 18,
      "pull_request_review_id" : 54635214,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10952",
      "updated_at" : "2017-08-07T12:07:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/131637416",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
