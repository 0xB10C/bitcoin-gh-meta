[
   {
      "body" : "Strong Concept ACK\r\n\r\nHowever I don't think this should be built on the 0.14 branch but directly on 0.14.2\r\nI don't think we want any of the other backports.\r\nIf we merge this, there will be no time for significant testing and we want the decision on whether to run this or keep running 0.14.2 to be based solely on a user's opinion on whether BIP91 represents the new consensus rules.\r\n\r\nI'd advocate for releasing this as perhaps 0.14.2-segsignal or something else outside of the usual version numbering scheme.\r\n\r\nIn future versions, I think we should be able to drop all this transient BIP91 nonsense.\r\nThis code/patch is hopefully only necessary to protect users for the next 3 weeks until BIP 141 (segwit) activates.\r\n",
      "created_at" : "2017-07-21T23:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10900#issuecomment-317135145",
      "id" : 317135145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10900",
      "updated_at" : "2017-07-21T23:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317135145",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@morcos I have rebased it so that it is just a patch on top of 0.14.2. Of course that means that a separate branch based on 0.14.2 will need to be made for this to be merged and released as a 0.14.2 change.",
      "created_at" : "2017-07-21T23:59:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10900#issuecomment-317137795",
      "id" : 317137795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10900",
      "updated_at" : "2017-07-22T00:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317137795",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10900#discussion_r128885088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128885088"
         }
      },
      "body" : "Not sure if this is a test case we necessarily care about, but maybe generate another 143 blocks and check that a non-segwit-signaling block is still accepted?",
      "commit_id" : "b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
      "created_at" : "2017-07-22T01:11:05Z",
      "diff_hunk" : "@@ -0,0 +1,68 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.test_framework import ComparisonTestFramework\n+from test_framework.util import *\n+from test_framework.blocktools import create_coinbase, create_block\n+\n+class SegsignalUASFTest(ComparisonTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        self.tip = int(\"0x\" + self.nodes[0].getbestblockhash(), 0)\n+        self.height = 1  # height of the next block to build\n+        self.last_block_time = int(time.time())\n+\n+        # Mine 1439 non segwit blocks\n+        self.generate_blocks(1439, 0x20000000)\n+\n+        # Check that segwit is still started\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'started')\n+\n+        # Mine a non-segwit block. this should be rejected\n+        self.generate_blocks(1, 0x20000000, 'bad-no-segwit')\n+\n+        # Now mine a segwit block. this should not be rejected\n+        self.generate_blocks(1, 0x20000002)\n+\n+        # Mine another non-segwit block, this should be rejected\n+        self.generate_blocks(1, 0x20000000, 'bad-no-segwit')\n+\n+        # Mine 143 more blocks. should still be started\n+        print(self.nodes[0].getblockchaininfo())\n+        self.generate_blocks(142, 0x20000002)\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'started')\n+\n+        # Mine 1 more block, should now be locked in\n+        self.generate_blocks(1, 0x20000002)\n+        print(self.nodes[0].getblockchaininfo())\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'locked_in')\n+\n+        # Mine a non-segwit block, should be accepted\n+        self.generate_blocks(1, 0x20000000)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10900#discussion_r128885088",
      "id" : 128885088,
      "original_commit_id" : "b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
      "original_position" : 48,
      "path" : "qa/rpc-tests/segsignal.py",
      "position" : 48,
      "pull_request_review_id" : 51611340,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10900",
      "updated_at" : "2017-07-22T01:37:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128885088",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/524761?v=4",
         "events_url" : "https://api.github.com/users/jimmysong/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimmysong/followers",
         "following_url" : "https://api.github.com/users/jimmysong/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimmysong/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimmysong",
         "id" : 524761,
         "login" : "jimmysong",
         "organizations_url" : "https://api.github.com/users/jimmysong/orgs",
         "received_events_url" : "https://api.github.com/users/jimmysong/received_events",
         "repos_url" : "https://api.github.com/users/jimmysong/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimmysong/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimmysong"
      }
   },
   {
      "body" : "utAck - yes please, merge BIP148 into core! Ã°ÂÂÂ Ã°ÂÂÂ ",
      "created_at" : "2017-07-22T01:53:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10900#issuecomment-317146111",
      "id" : 317146111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10900",
      "updated_at" : "2017-07-22T01:53:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317146111",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10075?v=4",
         "events_url" : "https://api.github.com/users/lichtamberg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/lichtamberg/followers",
         "following_url" : "https://api.github.com/users/lichtamberg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/lichtamberg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/lichtamberg",
         "id" : 10075,
         "login" : "lichtamberg",
         "organizations_url" : "https://api.github.com/users/lichtamberg/orgs",
         "received_events_url" : "https://api.github.com/users/lichtamberg/received_events",
         "repos_url" : "https://api.github.com/users/lichtamberg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/lichtamberg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/lichtamberg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/lichtamberg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10900#discussion_r128886673"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128886673"
         }
      },
      "body" : "I don't think that test case matters as it is already covered by this one here.",
      "commit_id" : "b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
      "created_at" : "2017-07-22T02:10:24Z",
      "diff_hunk" : "@@ -0,0 +1,68 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.test_framework import ComparisonTestFramework\n+from test_framework.util import *\n+from test_framework.blocktools import create_coinbase, create_block\n+\n+class SegsignalUASFTest(ComparisonTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        self.tip = int(\"0x\" + self.nodes[0].getbestblockhash(), 0)\n+        self.height = 1  # height of the next block to build\n+        self.last_block_time = int(time.time())\n+\n+        # Mine 1439 non segwit blocks\n+        self.generate_blocks(1439, 0x20000000)\n+\n+        # Check that segwit is still started\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'started')\n+\n+        # Mine a non-segwit block. this should be rejected\n+        self.generate_blocks(1, 0x20000000, 'bad-no-segwit')\n+\n+        # Now mine a segwit block. this should not be rejected\n+        self.generate_blocks(1, 0x20000002)\n+\n+        # Mine another non-segwit block, this should be rejected\n+        self.generate_blocks(1, 0x20000000, 'bad-no-segwit')\n+\n+        # Mine 143 more blocks. should still be started\n+        print(self.nodes[0].getblockchaininfo())\n+        self.generate_blocks(142, 0x20000002)\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'started')\n+\n+        # Mine 1 more block, should now be locked in\n+        self.generate_blocks(1, 0x20000002)\n+        print(self.nodes[0].getblockchaininfo())\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'locked_in')\n+\n+        # Mine a non-segwit block, should be accepted\n+        self.generate_blocks(1, 0x20000000)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10900#discussion_r128886673",
      "id" : 128886673,
      "original_commit_id" : "b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
      "original_position" : 48,
      "path" : "qa/rpc-tests/segsignal.py",
      "position" : 48,
      "pull_request_review_id" : 51612773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10900",
      "updated_at" : "2017-07-22T02:10:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128886673",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10900#discussion_r128886731"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128886731"
         }
      },
      "body" : "nit: whitespace before last param",
      "commit_id" : "b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
      "created_at" : "2017-07-22T02:13:02Z",
      "diff_hunk" : "@@ -1851,6 +1851,17 @@ bool ConnectBlock(const CBlock& block, CValidationState& state, CBlockIndex* pin\n         flags |= SCRIPT_VERIFY_NULLDUMMY;\n     }\n \n+    // SEGSIGNAL mandatory segwit signalling.\n+    if (pindex->nHeight >= chainparams.GetConsensus().BIP91Height &&\n+        VersionBitsState(pindex->pprev, chainparams.GetConsensus(), Consensus::DEPLOYMENT_SEGWIT,    versionbitscache) == THRESHOLD_STARTED)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10900#discussion_r128886731",
      "id" : 128886731,
      "original_commit_id" : "b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
      "original_position" : 6,
      "path" : "src/validation.cpp",
      "position" : 6,
      "pull_request_review_id" : 51612834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10900",
      "updated_at" : "2017-07-22T02:13:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128886731",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10900#discussion_r128886769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10900"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128886769"
         }
      },
      "body" : "Wouldn't the bip9 status be \"active\"? Just suggesting you check behavior in that last state for completeness.",
      "commit_id" : "b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
      "created_at" : "2017-07-22T02:14:57Z",
      "diff_hunk" : "@@ -0,0 +1,68 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.test_framework import ComparisonTestFramework\n+from test_framework.util import *\n+from test_framework.blocktools import create_coinbase, create_block\n+\n+class SegsignalUASFTest(ComparisonTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def run_test(self):\n+        self.tip = int(\"0x\" + self.nodes[0].getbestblockhash(), 0)\n+        self.height = 1  # height of the next block to build\n+        self.last_block_time = int(time.time())\n+\n+        # Mine 1439 non segwit blocks\n+        self.generate_blocks(1439, 0x20000000)\n+\n+        # Check that segwit is still started\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'started')\n+\n+        # Mine a non-segwit block. this should be rejected\n+        self.generate_blocks(1, 0x20000000, 'bad-no-segwit')\n+\n+        # Now mine a segwit block. this should not be rejected\n+        self.generate_blocks(1, 0x20000002)\n+\n+        # Mine another non-segwit block, this should be rejected\n+        self.generate_blocks(1, 0x20000000, 'bad-no-segwit')\n+\n+        # Mine 143 more blocks. should still be started\n+        print(self.nodes[0].getblockchaininfo())\n+        self.generate_blocks(142, 0x20000002)\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'started')\n+\n+        # Mine 1 more block, should now be locked in\n+        self.generate_blocks(1, 0x20000002)\n+        print(self.nodes[0].getblockchaininfo())\n+        assert_equal(self.get_bip9_status('segwit')['status'], 'locked_in')\n+\n+        # Mine a non-segwit block, should be accepted\n+        self.generate_blocks(1, 0x20000000)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10900#discussion_r128886769",
      "id" : 128886769,
      "original_commit_id" : "b6abab653300da5152d9d9cfa5f8582e0b4b85d4",
      "original_position" : 48,
      "path" : "qa/rpc-tests/segsignal.py",
      "position" : 48,
      "pull_request_review_id" : 51612880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10900",
      "updated_at" : "2017-07-22T02:14:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128886769",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/524761?v=4",
         "events_url" : "https://api.github.com/users/jimmysong/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimmysong/followers",
         "following_url" : "https://api.github.com/users/jimmysong/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimmysong/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimmysong",
         "id" : 524761,
         "login" : "jimmysong",
         "organizations_url" : "https://api.github.com/users/jimmysong/orgs",
         "received_events_url" : "https://api.github.com/users/jimmysong/received_events",
         "repos_url" : "https://api.github.com/users/jimmysong/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimmysong/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimmysong"
      }
   },
   {
      "body" : "Concept ACK, agree with @morcos on a new branch for 0.14.2.1 or such (we've used a fourth number for this kind of purpose before). Code looks okay too, but I didn't test (utACK).",
      "created_at" : "2017-07-22T03:22:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10900#issuecomment-317150629",
      "id" : 317150629,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10900",
      "updated_at" : "2017-07-22T03:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317150629",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   }
]
