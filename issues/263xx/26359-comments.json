[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001578644"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001578644"
         }
      },
      "author_association" : "MEMBER",
      "body" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f:\r\n\r\nThere are several unrelated things:\r\n\r\n* If this feeler check isn't dead code here, it should probably be moved to the previous section that initializes the TxRelay struct. (And maybe in a separate pull request, as it would change non-erlay code?) This would mean that the tx relay struct isn't initialized and also m_relays_txs isn't set, which is then checked in this line here.\r\n* Unrelated, I wonder if `RejectIncomingTxs` should be used here. The difference is that the `Relay` permission will be carved out. I don't know the answer, I just wanted to raise the point.",
      "commit_id" : "15962a8eea8cbadb302453ae0960132c1a3cfc4d",
      "created_at" : "2022-10-21T09:30:08Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001578644",
      "id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5847suCU",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1150648334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001578644/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-21T09:30:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001578644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25572](https://github.com/bitcoin/bitcoin/pull/25572) (refactor: Introduce EvictionManager and use it for the inbound eviction logic by dergoegge)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-10-21T10:18:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#issuecomment-1286753334",
      "id" : 1286753334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26359",
      "node_id" : "IC_kwDOABII585Mskw2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286753334/reactions"
      },
      "updated_at" : "2022-10-21T10:18:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286753334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001625212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001625212"
         }
      },
      "author_association" : "MEMBER",
      "body" : "good point, i'll look closer.",
      "commit_id" : "15962a8eea8cbadb302453ae0960132c1a3cfc4d",
      "created_at" : "2022-10-21T10:20:13Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001625212",
      "id" : 1001625212,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5847s5Z8",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1150717088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001625212/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-21T10:20:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001625212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001842102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001842102"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1. From my understanding, this code isn't dead. The feeler check could indeed be moved above. Not sure what's the best way to attack this w.r.t. this PR (surely, a separate PR is the best option, but is that gonna get merged sooner...)\r\n2. Yeah checking for tx relay support is kinda ugly in general. `RejectIncomingTxs` is of course relevant, but not 100% match, if you just look at the name. I'd better keep the code as-is now, and refactor this separately (dunno how yet)",
      "commit_id" : "15962a8eea8cbadb302453ae0960132c1a3cfc4d",
      "created_at" : "2022-10-21T14:14:38Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001842102",
      "id" : 1001842102,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5847tuW2",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1151036674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001842102/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-21T14:14:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001842102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1002071153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002071153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "By the latter I mean that even `RejectIncomingTxs`-ing (whatever that could mean) doesn't necessarily mean we should reject reconciling. Might be useful to reconcile even if we \"should reject\". Not 100% sure (certainly not how Erlay intends to work in the default case).\r\n\r\nAnyway, not changing the code until further consideration.",
      "commit_id" : "15962a8eea8cbadb302453ae0960132c1a3cfc4d",
      "created_at" : "2022-10-21T18:20:16Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1002071153",
      "id" : 1002071153,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5847umRx",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1151382479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002071153/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-21T18:31:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002071153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1004664239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004664239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Not sure what's the best way to attack this w.r.t. this PR \r\n\r\nHappy to work on this, unless you want to",
      "commit_id" : "0ba8bd18bf0473b8a8239954310919e1a33ab671",
      "created_at" : "2022-10-25T15:47:47Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1004664239",
      "id" : 1004664239,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII58474fWv",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1155070256,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004664239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T15:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004664239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1004919267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004919267"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was waiting for another opinion to show up here :)\r\nFeel free to open a separate PR with that stuff, I will ack. Or, if you think it makes more sense here,, then I can just add a commit here, that i can do.",
      "commit_id" : "0ba8bd18bf0473b8a8239954310919e1a33ab671",
      "created_at" : "2022-10-25T20:08:48Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1004919267",
      "id" : 1004919267,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII58475dnj",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1155432194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004919267/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T20:08:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004919267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1005876083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005876083"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Heh, maybe it should be left as-is here. We also send a lot of other messages, such as `GETADDR`, so the `SENDTXRCNCL` message seems to be consistent. Changing the tx-relay allocation could still be done, though. See https://github.com/bitcoin/bitcoin/pull/26396",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-26T15:59:48Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1005876083",
      "id" : 1005876083,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII58479HNz",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1156842842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005876083/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:59:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005876083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007907629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007907629"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit 2269d91d2a `p2p: Drop roles from sendtxrcncl` there is this change:\r\n\r\n```diff\r\n     // Reconciliation version is higher than ours, should be able to register.\r\n     BOOST_REQUIRE(!tracker.IsPeerRegistered(1));\r\n     tracker.PreRegisterPeer(1);\r\n-    BOOST_REQUIRE(tracker.RegisterPeer(1, true, true, false, 2, salt) == ReconciliationRegisterResult::SUCCESS);\r\n+    BOOST_REQUIRE(tracker.RegisterPeer(1, false, 1, salt) == ReconciliationRegisterResult::SUCCESS);\r\n     BOOST_CHECK(tracker.IsPeerRegistered(1));\r\n```\r\n\r\nI think that should be\r\n\r\n```diff\r\n+    BOOST_REQUIRE(tracker.RegisterPeer(1, true, 2, salt) == ReconciliationRegisterResult::SUCCESS);\r\n```\r\n\r\n(it is further modified by subsequent commits and I think that the cumulative diff is ok, but still each commit should make sense on its own)",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T10:22:23Z",
      "diff_hunk" : "@@ -12,71 +12,65 @@ BOOST_FIXTURE_TEST_SUITE(txreconciliation_tests, BasicTestingSetup)\n \n BOOST_AUTO_TEST_CASE(RegisterPeerTest)\n {\n-    TxReconciliationTracker tracker(1);\n+    TxReconciliationTracker tracker(TXRECONCILIATION_VERSION);\n     const uint64_t salt = 0;\n \n     // Prepare a peer for reconciliation.\n     tracker.PreRegisterPeer(0);\n \n-    // Both roles are false, don't register.\n-    BOOST_CHECK(tracker.RegisterPeer(/*peer_id=*/0, /*is_peer_inbound=*/true,\n-                                      /*is_peer_recon_initiator=*/false,\n-                                      /*is_peer_recon_responder=*/false,\n-                                      /*peer_recon_version=*/1, salt) ==\n-                    ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n-\n-    // Invalid roles for the given connection direction.\n-    BOOST_CHECK(tracker.RegisterPeer(0, true, false, true, 1, salt) == ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n-    BOOST_CHECK(tracker.RegisterPeer(0, false, true, false, 1, salt) == ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n-\n     // Invalid version.\n-    BOOST_CHECK(tracker.RegisterPeer(0, true, true, false, 0, salt) == ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n+    BOOST_CHECK_EQUAL(tracker.RegisterPeer(/*peer_id=*/0, /*is_peer_inbound=*/true,\n+                                        /*peer_recon_version=*/0, salt), ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n \n-    // Valid registration.\n+    // Valid registration (inbound and outbound peers).\n     BOOST_REQUIRE(!tracker.IsPeerRegistered(0));\n-    BOOST_REQUIRE(tracker.RegisterPeer(0, true, true, false, 1, salt) == ReconciliationRegisterResult::SUCCESS);\n+    BOOST_REQUIRE_EQUAL(tracker.RegisterPeer(0, true, 1, salt), ReconciliationRegisterResult::SUCCESS);\n     BOOST_CHECK(tracker.IsPeerRegistered(0));\n-\n-    // Reconciliation version is higher than ours, should be able to register.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007907629",
      "id" : 1007907629,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII5848E3Mt",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 40,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/test/txreconciliation_tests.cpp",
      "position" : 34,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007907629/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T11:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007907629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007934092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007934092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit 60a066da70 `p2p: Disconnect peer after sendtxrcncl if we are in blocksonly`\r\n\r\nIt could happen that `m_ignore_incoming_txs` is `true` (thus we disconnect the peer), but we did _not_ indicate no tx relay to that peer as mentioned in the log message. That is - we sent `relay=true` in the `VERSION` message.\r\n\r\nThis could happen if the peer has `NetPermissionFlags::Relay` permission.\r\n\r\nOr the other way around - we may send `relay=false` in the `VERSION` message, but not disconnect the peer here (block-only or feeler connections).\r\n\r\nWould it be better to use `PeerManagerImpl::RejectIncomingTxs()` here instead of `m_ignore_incoming_txs`? The relay flag in the `VERSION` message is set based on it in `PeerManagerImpl::PushNodeVersion()`.",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T10:55:26Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007934092",
      "id" : 1007934092,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848E9qM",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : 3502,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007934092/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3502,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-28T11:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007934092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007948789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948789"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It may also happen that we disconnect the peer because `peer->GetTxRelay()` is not set because the peer did not sent us relay=true in their `VERSION` message and we don't provide bloom filter to them. I think this warrants a separate log message, something like:\r\n\r\n\"sendtxrcncl received from peer=%d that indicated no tx relay; disconnecting\\n\"",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T11:15:10Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007948789",
      "id" : 1007948789,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848FBP1",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948789/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T11:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007948957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948957"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What about peers that send us relay=false in the VERSION message but we provide bloom filters to them. The code in this PR would not disconnect such a peer, but I think it should, right?",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T11:15:24Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007948957",
      "id" : 1007948957,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848FBSd",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948957/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T11:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007975709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007975709"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: the `return` inside the `if` is unnecessary",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T11:46:55Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        bool is_peer_initiator, is_peer_responder;\n-        uint32_t peer_txreconcl_version;\n-        uint64_t remote_salt;\n-        vRecv >> is_peer_initiator >> is_peer_responder >> peer_txreconcl_version >> remote_salt;\n-\n         if (m_txreconciliation->IsPeerRegistered(pfrom.GetId())) {\n-            // A peer is already registered, meaning we already received SENDTXRCNCL from them.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n+        uint32_t peer_txreconcl_version;\n+        uint64_t remote_salt;\n+        vRecv >> peer_txreconcl_version >> remote_salt;\n+\n         const ReconciliationRegisterResult result = m_txreconciliation->RegisterPeer(pfrom.GetId(), pfrom.IsInboundConn(),\n-                                                                                is_peer_initiator, is_peer_responder,\n-                                                                                peer_txreconcl_version,\n-                                                                                remote_salt);\n+                                                                                peer_txreconcl_version, remote_salt);\n \n-        // If it's a protocol violation, disconnect.\n-        // If the peer was not found (but something unexpected happened) or it was registered,\n-        // nothing to be done.\n         if (result == ReconciliationRegisterResult::PROTOCOL_VIOLATION) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n+\n+        if (result == ReconciliationRegisterResult::NOT_FOUND) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"Ignore unexpected txreconciliation signal from peer=%d\\n\", pfrom.GetId());\n+            return;\n+        }\n+\n         return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007975709",
      "id" : 1007975709,
      "line" : 3532,
      "node_id" : "PRRC_kwDOABII5848FH0d",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3532,
      "original_position" : 73,
      "original_start_line" : 3527,
      "path" : "src/net_processing.cpp",
      "position" : 73,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007975709/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3527,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-28T11:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007975709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007983022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007983022"
         }
      },
      "author_association" : "MEMBER",
      "body" : "i thought this improves readability somehow... good to drop.",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T11:56:07Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        bool is_peer_initiator, is_peer_responder;\n-        uint32_t peer_txreconcl_version;\n-        uint64_t remote_salt;\n-        vRecv >> is_peer_initiator >> is_peer_responder >> peer_txreconcl_version >> remote_salt;\n-\n         if (m_txreconciliation->IsPeerRegistered(pfrom.GetId())) {\n-            // A peer is already registered, meaning we already received SENDTXRCNCL from them.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n+        uint32_t peer_txreconcl_version;\n+        uint64_t remote_salt;\n+        vRecv >> peer_txreconcl_version >> remote_salt;\n+\n         const ReconciliationRegisterResult result = m_txreconciliation->RegisterPeer(pfrom.GetId(), pfrom.IsInboundConn(),\n-                                                                                is_peer_initiator, is_peer_responder,\n-                                                                                peer_txreconcl_version,\n-                                                                                remote_salt);\n+                                                                                peer_txreconcl_version, remote_salt);\n \n-        // If it's a protocol violation, disconnect.\n-        // If the peer was not found (but something unexpected happened) or it was registered,\n-        // nothing to be done.\n         if (result == ReconciliationRegisterResult::PROTOCOL_VIOLATION) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n+\n+        if (result == ReconciliationRegisterResult::NOT_FOUND) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"Ignore unexpected txreconciliation signal from peer=%d\\n\", pfrom.GetId());\n+            return;\n+        }\n+\n         return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007983022",
      "id" : 1007983022,
      "in_reply_to_id" : 1007975709,
      "line" : 3532,
      "node_id" : "PRRC_kwDOABII5848FJmu",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3532,
      "original_position" : 73,
      "original_start_line" : 3527,
      "path" : "src/net_processing.cpp",
      "position" : 73,
      "pull_request_review_id" : 1159940931,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007983022/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3527,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-28T11:56:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007983022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007989670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007989670"
         }
      },
      "author_association" : "MEMBER",
      "body" : "These flags are confusing :(\r\nIndeed, having `fRelay=false` I think is not currently compatible with reconciliations.\r\n\r\nSo, instead of `GetTxRelay()`, we better look at `pfrom.m_relays_txs`, right?",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T12:04:12Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007989670",
      "id" : 1007989670,
      "in_reply_to_id" : 1007948957,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848FLOm",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1159951251,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007989670/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T12:04:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007989670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008028799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008028799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> These flags are confusing :(\r\n\r\nYes! :frowning_face:\r\n\r\n> Indeed, having `fRelay=false` I think is not currently compatible with reconciliations.\r\n\r\nI guess you mean the relay flag in the either VERSION message - sent or received, right?\r\n\r\nWhat about clarifying the BIP:\r\n\r\n```diff\r\n-sendtxrcncl ... Must not be sent if peer specified no support for transaction relay (fRelay=0) in \"version\". Otherwise, the sender should be disconnected.\r\n+sendtxrcncl ... Must not be sent if either peer specified no support for transaction relay (fRelay=0) in \"version\". Otherwise, the sender should be disconnected.\r\n```\r\n\r\n> So, instead of `GetTxRelay()`, we better look at `pfrom.m_relays_txs`, right?\r\n\r\nYes, this is closer to checking whether the peer sent us `relay=false` in `VERSION`. However it is not identical - `fRelay` may be `true`, but `pfrom.m_relays_txs` be `false` if `pfrom.IsBlockOnlyConn()`. It is ok to accept this discrepancy because for block-only connections we sent `relay=false` in our `VERSION` message.\r\n\r\nThat said, maybe the condition should be:\r\n\r\n```diff\r\n-if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\r\n+if (!pfrom.m_relays_txs /* they sent relay=false */ ||\r\n+    RejectIncomingTxs(pfrom) /* we sent relay=false */) {\r\n```",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T12:49:25Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008028799",
      "id" : 1008028799,
      "in_reply_to_id" : 1007948957,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848FUx_",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1160010089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008028799/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T12:49:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008028799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008948272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008948272"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you should update `SENDTXRCNCL` , this still mentioning the role assignment based on booleans. I would also suggest to document somewhere, in `protocol.h` or `txreconciliation.cpp`, near to `m_we_initiate` how the role assignment is made. ",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-30T23:52:14Z",
      "diff_hunk" : "@@ -116,24 +115,11 @@ class TxReconciliationTracker::Impl\n         // v1 is the lowest version, so suggesting something below must be a protocol violation.\n         if (recon_version < 1) return PROTOCOL_VIOLATION;\n \n-        // Must match SENDTXRCNCL logic.\n-        const bool they_initiate = is_peer_recon_initiator && is_peer_inbound;\n-        const bool we_initiate = !is_peer_inbound && is_peer_recon_responder;\n-\n-        // If we ever announce support for both requesting and responding, this will need\n-        // tie-breaking. For now, this is mutually exclusive because both are based on the\n-        // inbound flag.\n-        assert(!(they_initiate && we_initiate));\n-\n-        // The peer set both flags to false, we treat it as a protocol violation.\n-        if (!(they_initiate || we_initiate)) return PROTOCOL_VIOLATION;\n-\n-        LogPrintLevel(BCLog::TXRECONCILIATION, BCLog::Level::Debug, \"Register peer=%d with the following params: \" /* Continued */\n-                                                                    \"we_initiate=%i, they_initiate=%i.\\n\",\n-                      peer_id, we_initiate, they_initiate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008948272",
      "id" : 1008948272,
      "line" : 133,
      "node_id" : "PRRC_kwDOABII5848I1Qw",
      "original_commit_id" : "2269d91d2a5653116e0b2a4937d1c2e85413e92f",
      "original_line" : 133,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/node/txreconciliation.cpp",
      "position" : 28,
      "pull_request_review_id" : 1161214019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008948272/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-30T23:59:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008948272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008949154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008949154"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What about `IsAddrFetchConn()` ? I think we should restrain ourselves to send `ConnectionType::ADDR_FETCH`. ",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-30T23:57:34Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008949154",
      "id" : 1008949154,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5848I1ei",
      "original_commit_id" : "d2b402ca64375e65d15fb6d9ee871012f6eeb68b",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1161214019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008949154/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-30T23:59:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008949154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1009134521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009134521"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I decided to keep it unless there are strong objections.",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-31T08:16:20Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        bool is_peer_initiator, is_peer_responder;\n-        uint32_t peer_txreconcl_version;\n-        uint64_t remote_salt;\n-        vRecv >> is_peer_initiator >> is_peer_responder >> peer_txreconcl_version >> remote_salt;\n-\n         if (m_txreconciliation->IsPeerRegistered(pfrom.GetId())) {\n-            // A peer is already registered, meaning we already received SENDTXRCNCL from them.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n+        uint32_t peer_txreconcl_version;\n+        uint64_t remote_salt;\n+        vRecv >> peer_txreconcl_version >> remote_salt;\n+\n         const ReconciliationRegisterResult result = m_txreconciliation->RegisterPeer(pfrom.GetId(), pfrom.IsInboundConn(),\n-                                                                                is_peer_initiator, is_peer_responder,\n-                                                                                peer_txreconcl_version,\n-                                                                                remote_salt);\n+                                                                                peer_txreconcl_version, remote_salt);\n \n-        // If it's a protocol violation, disconnect.\n-        // If the peer was not found (but something unexpected happened) or it was registered,\n-        // nothing to be done.\n         if (result == ReconciliationRegisterResult::PROTOCOL_VIOLATION) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n+\n+        if (result == ReconciliationRegisterResult::NOT_FOUND) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"Ignore unexpected txreconciliation signal from peer=%d\\n\", pfrom.GetId());\n+            return;\n+        }\n+\n         return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1009134521",
      "id" : 1009134521,
      "in_reply_to_id" : 1007975709,
      "line" : 3532,
      "node_id" : "PRRC_kwDOABII5848Jiu5",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3532,
      "original_position" : 73,
      "original_start_line" : 3527,
      "path" : "src/net_processing.cpp",
      "position" : 73,
      "pull_request_review_id" : 1161474759,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009134521/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3527,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-31T08:16:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009134521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1009168380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009168380"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Similarly to #26396, i think this should be fixed above (`m_relays_tx`), and done in a separate PR :)\r\nLet's hope Marco updates that one for now.",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-31T08:57:27Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1009168380",
      "id" : 1009168380,
      "in_reply_to_id" : 1008949154,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5848Jq_8",
      "original_commit_id" : "d2b402ca64375e65d15fb6d9ee871012f6eeb68b",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1161522905,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009168380/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-31T08:57:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009168380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   }
]
