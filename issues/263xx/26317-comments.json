[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Interesting bug but I could not reproduce. Would be helpful if there was some research and steps to reproduce.\r\n\r\nNot sure RBF does it because I tried with custom change address as well. Zap config doesn't exist anymore. ",
      "created_at" : "2022-10-15T15:43:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26317#issuecomment-1279769830",
      "id" : 1279769830,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26317",
      "node_id" : "IC_kwDOABII585MR7zm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279769830/reactions"
      },
      "updated_at" : "2022-10-15T15:43:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279769830",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've been using the same wallet since 2011 so it's really hard to know when this happened.\r\n\r\nI don't see anything in the code that ever clears the 'used' key once it is set on an address.\r\n\r\nI was thinking that bumping the fee using RBF might occasionally drop one input for a bigger input when necessary but I see from the code that that doesn't happen:\r\n\r\n`wallet/feebumper.cpp`:\r\n\r\n    // Fill in required inputs we are double-spending(all of them)\r\n    // N.B.: bip125 doesn't require all the inputs in the replaced transaction to be\r\n    // used in the replacement transaction, but it's very important for wallets to make\r\n    // sure that happens.\r\n\r\nSo I don't know. It could well be that this happened long ago due to a bug that has already been fixed. I'm just going to spend the missing UTXO back to a new address using a raw transaction and forget about it but thought it might be useful to mention here that it happened to me.",
      "created_at" : "2022-10-15T21:00:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26317#issuecomment-1279831264",
      "id" : 1279831264,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26317",
      "node_id" : "IC_kwDOABII585MSKzg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279831264/reactions"
      },
      "updated_at" : "2022-10-17T16:09:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279831264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=4",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "node_id" : "MDQ6VXNlcjU3MzM1Ng==",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Only 3 devs can help you if RBF is involved because we cannot select inputs in core wallet afaik: @achow101 @Xekyo @luke-jr ",
      "created_at" : "2022-10-15T21:16:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26317#issuecomment-1279833874",
      "id" : 1279833874,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26317",
      "node_id" : "IC_kwDOABII585MSLcS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279833874/reactions"
      },
      "updated_at" : "2022-10-15T21:18:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279833874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think you misunderstand me. I'm not looking for help. I am reporting an issue. It is apparently rare and I can work around it by spending the hidden UTXO using the raw transaction RPCs.",
      "created_at" : "2022-10-16T11:24:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26317#issuecomment-1279949726",
      "id" : 1279949726,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26317",
      "node_id" : "IC_kwDOABII585MSnue",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279949726/reactions"
      },
      "updated_at" : "2022-10-16T11:24:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279949726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=4",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "node_id" : "MDQ6VXNlcjU3MzM1Ng==",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@dooglus how did you sum your unspent outputs, using `listunspent` rpc or some other way? I would be curious to learn that `listunspent` did not match `getbalance` for the wallet, as this is not something that I can see an obvious codepath for...\r\n\r\nI did manage to re-create \"losing\" UTXOs from a wallet. Setting the `walletbroadcast=0` flag on bitcoind and then making a transaction will result in tx hex beign returned, and the coins marked as \"used\". If the user does not save the transaction and broadcast it manually, the wallet will still [consider the UTXO spen](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/wallet.cpp#L2222-L2225)t and require a reindex (or for a descriptor wallet can use `scantxoutset`). But this does not in my testing result in `listunspent` and `getbalance` getting out of sync, e.g. see this rudimentary [test](https://gist.github.com/willcl-ark/5a9cc5cc5a8744bd85537d34ef86eb72).\r\n\r\nWe can also see in the Miniwallet [source](https://github.com/bitcoin/bitcoin/blob/v24.0rc2/test/functional/test_framework/wallet.py#L164-L169) that it is somewhat (obscurely?) known that transactions might get \"lost\" if the transaction was RBFed after a re-org.",
      "created_at" : "2022-10-18T08:19:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26317#issuecomment-1281994997",
      "id" : 1281994997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26317",
      "node_id" : "IC_kwDOABII585MabD1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1281994997/reactions"
      },
      "updated_at" : "2022-10-18T08:19:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1281994997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I summed the outputs listed by the `listunspent` RPC, yes. If I sum just the ones with `\"reused\": false`, I get the same total as `getbalance` shows. And if I include the ones with `\"reused\": true` then I get the full balance.\r\n\r\nI don't remember whether I ever manually enabled the \"avoid reuse\" flag on my wallet, or it is it on by default, but maybe you don't have it on, and I do? Check this code in `src/wallet/rpc/util.cpp`:\r\n\r\n    bool GetAvoidReuseFlag(const CWallet& wallet, const UniValue& param) {\r\n\r\nDo your \"lost\" UTXOs show up with `\"reused\": true` in the `listunspent` output?",
      "created_at" : "2022-10-18T19:54:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/26317#issuecomment-1282928644",
      "id" : 1282928644,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26317",
      "node_id" : "IC_kwDOABII585Md_AE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1282928644/reactions"
      },
      "updated_at" : "2022-10-18T19:54:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1282928644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=4",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "node_id" : "MDQ6VXNlcjU3MzM1Ng==",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   }
]
