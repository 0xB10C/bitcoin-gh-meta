[
   {
      "author_association" : "MEMBER",
      "body" : "I'm wondering whether the `accurate` mode should be enabled by default. If an application or a user uses the `scanblocks` RPC, they'll need to filter out false positives anyway, so maybe Bitcoin Core should do it?\r\n\r\nAlso, is there a way to reproduce false positives? It would be nice to add a test but I haven't figured out how?",
      "created_at" : "2022-10-17T14:57:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1281001827",
      "id" : 1281001827,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585MWolj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1281001827/reactions"
      },
      "updated_at" : "2022-10-18T14:14:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1281001827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r997670551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997670551"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldn't it be optional ?",
      "commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "created_at" : "2022-10-18T02:56:40Z",
      "diff_hunk" : "@@ -2244,7 +2276,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"accurate\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Enable accurate mode (requires -txindex). Inaccurate mode may result in false positives but is faster.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r997670551",
      "id" : 997670551,
      "line" : 2280,
      "node_id" : "PRRC_kwDOABII5847dz6X",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 2280,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 58,
      "pull_request_review_id" : 1145024484,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997670551/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T02:59:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997670551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r997855026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997855026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is optional.",
      "commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "created_at" : "2022-10-18T07:58:06Z",
      "diff_hunk" : "@@ -2244,7 +2276,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"accurate\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Enable accurate mode (requires -txindex). Inaccurate mode may result in false positives but is faster.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r997855026",
      "id" : 997855026,
      "in_reply_to_id" : 997670551,
      "line" : 2280,
      "node_id" : "PRRC_kwDOABII5847eg8y",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 2280,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 58,
      "pull_request_review_id" : 1145280677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997855026/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T07:58:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997855026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998217009"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998217009"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can't you read the scriptpubkey from the undo data?",
      "commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "created_at" : "2022-10-18T13:24:02Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998217009",
      "id" : 998217009,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII5847f5Ux",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 4,
      "pull_request_review_id" : 1145814329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998217009/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T13:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998217009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998268335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998268335"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Isn't undo data only kept for recent blocks in the case of reorgs? Didn't check but I can hardly imagine that we store every scriptPubKey of a spent output twice forever.",
      "commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "created_at" : "2022-10-18T13:55:27Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998268335",
      "id" : 998268335,
      "in_reply_to_id" : 998217009,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII5847gF2v",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 4,
      "pull_request_review_id" : 1145875594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998268335/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T13:55:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998268335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998281609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998281609"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I didn't know about undo data, I pushed a version using it instead of `txindex`. Can revert if undo data is not reliable :/\r\nEDIT: I looked it up and undo data doesn't seem to ever be pruned so I think this is safe?",
      "commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "created_at" : "2022-10-18T14:05:31Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998281609",
      "id" : 998281609,
      "in_reply_to_id" : 998217009,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847gJGJ",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1145895523,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998281609/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T14:09:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998281609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998310945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998310945"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems my suspicion was wrong and we indeed keep undo data forever on a non-pruned node. Sorry for confusing!",
      "commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "created_at" : "2022-10-18T14:27:36Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998310945",
      "id" : 998310945,
      "in_reply_to_id" : 998217009,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847gQQh",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1145938952,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998310945/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T14:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998310945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998385576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998385576"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: spacing\r\n```suggestion\r\n    if (!UndoReadFromDisk(block_undo, pindex)) {\r\n```",
      "commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "created_at" : "2022-10-18T15:20:02Z",
      "diff_hunk" : "@@ -2234,6 +2235,39 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(const CBlockIndex* pindex, const GCSFilter::ElementSet& needles, const CChainParams& chainparams)\n+{\n+    CBlock block;\n+    if (!ReadBlockFromDisk(block, pindex, chainparams.GetConsensus())) {\n+        return false;\n+    }\n+\n+    CBlockUndo block_undo;\n+    if(!UndoReadFromDisk(block_undo, pindex)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998385576",
      "id" : 998385576,
      "line" : 2246,
      "node_id" : "PRRC_kwDOABII5847gieo",
      "original_commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "original_line" : 2246,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 20,
      "pull_request_review_id" : 1146047002,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998385576/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T15:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998385576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the tips @theStack.\r\nI tried creating a test as well. I managed to generate false positives using the following test, but it only happens once every few runs. I'll continue to work on it later, but here's my snippet in case you have ideas.\r\n\r\n\r\n<details>\r\n<summary>Test</summary>\r\n\r\n```diff\r\ndiff --git a/test/functional/rpc_scanblocks.py b/test/functional/rpc_scanblocks.py\r\nindex 0ba5f12bd..e7d26a5ef 100755\r\n--- a/test/functional/rpc_scanblocks.py\r\n+++ b/test/functional/rpc_scanblocks.py\r\n@@ -102,6 +102,42 @@ class ScanblocksTest(BitcoinTestFramework):\r\n         # test invalid command\r\n         assert_raises_rpc_error(-8, \"Invalid command\", node.scanblocks, \"foobar\")\r\n \r\n+        # generate block with a lot of random outputs\r\n+        print(\"Generate block with random transactions\")\r\n+        for i in range(500): # should be deterministic and give false positives\r\n+            _, spk, _ = getnewdestination()\r\n+            wallet.send_to(from_node=self.nodes[1], scriptPubKey=spk, amount=400)\r\n+\r\n+        blockhash = self.generate(self.nodes[1], 1)[0]\r\n+        print(blockhash)\r\n+\r\n+        # scan the block with the ranged descriptor\r\n+        height = node.getblockheader(blockhash)['height']\r\n+        desc = f\"pkh({parent_key}/*)\"\r\n+\r\n+        # begin debug\r\n+        blocks = node.scanblocks(\r\n+            action=\"start\",\r\n+            scanobjects=[{\"desc\": desc, \"range\": [0, 200000]}],\r\n+            start_height=height,\r\n+            accurate=False)['relevant_blocks']\r\n+\r\n+        print(blocks)\r\n+        # end debug\r\n+\r\n+        for v in [False, True]:\r\n+            blocks = node.scanblocks(\r\n+                action=\"start\",\r\n+                scanobjects=[{\"desc\": desc, \"range\": [0, 200000]}],\r\n+                start_height=height,\r\n+                accurate=v)['relevant_blocks']\r\n+\r\n+            if v:\r\n+                assert_equal(len(blocks), 0)\r\n+            else:\r\n+                assert_equal(len(blocks), 1)\r\n+                assert_equal(blocks[0], blockhash)\r\n+\r\n \r\n if __name__ == '__main__':\r\n     ScanblocksTest().main()\r\n```\r\n\r\n</details>\r\n\r\nThe only part that isn't deterministic is:\r\n```python\r\nfor i in range(500): # should be deterministic and give false positives\r\n\t_, spk, _ = getnewdestination()\r\n\twallet.send_to(from_node=self.nodes[1], scriptPubKey=spk, amount=400)\r\n```\r\n\r\nMaybe we could use `i` to generate deterministic scriptPubKeys and hope a certain arrangement always gives false positives? Not sure how reliable this is.",
      "created_at" : "2022-10-18T16:54:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1282704275",
      "id" : 1282704275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585MdIOT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1282704275/reactions"
      },
      "updated_at" : "2022-10-18T16:54:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1282704275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   }
]
