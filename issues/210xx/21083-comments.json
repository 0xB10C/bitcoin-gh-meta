[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21207 (MOVEONLY: CWallet transaction code out of wallet.cpp/.h by ryanofsky)\n* #17526 (Use Single Random Draw In addition to knapsack as coin selection fallback by achow101)\n* #17331 (Use effective values throughout coin selection by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-02-05T07:59:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#issuecomment-773864616",
      "id" : 773864616,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3Mzg2NDYxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T18:07:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/773864616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, was thinking about this as well",
      "created_at" : "2021-02-06T18:08:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#issuecomment-774517656",
      "id" : 774517656,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NDUxNzY1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-06T18:08:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/774517656",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept / light-look-through ACK",
      "created_at" : "2021-02-16T22:02:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#issuecomment-780146178",
      "id" : 780146178,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MDE0NjE3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-16T22:02:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780146178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577986291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577986291"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Use existing feerate instead of getting a new one\" (81b6a6b12b46ee351a293ae4928e815c37f193d3)\r\n\r\nReview note: this assignment is equivalent to previous `GetMinimumFee` assignment because `GetMinimumFeeRate` is always assigned to `nFeeRateNeeded` line 2810, and `nFeeRateNeeded` is always assigned to `coin_selection_params.effective_fee` on line 2896 (thanks to `pick_new_inputs` spaghetti) and because `GetMinimumFee()` is just a wrapper for `GetMinimumFeeRate().GetFee()`",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-02-17T22:21:36Z",
      "diff_hunk" : "@@ -2951,13 +2956,7 @@ bool CWallet::CreateTransactionInternal(\n                     return false;\n                 }\n \n-                nFeeNeeded = GetMinimumFee(*this, nBytes, coin_control, &feeCalc);\n-                if (feeCalc.reason == FeeReason::FALLBACK && !m_allow_fallback_fee) {\n-                    // eventually allow a fallback fee\n-                    error = _(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable -fallbackfee.\");\n-                    return false;\n-                }\n-\n+                nFeeNeeded = coin_selection_params.effective_fee.GetFee(nBytes);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577986291",
      "id" : 577986291,
      "line" : 2958,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk4NjI5MQ==",
      "original_commit_id" : "81b6a6b12b46ee351a293ae4928e815c37f193d3",
      "original_line" : 2958,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 87,
      "pull_request_review_id" : 592680099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577986291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577988119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577988119"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Use existing feerate instead of getting a new one\" (81b6a6b12b46ee351a293ae4928e815c37f193d3)\r\n\r\nIt appears there is a change behavior here. \"Fee estimation failed\" error will now take priority over \"insufficient funds\", \"Signing transaction failed\", and other errors. It would be good to mention this in the commit message or at least say that this isn't a pure refactoring like it might seem to be (could mention the pick new inputs race condition behavior change as well).",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-02-17T22:25:18Z",
      "diff_hunk" : "@@ -2814,6 +2814,11 @@ bool CWallet::CreateTransactionInternal(\n                 error = strprintf(_(\"Fee rate (%s) is lower than the minimum fee rate setting (%s)\"), coin_control.m_feerate->ToString(FeeEstimateMode::SAT_VB), nFeeRateNeeded.ToString(FeeEstimateMode::SAT_VB));\n                 return false;\n             }\n+            if (feeCalc.reason == FeeReason::FALLBACK && !m_allow_fallback_fee) {\n+                // eventually allow a fallback fee\n+                error = _(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable -fallbackfee.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577988119",
      "id" : 577988119,
      "line" : 2814,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk4ODExOQ==",
      "original_commit_id" : "81b6a6b12b46ee351a293ae4928e815c37f193d3",
      "original_line" : 2814,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 592680099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577988119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577995228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577995228"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace nFeeRateNeeded with effective_fee\" (befa7ef609c977e6baa609900cedf3d41da12e53)\r\n\r\nReview notes: It is safe to set `coin_selection_params.effective_fee` here, because there is no other code except `SelectCoins` called on line 2897 and the `nFeeRet >= nFeeNeeded` branch line 2959 below which ever read `effective_fee`, and both of these pieces of code come after the place where `effective_fee` was previously set on line 2896.\r\n\r\nAlso, it is nice to see the unnecessary `nFeeRateNeeded` variable being removed.\r\n\r\nWould be good to mention this is a pure refactoring that doesn't change behavior in the commit description (same for the following 2 commits).",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-02-17T22:39:00Z",
      "diff_hunk" : "@@ -2807,11 +2807,11 @@ bool CWallet::CreateTransactionInternal(\n             CFeeRate discard_rate = GetDiscardRate(*this);\n \n             // Get the fee rate to use effective values in coin selection\n-            CFeeRate nFeeRateNeeded = GetMinimumFeeRate(*this, coin_control, &feeCalc);\n+            coin_selection_params.effective_fee = GetMinimumFeeRate(*this, coin_control, &feeCalc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577995228",
      "id" : 577995228,
      "line" : 2805,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk5NTIyOA==",
      "original_commit_id" : "befa7ef609c977e6baa609900cedf3d41da12e53",
      "original_line" : 2805,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 36,
      "pull_request_review_id" : 592680099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577995228",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r578005262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578005262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Move long term feerate setting to CreateTransaction\" (d3191194a8ced53ae511551dce1321c0416d9e6d)\r\n\r\nIn this commit and next commit, usage of SelectCoins is now more error prone because caller is responsible for setting `m_long_term_feerate` and `m_discard_feerate` variables in some cases (in other cases they are apparently never used), and there's not documentation about when to set them. Also these changes add to a proliferation of CoinSelectionParams constructor arguments can get easily confused together.\r\n\r\nA safer approach might be to make these `std::optional<CFeeRate>` members instead of `CFeeRate` members so the CoinSelectionParams constructor doesn't have to be involved with them at all. Then they can be directly set by name, and explicit errors will be triggered if they are ever accessed without being set.\r\n",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-02-17T23:01:16Z",
      "diff_hunk" : "@@ -607,16 +607,18 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r578005262",
      "id" : 578005262,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODAwNTI2Mg==",
      "original_commit_id" : "d3191194a8ced53ae511551dce1321c0416d9e6d",
      "original_line" : 616,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 592680099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578005262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457178"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The constructor parameters are more to make the tests easier to implement.",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-02-19T20:28:45Z",
      "diff_hunk" : "@@ -607,16 +607,18 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457178",
      "id" : 579457178,
      "in_reply_to_id" : 578005262,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTQ1NzE3OA==",
      "original_commit_id" : "d3191194a8ced53ae511551dce1321c0416d9e6d",
      "original_line" : 616,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 594546711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will update the commit message if I have to retouch.",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-02-19T20:29:18Z",
      "diff_hunk" : "@@ -2814,6 +2814,11 @@ bool CWallet::CreateTransactionInternal(\n                 error = strprintf(_(\"Fee rate (%s) is lower than the minimum fee rate setting (%s)\"), coin_control.m_feerate->ToString(FeeEstimateMode::SAT_VB), nFeeRateNeeded.ToString(FeeEstimateMode::SAT_VB));\n                 return false;\n             }\n+            if (feeCalc.reason == FeeReason::FALLBACK && !m_allow_fallback_fee) {\n+                // eventually allow a fallback fee\n+                error = _(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable -fallbackfee.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457462",
      "id" : 579457462,
      "in_reply_to_id" : 577988119,
      "line" : 2814,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTQ1NzQ2Mg==",
      "original_commit_id" : "81b6a6b12b46ee351a293ae4928e815c37f193d3",
      "original_line" : 2814,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 594547850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457502"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will update the commit message if I have to retouch.",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-02-19T20:29:22Z",
      "diff_hunk" : "@@ -2807,11 +2807,11 @@ bool CWallet::CreateTransactionInternal(\n             CFeeRate discard_rate = GetDiscardRate(*this);\n \n             // Get the fee rate to use effective values in coin selection\n-            CFeeRate nFeeRateNeeded = GetMinimumFeeRate(*this, coin_control, &feeCalc);\n+            coin_selection_params.effective_fee = GetMinimumFeeRate(*this, coin_control, &feeCalc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457502",
      "id" : 579457502,
      "in_reply_to_id" : 577995228,
      "line" : 2805,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTQ1NzUwMg==",
      "original_commit_id" : "befa7ef609c977e6baa609900cedf3d41da12e53",
      "original_line" : 2805,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 36,
      "pull_request_review_id" : 594547980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r584415074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584415074"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I suggest not expanding the monster constructor here. Overall code readability seems to improve just assigning the new members after construction.\r\n\r\n(Also much cleaner to backport...)",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-03-01T02:43:06Z",
      "diff_hunk" : "@@ -607,16 +607,20 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n+    CFeeRate m_discard_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, CFeeRate discard_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r584415074",
      "id" : 584415074,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDQxNTA3NA==",
      "original_commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "original_line" : 617,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 600354891,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584415074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r587709004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/587709004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457178",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-03-04T18:21:07Z",
      "diff_hunk" : "@@ -607,16 +607,20 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n+    CFeeRate m_discard_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, CFeeRate discard_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r587709004",
      "id" : 587709004,
      "in_reply_to_id" : 584415074,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NzcwOTAwNA==",
      "original_commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "original_line" : 617,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 604413000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/587709004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK 7b4b48f6aa186d878984ae14727e5fa203f0d9b6\r\n\r\nThe code is definitely an improvement and can be merged as-is.\r\n\r\nLooking at #19229 I was skeptical initially that this would fix it fully because, even though nobody said It explicitly, I assume some people have tried running the command multiple times. It sounded like it was a particular tx that caused these issues, rather than it just happening inconsistently on different txs which would seem more reasonable if a volatile fee market is the cause for this. But I have stared at the code for a pretty long time now (particularly the `subtractfeefromamount` scenario because that was mentioned several times in #19229) and I couldn't find another edge case that might cause this error. So I think the best path forward is to try and see if this code fixes the issue for those that have observed it. At least one user has already indicated in #19229 that they didn't see the issue again after running this PR so that's a good sign.",
      "created_at" : "2021-03-14T02:03:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#issuecomment-798819608",
      "id" : 798819608,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5ODgxOTYwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-14T02:03:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/798819608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> even though nobody said It explicitly, I assume some people have tried running the command multiple times\r\n\r\nThat's correct, @fjahr, we have observed that a retry can still be met with the error.  Bad luck maybe?\r\n\r\nIf a 0.21 backport branch were available, I might be able to try this out.",
      "created_at" : "2021-03-15T16:17:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#issuecomment-799549600",
      "id" : 799549600,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5OTU0OTYwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-15T16:17:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/799549600",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9373513?v=4",
         "events_url" : "https://api.github.com/users/chappjc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/chappjc/followers",
         "following_url" : "https://api.github.com/users/chappjc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/chappjc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/chappjc",
         "id" : 9373513,
         "login" : "chappjc",
         "node_id" : "MDQ6VXNlcjkzNzM1MTM=",
         "organizations_url" : "https://api.github.com/users/chappjc/orgs",
         "received_events_url" : "https://api.github.com/users/chappjc/received_events",
         "repos_url" : "https://api.github.com/users/chappjc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/chappjc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/chappjc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/chappjc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r595184535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595184535"
         }
      },
      "author_association" : "MEMBER",
      "body" : "re https://github.com/bitcoin/bitcoin/pull/21083/files#r584415074 and https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457178:\r\n\r\nI agree with @ryanofsky and @luke-jr that expanding this very large ctor signature makes the code less readable. Russ's suggestion of using std::optionals is good. Alternatively, I think these small changes would make things more readable:\r\n\r\n- add line breaks to the declaration and call sites, so there aren't 200+ column lines\r\n- add doxygen comments to the members so it's obvious what they're doing\r\n- use inline comments in the call sites:\r\n\r\n```diff\r\n-CoinSelectionParams coin_selection_params(false, 0, 0, CFeeRate(0), CFeeRate(0), CFeeRate(0), 0, false);\r\n+CoinSelectionParams coin_selection_params(/* use_bnb= */ false, /* change_output_size= */ 0,\r\n+                                          /* change_spend_size= */ 0, /* effective_fee= */ CFeeRate(0),\r\n+                                          /* long_term_feerate= */ CFeeRate(0), /* discard_feerate= */ CFeeRate(0),\r\n+                                          /* tx_noinputs_size= */ 0, /* avoid_partial= */ false);\r\n```\r\n\r\nc++20 will bring [designated initializers](https://en.cppreference.com/w/cpp/language/aggregate_initialization), which make initializing large structs like this much more readable. ",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-03-16T13:47:36Z",
      "diff_hunk" : "@@ -607,16 +607,20 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n+    CFeeRate m_discard_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, CFeeRate discard_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r595184535",
      "id" : 595184535,
      "in_reply_to_id" : 584415074,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTE4NDUzNQ==",
      "original_commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "original_line" : 617,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 613263443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595184535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r595368439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595368439"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've tried to make it more readable. However I also think that setting all of these things should be set in the constructor and that the current thing where we set all the parameters ad-hoc is not a good design.",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-03-16T17:01:36Z",
      "diff_hunk" : "@@ -607,16 +607,20 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n+    CFeeRate m_discard_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, CFeeRate discard_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r595368439",
      "id" : 595368439,
      "in_reply_to_id" : 584415074,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTM2ODQzOQ==",
      "original_commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "original_line" : 617,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 613504233,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595368439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r595368636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595368636"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated the commit message",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-03-16T17:01:50Z",
      "diff_hunk" : "@@ -2807,11 +2807,11 @@ bool CWallet::CreateTransactionInternal(\n             CFeeRate discard_rate = GetDiscardRate(*this);\n \n             // Get the fee rate to use effective values in coin selection\n-            CFeeRate nFeeRateNeeded = GetMinimumFeeRate(*this, coin_control, &feeCalc);\n+            coin_selection_params.effective_fee = GetMinimumFeeRate(*this, coin_control, &feeCalc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r595368636",
      "id" : 595368636,
      "in_reply_to_id" : 577995228,
      "line" : 2805,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTM2ODYzNg==",
      "original_commit_id" : "befa7ef609c977e6baa609900cedf3d41da12e53",
      "original_line" : 2805,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 36,
      "pull_request_review_id" : 613504475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595368636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r595368700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595368700"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated the commit message",
      "commit_id" : "cb93fbda152fe7427502b41ad897f40be13fc33b",
      "created_at" : "2021-03-16T17:01:54Z",
      "diff_hunk" : "@@ -2814,6 +2814,11 @@ bool CWallet::CreateTransactionInternal(\n                 error = strprintf(_(\"Fee rate (%s) is lower than the minimum fee rate setting (%s)\"), coin_control.m_feerate->ToString(FeeEstimateMode::SAT_VB), nFeeRateNeeded.ToString(FeeEstimateMode::SAT_VB));\n                 return false;\n             }\n+            if (feeCalc.reason == FeeReason::FALLBACK && !m_allow_fallback_fee) {\n+                // eventually allow a fallback fee\n+                error = _(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable -fallbackfee.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r595368700",
      "id" : 595368700,
      "in_reply_to_id" : 577988119,
      "line" : 2814,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTM2ODcwMA==",
      "original_commit_id" : "81b6a6b12b46ee351a293ae4928e815c37f193d3",
      "original_line" : 2814,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 613504554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-16T17:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/595368700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@chappjc Here is a branch of this PR backported to 0.21: https://github.com/achow101/bitcoin/tree/0.21-createtx-same-feerate",
      "created_at" : "2021-03-16T17:43:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#issuecomment-800473457",
      "id" : 800473457,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwMDQ3MzQ1Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-16T17:43:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/800473457",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
