[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20640 (wallet, refactor: return out-params of CreateTransaction() as optional struct by theStack)\n* #17526 (Use Single Random Draw In addition to knapsack as coin selection fallback by achow101)\n* #17331 (Use effective values throughout coin selection by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-02-05T07:59:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#issuecomment-773864616",
      "id" : 773864616,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3Mzg2NDYxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-05T07:59:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/773864616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, was thinking about this as well",
      "created_at" : "2021-02-06T18:08:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#issuecomment-774517656",
      "id" : 774517656,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NDUxNzY1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-06T18:08:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/774517656",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept / light-look-through ACK",
      "created_at" : "2021-02-16T22:02:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#issuecomment-780146178",
      "id" : 780146178,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21083",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MDE0NjE3OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-16T22:02:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780146178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577986291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577986291"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Use existing feerate instead of getting a new one\" (81b6a6b12b46ee351a293ae4928e815c37f193d3)\r\n\r\nReview note: this assignment is equivalent to previous `GetMinimumFee` assignment because `GetMinimumFeeRate` is always assigned to `nFeeRateNeeded` line 2810, and `nFeeRateNeeded` is always assigned to `coin_selection_params.effective_fee` on line 2896 (thanks to `pick_new_inputs` spaghetti) and because `GetMinimumFee()` is just a wrapper for `GetMinimumFeeRate().GetFee()`",
      "commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "created_at" : "2021-02-17T22:21:36Z",
      "diff_hunk" : "@@ -2951,13 +2956,7 @@ bool CWallet::CreateTransactionInternal(\n                     return false;\n                 }\n \n-                nFeeNeeded = GetMinimumFee(*this, nBytes, coin_control, &feeCalc);\n-                if (feeCalc.reason == FeeReason::FALLBACK && !m_allow_fallback_fee) {\n-                    // eventually allow a fallback fee\n-                    error = _(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable -fallbackfee.\");\n-                    return false;\n-                }\n-\n+                nFeeNeeded = coin_selection_params.effective_fee.GetFee(nBytes);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577986291",
      "id" : 577986291,
      "line" : 2960,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk4NjI5MQ==",
      "original_commit_id" : "81b6a6b12b46ee351a293ae4928e815c37f193d3",
      "original_line" : 2959,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 76,
      "pull_request_review_id" : 592680099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-17T23:14:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577986291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577988119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577988119"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Use existing feerate instead of getting a new one\" (81b6a6b12b46ee351a293ae4928e815c37f193d3)\r\n\r\nIt appears there is a change behavior here. \"Fee estimation failed\" error will now take priority over \"insufficient funds\", \"Signing transaction failed\", and other errors. It would be good to mention this in the commit message or at least say that this isn't a pure refactoring like it might seem to be (could mention the pick new inputs race condition behavior change as well).",
      "commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "created_at" : "2021-02-17T22:25:18Z",
      "diff_hunk" : "@@ -2814,6 +2814,11 @@ bool CWallet::CreateTransactionInternal(\n                 error = strprintf(_(\"Fee rate (%s) is lower than the minimum fee rate setting (%s)\"), coin_control.m_feerate->ToString(FeeEstimateMode::SAT_VB), nFeeRateNeeded.ToString(FeeEstimateMode::SAT_VB));\n                 return false;\n             }\n+            if (feeCalc.reason == FeeReason::FALLBACK && !m_allow_fallback_fee) {\n+                // eventually allow a fallback fee\n+                error = _(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable -fallbackfee.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577988119",
      "id" : 577988119,
      "line" : 2813,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk4ODExOQ==",
      "original_commit_id" : "81b6a6b12b46ee351a293ae4928e815c37f193d3",
      "original_line" : 2819,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 42,
      "pull_request_review_id" : 592680099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-17T23:14:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577988119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577995228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577995228"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Replace nFeeRateNeeded with effective_fee\" (befa7ef609c977e6baa609900cedf3d41da12e53)\r\n\r\nReview notes: It is safe to set `coin_selection_params.effective_fee` here, because there is no other code except `SelectCoins` called on line 2897 and the `nFeeRet >= nFeeNeeded` branch line 2959 below which ever read `effective_fee`, and both of these pieces of code come after the place where `effective_fee` was previously set on line 2896.\r\n\r\nAlso, it is nice to see the unnecessary `nFeeRateNeeded` variable being removed.\r\n\r\nWould be good to mention this is a pure refactoring that doesn't change behavior in the commit description (same for the following 2 commits).",
      "commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "created_at" : "2021-02-17T22:39:00Z",
      "diff_hunk" : "@@ -2807,11 +2807,11 @@ bool CWallet::CreateTransactionInternal(\n             CFeeRate discard_rate = GetDiscardRate(*this);\n \n             // Get the fee rate to use effective values in coin selection\n-            CFeeRate nFeeRateNeeded = GetMinimumFeeRate(*this, coin_control, &feeCalc);\n+            coin_selection_params.effective_fee = GetMinimumFeeRate(*this, coin_control, &feeCalc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r577995228",
      "id" : 577995228,
      "line" : 2804,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk5NTIyOA==",
      "original_commit_id" : "befa7ef609c977e6baa609900cedf3d41da12e53",
      "original_line" : 2810,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 31,
      "pull_request_review_id" : 592680099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-17T23:14:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577995228",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r578005262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578005262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: Move long term feerate setting to CreateTransaction\" (d3191194a8ced53ae511551dce1321c0416d9e6d)\r\n\r\nIn this commit and next commit, usage of SelectCoins is now more error prone because caller is responsible for setting `m_long_term_feerate` and `m_discard_feerate` variables in some cases (in other cases they are apparently never used), and there's not documentation about when to set them. Also these changes add to a proliferation of CoinSelectionParams constructor arguments can get easily confused together.\r\n\r\nA safer approach might be to make these `std::optional<CFeeRate>` members instead of `CFeeRate` members so the CoinSelectionParams constructor doesn't have to be involved with them at all. Then they can be directly set by name, and explicit errors will be triggered if they are ever accessed without being set.\r\n",
      "commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "created_at" : "2021-02-17T23:01:16Z",
      "diff_hunk" : "@@ -607,16 +607,18 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r578005262",
      "id" : 578005262,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODAwNTI2Mg==",
      "original_commit_id" : "d3191194a8ced53ae511551dce1321c0416d9e6d",
      "original_line" : 616,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 592680099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-17T23:14:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578005262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457178"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The constructor parameters are more to make the tests easier to implement.",
      "commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "created_at" : "2021-02-19T20:28:45Z",
      "diff_hunk" : "@@ -607,16 +607,18 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457178",
      "id" : 579457178,
      "in_reply_to_id" : 578005262,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTQ1NzE3OA==",
      "original_commit_id" : "d3191194a8ced53ae511551dce1321c0416d9e6d",
      "original_line" : 616,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 594546711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-19T20:28:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will update the commit message if I have to retouch.",
      "commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "created_at" : "2021-02-19T20:29:18Z",
      "diff_hunk" : "@@ -2814,6 +2814,11 @@ bool CWallet::CreateTransactionInternal(\n                 error = strprintf(_(\"Fee rate (%s) is lower than the minimum fee rate setting (%s)\"), coin_control.m_feerate->ToString(FeeEstimateMode::SAT_VB), nFeeRateNeeded.ToString(FeeEstimateMode::SAT_VB));\n                 return false;\n             }\n+            if (feeCalc.reason == FeeReason::FALLBACK && !m_allow_fallback_fee) {\n+                // eventually allow a fallback fee\n+                error = _(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable -fallbackfee.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457462",
      "id" : 579457462,
      "in_reply_to_id" : 577988119,
      "line" : 2813,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTQ1NzQ2Mg==",
      "original_commit_id" : "81b6a6b12b46ee351a293ae4928e815c37f193d3",
      "original_line" : 2819,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 42,
      "pull_request_review_id" : 594547850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-19T20:29:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457502"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will update the commit message if I have to retouch.",
      "commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "created_at" : "2021-02-19T20:29:22Z",
      "diff_hunk" : "@@ -2807,11 +2807,11 @@ bool CWallet::CreateTransactionInternal(\n             CFeeRate discard_rate = GetDiscardRate(*this);\n \n             // Get the fee rate to use effective values in coin selection\n-            CFeeRate nFeeRateNeeded = GetMinimumFeeRate(*this, coin_control, &feeCalc);\n+            coin_selection_params.effective_fee = GetMinimumFeeRate(*this, coin_control, &feeCalc);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457502",
      "id" : 579457502,
      "in_reply_to_id" : 577995228,
      "line" : 2804,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTQ1NzUwMg==",
      "original_commit_id" : "befa7ef609c977e6baa609900cedf3d41da12e53",
      "original_line" : 2810,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 31,
      "pull_request_review_id" : 594547980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-19T20:29:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/579457502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r584415074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584415074"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I suggest not expanding the monster constructor here. Overall code readability seems to improve just assigning the new members after construction.\r\n\r\n(Also much cleaner to backport...)",
      "commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "created_at" : "2021-03-01T02:43:06Z",
      "diff_hunk" : "@@ -607,16 +607,20 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n+    CFeeRate m_discard_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, CFeeRate discard_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r584415074",
      "id" : 584415074,
      "line" : 617,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDQxNTA3NA==",
      "original_commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "original_line" : 617,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 12,
      "pull_request_review_id" : 600354891,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-01T02:43:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584415074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r587709004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/587709004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See https://github.com/bitcoin/bitcoin/pull/21083#discussion_r579457178",
      "commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "created_at" : "2021-03-04T18:21:07Z",
      "diff_hunk" : "@@ -607,16 +607,20 @@ struct CoinSelectionParams\n     size_t change_output_size = 0;\n     size_t change_spend_size = 0;\n     CFeeRate effective_fee = CFeeRate(0);\n+    CFeeRate m_long_term_feerate = CFeeRate(0);\n+    CFeeRate m_discard_feerate = CFeeRate(0);\n     size_t tx_noinputs_size = 0;\n     //! Indicate that we are subtracting the fee from outputs\n     bool m_subtract_fee_outputs = false;\n     bool m_avoid_partial_spends = false;\n \n-    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, size_t tx_noinputs_size, bool avoid_partial) :\n+    CoinSelectionParams(bool use_bnb, size_t change_output_size, size_t change_spend_size, CFeeRate effective_fee, CFeeRate long_term_feerate, CFeeRate discard_feerate, size_t tx_noinputs_size, bool avoid_partial) :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21083#discussion_r587709004",
      "id" : 587709004,
      "in_reply_to_id" : 584415074,
      "line" : 617,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NzcwOTAwNA==",
      "original_commit_id" : "7b4b48f6aa186d878984ae14727e5fa203f0d9b6",
      "original_line" : 617,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 12,
      "pull_request_review_id" : 604413000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21083",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-04T18:21:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/587709004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
