[
   {
      "author_association" : "MEMBER",
      "body" : "## Merge Plan & Next Steps:\r\nAll of the functionality in this PR is hidden behind a configuration switch that defaults to off, and the wallet rebroadcast logic is currently untouched. The idea is to make these changes as safe as possible to merge into master, and allow reviewers to easily enable and observe the new rebroadcast mechanism in todayâs network conditions. \r\n\r\nIf we build confidence that these changes are safe and desirable, we can default enable this new node rebroadcast logic and disable the legacy wallet rebroadcast logic. This is the desired end goal. \r\n\r\n## Project History: \r\nA version of these changes were originally proposed in #16698. \r\n\r\n#18038 broke out a subset of the functionality, enabling the node to provide a guarantee around minimal initial broadcast & reducing the frequency of the existing wallet rebroadcast functionality (unbroadcast set) \r\n\r\nSince #16698, there have been some changes in approach, and all of the unbroadcast conversation is no longer relevant. So, to help with review, I've decided to open a new PR. To preserve the relevant feedback and concerns, I've tried my best to capture the history of conversations in the following write-up: https://github.com/amitiuttarwar/bitcoin-notes/blob/main/rebroadcast-history.md. warning: it goes quite in depth.\r\n\r\n\r\nðð½ Huge shout out to the village of core contributors who have provided feedback & guidance on this project so far. Honestly too many to name, but this project is much better for it. Thank you :) \r\n",
      "created_at" : "2021-02-02T07:23:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-771426879",
      "id" : 771426879,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MTQyNjg3OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-08T17:50:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/771426879",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2021-02-02T08:05:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-771448221",
      "id" : 771448221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MTQ0ODIyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T06:31:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/771448221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "marking as draft until I resolve CI issues",
      "created_at" : "2021-02-03T03:32:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-772195305",
      "id" : 772195305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MjE5NTMwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-03T03:32:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/772195305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21061#discussion_r572243729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21061"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572243729"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm importing this file so I can use the default key extractors in the `indexed_rebroadcast_set` multi_index: 1. https://github.com/bitcoin/bitcoin/pull/21061/files#diff-eccf6b88ae8b612dbdbdb92c110b66e4e7e3ffa665ccdc1acf08093aadc66b82R49 2. https://github.com/bitcoin/bitcoin/pull/21061/files#diff-eccf6b88ae8b612dbdbdb92c110b66e4e7e3ffa665ccdc1acf08093aadc66b82R55\r\n\r\nThe contents of the boost header file can be found [here](https://www.boost.org/doc/libs/1_71_0/boost/multi_index/member.hpp).\r\n\r\nIf we'd rather not import another boost header, I can avoid by writing custom key extractors.",
      "commit_id" : "47060cff449da91a6c82405a934562f160da1cf7",
      "created_at" : "2021-02-08T17:44:59Z",
      "diff_hunk" : "@@ -57,6 +57,7 @@ EXPECTED_BOOST_INCLUDES=(\n     boost/filesystem.hpp\n     boost/filesystem/fstream.hpp\n     boost/multi_index/hashed_index.hpp\n+    boost/multi_index/member.hpp",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#discussion_r572243729",
      "id" : 572243729,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI0MzcyOQ==",
      "original_commit_id" : "3766479d7924358f9c3b0d53fca1ca2e218e66fb",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/lint/lint-includes.sh",
      "position" : 4,
      "pull_request_review_id" : 585760946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21061",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T22:39:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572243729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased master, added a functional test, some small fixups. \r\n\r\nthis PR is ready for review! ð",
      "created_at" : "2021-02-10T02:44:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-776398956",
      "id" : 776398956,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjM5ODk1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T02:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776398956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21061#discussion_r574281895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21061"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574281895"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's fine to add a boost multi_index header dependency, it's the only submodule of boost that we really need and for which there is no replacement on the horizon. So just use what you need IMO, re-implementing anything from multi-index without a good plan would be a waste of time, I think. ",
      "commit_id" : "47060cff449da91a6c82405a934562f160da1cf7",
      "created_at" : "2021-02-11T06:58:44Z",
      "diff_hunk" : "@@ -57,6 +57,7 @@ EXPECTED_BOOST_INCLUDES=(\n     boost/filesystem.hpp\n     boost/filesystem/fstream.hpp\n     boost/multi_index/hashed_index.hpp\n+    boost/multi_index/member.hpp",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#discussion_r574281895",
      "id" : 574281895,
      "in_reply_to_id" : 572243729,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDI4MTg5NQ==",
      "original_commit_id" : "3766479d7924358f9c3b0d53fca1ca2e218e66fb",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/lint/lint-includes.sh",
      "position" : 4,
      "pull_request_review_id" : 588280404,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21061",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-11T06:59:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574281895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-16T20:20:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-780093975",
      "id" : 780093975,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MDA5Mzk3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-16T20:20:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780093975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2021-02-16T20:27:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-780097794",
      "id" : 780097794,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MDA5Nzc5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-16T20:27:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780097794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased to include #21121",
      "created_at" : "2021-02-17T23:29:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-780922203",
      "id" : 780922203,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MDkyMjIwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-17T23:29:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780922203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems like a big win, both for privacy and for quality of service. There are a lot of nodes out there with larger-than-default mempools, and if this were the default, they would serve as reservoirs for transactions that were dropped from the default mempool, eventually rebroadcasting them when they noticed that they had a chance of getting confirmed. This would save users from sometimes having to manually intervene to unstick stuck transactions.\r\n\r\nIt might be a good idea to log whenever this logic kicks in and rebroadcast transactions. Perhaps just the number of transactions that it's rebroadcasting, i.e. `Rebroadcasting 23 transactions`, and maybe also the individual transaction IDs.\r\n\r\nI'd like to run this code on mainnet, and having logging statements would be very helpful for tracking how it actually behaves.",
      "created_at" : "2021-02-28T00:52:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-787211962",
      "id" : 787211962,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4NzIxMTk2Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-28T00:52:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/787211962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1945?v=4",
         "events_url" : "https://api.github.com/users/casey/events{/privacy}",
         "followers_url" : "https://api.github.com/users/casey/followers",
         "following_url" : "https://api.github.com/users/casey/following{/other_user}",
         "gists_url" : "https://api.github.com/users/casey/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/casey",
         "id" : 1945,
         "login" : "casey",
         "node_id" : "MDQ6VXNlcjE5NDU=",
         "organizations_url" : "https://api.github.com/users/casey/orgs",
         "received_events_url" : "https://api.github.com/users/casey/received_events",
         "repos_url" : "https://api.github.com/users/casey/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/casey/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/casey/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/casey"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Can you help do this\n\nOn Sun, 28 Feb 2021, 11:55 Casey Rodarmor, <notifications@github.com> wrote:\n\n> This seems like a big win, both for privacy and for quality of service.\n> There are a lot of nodes out there with larger-than-default mempools, and\n> if this were the default, they would serve as reservoirs for transactions\n> that were dropped from the default mempool, eventually rebroadcasting them\n> when they noticed that they had a chance of getting confirmed. This would\n> save users from sometimes having to manually intervene to unstick stuck\n> transactions.\n>\n> It might be a good idea to log whenever this logic kicks in and\n> rebroadcast transactions. Perhaps just the number of transactions that it's\n> rebroadcasting, i.e. Rebroadcasting 23 transactions, and maybe also the\n> individual transaction IDs.\n>\n> I'd like to run this code on mainnet, and having logging statements would\n> be very helpful for tracking how it actually behaves.\n>\n> â\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-787211962>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/ATAD2EYMMKQOW2CLWSDRZNLTBGH6LANCNFSM4W5YT4HA>\n> .\n>\n",
      "created_at" : "2021-02-28T00:57:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-787212349",
      "id" : 787212349,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4NzIxMjM0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-28T00:57:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/787212349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/79707411?v=4",
         "events_url" : "https://api.github.com/users/schuie2528/events{/privacy}",
         "followers_url" : "https://api.github.com/users/schuie2528/followers",
         "following_url" : "https://api.github.com/users/schuie2528/following{/other_user}",
         "gists_url" : "https://api.github.com/users/schuie2528/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/schuie2528",
         "id" : 79707411,
         "login" : "schuie2528",
         "node_id" : "MDQ6VXNlcjc5NzA3NDEx",
         "organizations_url" : "https://api.github.com/users/schuie2528/orgs",
         "received_events_url" : "https://api.github.com/users/schuie2528/received_events",
         "repos_url" : "https://api.github.com/users/schuie2528/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/schuie2528/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/schuie2528/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/schuie2528"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@casey thanks for taking a look! \r\n\r\nThe current code does have some logging, the most relevant statement firing here: https://github.com/bitcoin/bitcoin/pull/21061/files?file-filters%5B%5D=.cpp&file-filters%5B%5D=.h&file-filters%5B%5D=.py&file-filters%5B%5D=.sh#diff-7dff50848db96bdb8edffc4d21daeca6d9050ec0e67d96072780ea5751e7df06R90. This prints the transactions hashes where a rebroadcast will be attempted for all peers. Those candidates will go through additional per-peer filters (see SendMessages code that copies `setInventoryTxToSend` and `filterInventoryKnown`), so might not actually make it to every peer, but should be sufficient signal for us to monitor the frequency of rebroadcast. \r\n\r\nI've also added logs to monitor how long it takes to calculate rebroadcast blocks. The logs are all in the `NET` & `BENCH` categories. I'm currently running a node with this patch, but I'd love to gather more data so It'd be helpful if you are willing to run the patch and share your findings. \r\n\r\nSo far, I ran a node for 1 week with default mempool settings & 0 transactions were selected for rebroadcast. That seems reasonable. I'm now running a node with a larger mempool, and also want to tinker with making low fee rate wallet transactions to monitor node rebroadcast logic.\r\n\r\nIf you've intended to request more logging than what's currently there, I'm open to suggestions. ",
      "created_at" : "2021-02-28T22:17:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-787533629",
      "id" : 787533629,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4NzUzMzYyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-28T22:17:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/787533629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The current code does have some logging, the most relevant statement firing here:\r\n\r\nAh, excellent! I was looking where the transactions are actually rebroadcast, so I missed that. What's there looks good, I can't think of anything else I'd want.\r\n\r\n> â¦but I'd love to gather more data so It'd be helpful if you are willing to run the patch and share your findings.\r\n\r\nI was thinking about running a node with a very large max mempool size, as well as no mempool expiration time, to try to maximize transaction rebroadcasting. (Those are the only two settings I can think of that would affect this, but let me know if you can think of others.) I'll definitely share the logs if I wind up doing this!",
      "created_at" : "2021-03-01T06:09:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-787673640",
      "id" : 787673640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4NzY3MzY0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-01T06:09:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/787673640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1945?v=4",
         "events_url" : "https://api.github.com/users/casey/events{/privacy}",
         "followers_url" : "https://api.github.com/users/casey/followers",
         "following_url" : "https://api.github.com/users/casey/following{/other_user}",
         "gists_url" : "https://api.github.com/users/casey/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/casey",
         "id" : 1945,
         "login" : "casey",
         "node_id" : "MDQ6VXNlcjE5NDU=",
         "organizations_url" : "https://api.github.com/users/casey/orgs",
         "received_events_url" : "https://api.github.com/users/casey/received_events",
         "repos_url" : "https://api.github.com/users/casey/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/casey/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/casey/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/casey"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@casey \r\n\r\n> I was thinking about running a node with a very large max mempool size, as well as no mempool expiration time, to try to maximize transaction rebroadcasting\r\n\r\nyup, that's exactly what I did, I also minimized the `feefilter` and `minrelaytxfee` to ensure I'd get all the transactions. \r\n\r\n> I'll definitely share the logs if I wind up doing this!\r\n\r\nsounds good, thanks :) ",
      "created_at" : "2021-03-02T05:15:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-788594423",
      "id" : 788594423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4ODU5NDQyMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-02T05:15:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/788594423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2021-03-04T22:27:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-790989016",
      "id" : 790989016,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MDk4OTAxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-04T22:27:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/790989016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-03-11T12:46:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-796710682",
      "id" : 796710682,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NjcxMDY4Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-11T12:46:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/796710682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2021-03-11T23:34:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-797121429",
      "id" : 797121429,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzEyMTQyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-11T23:34:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797121429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Motivation and PR overview looks interesting. Couldn't compile though. Maybe I should have checked CI results.\r\n\r\n![image](https://user-images.githubusercontent.com/13405205/110874750-525a0c00-82fa-11eb-9a14-e632f0084574.png)\r\n\r\n\r\n",
      "created_at" : "2021-03-12T00:45:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-797153844",
      "id" : 797153844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzE1Mzg0NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T00:45:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797153844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@prayank23 Thanks for taking a look. I missed the tests in a recent rebase. It should be fixed now",
      "created_at" : "2021-03-12T18:39:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-797676411",
      "id" : 797676411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzY3NjQxMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-12T18:39:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797676411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Have few questions about the approach and will mention them below. Compiled successfully on Ubuntu. Tests passed.\r\n\r\n> Conceptually, we want to rebroadcast transactions that we believe âshouldâ have been mined by now.\r\n\r\nNot sure about this part. Can we randomly rebroadcast different transactions to make it difficult for spy nodes to notice any pattern?\r\n\r\nI used below `bitcoin.conf`:\r\n```\r\ntestnet=1\r\nrebroadcast=1\r\ndebug=1\r\n```\r\n\r\nHad 1 incoming and 1 outgoing transaction pending associated with my wallet (segwit,rbf,1sat/vB). Node was connected to 10 peers.\r\n\r\n![image](https://user-images.githubusercontent.com/13405205/111013015-f22f9c80-83c3-11eb-9183-76d8d62f66f5.png)\r\n\r\nStill trying to understand if I can find something relevant in logs. Only one line related to `rebroadcast`:\r\n\r\n`2021-03-13T00:34:03Z Caching minimum fee for rebroadcast to 1.000 sat/vB, took 122 Âµs to calculate.`\r\n\r\n> After we process a block, invoke the rebroadcast module to identify if there\r\nare any transactions we would have expected to be included, and queue them up\r\nfor relay to our peers.\r\n\r\nMaybe it couldn't find any transactions that should be rebroadcasted based on fee rate and other things.\r\n\r\n> In order to prevent spam, we need to carefully select which transactions to rebroadcast. As of this commit, we select the transactions in the mempool that have the highest feerate.\r\n\r\nCan you explain the SPAM part mentioned in https://github.com/bitcoin/bitcoin/pull/21061/commits/b86f6d90a844dd71008f7c8a5fb92a1ac8673891? \r\n\r\nIt would be helpful if you can suggest few ways to experiment with `rebroadcast` and check different things?\r\n\r\n",
      "created_at" : "2021-03-13T00:58:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-797836751",
      "id" : 797836751,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzgzNjc1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-13T00:58:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797836751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   }
]
