[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nCan you [squash](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits) your commits @stackman27?",
      "created_at" : "2021-01-26T19:02:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#issuecomment-767759198",
      "id" : 767759198,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21014",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2Nzc1OTE5OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-26T19:02:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767759198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Concept ACK\r\n> \r\n> Can you [squash](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits) your commits @stackman27?\r\n\r\nYes! Should be fine now :) ",
      "created_at" : "2021-01-26T21:00:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#issuecomment-767824800",
      "id" : 767824800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21014",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2NzgyNDgwMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-26T21:00:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767824800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20874 (test: Run mempool_limit.py even with wallet disabled by stackman27)\n* #20808 (test: Run rpc_generateblock.py even with wallet disabled by nginocchio)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-01-27T01:25:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#issuecomment-767944191",
      "id" : 767944191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21014",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2Nzk0NDE5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T01:25:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767944191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r565947664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565947664"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why do we +1 here?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-01-28T09:38:28Z",
      "diff_hunk" : "@@ -139,6 +122,7 @@ def run_test(self):\n         self.log.info('A transaction that conflicts with an unconfirmed tx')\n         # Send the transaction that replaces the mempool transaction and opts out of replaceability\n         node.sendrawtransaction(hexstring=tx.serialize().hex(), maxfeerate=0)\n+        self.mempool_size += 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r565947664",
      "id" : 565947664,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk0NzY2NA==",
      "original_commit_id" : "45010220ced6d528f190e9eff3e2285c94ff71c2",
      "original_line" : 125,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 578144516,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565947664",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r565950244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565950244"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why not add version to `send_self_transfer()` as optional argument too?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-01-28T09:42:18Z",
      "diff_hunk" : "@@ -327,13 +306,13 @@ def run_test(self):\n         self.log.info('A transaction that is locked by BIP68 sequence logic')\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_reference)))\n         tx.vin[0].nSequence = 2  # We could include it in the second block mined from now, but not the very next one\n+        tx.nVersion = 2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r565950244",
      "id" : 565950244,
      "line" : 306,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk1MDI0NA==",
      "original_commit_id" : "45010220ced6d528f190e9eff3e2285c94ff71c2",
      "original_line" : 306,
      "original_position" : 176,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : 167,
      "pull_request_review_id" : 578144516,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565950244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r566168166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566168166"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe it's because we're keeping track of the `mempool_size` throughout the test.  \r\nThis is where we initialize it. \r\n`self.log.info('Start with empty mempool, and 200 blocks')\r\n self.mempool_size = 0` \r\nAlso I didn't wanted to disturb the previous behavior of the test file, therefore I just kept it there :) \r\n",
      "commit_id" : "45010220ced6d528f190e9eff3e2285c94ff71c2",
      "created_at" : "2021-01-28T15:09:46Z",
      "diff_hunk" : "@@ -139,6 +122,7 @@ def run_test(self):\n         self.log.info('A transaction that conflicts with an unconfirmed tx')\n         # Send the transaction that replaces the mempool transaction and opts out of replaceability\n         node.sendrawtransaction(hexstring=tx.serialize().hex(), maxfeerate=0)\n+        self.mempool_size += 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r566168166",
      "id" : 566168166,
      "in_reply_to_id" : 565947664,
      "line" : 125,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjE2ODE2Ng==",
      "original_commit_id" : "45010220ced6d528f190e9eff3e2285c94ff71c2",
      "original_line" : 125,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : 106,
      "pull_request_review_id" : 578430685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T15:09:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566168166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r566174205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566174205"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I thought about that approach, but this is the only time I needed to modify `nVersion` and I didn't know how viable that would be considering other files that didn't modify `nVersion`.  Nevertheless, if it's overall consensus is to include it in `send_self_transfer()`, I can happily do it!",
      "commit_id" : "45010220ced6d528f190e9eff3e2285c94ff71c2",
      "created_at" : "2021-01-28T15:17:31Z",
      "diff_hunk" : "@@ -327,13 +306,13 @@ def run_test(self):\n         self.log.info('A transaction that is locked by BIP68 sequence logic')\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_reference)))\n         tx.vin[0].nSequence = 2  # We could include it in the second block mined from now, but not the very next one\n+        tx.nVersion = 2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r566174205",
      "id" : 566174205,
      "in_reply_to_id" : 565950244,
      "line" : 309,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjE3NDIwNQ==",
      "original_commit_id" : "45010220ced6d528f190e9eff3e2285c94ff71c2",
      "original_line" : 309,
      "original_position" : 176,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : 176,
      "pull_request_review_id" : 578438833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-01-28T15:17:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566174205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571121996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571121996"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "oops that was my bad ð. However, I just pushed a new commit and fixed the issue. Not the most eloquent solution, but I'd highly appreciate any suggestions to improve it",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-05T17:14:28Z",
      "diff_hunk" : "@@ -139,6 +122,7 @@ def run_test(self):\n         self.log.info('A transaction that conflicts with an unconfirmed tx')\n         # Send the transaction that replaces the mempool transaction and opts out of replaceability\n         node.sendrawtransaction(hexstring=tx.serialize().hex(), maxfeerate=0)\n+        self.mempool_size += 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571121996",
      "id" : 571121996,
      "in_reply_to_id" : 565947664,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTEyMTk5Ng==",
      "original_commit_id" : "45010220ced6d528f190e9eff3e2285c94ff71c2",
      "original_line" : 125,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 584541063,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571121996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571122882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571122882"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I did try to do that, but I wasn't sure about the stylistic aspect of passing arguments in functions. Do we have a hard cap on the # of arguments we can pass on functions? ",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-05T17:15:52Z",
      "diff_hunk" : "@@ -327,13 +306,13 @@ def run_test(self):\n         self.log.info('A transaction that is locked by BIP68 sequence logic')\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_reference)))\n         tx.vin[0].nSequence = 2  # We could include it in the second block mined from now, but not the very next one\n+        tx.nVersion = 2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571122882",
      "id" : 571122882,
      "in_reply_to_id" : 565950244,
      "line" : 306,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTEyMjg4Mg==",
      "original_commit_id" : "45010220ced6d528f190e9eff3e2285c94ff71c2",
      "original_line" : 306,
      "original_position" : 176,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : 167,
      "pull_request_review_id" : 584542264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571122882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571516444"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571516444"
         }
      },
      "author_association" : "MEMBER",
      "body" : "the log 3 lines up says 200 blocks, but here we check 400. can you make these consistent?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-07T02:04:37Z",
      "diff_hunk" : "@@ -58,38 +55,30 @@ def check_mempool_result(self, result_expected, *args, **kwargs):\n \n     def run_test(self):\n         node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n \n         self.log.info('Start with empty mempool, and 200 blocks')\n         self.mempool_size = 0\n-        assert_equal(node.getblockcount(), 200)\n+        miniwallet.generate(200)\n+        assert_equal(node.getblockcount(), 400)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571516444",
      "id" : 571516444,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTUxNjQ0NA==",
      "original_commit_id" : "27f078c484a99b95182c5e2bb987b8f8fa165719",
      "original_line" : 63,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : 30,
      "pull_request_review_id" : 584933219,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571516444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571516496"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571516496"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this line should be deleted. If you meant it communicate something about the test, please clarify ",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-07T02:05:08Z",
      "diff_hunk" : "@@ -139,6 +122,7 @@ def run_test(self):\n         self.log.info('A transaction that conflicts with an unconfirmed tx')\n         # Send the transaction that replaces the mempool transaction and opts out of replaceability\n         node.sendrawtransaction(hexstring=tx.serialize().hex(), maxfeerate=0)\n+        #self.mempool_size += 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571516496",
      "id" : 571516496,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTUxNjQ5Ng==",
      "original_commit_id" : "27f078c484a99b95182c5e2bb987b8f8fa165719",
      "original_line" : 125,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 584933219,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571516496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571517084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571517084"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I find this one-line if/else to be pretty confusing. could you just break it into a few lines to clarify the logic flow? ",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-07T02:10:26Z",
      "diff_hunk" : "@@ -55,25 +55,37 @@ def get_utxo(self, *, txid=''):\n             index = self._utxos.index(utxo)\n         return self._utxos.pop(index)\n \n-    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), from_node, utxo_to_spend=None):\n+    def sign_tx(self, *, tx):\n+        \"\"\"Sign the tx with witness stack of OP_TRUE\"\"\"\n+        tx.wit.vtxinwit = [CTxInWitness()]\n+        tx.wit.vtxinwit[0].scriptWitness.stack = [CScript([OP_TRUE])]\n+        return tx\n+\n+    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), seq_num = 0xffffffff, from_node, utxo_to_spend=None, existing_tx = None, send_tx = True, default_fee = False):\n         \"\"\"Create and send a tx with the specified fee_rate. Fee may be exact or at most one satoshi higher than needed.\"\"\"\n         self._utxos = sorted(self._utxos, key=lambda k: k['value'])\n         utxo_to_spend = utxo_to_spend or self._utxos.pop()  # Pick the largest utxo (if none provided) and hope it covers the fee\n+\n         vsize = Decimal(96)\n-        send_value = satoshi_round(utxo_to_spend['value'] - fee_rate * (vsize / 1000))\n+        send_value = satoshi_round(utxo_to_spend['value'] - fee_rate * (vsize / 1000)) if send_tx else satoshi_round(utxo_to_spend['value'] - fee_rate)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571517084",
      "id" : 571517084,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTUxNzA4NA==",
      "original_commit_id" : "27f078c484a99b95182c5e2bb987b8f8fa165719",
      "original_line" : 70,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 584933219,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571517084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571663601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571663601"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Got it! Fixed",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-07T18:36:08Z",
      "diff_hunk" : "@@ -58,38 +55,30 @@ def check_mempool_result(self, result_expected, *args, **kwargs):\n \n     def run_test(self):\n         node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n \n         self.log.info('Start with empty mempool, and 200 blocks')\n         self.mempool_size = 0\n-        assert_equal(node.getblockcount(), 200)\n+        miniwallet.generate(200)\n+        assert_equal(node.getblockcount(), 400)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571663601",
      "id" : 571663601,
      "in_reply_to_id" : 571516444,
      "line" : 63,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTY2MzYwMQ==",
      "original_commit_id" : "27f078c484a99b95182c5e2bb987b8f8fa165719",
      "original_line" : 63,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : 30,
      "pull_request_review_id" : 585048712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571663601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571663698"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571663698"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I broke it down, I hope it makes more sense now :) ",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-07T18:37:09Z",
      "diff_hunk" : "@@ -55,25 +55,37 @@ def get_utxo(self, *, txid=''):\n             index = self._utxos.index(utxo)\n         return self._utxos.pop(index)\n \n-    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), from_node, utxo_to_spend=None):\n+    def sign_tx(self, *, tx):\n+        \"\"\"Sign the tx with witness stack of OP_TRUE\"\"\"\n+        tx.wit.vtxinwit = [CTxInWitness()]\n+        tx.wit.vtxinwit[0].scriptWitness.stack = [CScript([OP_TRUE])]\n+        return tx\n+\n+    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), seq_num = 0xffffffff, from_node, utxo_to_spend=None, existing_tx = None, send_tx = True, default_fee = False):\n         \"\"\"Create and send a tx with the specified fee_rate. Fee may be exact or at most one satoshi higher than needed.\"\"\"\n         self._utxos = sorted(self._utxos, key=lambda k: k['value'])\n         utxo_to_spend = utxo_to_spend or self._utxos.pop()  # Pick the largest utxo (if none provided) and hope it covers the fee\n+\n         vsize = Decimal(96)\n-        send_value = satoshi_round(utxo_to_spend['value'] - fee_rate * (vsize / 1000))\n+        send_value = satoshi_round(utxo_to_spend['value'] - fee_rate * (vsize / 1000)) if send_tx else satoshi_round(utxo_to_spend['value'] - fee_rate)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r571663698",
      "id" : 571663698,
      "in_reply_to_id" : 571517084,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTY2MzY5OA==",
      "original_commit_id" : "27f078c484a99b95182c5e2bb987b8f8fa165719",
      "original_line" : 70,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 585048822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571663698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572172425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572172425"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to change this from `node.generate(1)`? `miniwallet.generate` will put an immature utxo in the wallet.",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T16:12:28Z",
      "diff_hunk" : "@@ -58,38 +55,30 @@ def check_mempool_result(self, result_expected, *args, **kwargs):\n \n     def run_test(self):\n         node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n \n-        self.log.info('Start with empty mempool, and 200 blocks')\n+        self.log.info('Start with empty mempool, and 400 blocks')\n         self.mempool_size = 0\n-        assert_equal(node.getblockcount(), 200)\n+        miniwallet.generate(200)\n+        assert_equal(node.getblockcount(), 400)\n         assert_equal(node.getmempoolinfo()['size'], self.mempool_size)\n-        coins = node.listunspent()\n \n         self.log.info('Should not accept garbage to testmempoolaccept')\n         assert_raises_rpc_error(-3, 'Expected type array, got string', lambda: node.testmempoolaccept(rawtxs='ff00baar'))\n         assert_raises_rpc_error(-8, 'Array must contain exactly one raw transaction for now', lambda: node.testmempoolaccept(rawtxs=['ff00baar', 'ff22']))\n         assert_raises_rpc_error(-22, 'TX decode failed', lambda: node.testmempoolaccept(rawtxs=['ff00baar']))\n \n         self.log.info('A transaction already in the blockchain')\n-        coin = coins.pop()  # Pick a random coin(base) to spend\n-        raw_tx_in_block = node.signrawtransactionwithwallet(node.createrawtransaction(\n-            inputs=[{'txid': coin['txid'], 'vout': coin['vout']}],\n-            outputs=[{node.getnewaddress(): 0.3}, {node.getnewaddress(): 49}],\n-        ))['hex']\n-        txid_in_block = node.sendrawtransaction(hexstring=raw_tx_in_block, maxfeerate=0)\n-        node.generate(1)\n+        tx_in_block = miniwallet.send_self_transfer(from_node = node, default_fee = True)\n+        miniwallet.generate(1) # Generate a block, tx gets mined therefore mempool is empty",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572172425",
      "id" : 572172425,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjE3MjQyNQ==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 73,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585666435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572172425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572173488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572173488"
         }
      },
      "author_association" : "MEMBER",
      "body" : "any reason to change this? Previously there was a newline between each test",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T16:13:55Z",
      "diff_hunk" : "@@ -58,38 +55,30 @@ def check_mempool_result(self, result_expected, *args, **kwargs):\n \n     def run_test(self):\n         node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n \n-        self.log.info('Start with empty mempool, and 200 blocks')\n+        self.log.info('Start with empty mempool, and 400 blocks')\n         self.mempool_size = 0\n-        assert_equal(node.getblockcount(), 200)\n+        miniwallet.generate(200)\n+        assert_equal(node.getblockcount(), 400)\n         assert_equal(node.getmempoolinfo()['size'], self.mempool_size)\n-        coins = node.listunspent()\n \n         self.log.info('Should not accept garbage to testmempoolaccept')\n         assert_raises_rpc_error(-3, 'Expected type array, got string', lambda: node.testmempoolaccept(rawtxs='ff00baar'))\n         assert_raises_rpc_error(-8, 'Array must contain exactly one raw transaction for now', lambda: node.testmempoolaccept(rawtxs=['ff00baar', 'ff22']))\n         assert_raises_rpc_error(-22, 'TX decode failed', lambda: node.testmempoolaccept(rawtxs=['ff00baar']))\n \n         self.log.info('A transaction already in the blockchain')\n-        coin = coins.pop()  # Pick a random coin(base) to spend\n-        raw_tx_in_block = node.signrawtransactionwithwallet(node.createrawtransaction(\n-            inputs=[{'txid': coin['txid'], 'vout': coin['vout']}],\n-            outputs=[{node.getnewaddress(): 0.3}, {node.getnewaddress(): 49}],\n-        ))['hex']\n-        txid_in_block = node.sendrawtransaction(hexstring=raw_tx_in_block, maxfeerate=0)\n-        node.generate(1)\n+        tx_in_block = miniwallet.send_self_transfer(from_node = node, default_fee = True)\n+        miniwallet.generate(1) # Generate a block, tx gets mined therefore mempool is empty\n         self.mempool_size = 0\n         self.check_mempool_result(\n-            result_expected=[{'txid': txid_in_block, 'allowed': False, 'reject-reason': 'txn-already-known'}],\n-            rawtxs=[raw_tx_in_block],\n+            result_expected=[{'txid': tx_in_block['txid'], 'allowed': False, 'reject-reason': 'txn-already-known'}],\n+            rawtxs=[tx_in_block['hex']],\n         )\n-",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572173488",
      "id" : 572173488,
      "line" : 86,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjE3MzQ4OA==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 86,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : 56,
      "pull_request_review_id" : 585666435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572173488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572176537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572176537"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to mention 0xffffffd?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T16:17:47Z",
      "diff_hunk" : "@@ -58,38 +55,30 @@ def check_mempool_result(self, result_expected, *args, **kwargs):\n \n     def run_test(self):\n         node = self.nodes[0]\n+        miniwallet = MiniWallet(node)\n \n-        self.log.info('Start with empty mempool, and 200 blocks')\n+        self.log.info('Start with empty mempool, and 400 blocks')\n         self.mempool_size = 0\n-        assert_equal(node.getblockcount(), 200)\n+        miniwallet.generate(200)\n+        assert_equal(node.getblockcount(), 400)\n         assert_equal(node.getmempoolinfo()['size'], self.mempool_size)\n-        coins = node.listunspent()\n \n         self.log.info('Should not accept garbage to testmempoolaccept')\n         assert_raises_rpc_error(-3, 'Expected type array, got string', lambda: node.testmempoolaccept(rawtxs='ff00baar'))\n         assert_raises_rpc_error(-8, 'Array must contain exactly one raw transaction for now', lambda: node.testmempoolaccept(rawtxs=['ff00baar', 'ff22']))\n         assert_raises_rpc_error(-22, 'TX decode failed', lambda: node.testmempoolaccept(rawtxs=['ff00baar']))\n \n         self.log.info('A transaction already in the blockchain')\n-        coin = coins.pop()  # Pick a random coin(base) to spend\n-        raw_tx_in_block = node.signrawtransactionwithwallet(node.createrawtransaction(\n-            inputs=[{'txid': coin['txid'], 'vout': coin['vout']}],\n-            outputs=[{node.getnewaddress(): 0.3}, {node.getnewaddress(): 49}],\n-        ))['hex']\n-        txid_in_block = node.sendrawtransaction(hexstring=raw_tx_in_block, maxfeerate=0)\n-        node.generate(1)\n+        tx_in_block = miniwallet.send_self_transfer(from_node = node, default_fee = True)\n+        miniwallet.generate(1) # Generate a block, tx gets mined therefore mempool is empty\n         self.mempool_size = 0\n         self.check_mempool_result(\n-            result_expected=[{'txid': txid_in_block, 'allowed': False, 'reject-reason': 'txn-already-known'}],\n-            rawtxs=[raw_tx_in_block],\n+            result_expected=[{'txid': tx_in_block['txid'], 'allowed': False, 'reject-reason': 'txn-already-known'}],\n+            rawtxs=[tx_in_block['hex']],\n         )\n-\n         self.log.info('A transaction not in the mempool')\n         fee = Decimal('0.000007')\n-        raw_tx_0 = node.signrawtransactionwithwallet(node.createrawtransaction(\n-            inputs=[{\"txid\": txid_in_block, \"vout\": 0, \"sequence\": BIP125_SEQUENCE_NUMBER}],  # RBF is used later\n-            outputs=[{node.getnewaddress(): Decimal('0.3') - fee}],\n-        ))['hex']\n+        raw_tx_0 = miniwallet.send_self_transfer(from_node = node, seq_num = BIP125_SEQUENCE_NUMBER,  fee_rate = fee, send_tx = False)['hex'] #RBF enabled (0xffffffd)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572176537",
      "id" : 572176537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjE3NjUzNw==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 81,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585666435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572176537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572177242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572177242"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why is this no longer passing SEQUENCE_FINAL, etc...?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T16:18:42Z",
      "diff_hunk" : "@@ -99,21 +88,15 @@ def run_test(self):\n         )\n \n         self.log.info('A final transaction not in the mempool')\n-        coin = coins.pop()  # Pick a random coin(base) to spend\n-        output_amount = Decimal('0.025')\n-        raw_tx_final = node.signrawtransactionwithwallet(node.createrawtransaction(\n-            inputs=[{'txid': coin['txid'], 'vout': coin['vout'], \"sequence\": 0xffffffff}],  # SEQUENCE_FINAL\n-            outputs=[{node.getnewaddress(): output_amount}],\n-            locktime=node.getblockcount() + 2000,  # Can be anything\n-        ))['hex']\n-        tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_final)))\n-        fee_expected = coin['amount'] - output_amount\n+        raw_tx_final = miniwallet.send_self_transfer(from_node = node, send_tx = False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572177242",
      "id" : 572177242,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjE3NzI0Mg==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 91,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585666435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572177242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572181551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572181551"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this call needed? The tx should already be signed",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T16:24:19Z",
      "diff_hunk" : "@@ -128,7 +111,7 @@ def run_test(self):\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_0)))\n         tx.vout[0].nValue -= int(fee * COIN)  # Double the fee\n         tx.vin[0].nSequence = BIP125_SEQUENCE_NUMBER + 1  # Now, opt out of RBF\n-        raw_tx_0 = node.signrawtransactionwithwallet(tx.serialize().hex())['hex']\n+        raw_tx_0 = miniwallet.send_self_transfer(from_node = node, fee_rate = fee * 2, send_tx = False, existing_tx = tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572181551",
      "id" : 572181551,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjE4MTU1MQ==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 114,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585666435,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572181551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572208649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572208649"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thats because the default is set to `0xffffffff` in `send_send_transfer` parameter",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T16:58:43Z",
      "diff_hunk" : "@@ -99,21 +88,15 @@ def run_test(self):\n         )\n \n         self.log.info('A final transaction not in the mempool')\n-        coin = coins.pop()  # Pick a random coin(base) to spend\n-        output_amount = Decimal('0.025')\n-        raw_tx_final = node.signrawtransactionwithwallet(node.createrawtransaction(\n-            inputs=[{'txid': coin['txid'], 'vout': coin['vout'], \"sequence\": 0xffffffff}],  # SEQUENCE_FINAL\n-            outputs=[{node.getnewaddress(): output_amount}],\n-            locktime=node.getblockcount() + 2000,  # Can be anything\n-        ))['hex']\n-        tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_final)))\n-        fee_expected = coin['amount'] - output_amount\n+        raw_tx_final = miniwallet.send_self_transfer(from_node = node, send_tx = False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572208649",
      "id" : 572208649,
      "in_reply_to_id" : 572177242,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjIwODY0OQ==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 91,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585714521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572208649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572209459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572209459"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I thought we changed the `nValue` and `nSequence` of raw_tx_0 therefore we have to resign it, is that not the case? ",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T16:59:47Z",
      "diff_hunk" : "@@ -128,7 +111,7 @@ def run_test(self):\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_0)))\n         tx.vout[0].nValue -= int(fee * COIN)  # Double the fee\n         tx.vin[0].nSequence = BIP125_SEQUENCE_NUMBER + 1  # Now, opt out of RBF\n-        raw_tx_0 = node.signrawtransactionwithwallet(tx.serialize().hex())['hex']\n+        raw_tx_0 = miniwallet.send_self_transfer(from_node = node, fee_rate = fee * 2, send_tx = False, existing_tx = tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572209459",
      "id" : 572209459,
      "in_reply_to_id" : 572181551,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjIwOTQ1OQ==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 114,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585715528,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572209459",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572228039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572228039"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So if the default changes, the test will fail? If so, I'd prefer to set it here to avoid a changed default breaking the test.",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T17:23:49Z",
      "diff_hunk" : "@@ -99,21 +88,15 @@ def run_test(self):\n         )\n \n         self.log.info('A final transaction not in the mempool')\n-        coin = coins.pop()  # Pick a random coin(base) to spend\n-        output_amount = Decimal('0.025')\n-        raw_tx_final = node.signrawtransactionwithwallet(node.createrawtransaction(\n-            inputs=[{'txid': coin['txid'], 'vout': coin['vout'], \"sequence\": 0xffffffff}],  # SEQUENCE_FINAL\n-            outputs=[{node.getnewaddress(): output_amount}],\n-            locktime=node.getblockcount() + 2000,  # Can be anything\n-        ))['hex']\n-        tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_final)))\n-        fee_expected = coin['amount'] - output_amount\n+        raw_tx_final = miniwallet.send_self_transfer(from_node = node, send_tx = False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572228039",
      "id" : 572228039,
      "in_reply_to_id" : 572177242,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjIyODAzOQ==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 91,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585741103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572228039",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572228749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572228749"
         }
      },
      "author_association" : "MEMBER",
      "body" : "miniwallet doesn't do any sighashing, so no. What is the error message you see when not \"signing\"?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T17:24:43Z",
      "diff_hunk" : "@@ -128,7 +111,7 @@ def run_test(self):\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_0)))\n         tx.vout[0].nValue -= int(fee * COIN)  # Double the fee\n         tx.vin[0].nSequence = BIP125_SEQUENCE_NUMBER + 1  # Now, opt out of RBF\n-        raw_tx_0 = node.signrawtransactionwithwallet(tx.serialize().hex())['hex']\n+        raw_tx_0 = miniwallet.send_self_transfer(from_node = node, fee_rate = fee * 2, send_tx = False, existing_tx = tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572228749",
      "id" : 572228749,
      "in_reply_to_id" : 572181551,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjIyODc0OQ==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 114,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585741973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572228749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572232350"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572232350"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I commented 114 out and it fails this assertion\r\n```\r\n self.check_mempool_result(\r\n  result_expected=[{'txid': txid_0, 'allowed': True, 'vsize': tx.get_vsize(), 'fees': {'base': (2 * fee)}}],\r\n  rawtxs=[raw_tx_0],\r\n )\r\n****** OUTPUT ******\r\nAssertionError: not([{'txid': '9295ae1bef2de5cb6dcf3a63504d2a58435572a32cf95caa078cd1a988f19101', 'allowed': True, 'vsize': 96, 'fees': {'base': Decimal('0.000014')}}] == [{'txid': '9295ae1bef2de5cb6dcf3a63504d2a58435572a32cf95caa078cd1a988f19101', 'allowed': False, 'reject-reason': 'txn-already-in-mempool'}])\r\n```",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T17:29:14Z",
      "diff_hunk" : "@@ -128,7 +111,7 @@ def run_test(self):\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_0)))\n         tx.vout[0].nValue -= int(fee * COIN)  # Double the fee\n         tx.vin[0].nSequence = BIP125_SEQUENCE_NUMBER + 1  # Now, opt out of RBF\n-        raw_tx_0 = node.signrawtransactionwithwallet(tx.serialize().hex())['hex']\n+        raw_tx_0 = miniwallet.send_self_transfer(from_node = node, fee_rate = fee * 2, send_tx = False, existing_tx = tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572232350",
      "id" : 572232350,
      "in_reply_to_id" : 572181551,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjIzMjM1MA==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 114,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585746442,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572232350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572233311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572233311"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Got it! Thank you",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T17:30:26Z",
      "diff_hunk" : "@@ -99,21 +88,15 @@ def run_test(self):\n         )\n \n         self.log.info('A final transaction not in the mempool')\n-        coin = coins.pop()  # Pick a random coin(base) to spend\n-        output_amount = Decimal('0.025')\n-        raw_tx_final = node.signrawtransactionwithwallet(node.createrawtransaction(\n-            inputs=[{'txid': coin['txid'], 'vout': coin['vout'], \"sequence\": 0xffffffff}],  # SEQUENCE_FINAL\n-            outputs=[{node.getnewaddress(): output_amount}],\n-            locktime=node.getblockcount() + 2000,  # Can be anything\n-        ))['hex']\n-        tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_final)))\n-        fee_expected = coin['amount'] - output_amount\n+        raw_tx_final = miniwallet.send_self_transfer(from_node = node, send_tx = False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572233311",
      "id" : 572233311,
      "in_reply_to_id" : 572177242,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjIzMzMxMQ==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 91,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585747571,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572233311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572241824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572241824"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can't comment out the line, but you can remove the \"signing roundtrip\" and simply take the tx as is.",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T17:42:14Z",
      "diff_hunk" : "@@ -128,7 +111,7 @@ def run_test(self):\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_0)))\n         tx.vout[0].nValue -= int(fee * COIN)  # Double the fee\n         tx.vin[0].nSequence = BIP125_SEQUENCE_NUMBER + 1  # Now, opt out of RBF\n-        raw_tx_0 = node.signrawtransactionwithwallet(tx.serialize().hex())['hex']\n+        raw_tx_0 = miniwallet.send_self_transfer(from_node = node, fee_rate = fee * 2, send_tx = False, existing_tx = tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572241824",
      "id" : 572241824,
      "in_reply_to_id" : 572181551,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI0MTgyNA==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 114,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585758478,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572241824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572251107"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572251107"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm sorry but do you mean just take the `raw_tx_0 = tx.serialize().hex()`? ",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T17:55:27Z",
      "diff_hunk" : "@@ -128,7 +111,7 @@ def run_test(self):\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_0)))\n         tx.vout[0].nValue -= int(fee * COIN)  # Double the fee\n         tx.vin[0].nSequence = BIP125_SEQUENCE_NUMBER + 1  # Now, opt out of RBF\n-        raw_tx_0 = node.signrawtransactionwithwallet(tx.serialize().hex())['hex']\n+        raw_tx_0 = miniwallet.send_self_transfer(from_node = node, fee_rate = fee * 2, send_tx = False, existing_tx = tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572251107",
      "id" : 572251107,
      "in_reply_to_id" : 572181551,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI1MTEwNw==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 114,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585770298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572251107",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572266680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572266680"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I tried the above approach but am unable to get/spend the utxo in line 149/151 associated with `txid_0`, because it doesnot have  tides with `send_self_transfer` . Is there any way around it?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T18:19:05Z",
      "diff_hunk" : "@@ -128,7 +111,7 @@ def run_test(self):\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_0)))\n         tx.vout[0].nValue -= int(fee * COIN)  # Double the fee\n         tx.vin[0].nSequence = BIP125_SEQUENCE_NUMBER + 1  # Now, opt out of RBF\n-        raw_tx_0 = node.signrawtransactionwithwallet(tx.serialize().hex())['hex']\n+        raw_tx_0 = miniwallet.send_self_transfer(from_node = node, fee_rate = fee * 2, send_tx = False, existing_tx = tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572266680",
      "id" : 572266680,
      "in_reply_to_id" : 572181551,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI2NjY4MA==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 114,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585790541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572266680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/26356227?v=4",
         "events_url" : "https://api.github.com/users/stackman27/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stackman27/followers",
         "following_url" : "https://api.github.com/users/stackman27/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stackman27/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stackman27",
         "id" : 26356227,
         "login" : "stackman27",
         "node_id" : "MDQ6VXNlcjI2MzU2MjI3",
         "organizations_url" : "https://api.github.com/users/stackman27/orgs",
         "received_events_url" : "https://api.github.com/users/stackman27/received_events",
         "repos_url" : "https://api.github.com/users/stackman27/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stackman27/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stackman27/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stackman27"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572268388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572268388"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe add a send_tx to miniwallet which does the needed steps?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-08T18:21:49Z",
      "diff_hunk" : "@@ -128,7 +111,7 @@ def run_test(self):\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_0)))\n         tx.vout[0].nValue -= int(fee * COIN)  # Double the fee\n         tx.vin[0].nSequence = BIP125_SEQUENCE_NUMBER + 1  # Now, opt out of RBF\n-        raw_tx_0 = node.signrawtransactionwithwallet(tx.serialize().hex())['hex']\n+        raw_tx_0 = miniwallet.send_self_transfer(from_node = node, fee_rate = fee * 2, send_tx = False, existing_tx = tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r572268388",
      "id" : 572268388,
      "in_reply_to_id" : 572181551,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI2ODM4OA==",
      "original_commit_id" : "582d57cc9451fab44d693736127796fc1e7538e4",
      "original_line" : 114,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : null,
      "pull_request_review_id" : 585792720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T18:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572268388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575334436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575334436"
         }
      },
      "author_association" : "NONE",
      "body" : "You could use `self.setup_clean_chain = True` to start the blockchain with 0 blocks.",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-12T16:11:32Z",
      "diff_hunk" : "@@ -35,7 +35,7 @@\n     assert_raises_rpc_error,\n     hex_str_to_bytes,\n )\n-\n+from test_framework.wallet import MiniWallet\n \n class MempoolAcceptanceTest(BitcoinTestFramework):\n     def set_test_params(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575334436",
      "id" : 575334436,
      "line" : 41,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTMzNDQzNg==",
      "original_commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "original_line" : 41,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : 8,
      "pull_request_review_id" : 589608933,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-15T02:43:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575334436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/41220998?v=4",
         "events_url" : "https://api.github.com/users/DariusParvin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DariusParvin/followers",
         "following_url" : "https://api.github.com/users/DariusParvin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DariusParvin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DariusParvin",
         "id" : 41220998,
         "login" : "DariusParvin",
         "node_id" : "MDQ6VXNlcjQxMjIwOTk4",
         "organizations_url" : "https://api.github.com/users/DariusParvin/orgs",
         "received_events_url" : "https://api.github.com/users/DariusParvin/received_events",
         "repos_url" : "https://api.github.com/users/DariusParvin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DariusParvin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DariusParvin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DariusParvin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575906571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575906571"
         }
      },
      "author_association" : "NONE",
      "body" : "I'm curious why `send_tx = False` should affect the fee?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-15T02:00:06Z",
      "diff_hunk" : "@@ -55,25 +55,34 @@ def get_utxo(self, *, txid=''):\n             index = self._utxos.index(utxo)\n         return self._utxos.pop(index)\n \n-    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), from_node, utxo_to_spend=None):\n+    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), seq_num = 0xffffffff, from_node, utxo_to_spend=None, send_tx = True, default_fee = False):\n         \"\"\"Create and send a tx with the specified fee_rate. Fee may be exact or at most one satoshi higher than needed.\"\"\"\n         self._utxos = sorted(self._utxos, key=lambda k: k['value'])\n         utxo_to_spend = utxo_to_spend or self._utxos.pop()  # Pick the largest utxo (if none provided) and hope it covers the fee\n         vsize = Decimal(96)\n-        send_value = satoshi_round(utxo_to_spend['value'] - fee_rate * (vsize / 1000))\n+\n+        # if send_tx is set to False then calculate send_value without vsize",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575906571",
      "id" : 575906571,
      "line" : 64,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTkwNjU3MQ==",
      "original_commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "original_line" : 64,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 12,
      "pull_request_review_id" : 589608933,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-15T02:43:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575906571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/41220998?v=4",
         "events_url" : "https://api.github.com/users/DariusParvin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DariusParvin/followers",
         "following_url" : "https://api.github.com/users/DariusParvin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DariusParvin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DariusParvin",
         "id" : 41220998,
         "login" : "DariusParvin",
         "node_id" : "MDQ6VXNlcjQxMjIwOTk4",
         "organizations_url" : "https://api.github.com/users/DariusParvin/orgs",
         "received_events_url" : "https://api.github.com/users/DariusParvin/received_events",
         "repos_url" : "https://api.github.com/users/DariusParvin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DariusParvin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DariusParvin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DariusParvin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575906973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575906973"
         }
      },
      "author_association" : "NONE",
      "body" : "Maybe it's worth just assuming `nVersion = 2` in the MiniWallet, and add it as an option argument in the future if/when there's a test that requires `nVersion = 1`?",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-15T02:02:33Z",
      "diff_hunk" : "@@ -327,13 +306,13 @@ def run_test(self):\n         self.log.info('A transaction that is locked by BIP68 sequence logic')\n         tx.deserialize(BytesIO(hex_str_to_bytes(raw_tx_reference)))\n         tx.vin[0].nSequence = 2  # We could include it in the second block mined from now, but not the very next one\n+        tx.nVersion = 2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575906973",
      "id" : 575906973,
      "in_reply_to_id" : 565950244,
      "line" : 306,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTkwNjk3Mw==",
      "original_commit_id" : "45010220ced6d528f190e9eff3e2285c94ff71c2",
      "original_line" : 306,
      "original_position" : 176,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept.py",
      "position" : 167,
      "pull_request_review_id" : 589608933,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-15T02:50:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575906973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/41220998?v=4",
         "events_url" : "https://api.github.com/users/DariusParvin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DariusParvin/followers",
         "following_url" : "https://api.github.com/users/DariusParvin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DariusParvin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DariusParvin",
         "id" : 41220998,
         "login" : "DariusParvin",
         "node_id" : "MDQ6VXNlcjQxMjIwOTk4",
         "organizations_url" : "https://api.github.com/users/DariusParvin/orgs",
         "received_events_url" : "https://api.github.com/users/DariusParvin/received_events",
         "repos_url" : "https://api.github.com/users/DariusParvin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DariusParvin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DariusParvin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DariusParvin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575907953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575907953"
         }
      },
      "author_association" : "NONE",
      "body" : "It seems like it might be misleading to have a method whose name is `send_self_transfer`, but then have a flag to say `send = False`. \r\n\r\nInstead, maybe it would be more straightforward to have a separate method `create_self_transfer`, that returns the tx hex. This function could be used within `send_self_transfer` to create the transaction before broadcasting it. \r\n\r\nI'm about to submit a PR for another test where I had a go at doing it this way.",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-15T02:08:05Z",
      "diff_hunk" : "@@ -55,25 +55,34 @@ def get_utxo(self, *, txid=''):\n             index = self._utxos.index(utxo)\n         return self._utxos.pop(index)\n \n-    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), from_node, utxo_to_spend=None):\n+    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), seq_num = 0xffffffff, from_node, utxo_to_spend=None, send_tx = True, default_fee = False):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575907953",
      "id" : 575907953,
      "line" : 58,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTkwNzk1Mw==",
      "original_commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "original_line" : 58,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 5,
      "pull_request_review_id" : 589608933,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-15T02:43:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575907953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/41220998?v=4",
         "events_url" : "https://api.github.com/users/DariusParvin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DariusParvin/followers",
         "following_url" : "https://api.github.com/users/DariusParvin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DariusParvin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DariusParvin",
         "id" : 41220998,
         "login" : "DariusParvin",
         "node_id" : "MDQ6VXNlcjQxMjIwOTk4",
         "organizations_url" : "https://api.github.com/users/DariusParvin/orgs",
         "received_events_url" : "https://api.github.com/users/DariusParvin/received_events",
         "repos_url" : "https://api.github.com/users/DariusParvin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DariusParvin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DariusParvin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DariusParvin"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575909995"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575909995"
         }
      },
      "author_association" : "NONE",
      "body" : "If `send_tx` was set to `False`, this utxo could be unspendable, potentially causing problems downstream where the `get_utxo` does not yield a spendable utxo. So I it's probably better to only append the new utxo if `send_tx == True`, after calling `sendrawtransaction`.",
      "commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "created_at" : "2021-02-15T02:18:23Z",
      "diff_hunk" : "@@ -55,25 +55,34 @@ def get_utxo(self, *, txid=''):\n             index = self._utxos.index(utxo)\n         return self._utxos.pop(index)\n \n-    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), from_node, utxo_to_spend=None):\n+    def send_self_transfer(self, *, fee_rate=Decimal(\"0.003\"), seq_num = 0xffffffff, from_node, utxo_to_spend=None, send_tx = True, default_fee = False):\n         \"\"\"Create and send a tx with the specified fee_rate. Fee may be exact or at most one satoshi higher than needed.\"\"\"\n         self._utxos = sorted(self._utxos, key=lambda k: k['value'])\n         utxo_to_spend = utxo_to_spend or self._utxos.pop()  # Pick the largest utxo (if none provided) and hope it covers the fee\n         vsize = Decimal(96)\n-        send_value = satoshi_round(utxo_to_spend['value'] - fee_rate * (vsize / 1000))\n+\n+        # if send_tx is set to False then calculate send_value without vsize\n+        if send_tx:\n+            send_value = satoshi_round(utxo_to_spend['value'] - fee_rate * (vsize / 1000))\n+        else:\n+            send_value = satoshi_round(utxo_to_spend['value'] - fee_rate)\n         fee = utxo_to_spend['value'] - send_value\n         assert send_value > 0\n \n         tx = CTransaction()\n-        tx.vin = [CTxIn(COutPoint(int(utxo_to_spend['txid'], 16), utxo_to_spend['vout']))]\n+        tx.vin = [CTxIn(COutPoint(int(utxo_to_spend['txid'], 16), utxo_to_spend['vout']), nSequence = seq_num)]\n         tx.vout = [CTxOut(int(send_value * COIN), self._scriptPubKey)]\n         tx.wit.vtxinwit = [CTxInWitness()]\n         tx.wit.vtxinwit[0].scriptWitness.stack = [CScript([OP_TRUE])]\n         tx_hex = tx.serialize().hex()\n \n         tx_info = from_node.testmempoolaccept([tx_hex])[0]\n         self._utxos.append({'txid': tx_info['txid'], 'vout': 0, 'value': send_value})",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21014#discussion_r575909995",
      "id" : 575909995,
      "line" : 80,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTkwOTk5NQ==",
      "original_commit_id" : "91c2848db8122d3a9ccee9f05775ccaf9bed2e19",
      "original_line" : 80,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 29,
      "pull_request_review_id" : 589608933,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21014",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-15T02:43:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575909995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/41220998?v=4",
         "events_url" : "https://api.github.com/users/DariusParvin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DariusParvin/followers",
         "following_url" : "https://api.github.com/users/DariusParvin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DariusParvin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DariusParvin",
         "id" : 41220998,
         "login" : "DariusParvin",
         "node_id" : "MDQ6VXNlcjQxMjIwOTk4",
         "organizations_url" : "https://api.github.com/users/DariusParvin/orgs",
         "received_events_url" : "https://api.github.com/users/DariusParvin/received_events",
         "repos_url" : "https://api.github.com/users/DariusParvin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DariusParvin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DariusParvin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DariusParvin"
      }
   }
]
