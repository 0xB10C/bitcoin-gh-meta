[
   {
      "author_association" : "MEMBER",
      "body" : "This is the first two commits from #16279. Thanks for your work, @TheBlueMatt!",
      "created_at" : "2019-11-14T17:18:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-553988839",
      "id" : 553988839,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1Mzk4ODgzOQ==",
      "updated_at" : "2019-11-14T17:18:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553988839",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #17997 (refactor: Remove mempool global from net by MarcoFalke)\n* #17693 (rpc: Add generateblock to mine a custom set of transactions by andrewtoth)\n* #17601 (Validation: Move CheckBlock() mutation guard to AcceptBlock() by jnewbery)\n* #15545 ([doc] explain why CheckBlock() is called before AcceptBlock by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-11-14T19:15:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554036805",
      "id" : 554036805,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDAzNjgwNQ==",
      "updated_at" : "2020-03-13T23:33:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554036805",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added a commit that deduplicates post-block-checking code, which makes the main commit in this PR smaller and (I hope) easier to understand.",
      "created_at" : "2019-11-14T21:19:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554084723",
      "id" : 554084723,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDA4NDcyMw==",
      "updated_at" : "2019-11-14T21:19:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554084723",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've taken the final (behaviour change) commit from #16279 and PR'ed it as #17485. That gives some justification for this PR. If we get the anti-dos / mutation checks back from validation immediately, we can use that state to mark the block as no longer in-flight, rather than by indirectly checking that the block has been written to disk.\r\n\r\nSeparating into two PRs makes this easier to review. This PR should result in no behaviour changes (modulo the `BlockChecked()` callback in net processing now being called immediately instead of on the background scheduler thread), and the follow-up PR has the (minor) behaviour change along with lots of commenting and justification.",
      "created_at" : "2019-11-14T22:28:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554110522",
      "id" : 554110522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDExMDUyMg==",
      "updated_at" : "2019-11-14T22:28:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554110522",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I found the last commit in this PR (71867666388bf1137b431f944fd430f262480eba) a bit hard to parse, so I split it up in my branch here: https://github.com/bitcoin/bitcoin/compare/master...dongcarl:2019-11-processnewblock-early-return-redo-last. The main change in the last commit on this branch resides in f46102be8fdd1ef8a21b821c121ed9fa027c9d32 on mine, and f46102be8fdd1ef8a21b821c121ed9fa027c9d32 also retains the same commit message. Feel free to use/use only to review/not use.",
      "created_at" : "2019-11-15T21:06:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554528497",
      "id" : 554528497,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDUyODQ5Nw==",
      "updated_at" : "2019-11-15T21:06:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554528497",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347011474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347011474"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps I'm understanding wrong but this shouldn't apply anymore?",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-15T21:07:35Z",
      "diff_hunk" : "@@ -199,22 +199,33 @@ static const uint64_t MIN_DISK_SPACE_FOR_BLOCK_FILES = 550 * 1024 * 1024;\n  * block is made active. Note that it does not, however, guarantee that the\n  * specific block passed to it has been checked for validity!\n  *\n- * If you want to *possibly* get feedback on whether pblock is valid, you must\n- * install a CValidationInterface (see validationinterface.h) - this will have\n- * its BlockChecked method called whenever *any* block completes validation.\n+ * Performs initial sanity checks using the provided BlockValidationState before\n+ * connecting any block(s). If you want to *possibly* get feedback on whether\n+ * pblock is valid beyond just cursory mutation/DoS checks, you must install\n+ * a CValidationInterface (see validationinterface.h) - this will have its\n+ * BlockChecked method called whenever *any* block completes validation (note",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347011474",
      "id" : 347011474,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzAxMTQ3NA==",
      "original_commit_id" : "71867666388bf1137b431f944fd430f262480eba",
      "original_position" : 11,
      "path" : "src/validation.h",
      "position" : 11,
      "pull_request_review_id" : 317869779,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347011474",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the branch @dongcarl ! I've reset to that and made a couple of minor comment changes.",
      "created_at" : "2019-11-15T22:19:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554551727",
      "id" : 554551727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDU1MTcyNw==",
      "updated_at" : "2019-11-15T22:19:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554551727",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347035231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347035231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "BlockChecked is called for any block that we try to connect to the chain. See the call in `ConnectTip()`:\r\n\r\n- if the call to `ConnectBlock()` failed, then we'll call `BlockChecked()` with a state that is NOT `IsValid()`.\r\n- if the call to `ConnectBlock()` succeeded, then the block has been connected and is part of the main chain, and we'll call `BlockChecked()` with a state that IS `IsValid()`.\r\n\r\nNote that we may never even call `ConnectTip()` if we don't try to connect the block to the most work chain.",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-15T22:23:13Z",
      "diff_hunk" : "@@ -199,22 +199,33 @@ static const uint64_t MIN_DISK_SPACE_FOR_BLOCK_FILES = 550 * 1024 * 1024;\n  * block is made active. Note that it does not, however, guarantee that the\n  * specific block passed to it has been checked for validity!\n  *\n- * If you want to *possibly* get feedback on whether pblock is valid, you must\n- * install a CValidationInterface (see validationinterface.h) - this will have\n- * its BlockChecked method called whenever *any* block completes validation.\n+ * Performs initial sanity checks using the provided BlockValidationState before\n+ * connecting any block(s). If you want to *possibly* get feedback on whether\n+ * pblock is valid beyond just cursory mutation/DoS checks, you must install\n+ * a CValidationInterface (see validationinterface.h) - this will have its\n+ * BlockChecked method called whenever *any* block completes validation (note",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347035231",
      "id" : 347035231,
      "in_reply_to_id" : 347011474,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzAzNTIzMQ==",
      "original_commit_id" : "71867666388bf1137b431f944fd430f262480eba",
      "original_position" : 11,
      "path" : "src/validation.h",
      "position" : 11,
      "pull_request_review_id" : 317901418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347035231",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347577049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347577049"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`submitblock_StateCacher` is the last client of validationinterface, I think we can go further, tweak it a bit and remove definitely `BlockChecked`, see : https://github.com/ariard/bitcoin/commits/2019-11-processnewblock-review\r\n(but maybe to include this in a follow-up cleanup PR?)",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-18T19:50:34Z",
      "diff_hunk" : "@@ -784,6 +784,9 @@ static UniValue submitblock(const JSONRPCRequest& request)\n     if (!new_block && accepted) {\n         return \"duplicate\";\n     }\n+    if (!dos_state.IsValid()) {\n+        return BIP22ValidationResult(dos_state);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347577049",
      "id" : 347577049,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU3NzA0OQ==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 5,
      "path" : "src/rpc/mining.cpp",
      "position" : 22,
      "pull_request_review_id" : 318587270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347577049",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347580252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347580252"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Isn't this check break `BlockChecked` where we check `state.IsValid` for promoting peer to compact block announcement?",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-18T19:57:34Z",
      "diff_hunk" : "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347580252",
      "id" : 347580252,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU4MDI1Mg==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 15,
      "path" : "src/net_processing.cpp",
      "position" : 33,
      "pull_request_review_id" : 318587270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347580252",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347582776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347582776"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can't this branch combined with `BlockChecked` by passing new_block as param? Even wonder if we still need `fNewBlock` in PNB, as  `BlockChecked`  erase block from `mapBlockSource` independently of validity/novelty",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-18T20:03:34Z",
      "diff_hunk" : "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {\n+        // The block failed anti-dos / mutation checks. Call BlockChecked() callback here.\n+        // This clears the block from mapBlockSource.\n+        BlockChecked(*pblock, state, connman);\n+    } else if (!new_block) {\n+        // Block was valid but we've seen it before. Clear it from mapBlockSource.\n         LOCK(cs_main);\n         ::mapBlockSource.erase(pblock->GetHash());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347582776",
      "id" : 347582776,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU4Mjc3Ng==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 22,
      "path" : "src/net_processing.cpp",
      "position" : 40,
      "pull_request_review_id" : 318587270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347582776",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347617540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347617540"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No. `BlockProcessed` is only called when `ProcessNewBlock()` returns early because the block failed `CheckBlock()` or `AcceptBlock()`. The logic you're talking about for promoting a peer to compact block announcement in `BlockChecked()` is only invoked when `BlockChecked()` is called after successfully connecting a valid block.",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-18T21:25:55Z",
      "diff_hunk" : "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347617540",
      "id" : 347617540,
      "in_reply_to_id" : 347580252,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzYxNzU0MA==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 15,
      "path" : "src/net_processing.cpp",
      "position" : 33,
      "pull_request_review_id" : 318640247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347617540",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347618870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347618870"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`BlockChecked()` will only be called from `BlockProcessed()` if the block failed `CheckBlock()`/`AcceptBlock()`. This else branch is catching the case where the block didn't fail, but we've seen it before.\r\n\r\nIf you think this can be cleaned up further, perhaps we can do it in a follow-up PR.",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-18T21:29:00Z",
      "diff_hunk" : "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {\n+        // The block failed anti-dos / mutation checks. Call BlockChecked() callback here.\n+        // This clears the block from mapBlockSource.\n+        BlockChecked(*pblock, state, connman);\n+    } else if (!new_block) {\n+        // Block was valid but we've seen it before. Clear it from mapBlockSource.\n         LOCK(cs_main);\n         ::mapBlockSource.erase(pblock->GetHash());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347618870",
      "id" : 347618870,
      "in_reply_to_id" : 347582776,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzYxODg3MA==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 22,
      "path" : "src/net_processing.cpp",
      "position" : 40,
      "pull_request_review_id" : 318640247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347618870",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347619936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347619936"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I was planning to do this as a follow-up PR.\r\n\r\nI've had a quick look at your branch. I think it misses breaks the 'promote to announcing compact blocks' behaviour. We'd want to move that to a different validation interface event (probably `UpdatedBlockTip()`)",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-18T21:31:33Z",
      "diff_hunk" : "@@ -784,6 +784,9 @@ static UniValue submitblock(const JSONRPCRequest& request)\n     if (!new_block && accepted) {\n         return \"duplicate\";\n     }\n+    if (!dos_state.IsValid()) {\n+        return BIP22ValidationResult(dos_state);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347619936",
      "id" : 347619936,
      "in_reply_to_id" : 347577049,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzYxOTkzNg==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 5,
      "path" : "src/rpc/mining.cpp",
      "position" : 22,
      "pull_request_review_id" : 318640247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347619936",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r348037038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348037038"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, right, the call to `BlockChecked` is still in `ConnectTip` path on your branch. I still think that's counter-intuitive to have both peer punishment and compact blocks promotion in one function, so would be down to split in a follow-up PR and like you said previously rely on `UpdatedBlockTip` for the latter.",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-19T16:38:50Z",
      "diff_hunk" : "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r348037038",
      "id" : 348037038,
      "in_reply_to_id" : 347580252,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODAzNzAzOA==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 15,
      "path" : "src/net_processing.cpp",
      "position" : 33,
      "pull_request_review_id" : 319183434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348037038",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r348038837"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348038837"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah yes, agree with you, better to do it in a follow-up PR to avoid breaking things inadvertently.",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-19T16:41:52Z",
      "diff_hunk" : "@@ -784,6 +784,9 @@ static UniValue submitblock(const JSONRPCRequest& request)\n     if (!new_block && accepted) {\n         return \"duplicate\";\n     }\n+    if (!dos_state.IsValid()) {\n+        return BIP22ValidationResult(dos_state);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r348038837",
      "id" : 348038837,
      "in_reply_to_id" : 347577049,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODAzODgzNw==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 5,
      "path" : "src/rpc/mining.cpp",
      "position" : 22,
      "pull_request_review_id" : 319185866,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348038837",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r349358840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349358840"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The documentation strikes me as repetitive with the code. Perhaps it could be phrased differently such that if the code changes the comment doesn't need to be updated.\r\n\r\nnit: s/was failed/failed",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-21T22:53:01Z",
      "diff_hunk" : "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r349358840",
      "id" : 349358840,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0OTM1ODg0MA==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 7,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 321241524,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349358840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4015903?v=4",
         "events_url" : "https://api.github.com/users/jkczyz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jkczyz/followers",
         "following_url" : "https://api.github.com/users/jkczyz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jkczyz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jkczyz",
         "id" : 4015903,
         "login" : "jkczyz",
         "node_id" : "MDQ6VXNlcjQwMTU5MDM=",
         "organizations_url" : "https://api.github.com/users/jkczyz/orgs",
         "received_events_url" : "https://api.github.com/users/jkczyz/received_events",
         "repos_url" : "https://api.github.com/users/jkczyz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jkczyz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jkczyz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r349799232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349799232"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Work in progress: https://github.com/jnewbery/bitcoin/tree/2019-11-remove-block-checked",
      "commit_id" : "e48152f3c509b3327f2ece480299eff30e3f7475",
      "created_at" : "2019-11-22T21:21:32Z",
      "diff_hunk" : "@@ -784,6 +784,9 @@ static UniValue submitblock(const JSONRPCRequest& request)\n     if (!new_block && accepted) {\n         return \"duplicate\";\n     }\n+    if (!dos_state.IsValid()) {\n+        return BIP22ValidationResult(dos_state);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r349799232",
      "id" : 349799232,
      "in_reply_to_id" : 347577049,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0OTc5OTIzMg==",
      "original_commit_id" : "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
      "original_position" : 5,
      "path" : "src/rpc/mining.cpp",
      "position" : 22,
      "pull_request_review_id" : 321816657,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
      "updated_at" : "2019-11-22T21:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349799232",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @jkczyz . I've updated the function comment to be less redundant.",
      "created_at" : "2019-11-22T21:27:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-557700722",
      "id" : 557700722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NzcwMDcyMg==",
      "updated_at" : "2019-11-22T21:27:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557700722",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-12-16T21:53:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-566261209",
      "id" : 566261209,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NjI2MTIwOQ==",
      "updated_at" : "2019-12-16T21:53:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/566261209",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2019-12-19T19:23:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-567627381",
      "id" : 567627381,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NzYyNzM4MQ==",
      "updated_at" : "2019-12-19T19:23:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/567627381",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-03-01T22:06:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-593151629",
      "id" : 593151629,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MzE1MTYyOQ==",
      "updated_at" : "2020-03-01T22:06:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593151629",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2020-03-13T20:46:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-598904334",
      "id" : 598904334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5ODkwNDMzNA==",
      "updated_at" : "2020-03-13T20:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598904334",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-03-16T15:16:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-599593329",
      "id" : 599593329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5OTU5MzMyOQ==",
      "updated_at" : "2020-03-16T15:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599593329",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks :octopus: . I've rebased on master.",
      "created_at" : "2020-03-22T02:18:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-602137630",
      "id" : 602137630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMjEzNzYzMA==",
      "updated_at" : "2020-03-22T02:18:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602137630",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
