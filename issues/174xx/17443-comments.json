[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r344854791"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344854791"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Here it seems should be either \"Setting-appropriate flags select\" or \"Setting appropriate flags selects\". \r\n\r\nI think it's the latter but it's not clear from the sentence.\r\n\r\nSuggest: s/would/will/",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2019-11-11T18:47:04Z",
      "diff_hunk" : "@@ -192,12 +192,11 @@ bool CheckFinalTx(const CTransaction &tx, int flags)\n {\n     AssertLockHeld(cs_main);\n \n-    // By convention a negative value for flags indicates that the\n-    // current network-enforced consensus rules should be used. In\n-    // a future soft-fork scenario that would mean checking which\n-    // rules would be enforced for the next block and setting the\n-    // appropriate flags. At the present time no soft-forks are\n-    // scheduled, so no flags are set.\n+    // By convention a negative value for flags indicates that no\n+    // soft-forked consensus rules should be used. Setting appropriate\n+    // flags select which rules would be enforced for the next block.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r344854791",
      "id" : 344854791,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDg1NDc5MQ==",
      "original_commit_id" : "c9609737208a238984717d16e13f770ea350bb95",
      "original_position" : 12,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 315085918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344854791",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r344855824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344855824"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/i.e/i.e./\r\n\r\nIt looks like \"softfork\" should be plural.",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2019-11-11T18:49:38Z",
      "diff_hunk" : "@@ -192,12 +192,11 @@ bool CheckFinalTx(const CTransaction &tx, int flags)\n {\n     AssertLockHeld(cs_main);\n \n-    // By convention a negative value for flags indicates that the\n-    // current network-enforced consensus rules should be used. In\n-    // a future soft-fork scenario that would mean checking which\n-    // rules would be enforced for the next block and setting the\n-    // appropriate flags. At the present time no soft-forks are\n-    // scheduled, so no flags are set.\n+    // By convention a negative value for flags indicates that no\n+    // soft-forked consensus rules should be used. Setting appropriate\n+    // flags select which rules would be enforced for the next block.\n+    // At the present time, only CSV softfork (i.e BIP 113) alter",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r344855824",
      "id" : 344855824,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NDg1NTgyNA==",
      "original_commit_id" : "c9609737208a238984717d16e13f770ea350bb95",
      "original_position" : 13,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 315085918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/344855824",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18278 (interfaces: Describe and follow some code conventions by ryanofsky)\n* #18096 (doc: IsFinalTx comment about nSequence & OP_CLTV by nothingmuch)\n* #17824 (wallet: Improve coin selection for destination groups >10 by fjahr)\n* #17579 ([refactor] Merge getreceivedby tally into GetReceived function by andrewtoth)\n* #17477 (Remove the mempool's NotifyEntryAdded and NotifyEntryRemoved signals by jnewbery)\n* #16528 (Native Descriptor Wallets using DescriptorScriptPubKeyMan by achow101)\n* #9381 (Remove CWalletTx merging logic from AddToWallet by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-11-11T19:38:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#issuecomment-552584176",
      "id" : 552584176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MjU4NDE3Ng==",
      "updated_at" : "2020-03-11T20:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/552584176",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r358329218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358329218"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe drop this sentence about CSV/LOCKTIME_MEDIAN_TIME_PAST. It seems only slightly relevant, and already pretty clear by looking at the code below. This sentence could also become out of date if the code below changes.",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2019-12-16T16:22:58Z",
      "diff_hunk" : "@@ -192,12 +192,11 @@ bool CheckFinalTx(const CTransaction &tx, int flags)\n {\n     AssertLockHeld(cs_main);\n \n-    // By convention a negative value for flags indicates that the\n-    // current network-enforced consensus rules should be used. In\n-    // a future soft-fork scenario that would mean checking which\n-    // rules would be enforced for the next block and setting the\n-    // appropriate flags. At the present time no soft-forks are\n-    // scheduled, so no flags are set.\n+    // By convention a negative value for flags indicates that no\n+    // soft-forked consensus rules should be used. Setting appropriate\n+    // flags select which rules would be enforced for the next block.\n+    // At the present time, only CSV softfork (i.e BIP 113) alter\n+    // nBlockTime meaning through LOCKTIME_MEDIAN_TIME_PAST flag.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r358329218",
      "id" : 358329218,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1ODMyOTIxOA==",
      "original_commit_id" : "c9609737208a238984717d16e13f770ea350bb95",
      "original_position" : 14,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 332692782,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358329218",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r358335066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358335066"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I understand correcting \"negative value for flags indicates that _the current network-enforced consensus rules_ should be used\" to \"negative value for flags indicates that _no soft-forked consensus rules_ should be used\".\r\n\r\nBut I think the other changes to this comment make it less clear. I'm wondering if something about the following removed section is inaccurate or if it was shortened and rewritten for a different reason:\r\n\r\n> In a future soft-fork scenario that would mean checking which rules would be enforced for the next block and setting the appropriate flags. At the present time no soft-forks are scheduled, so no flags are set.",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2019-12-16T16:32:53Z",
      "diff_hunk" : "@@ -192,12 +192,11 @@ bool CheckFinalTx(const CTransaction &tx, int flags)\n {\n     AssertLockHeld(cs_main);\n \n-    // By convention a negative value for flags indicates that the\n-    // current network-enforced consensus rules should be used. In\n-    // a future soft-fork scenario that would mean checking which\n-    // rules would be enforced for the next block and setting the\n-    // appropriate flags. At the present time no soft-forks are\n-    // scheduled, so no flags are set.\n+    // By convention a negative value for flags indicates that no\n+    // soft-forked consensus rules should be used. Setting appropriate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r358335066",
      "id" : 358335066,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1ODMzNTA2Ng==",
      "original_commit_id" : "c9609737208a238984717d16e13f770ea350bb95",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : 11,
      "pull_request_review_id" : 332692782,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/358335066",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ryanofsky Thanks for review!\r\n\r\nI went ahead on replaced `checkFinalTx` by `CheckFinalWalletTx` which itself calls `IsFinalTx` by caching median time past in the wallet.\r\n\r\nAbout testing, I think a bit about it, it's quite hard because contrary to the consensus code where finality enforcement is going to change after softfork activation, wallet is always using current finality consensus rules. So that would need to have 2 versions of the wallet. I think that's an issue already known of our current wallet test framework..\r\n\r\n",
      "created_at" : "2019-12-18T00:49:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#issuecomment-566816288",
      "id" : 566816288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NjgxNjI4OA==",
      "updated_at" : "2019-12-18T00:49:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/566816288",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359105468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359105468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the comment was written when BIP113 code was merged but no yet activated and scheduled for activation. It's right we don't have soft-forks scheduled now, but it's false there is no flag to set (LOCKTIME_MEDIAN_TIME_PAST)",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2019-12-18T00:55:46Z",
      "diff_hunk" : "@@ -192,12 +192,11 @@ bool CheckFinalTx(const CTransaction &tx, int flags)\n {\n     AssertLockHeld(cs_main);\n \n-    // By convention a negative value for flags indicates that the\n-    // current network-enforced consensus rules should be used. In\n-    // a future soft-fork scenario that would mean checking which\n-    // rules would be enforced for the next block and setting the\n-    // appropriate flags. At the present time no soft-forks are\n-    // scheduled, so no flags are set.\n+    // By convention a negative value for flags indicates that no\n+    // soft-forked consensus rules should be used. Setting appropriate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359105468",
      "id" : 359105468,
      "in_reply_to_id" : 358335066,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1OTEwNTQ2OA==",
      "original_commit_id" : "c9609737208a238984717d16e13f770ea350bb95",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : 11,
      "pull_request_review_id" : 333674536,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359105468",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "01377a5\r\n\r\nMoved `IsFinalTx` from `consensus/tx_verify.h` to `consensus/tx_check.h` as it's context-independent and so let wallet code called it without linking against server one. Should fix travis build failure.",
      "created_at" : "2019-12-18T18:28:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#issuecomment-567153538",
      "id" : 567153538,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NzE1MzUzOA==",
      "updated_at" : "2019-12-18T18:28:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/567153538",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359502232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359502232"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359105468\r\n\r\nI don't understand \"it's false there is no flag to set (LOCKTIME_MEDIAN_TIME_PAST).\" since this code isn't setting LOCKTIME_MEDIAN_TIME_PAST, it's setting 0...\r\n\r\nBut more broadly, I don't understand why there would be a reason to keep this code if it isn't going to serve a function in a future soft fork. Why not simplify by making the CheckFinalTx `flags` argument required instead of optional, and dropping `std::max`. and dropping this comment?\r\n\r\n",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2019-12-18T18:32:25Z",
      "diff_hunk" : "@@ -192,12 +192,11 @@ bool CheckFinalTx(const CTransaction &tx, int flags)\n {\n     AssertLockHeld(cs_main);\n \n-    // By convention a negative value for flags indicates that the\n-    // current network-enforced consensus rules should be used. In\n-    // a future soft-fork scenario that would mean checking which\n-    // rules would be enforced for the next block and setting the\n-    // appropriate flags. At the present time no soft-forks are\n-    // scheduled, so no flags are set.\n+    // By convention a negative value for flags indicates that no\n+    // soft-forked consensus rules should be used. Setting appropriate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359502232",
      "id" : 359502232,
      "in_reply_to_id" : 358335066,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1OTUwMjIzMg==",
      "original_commit_id" : "c9609737208a238984717d16e13f770ea350bb95",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : 11,
      "pull_request_review_id" : 334177086,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359502232",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359507613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359507613"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Replace Chain::checkFinal by CWallet::CheckFinalWalletTx\" (0ef43cef24b837367a90c97a31470e0f19f18552)\r\n\r\nI see this comment is copied from [existing code](https://github.com/bitcoin/bitcoin/blob/6fef85bfa3cd7f76e83b8b57f9e4acd63eb664ec/src/validation.cpp#L200-L205), but the part about this function being called from `CBlock::AcceptBlock` doesn't apply here, right? Would it be ok to drop this long comment and simply write that we are passing  `m_last_block_processed_height + 1` because we are interested to know if the transaction could be included in the next block, not the current tip?",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2019-12-18T18:44:02Z",
      "diff_hunk" : "@@ -3964,6 +3965,27 @@ bool CWalletTx::IsImmatureCoinBase() const\n     return GetBlocksToMaturity() > 0;\n }\n \n+bool CWalletTx::isFinal() const\n+{\n+    return pwallet->CheckFinalWalletTx(*tx);\n+}\n+\n+bool CWallet::CheckFinalWalletTx(const CTransaction& tx) const\n+{\n+    // Wallet not doing historical validation work, it's only\n+    // interested by the nLocktime evaluation as enforced on\n+    // current chain tip (BIP 113). In the future, if there\n+    // is forks changing this, wallet should be updated.\n+\n+    // CheckFinalWalletTx() uses m_last_block_processed_height +1\n+    // to evaluate nLockTime because when IsFinalTx() is called within\n+    // CBlock::AcceptBlock(), the height of the block *being*\n+    // evaluated is what is used. Thus if we want to know if a\n+    // transaction can be part of the *next* block, we need to call\n+    // IsFinalTx() with one more than m_last_block_processed_height.\n+    return IsFinalTx(tx, m_last_block_processed_height + 1, m_last_block_median_time_past);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359507613",
      "id" : 359507613,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1OTUwNzYxMw==",
      "original_commit_id" : "0ef43cef24b837367a90c97a31470e0f19f18552",
      "original_position" : 48,
      "path" : "src/wallet/wallet.cpp",
      "position" : 105,
      "pull_request_review_id" : 334177086,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359507613",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359635222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359635222"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "CheckFinalTx is called with STANDARD_LOCKTIME_VERIFY_FLAGS in `PreChecks` and `removeForReorg`. Given it's only mempool I think you'e right, you can hardcode that you always want to use the most recent consensus rules but I would prefer to do that as a follow-up to avoid missing something.",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2019-12-19T00:25:32Z",
      "diff_hunk" : "@@ -192,12 +192,11 @@ bool CheckFinalTx(const CTransaction &tx, int flags)\n {\n     AssertLockHeld(cs_main);\n \n-    // By convention a negative value for flags indicates that the\n-    // current network-enforced consensus rules should be used. In\n-    // a future soft-fork scenario that would mean checking which\n-    // rules would be enforced for the next block and setting the\n-    // appropriate flags. At the present time no soft-forks are\n-    // scheduled, so no flags are set.\n+    // By convention a negative value for flags indicates that no\n+    // soft-forked consensus rules should be used. Setting appropriate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359635222",
      "id" : 359635222,
      "in_reply_to_id" : 358335066,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1OTYzNTIyMg==",
      "original_commit_id" : "c9609737208a238984717d16e13f770ea350bb95",
      "original_position" : 11,
      "path" : "src/validation.cpp",
      "position" : 11,
      "pull_request_review_id" : 334346173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359635222",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359636084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359636084"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The comment is about that we want to call `IsFinalTx` the same way it's called in `AcceptBlock`, i.e with `nBlockHeight` set to tip+1 to evaluate the consensus rule identically in both wallet and node. You don't want discrepancies between them. I think the last sentence is expressing that \"if a transaction can be part of the *next* block\", and speaking of `m_last_block_processed_height` is verbose but at least you avoid confusion between wallet tip and node tip.\r\n",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2019-12-19T00:29:18Z",
      "diff_hunk" : "@@ -3964,6 +3965,27 @@ bool CWalletTx::IsImmatureCoinBase() const\n     return GetBlocksToMaturity() > 0;\n }\n \n+bool CWalletTx::isFinal() const\n+{\n+    return pwallet->CheckFinalWalletTx(*tx);\n+}\n+\n+bool CWallet::CheckFinalWalletTx(const CTransaction& tx) const\n+{\n+    // Wallet not doing historical validation work, it's only\n+    // interested by the nLocktime evaluation as enforced on\n+    // current chain tip (BIP 113). In the future, if there\n+    // is forks changing this, wallet should be updated.\n+\n+    // CheckFinalWalletTx() uses m_last_block_processed_height +1\n+    // to evaluate nLockTime because when IsFinalTx() is called within\n+    // CBlock::AcceptBlock(), the height of the block *being*\n+    // evaluated is what is used. Thus if we want to know if a\n+    // transaction can be part of the *next* block, we need to call\n+    // IsFinalTx() with one more than m_last_block_processed_height.\n+    return IsFinalTx(tx, m_last_block_processed_height + 1, m_last_block_median_time_past);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r359636084",
      "id" : 359636084,
      "in_reply_to_id" : 359507613,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1OTYzNjA4NA==",
      "original_commit_id" : "0ef43cef24b837367a90c97a31470e0f19f18552",
      "original_position" : 48,
      "path" : "src/wallet/wallet.cpp",
      "position" : 105,
      "pull_request_review_id" : 334347246,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/359636084",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated bbdc8b5, extended both `IsTrusted` declarations with NO_THREAD_SAFETY_ANALYSIS to pass static analysis on macOS and so remove travis failure.",
      "created_at" : "2020-01-03T23:32:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#issuecomment-570729250",
      "id" : 570729250,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MDcyOTI1MA==",
      "updated_at" : "2020-01-04T00:30:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/570729250",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r364474972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364474972"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Replace Chain::checkFinal by CWallet::CheckFinalWalletTx\" (1f479751b2eaf6f17ae76334b72ebc5fd76d8956)\r\n\r\nI think it'd be safer to just add `AssertLockHeld` statements if the compiler can't determine that a particular lock is held, than to disable safety analysis altogether. On my system, the following changes seem to work:\r\n\r\n```diff\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex 9d291f0b585..c702f90681d 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -1882,6 +1882,7 @@ bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain) const\r\n bool CWalletTx::IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const\r\n {\r\n     // Quick answer in most cases\r\n+    AssertLockHeld(pwallet->cs_wallet);\r\n     if (!pwallet->CheckFinalWalletTx(*tx)) return false;\r\n     int nDepth = GetDepthInMainChain();\r\n     if (nDepth >= 1) return true;\r\n@@ -3967,6 +3968,7 @@ bool CWalletTx::IsImmatureCoinBase() const\r\n \r\n bool CWalletTx::isFinal() const\r\n {\r\n+    AssertLockHeld(pwallet->cs_wallet);\r\n     return pwallet->CheckFinalWalletTx(*tx);\r\n }\r\n \r\ndiff --git a/src/wallet/wallet.h b/src/wallet/wallet.h\r\nindex acf0de45f1c..4ae39ba328a 100644\r\n--- a/src/wallet/wallet.h\r\n+++ b/src/wallet/wallet.h\r\n@@ -477,8 +477,8 @@ public:\r\n     bool IsEquivalentTo(const CWalletTx& tx) const;\r\n \r\n     bool InMempool() const;\r\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const NO_THREAD_SAFETY_ANALYSIS;\r\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const NO_THREAD_SAFETY_ANALYSIS;\r\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const;\r\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const;\r\n \r\n     int64_t GetTxTime() const;\r\n \r\n@@ -531,7 +531,7 @@ public:\r\n     const uint256& GetHash() const { return tx->GetHash(); }\r\n     bool IsCoinBase() const { return tx->IsCoinBase(); }\r\n     bool IsImmatureCoinBase() const;\r\n-    bool isFinal() const NO_THREAD_SAFETY_ANALYSIS;\r\n+    bool isFinal() const;\r\n };\r\n \r\n class COutput\r\n```\r\n\r\n\r\n\r\n6e10c40e9507c2ff45d47ca863778fff85584b36",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2020-01-08T22:28:26Z",
      "diff_hunk" : "@@ -477,8 +477,8 @@ class CWalletTx\n     bool IsEquivalentTo(const CWalletTx& tx) const;\n \n     bool InMempool() const;\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const;\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const;\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const NO_THREAD_SAFETY_ANALYSIS;\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const NO_THREAD_SAFETY_ANALYSIS;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r364474972",
      "id" : 364474972,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ3NDk3Mg==",
      "original_commit_id" : "1f479751b2eaf6f17ae76334b72ebc5fd76d8956",
      "original_position" : 7,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 340186421,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/364474972",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r367693585"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367693585"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Did you test on a Linux ? IIRC clang static analysis only work on MacOS. `AssertLockHeld` is lock checking at runtime",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2020-01-16T22:59:48Z",
      "diff_hunk" : "@@ -477,8 +477,8 @@ class CWalletTx\n     bool IsEquivalentTo(const CWalletTx& tx) const;\n \n     bool InMempool() const;\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const;\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const;\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const NO_THREAD_SAFETY_ANALYSIS;\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const NO_THREAD_SAFETY_ANALYSIS;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r367693585",
      "id" : 367693585,
      "in_reply_to_id" : 364474972,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY5MzU4NQ==",
      "original_commit_id" : "1f479751b2eaf6f17ae76334b72ebc5fd76d8956",
      "original_position" : 7,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 344272652,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367693585",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r367700050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367700050"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Did you test on a Linux ? IIRC clang static analysis only work on MacOS. `AssertLockHeld` is lock checking at runtime\r\n\r\nAssertLockHeld does affect static analysis, because it sets the `assert_exclusive_lock` attribute, see https://clang.llvm.org/docs/ThreadSafetyAnalysis.html. I am testing on linux, and I am using clang and have static analysis enabled. The following change works fine for me with the asserts added, so still think NO_THREAD_SAFETY_ANALYSIS annotations are unneeded.\r\n\r\n```diff\r\n--- a/src/wallet/wallet.h\r\n+++ b/src/wallet/wallet.h\r\n@@ -481,12 +481,12 @@ public:\r\n     // annotation \"EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\". The\r\n     // annotation \"NO_THREAD_SAFETY_ANALYSIS\" was temporarily added to avoid\r\n     // having to resolve the issue of member access into incomplete type CWallet.\r\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const NO_THREAD_SAFETY_ANALYSIS;\r\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const;\r\n     // TODO: Remove \"NO_THREAD_SAFETY_ANALYSIS\" and replace it with the correct\r\n     // annotation \"EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\". The\r\n     // annotation \"NO_THREAD_SAFETY_ANALYSIS\" was temporarily added to avoid\r\n     // having to resolve the issue of member access into incomplete type CWallet.\r\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const NO_THREAD_SAFETY_ANALYSIS;\r\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const;\r\n \r\n     int64_t GetTxTime() const;\r\n \r\n@@ -543,7 +543,7 @@ public:\r\n     // annotation \"EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\". The\r\n     // annotation \"NO_THREAD_SAFETY_ANALYSIS\" was temporarily added to avoid\r\n     // having to resolve the issue of member access into incomplete type CWallet.\r\n-    bool isFinal() const NO_THREAD_SAFETY_ANALYSIS;\r\n+    bool isFinal() const;\r\n };\r\n```",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2020-01-16T23:21:20Z",
      "diff_hunk" : "@@ -477,8 +477,8 @@ class CWalletTx\n     bool IsEquivalentTo(const CWalletTx& tx) const;\n \n     bool InMempool() const;\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const;\n-    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const;\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain) const NO_THREAD_SAFETY_ANALYSIS;\n+    bool IsTrusted(interfaces::Chain::Lock& locked_chain, std::set<uint256>& trusted_parents) const NO_THREAD_SAFETY_ANALYSIS;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r367700050",
      "id" : 367700050,
      "in_reply_to_id" : 364474972,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzcwMDA1MA==",
      "original_commit_id" : "1f479751b2eaf6f17ae76334b72ebc5fd76d8956",
      "original_position" : 7,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 344280851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-16T23:22:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367700050",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r368250007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368250007"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: some grammar improvement on this paragraph\r\n\r\n```\r\n    // The wallet is not doing historical validation work, it's only\r\n    // interested in the nLocktime evaluation as enforced on\r\n    // the current chain tip (BIP 113). If there are forks changing\r\n    // this in the future, the wallet should be updated.\r\n```",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2020-01-18T21:39:14Z",
      "diff_hunk" : "@@ -3960,6 +3967,29 @@ bool CWalletTx::IsImmatureCoinBase() const\n     return GetBlocksToMaturity() > 0;\n }\n \n+bool CWalletTx::isFinal() const\n+{\n+    AssertLockHeld(pwallet->cs_wallet);\n+    return pwallet->CheckFinalWalletTx(*tx);\n+}\n+\n+bool CWallet::CheckFinalWalletTx(const CTransaction& tx) const\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Wallet not doing historical validation work, it's only",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r368250007",
      "id" : 368250007,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI1MDAwNw==",
      "original_commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "original_position" : 94,
      "path" : "src/wallet/wallet.cpp",
      "position" : 94,
      "pull_request_review_id" : 344963927,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-18T21:46:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/368250007",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r372640391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372640391"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for review, will take them if I have to update PR!",
      "commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "created_at" : "2020-01-29T21:30:18Z",
      "diff_hunk" : "@@ -3960,6 +3967,29 @@ bool CWalletTx::IsImmatureCoinBase() const\n     return GetBlocksToMaturity() > 0;\n }\n \n+bool CWalletTx::isFinal() const\n+{\n+    AssertLockHeld(pwallet->cs_wallet);\n+    return pwallet->CheckFinalWalletTx(*tx);\n+}\n+\n+bool CWallet::CheckFinalWalletTx(const CTransaction& tx) const\n+{\n+    AssertLockHeld(cs_wallet);\n+    // Wallet not doing historical validation work, it's only",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#discussion_r372640391",
      "id" : 372640391,
      "in_reply_to_id" : 368250007,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0MDM5MQ==",
      "original_commit_id" : "9afb8ddd1d9406a623d209bc5a4a5e955f0b806c",
      "original_position" : 94,
      "path" : "src/wallet/wallet.cpp",
      "position" : 94,
      "pull_request_review_id" : 350437766,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17443",
      "updated_at" : "2020-01-29T21:30:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372640391",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-01-30T06:07:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#issuecomment-580098323",
      "id" : 580098323,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDA5ODMyMw==",
      "updated_at" : "2020-01-30T06:07:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580098323",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-03-19T18:14:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17443#issuecomment-601336084",
      "id" : 601336084,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwMTMzNjA4NA==",
      "updated_at" : "2020-03-19T18:14:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601336084",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
