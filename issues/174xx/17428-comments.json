[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19860 (Improve diversification of new connections: privacy and stability by naumenkogs)\n* #19858 (Periodically make block-relay connections and sync headers by sdaftuar)\n* #19724 ([net] Cleanup connection types- followups by amitiuttarwar)\n* #19697 (Improvements on ADDR caching by naumenkogs)\n* #18077 (net: Add NAT-PMP port forwarding support by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-11-09T23:42:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-552147683",
      "id" : 552147683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MjE0NzY4Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-02T21:15:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/552147683",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Don't think this should get in the way of implementing something like this, but have to note here, as it's a significant change of behavior from before: reconnecting to peers \"aggressively\", was, up to now, the reserve of spy nodes and mass-connectors and such. For normal nodes the chance of making the same outgoing connection twice was pretty low. Historically this has been one of the ways used to detect these.",
      "created_at" : "2019-11-10T11:03:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-552184378",
      "id" : 552184378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MjE4NDM3OA==",
      "updated_at" : "2019-11-10T11:05:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/552184378",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It would be really good to limit it so that an honest node won't attempt to connect twice to the same peer through this mechanism for some prudent amount of time... like two minutes.\r\n\r\nI don't think it would cause any harm to the intent of this mechanism to not bring them up as fast as possible, and it would avoid  tripping up detection of aggressive mass connectors.",
      "created_at" : "2019-11-13T18:11:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-553531390",
      "id" : 553531390,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1MzUzMTM5MA==",
      "updated_at" : "2019-11-13T18:11:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553531390",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not sure if Iâm misreading this code (I havenât tested it), but it looks like on restart we would only  attempt to connect once to each anchor, and then it gets removed from consideration.  Does that satisfy the concern about rapid reconnects?  I guess if a user rapidly restarted their node, we could see rapid connections to the same peers, but that seems pretty weird.\r\n\r\nAnyway I just skimmed the discussion in #17326.  I think Greg or Matt commented that we shouldnât do this with all our block-relay-only connections, but since we only have 2 at the moment, perhaps itâs fine for now.  And then in the future if we expand to say 8 block-relay peers we might still cap the anchors at 2.  Does that reflect the thinking of others as well?",
      "created_at" : "2019-11-14T20:49:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-554073351",
      "id" : 554073351,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NDA3MzM1MQ==",
      "updated_at" : "2019-11-14T20:49:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554073351",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r346539871"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346539871"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think by putting this logic down here, youâre bypassing some important filtering that happens in the loop above, where we skip over some entries that addrMan gives us (for instance, the `IsReachable()â check).  I think the best thing would be to move this logic up to that loop (similar to the tried table collision selector) so that all those other criteria are still enforced.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2019-11-14T20:52:30Z",
      "diff_hunk" : "@@ -1863,11 +1863,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (block_relay_only && !m_anchors.empty()) {\n+                addrConnect = m_anchors.back();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r346539871",
      "id" : 346539871,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjUzOTg3MQ==",
      "original_commit_id" : "99d6f6fc6c11c7797dcf232be75d1803d7cacfa1",
      "original_line" : 1867,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 317252129,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346539871",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r348988284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348988284"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2019-11-21T09:53:23Z",
      "diff_hunk" : "@@ -1863,11 +1863,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (block_relay_only && !m_anchors.empty()) {\n+                addrConnect = m_anchors.back();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r348988284",
      "id" : 348988284,
      "in_reply_to_id" : 346539871,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODk4ODI4NA==",
      "original_commit_id" : "99d6f6fc6c11c7797dcf232be75d1803d7cacfa1",
      "original_line" : 1867,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 320757443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348988284",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sdaftuar \r\n\r\nThank you for your review. Your comment has been addressed.\r\n\r\nAlso, an additional safety check added to \"p2p: Integrate ReadAnchors() into CConnman()\" commit in the latest push.",
      "created_at" : "2019-11-21T09:56:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-557008273",
      "id" : 557008273,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU1NzAwODI3Mw==",
      "updated_at" : "2019-11-21T09:56:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557008273",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367057240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367057240"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why clear the whole instead of picking randomly `m_max_outbound_block_relay` among the anchors set? If one of our most recent anchors isn't reliable we should be allowed to pick up among older anchors to still of the counter-measure. ",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-15T19:14:13Z",
      "diff_hunk" : "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    if (m_anchors.size() > m_max_outbound_block_relay) {\n+        // Keep our policy safe.\n+        m_anchors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367057240",
      "id" : 367057240,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA1NzI0MA==",
      "original_commit_id" : "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
      "original_line" : 2190,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 343456401,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367057240",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367058564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367058564"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: isn't cleaner to avoid read() in CConnman constructor and instead do it in CConnman::Start like we do for peers.dat?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-15T19:17:03Z",
      "diff_hunk" : "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367058564",
      "id" : 367058564,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA1ODU2NA==",
      "original_commit_id" : "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
      "original_line" : 2187,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 343456401,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367058564",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367073224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367073224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "May we check here also `nOutboundFullRelay`, and so keep same connection order, i.e full-relay then block-only or is there any advantage to invert order ?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-15T19:48:43Z",
      "diff_hunk" : "@@ -1805,11 +1807,24 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddress addr;\n+            if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay) && !fFeeler) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367073224",
      "id" : 367073224,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA3MzIyNA==",
      "original_commit_id" : "d405145e8f935b454ba77e23cf7327515b85151e",
      "original_line" : 1898,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 343456401,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367073224",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367081001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367081001"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What do you think about waiting some time like 24hours or one block announcement before to qualify node as anchor? That would require at least some good behavior from it, that said and may favor too much well-reliable nodes and decay network-wide connectivity..\r\n\r\nnit: you may use scheduler for DumpAnchors like we do for DumpAddresses, that would avoid file syscalls while holding cs_main",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-15T20:05:50Z",
      "diff_hunk" : "@@ -2088,6 +2088,9 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                       pfrom->nVersion.load(), pfrom->nStartingHeight,\n                       pfrom->GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom->addr.ToString()) : \"\"),\n                       pfrom->m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom->m_tx_relay) {\n+                DumpAnchors(connman->m_anchors_db_path, connman->GetBlockRelayNodeAddresses());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367081001",
      "id" : 367081001,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA4MTAwMQ==",
      "original_commit_id" : "a41cf3dedb70f418d3003b182ce1d925576161eb",
      "original_line" : 2092,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 343456401,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/367081001",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added 0.20 milestone as this mitigates a security issue so it would be good to have.",
      "created_at" : "2020-01-20T20:09:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-576415049",
      "id" : 576415049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NjQxNTA0OQ==",
      "updated_at" : "2020-01-20T20:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/576415049",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r369783170"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369783170"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can use [`logging/timer.h`](https://github.com/bitcoin/bitcoin/blob/master/src/logging/timer.h#L96-L101) if you care to. [(example)](https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L2296)",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-22T20:21:48Z",
      "diff_hunk" : "@@ -165,3 +165,10 @@ std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path)\n \n     return ret;\n }\n+\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors)\n+{\n+    int64_t start = GetTimeMillis();\n+    SerializeFileDB(\"anchors\", anchors_db_path, anchors);\n+    LogPrintf(\"Flushed %d anchor outbound peer addresses to anchors.dat in %d ms\\n\", anchors.size(), GetTimeMillis() - start);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r369783170",
      "id" : 369783170,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc4MzE3MA==",
      "original_commit_id" : "161dfb8aa4c534c2faea403bd515a26d10c952fe",
      "original_line" : 173,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 346876682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369783170",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r369789242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369789242"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I like the idea of moving this onto the scheduler thread, but not a huge deal given this only happens once per blocks-only connection.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-22T20:36:26Z",
      "diff_hunk" : "@@ -2088,6 +2088,9 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                       pfrom->nVersion.load(), pfrom->nStartingHeight,\n                       pfrom->GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom->addr.ToString()) : \"\"),\n                       pfrom->m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom->m_tx_relay) {\n+                DumpAnchors(connman->m_anchors_db_path, connman->GetBlockRelayNodeAddresses());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r369789242",
      "id" : 369789242,
      "in_reply_to_id" : 367081001,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc4OTI0Mg==",
      "original_commit_id" : "a41cf3dedb70f418d3003b182ce1d925576161eb",
      "original_line" : 2092,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 346876682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/369789242",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ariard \r\n\r\nThe only idea of this PR is to make a node to try restore outbound block-relay-only connections as they were just before node restart. It is expected that this change in node behavior mitigates restart-based eclipse attacks without significant other tradeoffs.\r\n\r\n> IMO before to go forward we need to agree on a) the scope of anchors: full-relay, block-relay, both...\r\n\r\nAnchoring as a new procedure, or anchors as \"seemingly safe\" nodes are out of the scope of this PR.\r\n\r\n>  b) anchors selection & lifecyle, i.e after how much time do we select them or based on any metrics, do we prune them from anchors.dat, do we keep a bigger file and select randomly from it\r\n\r\nWith an idea _to make a node to try restore outbound block-relay-only connections as they were just before node restart_, anchors are the last known outbound block-relay-only connections only.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/17428#discussion_r367081001\r\n> What do you think about waiting some time like 24hours or one block announcement before to qualify node as anchor? That would require at least some good behavior from it, that said and may favor too much well-reliable nodes and decay network-wide connectivity..\r\n\r\nIn this PR anchors are considered as the last known outbound block-relay-only connections, not as \"presumable safe\" ones.",
      "created_at" : "2020-01-26T13:09:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-578500393",
      "id" : 578500393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3ODUwMDM5Mw==",
      "updated_at" : "2020-01-26T13:09:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578500393",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371009058"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009058"
         }
      },
      "author_association" : "MEMBER",
      "body" : "~I'd prefer to initialize `m_anchors` member in constructor.~",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-26T15:46:26Z",
      "diff_hunk" : "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371009058",
      "id" : 371009058,
      "in_reply_to_id" : 367058564,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAwOTA1OA==",
      "original_commit_id" : "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
      "original_line" : 2187,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 348387692,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009058",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371009626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009626"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The worst case is assumed. If condition `m_anchors.size() > m_max_outbound_block_relay` is satisfied, we could suppose that the `anchors.dat` file is wrong or corrupted.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-26T15:53:38Z",
      "diff_hunk" : "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    if (m_anchors.size() > m_max_outbound_block_relay) {\n+        // Keep our policy safe.\n+        m_anchors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371009626",
      "id" : 371009626,
      "in_reply_to_id" : 367057240,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAwOTYyNg==",
      "original_commit_id" : "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
      "original_line" : 2190,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 348388178,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371009626",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371020152"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371020152"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The order is not inverted. The first target \"anchors\" is added, and was not present before, i.e., the new order is \"anchors\" then \"full-relay\" then \"block-relay-only\".\r\nIf anchors would not the first, they could be connected as other type nodes, and anchoring could not happen.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-26T18:31:04Z",
      "diff_hunk" : "@@ -1805,11 +1807,24 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddress addr;\n+            if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay) && !fFeeler) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371020152",
      "id" : 371020152,
      "in_reply_to_id" : 367073224,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyMDE1Mg==",
      "original_commit_id" : "d405145e8f935b454ba77e23cf7327515b85151e",
      "original_line" : 1898,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 348396951,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371020152",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371021403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371021403"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> nit: you may use scheduler for DumpAnchors like we do for DumpAddresses, that would avoid file syscalls while holding cs_main\r\n\r\n> I like the idea of moving this onto the scheduler thread, but not a huge deal given this only happens once per blocks-only connection.\r\n\r\nAgree that using `CScheduler.scheduleFromNow()` for `DumpAnchors` is an improvement. Let's leave it for follow ups.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-26T18:52:21Z",
      "diff_hunk" : "@@ -2088,6 +2088,9 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                       pfrom->nVersion.load(), pfrom->nStartingHeight,\n                       pfrom->GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom->addr.ToString()) : \"\"),\n                       pfrom->m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom->m_tx_relay) {\n+                DumpAnchors(connman->m_anchors_db_path, connman->GetBlockRelayNodeAddresses());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371021403",
      "id" : 371021403,
      "in_reply_to_id" : 367081001,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyMTQwMw==",
      "original_commit_id" : "a41cf3dedb70f418d3003b182ce1d925576161eb",
      "original_line" : 2092,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 348397982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371021403",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371023351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023351"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in the latest push.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-26T19:24:53Z",
      "diff_hunk" : "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371023351",
      "id" : 371023351,
      "in_reply_to_id" : 367058564,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyMzM1MQ==",
      "original_commit_id" : "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
      "original_line" : 2187,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 348399659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023351",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371023391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023391"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks. Done in the latest push.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-26T19:25:36Z",
      "diff_hunk" : "@@ -165,3 +165,10 @@ std::vector<CAddress> ReadAnchors(const fs::path& anchors_db_path)\n \n     return ret;\n }\n+\n+void DumpAnchors(const fs::path& anchors_db_path, const std::vector<CAddress>& anchors)\n+{\n+    int64_t start = GetTimeMillis();\n+    SerializeFileDB(\"anchors\", anchors_db_path, anchors);\n+    LogPrintf(\"Flushed %d anchor outbound peer addresses to anchors.dat in %d ms\\n\", anchors.size(), GetTimeMillis() - start);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r371023391",
      "id" : 371023391,
      "in_reply_to_id" : 369783170,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyMzM5MQ==",
      "original_commit_id" : "161dfb8aa4c534c2faea403bd515a26d10c952fe",
      "original_line" : 173,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/addrdb.cpp",
      "position" : null,
      "pull_request_review_id" : 348399689,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/371023391",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated d405145e8f935b454ba77e23cf7327515b85151e -> f2b4cfdc75952e61ba98eeffe26b2f86a78a45c9 ([pr17428.02](https://github.com/hebasto/bitcoin/commits/pr17428.02) -> [pr17428.03](https://github.com/hebasto/bitcoin/commits/pr17428.03), [compare](https://github.com/hebasto/bitcoin/compare/pr17428.02..pr17428.03)).\r\n\r\n@ariard @jamesob \r\n\r\nThank you for your reviews. Your comments have been addressed.\r\n\r\n\r\n@jamesob\r\n> ... seeing some strange behavior locally.\r\n\r\nAdded additional logging when connecting to an anchor fails.",
      "created_at" : "2020-01-26T19:37:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-578535216",
      "id" : 578535216,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3ODUzNTIxNg==",
      "updated_at" : "2020-01-26T19:37:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578535216",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed a fixup. Ready for testing and (re)reviewing now.",
      "created_at" : "2020-01-26T20:38:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-578540792",
      "id" : 578540792,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3ODU0MDc5Mg==",
      "updated_at" : "2020-01-26T20:38:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578540792",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?",
      "created_at" : "2020-01-29T03:53:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579580035",
      "id" : 579580035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3OTU4MDAzNQ==",
      "updated_at" : "2020-01-29T03:53:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579580035",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-01-29T13:28:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579754482",
      "id" : 579754482,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3OTc1NDQ4Mg==",
      "updated_at" : "2020-01-29T13:28:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579754482",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #16702 has been merged.",
      "created_at" : "2020-01-29T20:13:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579938535",
      "id" : 579938535,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3OTkzODUzNQ==",
      "updated_at" : "2020-01-29T20:13:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579938535",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@luke-jr \r\n> Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?\r\n\r\n~Could manual deletion of the `anchors.dat` file be a remedy?~ See: https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582890916",
      "created_at" : "2020-01-29T20:14:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579939131",
      "id" : 579939131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3OTkzOTEzMQ==",
      "updated_at" : "2020-02-06T12:49:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579939131",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372715777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372715777"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No you're melting 2 different problems, tracking the anchors set and connecting to peers among this one. I don't understand why reaching the `m_max_outbound_block_relay` means we have to delete our whole repository of maybe-good anchors peers. \r\n\r\nIn the scenario you're aiming, if victim restarts and the 2 anchors peers are honest but unreliable, you're going to drop them and pick maybe new outbound peers from attacker-provided ones. You can avoid this if you have a bigger set of _potential_ anchor peers.\r\n",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-30T01:12:22Z",
      "diff_hunk" : "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    if (m_anchors.size() > m_max_outbound_block_relay) {\n+        // Keep our policy safe.\n+        m_anchors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372715777",
      "id" : 372715777,
      "in_reply_to_id" : 367057240,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcxNTc3Nw==",
      "original_commit_id" : "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
      "original_line" : 2190,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 350530344,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372715777",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372718282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372718282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "But anchors nodes are block-only, so now you have block-only-as-anchors, full-relay, block-only-classics. You can still test addresses returned from `addrman` against `m_anchors` andon continue in case of equality to avoid the problem you're describing, but don't think that changes something, do we favor first-connected nodes in anyway ?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-01-30T01:22:56Z",
      "diff_hunk" : "@@ -1805,11 +1807,24 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddress addr;\n+            if (!m_anchors.empty() && (nOutboundBlockRelay < m_max_outbound_block_relay) && !fFeeler) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372718282",
      "id" : 372718282,
      "in_reply_to_id" : 367073224,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcxODI4Mg==",
      "original_commit_id" : "d405145e8f935b454ba77e23cf7327515b85151e",
      "original_line" : 1898,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 350533306,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372718282",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@hebasto \r\n\r\nConcept ACK, reading your comment I do understand that this PR is really-scoped, so don't mind https://github.com/bitcoin/bitcoin/issues/17326#issuecomment-580033087 and https://github.com/bitcoin/bitcoin/pull/17428#discussion_r372715777 but would happily review future work to make anchors better (sorry for the noise)\r\n\r\nA note explaining the exact attack scenario mitigated near to m_anchors or somewhere else would be cool to avoid future reviewers relying on wrong-scoped security assumptions.\r\n\r\nGoign to test PR soon.",
      "created_at" : "2020-01-30T01:50:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580047275",
      "id" : 580047275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDA0NzI3NQ==",
      "updated_at" : "2020-01-30T01:50:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580047275",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@luke-jr oy. uh. forget them if you uncleanly exit?",
      "created_at" : "2020-01-30T08:15:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580134777",
      "id" : 580134777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDEzNDc3Nw==",
      "updated_at" : "2020-01-30T08:15:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580134777",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-02-05T13:51:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582416644",
      "id" : 582416644,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjQxNjY0NA==",
      "updated_at" : "2020-02-05T13:51:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582416644",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #18023 has been merged.",
      "created_at" : "2020-02-05T21:36:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582624214",
      "id" : 582624214,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjYyNDIxNA==",
      "updated_at" : "2020-02-05T21:36:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582624214",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@luke-jr \r\n> Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?\r\n\r\nIf an exploitable DoS vulnerability would exist, this risk would come true, unfortunately.\r\nAs a DoS attack timing is unpredictable, it seems infeasible to prevent such a risk in the scope of this PR. This might be prevented by means of detecting a particular DoS attack, no?",
      "created_at" : "2020-02-06T12:49:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582890916",
      "id" : 582890916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4Mjg5MDkxNg==",
      "updated_at" : "2020-02-06T12:49:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582890916",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">If an exploitable DoS vulnerability would exist, this risk would come true, unfortunately.\r\n\r\nThis is probably among the more common vulnerability types.\r\n\r\n(Let's go with @gmaxwell's suggestion to address it.)",
      "created_at" : "2020-02-06T13:33:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582907316",
      "id" : 582907316,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MjkwNzMxNg==",
      "updated_at" : "2020-02-06T13:33:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/582907316",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "After a consideration of @luke-jr's concerns and @gmaxwell's suggestion, I'm going to close this PR.\r\n\r\nThe initial idea to mitigate eclipse attacks based on node restarts, included ones initiated by adversary, introduces a [new risk](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579580035).\r\n\r\n@gmaxwell's [suggestion](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580134777) nullifies the initial idea by making anchoring usable only for clean (user initiated) restarts. The long-term impact of such changes on the entire p2p network is unclear, and requires further study.",
      "created_at" : "2020-02-08T13:34:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583737058",
      "id" : 583737058,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MzczNzA1OA==",
      "updated_at" : "2020-02-08T13:34:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583737058",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think closing this is a mistake.  Not saving state across crashes in no way nullifies the advantage of preserving connections, and it's also a natural implementation-- e.g. the software will fail to write out the latest peers.dat across a crash.",
      "created_at" : "2020-02-08T14:42:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583742368",
      "id" : 583742368,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4Mzc0MjM2OA==",
      "updated_at" : "2020-02-08T14:42:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583742368",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@gmaxwell \r\n> I think closing this is a mistake. Not saving state across crashes in no way nullifies the advantage of preserving connections, and it's also a natural implementation-- e.g. the software will fail to write out the latest peers.dat across a crash.\r\n\r\nReopened. Going to implement your suggestion soon.\r\n\r\nDefinitely, the OP requires an update.",
      "created_at" : "2020-02-08T14:49:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583743029",
      "id" : 583743029,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4Mzc0MzAyOQ==",
      "updated_at" : "2020-02-08T14:49:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/583743029",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Looking forward to an update to this PR :)",
      "created_at" : "2020-02-24T20:35:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-590535864",
      "id" : 590535864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MDUzNTg2NA==",
      "updated_at" : "2020-02-24T20:35:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590535864",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "to be clear, the scope of this PR is to attempt to persist connections across *clean* restarts triggered for whatever reason?",
      "created_at" : "2020-02-25T15:58:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-590939755",
      "id" : 590939755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MDkzOTc1NQ==",
      "updated_at" : "2020-02-25T15:58:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590939755",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@gmaxwell \r\n> Not saving state across crashes in no way nullifies the advantage of preserving connections\r\n\r\nmy understanding is this PR was intended to mitigate a restart-based eclipse attack. so, if an attacker crashes a victim node, the anchors help reduce the chance of victim being eclipsed. if we change to only persisting connections on clean restarts, we lose the benefit of that scenario. ( I understand the risk of implementing that solution )\r\n\r\nI'm still thinking it through & reading relevant material, but wondering.. what are the advantages you see of having anchors for clean restarts? (vs not having anchors). Is it to mitigate a smaller subset of eclipse attacks that occur with users intentionally restarting their nodes?",
      "created_at" : "2020-02-25T16:55:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-590960921",
      "id" : 590960921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MDk2MDkyMQ==",
      "updated_at" : "2020-02-25T16:55:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590960921",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I was thinking along the same lines as Amiti and would like to understand if the DoS attack possibility mentioned above is serious enough to give up the anchors in a unclean restart, because it seems to be especially desirable to have them in this scenario:Â \r\n1. I think that the suggestion to delete anchor.dat on crashes would just change the big picture in case of a subset of DoS attacks working only on the victim's outbound connections - for more general DoS attacks, the attacker could just as well connect to us after we have restarted (if we allow incoming connections) and attack again.\r\n2. Such a repeated DoS attack would be tough to apply in a targeted way, because the connection is outgoing from the victim, reducing the incentives.\r\n3. If an eclipse attacker somehow manages to control our addrman for an extended time (long enough to wait for our clean restart) it seems to me that we are pretty much screwed anyway: Even if anchors protect us from our restart, the attacker could also choose to wait until one by one, our anchors disconnect from us via clean restarts and are replaced by attacker nodes.\r\n4. On the other hand, an attack on our addrman that would only be effective for a short while and recoverable long-time, combined with a DoS attack that forces us to restart *now* uncleanly, would be a scenario in which having anchors would seem really great.",
      "created_at" : "2020-02-25T21:16:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-591073367",
      "id" : 591073367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTA3MzM2Nw==",
      "updated_at" : "2020-02-25T21:16:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591073367",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?\r\n> \r\n> If an exploitable DoS vulnerability would exist, this risk would come true, unfortunately.\r\n> As a DoS attack timing is unpredictable, it seems infeasible to prevent such a risk in the scope of this PR. This might be prevented by means of detecting a particular DoS attack, no?\r\n\r\nIf there was a known remote crash vulnerability and the behaviour was \"okay, in case of a crash, we don't try anchors\" wouldn't an attacker trying to eclipse a node use that exploit to ensure they can completely eclipse the node?\r\n\r\nIf your node is remote crashable, you want to fix it pretty quickly anyway because that often means you're vulnerable to remote code execution as well; so not sure the fix here is actually better?",
      "created_at" : "2020-02-26T01:03:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-591179774",
      "id" : 591179774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTE3OTc3NA==",
      "updated_at" : "2020-02-26T01:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591179774",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "An adversary has two distinct ways to force a victim node to restart:\r\n1) online activity that exploits a DoS vulnerability (i.e., a remote-crashable node)\r\n2) _offline_ activity: e.g., power failures, node operator's delusion via social engineering etc.\r\n\r\nThe current PR implementation works well against the latter adversary activity.\r\n\r\nRegarding the former case, I agree with @ajtowns:\r\n> If your node is remote crashable, you want to fix it pretty quickly anyway...\r\n\r\n---\r\n\r\nAlso an adversary could just wait for a user-initiated (clean) restart of a victim node, which includes restart after a node upgrade. In such cases the current PR implementation works well too.",
      "created_at" : "2020-02-26T14:20:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-591449881",
      "id" : 591449881,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MTQ0OTg4MQ==",
      "updated_at" : "2020-02-26T14:20:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/591449881",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 78b2f950350688f11b544d24ec44816554c67631 -> 780107e41fe86e31392b3ef76b917e623483259f ([pr17428.06](https://github.com/hebasto/bitcoin/commits/pr17428.06) -> [pr17428.07](https://github.com/hebasto/bitcoin/commits/pr17428.07), [compare](https://github.com/hebasto/bitcoin/compare/pr17428.06..pr17428.07)):\r\n\r\n- a new \"anchors.dat\" file is created only during clean shutdown now\r\n\r\nAlso see:\r\n- https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580134777\r\n- https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583742368\r\n- https://bitcoincore.reviews/17428.html",
      "created_at" : "2020-02-27T19:33:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592138078",
      "id" : 592138078,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjEzODA3OA==",
      "updated_at" : "2020-02-27T19:33:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592138078",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "hm, if my understanding of the code is correct, I think we also need to wipe the `anchors.dat` file on startup to prevent the malicious-anchor-connection-keeps-crashing-your-node issue. \r\n\r\nmy understanding is that currently you only (potentially) remove connections from `anchors.dat` when you next invoke `DumpAnchors()` and replace them. But I might be missing something?\r\n\r\nscenario: one of your outbound blocks-relay-only peers is malicious, but patient. eventually you restart your node for whatever reason. they are persisted to your anchors. when you startup you reconnect to them & they crash your node. and then you're caught in the same loop? ",
      "created_at" : "2020-02-27T19:47:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592144553",
      "id" : 592144553,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjE0NDU1Mw==",
      "updated_at" : "2020-02-27T19:47:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592144553",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@amitiuttarwar \r\n> hm, if my understanding of the code is correct, I think we also need to wipe the `anchors.dat` file on startup to prevent the malicious-anchor-connection-keeps-crashing-your-node issue.\r\n> \r\n> my understanding is that currently you only (potentially) remove connections from `anchors.dat` when you next invoke `DumpAnchors()` and replace them. But I might be missing something?\r\n> \r\n> scenario: one of your outbound blocks-relay-only peers is malicious, but patient. eventually you restart your node for whatever reason. they are persisted to your anchors. when you startup you reconnect to them & they crash your node. and then you're caught in the same loop?\r\n\r\nIt seems we need to re-write the `anchors.dat` file every time when another anchor is dropped in `m_anchors.pop_back();`, no?",
      "created_at" : "2020-02-27T20:16:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592156578",
      "id" : 592156578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjE1NjU3OA==",
      "updated_at" : "2020-02-27T20:16:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592156578",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385394617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385394617"
         }
      },
      "author_association" : "MEMBER",
      "body" : "consider introducing a new constant (eg. `m_max_anchors`) that currently matches the value of `m_max_outbound_block_relay`, so if we change the number of block-relay-only connections in the future we have to explicitly decide if we want to increase our anchor connections as well\r\n\r\n-> limiting max anchors mentioned [here](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-554073351), potential downside of anchoring all blocks-only connections mentioned [here](https://github.com/bitcoin/bitcoin/issues/17326#issuecomment-550521262) \r\n",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-02-27T21:56:23Z",
      "diff_hunk" : "@@ -2278,6 +2315,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > (size_t)m_max_outbound_block_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385394617",
      "id" : 385394617,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM5NDYxNw==",
      "original_commit_id" : "780107e41fe86e31392b3ef76b917e623483259f",
      "original_line" : 2321,
      "original_position" : 122,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 366028047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385394617",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385395410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385395410"
         }
      },
      "author_association" : "MEMBER",
      "body" : "and pass the first `m_max_anchors` elements of `GetBlockRelayNodeAddresses` here.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-02-27T21:58:07Z",
      "diff_hunk" : "@@ -2390,6 +2435,7 @@ void CConnman::Stop()\n     if (fAddressesInitialized)\n     {\n         DumpAddresses();\n+        DumpAnchors(m_anchors_db_path, GetBlockRelayNodeAddresses());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385395410",
      "id" : 385395410,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM5NTQxMA==",
      "original_commit_id" : "780107e41fe86e31392b3ef76b917e623483259f",
      "original_line" : 2438,
      "original_position" : 134,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 366028047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385395410",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385396664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385396664"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> It seems we need to re-write the anchors.dat file every time when another anchor is dropped in m_anchors.pop_back();, no?\r\n\r\nI think it would be simpler to delete the contents of the whole file once you have loaded the anchors into memory. Eg. After you read anchors here, invoke a method that wipes `anchors.dat`. \r\n\r\nThis way you can avoid adding per-anchor logic. ",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-02-27T22:00:58Z",
      "diff_hunk" : "@@ -2278,6 +2315,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385396664",
      "id" : 385396664,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM5NjY2NA==",
      "original_commit_id" : "780107e41fe86e31392b3ef76b917e623483259f",
      "original_line" : 2415,
      "original_position" : 120,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 366028047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385396664",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385404543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385404543"
         }
      },
      "author_association" : "MEMBER",
      "body" : "the logic implemented in this PR is minimal, and I think that makes sense for keeping it simple to reason about. \r\n\r\nwith this implementation, its possible for an attacker to poison the anchors and execute an eclipse attack, its just increases the cost of doing so. \r\n\r\nuntil we develop more robust logic around ensuring our anchors are not malicious, I don't think it makes sense to give priority to all historic anchors. I think it could sometimes be beneficial but other times degrade security, eg. if you historically were connected to a malicious peer but now your addrman is clear. ",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-02-27T22:19:07Z",
      "diff_hunk" : "@@ -2176,12 +2176,19 @@ void CConnman::SetNetworkActive(bool active)\n     uiInterface.NotifyNetworkActiveChanged(fNetworkActive);\n }\n \n-CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In) : nSeed0(nSeed0In), nSeed1(nSeed1In)\n+CConnman::CConnman(uint64_t nSeed0In, uint64_t nSeed1In)\n+    : m_anchors_db_path{GetDataDir() / \"anchors.dat\"}, nSeed0(nSeed0In), nSeed1(nSeed1In)\n {\n     SetTryNewOutboundPeer(false);\n \n     Options connOptions;\n     Init(connOptions);\n+\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    if (m_anchors.size() > m_max_outbound_block_relay) {\n+        // Keep our policy safe.\n+        m_anchors.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385404543",
      "id" : 385404543,
      "in_reply_to_id" : 367057240,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQwNDU0Mw==",
      "original_commit_id" : "ea5a307eaf1a2325b33df6a2a35ea6df783f4e6b",
      "original_line" : 2190,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 366040484,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/385404543",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">I am still unconvinced that we shouldnât persist anchors on crashes. I understand the risk is that a malicious anchor could exploit a DoS vulnerability (which is possibly more likely than executing an eclipse attack) and prevent the victim from being able to sync their node. I feel that if the node is DoS-attackable, it should be fixed immediately regardless. \r\n\r\nI agree with @amitiuttarwar right now. Additionally, it's very difficult to imagine a DoS vulnerability, which is opened only to *outbound blocks-only* connections.\r\nSo, if it is broad DoS issue an attacker will be able to shut down all the reachable nodes, because connecting to them in-bound is free. Much bigger trouble than persistent-anchor attack.\r\nOkay, if it applies to *only outbound* connections, then it's also very easy: an attacker spawns another 2,000 of reachable sybil nodes, and thus has a very high chance of a random node to connect to an attacker as a regular connection (not block-relay-only), and then restarts it. Also bigger trouble than persistent-anchor attack.\r\n\r\nConsidering these observations, I think such a specific risk (specifically block-relay-only outbound links are able to crush a node, and none other can) should not prevent us from getting benefits of anchor-persistence after crashing. (If we are *really worried*, one can try counting restarts ). And those benefits (anti-eclipse) are quite important I think, as this scenario (restart-to-attempt-eclipse) seems much more feasible and dangerous then just restart-node-repetitively.\r\n\r\n>But scoping this PR to focus only on persisting anchors on clean restarts seems reasonable for getting an improvement merged since it is less controversial.\r\n\r\nI would prefer to keep the discussion going. I think we may miss an important improvement here, if we just merge clean-restarts, because the conversation will die.",
      "created_at" : "2020-02-28T16:43:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592596746",
      "id" : 592596746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU5MjU5Njc0Ng==",
      "updated_at" : "2020-03-02T18:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/592596746",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r386686000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386686000"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: would have been nice to add a little more context information on the purpose of these anchors",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-03-02T22:20:11Z",
      "diff_hunk" : "@@ -95,4 +95,10 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/** Read the anchor IP address database (anchors.dat) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r386686000",
      "id" : 386686000,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY4NjAwMA==",
      "original_commit_id" : "780107e41fe86e31392b3ef76b917e623483259f",
      "original_line" : 98,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/addrdb.h",
      "position" : null,
      "pull_request_review_id" : 367571934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/386686000",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "From the discussions (#17326, this PR, https://bitcoincore.reviews/17428.html, https://diyhpl.us/wiki/transcripts/la-bitdevs/2020-04-16-amiti-uttarwar-attacking-bitcoin-core/) it follows that the worst case could happen in the following setup:\r\n1. a remote crash vulnerability is known to an adversary\r\n2. that adversary is a block-relay-only anchor peer of the victim node\r\n3. there is a watch-dog script that restarts the victim node in case of its crash\r\n\r\nPlease note that the message set accepted by a node from a block-relay-only peer is a strict subset of messages accepted from a full-relay outgoing connection. Therefore, the mentioned in (1) vulnerability could affect _any_ node, regardless of anchoring. Having a such vulnerability makes other attack vectors, including all types of eclipsing, much less dangerous in comparison.\r\n\r\nThe mentioned in (3) script could be optimized to prevent continuous restarts, e.g. from @naumenkogs' comment:\r\n> If we are _really worried_, one can try counting restarts\r\n\r\nTherefore, I believe the described worst case is out of scope of this PR.\r\n\r\nGoing to update this pull soon.  ",
      "created_at" : "2020-05-30T14:02:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636335317",
      "id" : 636335317,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjMzNTMxNw==",
      "updated_at" : "2020-05-30T14:02:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636335317",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432917391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432917391"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If a node crash happens between wiping `anchors.dat` and creating a new one, the anchors data would be lost.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-05-31T07:08:55Z",
      "diff_hunk" : "@@ -2278,6 +2315,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432917391",
      "id" : 432917391,
      "in_reply_to_id" : 385396664,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxNzM5MQ==",
      "original_commit_id" : "780107e41fe86e31392b3ef76b917e623483259f",
      "original_line" : 2415,
      "original_position" : 120,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421467710,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432917391",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 780107e41fe86e31392b3ef76b917e623483259f -> dacb155eaaa1775385bc4a2d82a3e0307f68ce7d ([pr17428.07](https://github.com/hebasto/bitcoin/commits/pr17428.07) -> [pr17428.09](https://github.com/hebasto/bitcoin/commits/pr17428.09), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.07..pr17428.09)):\r\n\r\n- addressed @amitiuttarwar's [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r385394617):\r\n> consider introducing a new constant (eg. `m_max_anchors`) that currently matches the value of `m_max_outbound_block_relay`, so if we change the number of block-relay-only connections in the future we have to explicitly decide if we want to increase our anchor connections as well\r\n\r\n- addressed @naumenkogs's [comment](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592596746):\r\n> So, if it is broad DoS issue an attacker will be able to shut down all the reachable nodes, because connecting to them in-bound is free. Much bigger trouble than persistent-anchor attack.\r\n\r\n- addressed @fjahr's [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r386686000):\r\n> nit: would have been nice to add a little more context information on the purpose of these anchors\r\n\r\n- addressed @luke-jr's [comment](https://bitcoincore.reviews/17428.html):\r\n> wonders if anchors should be reduced/skipped entirely if the user has manually configured addnode peers\r\n\r\n---\r\n\r\nCurrently, the `anchors.dat` contains IP addresses of the block-relay-only peers to which the node is connected, _and_ IP addresses that were loaded from `anchors.dat` into memory at startup and that have not been tried to re-connect to yet.",
      "created_at" : "2020-05-31T10:42:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636453433",
      "id" : 636453433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjQ1MzQzMw==",
      "updated_at" : "2020-05-31T10:42:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636453433",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased dacb155eaaa1775385bc4a2d82a3e0307f68ce7d -> 293065610dd1822c9f8585526031b5a38996f695 ([pr17428.09](https://github.com/hebasto/bitcoin/commits/pr17428.09) -> [pr17428.10](https://github.com/hebasto/bitcoin/commits/pr17428.10)) due to the conflicts with #18088 and #18910.",
      "created_at" : "2020-05-31T11:01:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636455389",
      "id" : 636455389,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjQ1NTM4OQ==",
      "updated_at" : "2020-05-31T11:01:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636455389",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432935166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935166"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636453433).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-05-31T11:03:15Z",
      "diff_hunk" : "@@ -95,4 +95,10 @@ class CBanDB\n     bool Read(banmap_t& banSet);\n };\n \n+/** Read the anchor IP address database (anchors.dat) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432935166",
      "id" : 432935166,
      "in_reply_to_id" : 386686000,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzNTE2Ng==",
      "original_commit_id" : "780107e41fe86e31392b3ef76b917e623483259f",
      "original_line" : 98,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/addrdb.h",
      "position" : null,
      "pull_request_review_id" : 421483521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935166",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432935189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935189"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-636453433).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-05-31T11:03:35Z",
      "diff_hunk" : "@@ -2278,6 +2315,14 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > (size_t)m_max_outbound_block_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r432935189",
      "id" : 432935189,
      "in_reply_to_id" : 385394617,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzNTE4OQ==",
      "original_commit_id" : "780107e41fe86e31392b3ef76b917e623483259f",
      "original_line" : 2321,
      "original_position" : 122,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421483546,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432935189",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-04T20:36:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-639102843",
      "id" : 639102843,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTEwMjg0Mw==",
      "updated_at" : "2020-06-04T20:36:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639102843",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased 293065610dd1822c9f8585526031b5a38996f695 -> 1d9264e296f1a03abbfa6c30363628a85cf33ce4 ([pr17428.10](https://github.com/hebasto/bitcoin/commits/pr17428.10) -> [pr17428.11](https://github.com/hebasto/bitcoin/commits/pr17428.11)) due to the conflict with #19053.",
      "created_at" : "2020-06-05T06:40:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-639289724",
      "id" : 639289724,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTI4OTcyNA==",
      "updated_at" : "2020-06-05T06:40:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639289724",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448267907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448267907"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function name doesn't reflect that it's inbound-only",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-01T10:24:54Z",
      "diff_hunk" : "@@ -1951,6 +1951,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetBlockRelayNodeAddresses() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448267907",
      "id" : 448267907,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI2NzkwNw==",
      "original_commit_id" : "cfe30185df561da9afb1258dc84ccd9618614617",
      "original_line" : 1954,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 440743009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448267907",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448268314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448268314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe it actually should be named \"GetCurrentAnchors\"",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-01T10:25:39Z",
      "diff_hunk" : "@@ -1951,6 +1951,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetBlockRelayNodeAddresses() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448268314",
      "id" : 448268314,
      "in_reply_to_id" : 448267907,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI2ODMxNA==",
      "original_commit_id" : "cfe30185df561da9afb1258dc84ccd9618614617",
      "original_line" : 1954,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 440743510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448268314",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448269036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448269036"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wait, why is this done on VERACK? Even if this was discussed in the PR, a comment would help.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-01T10:27:04Z",
      "diff_hunk" : "@@ -2411,6 +2411,10 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                DumpAnchors(connman->GetAnchorsDbPath(), anchors_to_save);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448269036",
      "id" : 448269036,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI2OTAzNg==",
      "original_commit_id" : "bd39249ea359e5349b93438e79ffa6a81a10ee51",
      "original_line" : 2416,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 440744544,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448269036",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448302491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448302491"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm a bit confused of what's going on here. I guess this is supposed to address the issue of reconnecting to the same anchor on many restarts, but it would really use some extra comments.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-01T11:36:07Z",
      "diff_hunk" : "@@ -2411,6 +2411,12 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                const std::vector<CAddress> anchors_not_tried = connman->GetAnchors();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448302491",
      "id" : 448302491,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMwMjQ5MQ==",
      "original_commit_id" : "1d9264e296f1a03abbfa6c30363628a85cf33ce4",
      "original_line" : 2416,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 440788275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448302491",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The implementation is very simple and fairly straightforward, which is good.\r\n\r\nAfter all discussions I also see that this version of the PR falls into the broader idea of anti-eclipse measures (many more to come).\r\n\r\nIt's true that fresh connections are often a good idea, but in this case we should achieve them by peer rotation and proactive feeler tip sync, not by relying on random restarts. Maybe this can be delayed by then, but I don't see why. This PR currently doesn't bring any concerns (in my opinion): spying, restart attack and whatnot.\r\n\r\nutACK 1d9264e296f1a03abbfa6c30363628a85cf33ce4 modulo those minor things I commented.",
      "created_at" : "2020-07-01T11:36:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-652366404",
      "id" : 652366404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjM2NjQwNA==",
      "updated_at" : "2020-07-01T11:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652366404",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449549043"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449549043"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Wait, why is this done on VERACK?\r\n\r\nIt is a point where we get know that an outbound connection to a block-relay-only peer has been established.\r\n\r\n> Even if this was discussed in the PR, a comment would help.\r\n\r\nWhat kind of comment do you expect to see here?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T12:06:34Z",
      "diff_hunk" : "@@ -2411,6 +2411,10 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                DumpAnchors(connman->GetAnchorsDbPath(), anchors_to_save);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449549043",
      "id" : 449549043,
      "in_reply_to_id" : 448269036,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU0OTA0Mw==",
      "original_commit_id" : "bd39249ea359e5349b93438e79ffa6a81a10ee51",
      "original_line" : 2416,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 442368051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449549043",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449553429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449553429"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've tried to avoid any confusion by meaningful naming variables, but failed :)\r\nThe node dumps:\r\n- anchors that are connected right now\r\n- anchors that were known at startup but have not tried to connect to yet\r\n\r\nThe latter set quickly gets empty after startup.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T12:17:32Z",
      "diff_hunk" : "@@ -2411,6 +2411,12 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                const std::vector<CAddress> anchors_not_tried = connman->GetAnchors();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449553429",
      "id" : 449553429,
      "in_reply_to_id" : 448302491,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1MzQyOQ==",
      "original_commit_id" : "1d9264e296f1a03abbfa6c30363628a85cf33ce4",
      "original_line" : 2416,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 442373706,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449553429",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449556623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449556623"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> This function name doesn't reflect that it's inbound-only\r\n\r\nYou mean \"outbound\"?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T12:25:38Z",
      "diff_hunk" : "@@ -1951,6 +1951,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetBlockRelayNodeAddresses() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449556623",
      "id" : 449556623,
      "in_reply_to_id" : 448267907,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1NjYyMw==",
      "original_commit_id" : "cfe30185df561da9afb1258dc84ccd9618614617",
      "original_line" : 1954,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442377885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449556623",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 1d9264e296f1a03abbfa6c30363628a85cf33ce4 -> 0a74c7c3686d4b03a27815c6107b3300954641cc ([pr17428.11](https://github.com/hebasto/bitcoin/commits/pr17428.11) -> [pr17428.13](https://github.com/hebasto/bitcoin/commits/pr17428.13), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.11..pr17428.13)):\r\n\r\n- addressed the recent @naumenkogs' comments\r\n- small style improvements\r\n",
      "created_at" : "2020-07-03T12:50:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653533271",
      "id" : 653533271,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MzUzMzI3MQ==",
      "updated_at" : "2020-07-03T12:50:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653533271",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449568124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Maybe it actually should be named \"GetCurrentAnchors\"\r\n\r\n[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653533271).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T12:52:44Z",
      "diff_hunk" : "@@ -1951,6 +1951,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n }\n \n+std::vector<CAddress> CConnman::GetBlockRelayNodeAddresses() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449568124",
      "id" : 449568124,
      "in_reply_to_id" : 448267907,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU2ODEyNA==",
      "original_commit_id" : "cfe30185df561da9afb1258dc84ccd9618614617",
      "original_line" : 1954,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442392872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568124",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449568334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653533271).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T12:53:10Z",
      "diff_hunk" : "@@ -2411,6 +2411,12 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {\n+                std::vector<CAddress> anchors_to_save = connman->GetBlockRelayNodeAddresses();\n+                const std::vector<CAddress> anchors_not_tried = connman->GetAnchors();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449568334",
      "id" : 449568334,
      "in_reply_to_id" : 448302491,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU2ODMzNA==",
      "original_commit_id" : "1d9264e296f1a03abbfa6c30363628a85cf33ce4",
      "original_line" : 2416,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 442393112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449568334",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449647325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449647325"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "2 questions about this:\r\n\r\n1. Is there a possible race condition where `GetCurrentAnchors()` is called before the connection to the anchor node is complete? Or before the handshake is complete? Like is it possible that the test succeeds, no message is printed to the log, but then the connection still fails due to the peer not responding, etc.?\r\n\r\n2. (and maybe this answers my first question) is there a better way of determining connection success than locking `cs_vNodes` and searching for the addr? Like, is there any sense in modifying `OpenNetworkConnection()` to return a success value?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T16:07:18Z",
      "diff_hunk" : "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449647325",
      "id" : 449647325,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY0NzMyNQ==",
      "original_commit_id" : "0a74c7c3686d4b03a27815c6107b3300954641cc",
      "original_line" : 2023,
      "original_position" : 109,
      "original_start_line" : 1978,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442494304,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449647325",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449650363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449650363"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: a bit awkward, maybe `\"%i block-relay-only anchors will be tried for connections.\\n\"` ?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T16:17:58Z",
      "diff_hunk" : "@@ -2348,6 +2385,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCKS_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        m_anchors.clear();\n+    }\n+    // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+    if (static_cast<size_t>(connOptions.m_max_block_relay_anchor) < connOptions.m_added_nodes.size()) {\n+        m_anchors.clear();\n+    } else {\n+        const size_t anchor_num_allowed = static_cast<size_t>(connOptions.m_max_block_relay_anchor) - connOptions.m_added_nodes.size();\n+        if (anchor_num_allowed < m_anchors.size()) m_anchors.resize(anchor_num_allowed);\n+    }\n+    LogPrintf(\"%i block-relay-only anchors will be tried to connect to.\\n\", m_anchors.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449650363",
      "id" : 449650363,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY1MDM2Mw==",
      "original_commit_id" : "0a74c7c3686d4b03a27815c6107b3300954641cc",
      "original_line" : 2402,
      "original_position" : 131,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442497942,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449650363",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, just a few questions above about execution.\r\n\r\nThis was tricky to test because on regtest all nodes have the same IP and my development environment doesn't have  a synced chain. I don't think the extra 2 blocks-only nodes are connected during IBD (?)\r\n\r\nBut I hot wired bitcoind with\r\n\r\n`static const int MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 0;`\r\n\r\n...forcing my only connections to be the two anchors. Verified the `anchors.dat` file, tried corrupting it and tested for that error (check!) and restarted bitcoind to check that the anchor connections were loaded and connected correctly (check!).\r\n\r\n`debug.log | grep anchor`:\r\n\r\n```\r\n2020-07-03T16:54:59Z DumpAnchors: Flush 1 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:54:59Z DumpAnchors: Flush 1 outbound block-relay-only peer addresses to anchors.dat completed (0.01s)\r\n2020-07-03T16:55:16Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:55:16Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat completed (0.06s)\r\n2020-07-03T16:55:32Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:55:32Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat completed (0.05s)\r\n2020-07-03T16:57:42Z Loaded 2 addresses from \"anchors.dat\"\r\n2020-07-03T16:57:42Z 2 block-relay-only anchors will be tried to connect to.\r\n2020-07-03T16:57:43Z Trying to make an anchor connection to 120.150.206.137:8333\r\n2020-07-03T16:57:43Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:57:43Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat completed (0.00s)\r\n2020-07-03T16:57:48Z Trying to make an anchor connection to 174.138.35.229:8333\r\n2020-07-03T16:57:48Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat started\r\n2020-07-03T16:57:48Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat completed (0.01s)\r\n```",
      "created_at" : "2020-07-03T17:17:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653627885",
      "id" : 653627885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MzYyNzg4NQ==",
      "updated_at" : "2020-07-03T17:17:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653627885",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449665450"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449665450"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The `CConnman::OpenNetworkConnection()` call is synchronous, therefore there is no race with the following `CConnman::GetCurrentAnchors()` call, and I couldn't see a reason to modify it.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T17:23:23Z",
      "diff_hunk" : "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449665450",
      "id" : 449665450,
      "in_reply_to_id" : 449647325,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2NTQ1MA==",
      "original_commit_id" : "0a74c7c3686d4b03a27815c6107b3300954641cc",
      "original_line" : 2023,
      "original_position" : 109,
      "original_start_line" : 1978,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442516073,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449665450",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 0a74c7c3686d4b03a27815c6107b3300954641cc -> ceb9d212716fe1134f9ac179d46e14e4847dd8b1 ([pr17428.13](https://github.com/hebasto/bitcoin/commits/pr17428.13) -> [pr17428.14](https://github.com/hebasto/bitcoin/commits/pr17428.14), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.13..pr17428.14)):\r\n\r\n- addressed @pinheadmz' [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449650363)\r\n> nit: a bit awkward, maybe `\"%i block-relay-only anchors will be tried for connections.\\n\"` ?\r\n",
      "created_at" : "2020-07-03T17:34:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653631684",
      "id" : 653631684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MzYzMTY4NA==",
      "updated_at" : "2020-07-03T17:34:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653631684",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449667822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449667822"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@pinheadmz Thanks for improving my English :)\r\n\r\n[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-653631684).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T17:35:15Z",
      "diff_hunk" : "@@ -2348,6 +2385,22 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCKS_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        m_anchors.clear();\n+    }\n+    // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+    if (static_cast<size_t>(connOptions.m_max_block_relay_anchor) < connOptions.m_added_nodes.size()) {\n+        m_anchors.clear();\n+    } else {\n+        const size_t anchor_num_allowed = static_cast<size_t>(connOptions.m_max_block_relay_anchor) - connOptions.m_added_nodes.size();\n+        if (anchor_num_allowed < m_anchors.size()) m_anchors.resize(anchor_num_allowed);\n+    }\n+    LogPrintf(\"%i block-relay-only anchors will be tried to connect to.\\n\", m_anchors.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449667822",
      "id" : 449667822,
      "in_reply_to_id" : 449650363,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2NzgyMg==",
      "original_commit_id" : "0a74c7c3686d4b03a27815c6107b3300954641cc",
      "original_line" : 2402,
      "original_position" : 131,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442518858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449667822",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449673605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449673605"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What do you think about (2)? Could you get what you need if `OpenNetworkConnection()` returned `true` on success? ",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T18:05:15Z",
      "diff_hunk" : "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449673605",
      "id" : 449673605,
      "in_reply_to_id" : 449647325,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY3MzYwNQ==",
      "original_commit_id" : "0a74c7c3686d4b03a27815c6107b3300954641cc",
      "original_line" : 2023,
      "original_position" : 109,
      "original_start_line" : 1978,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442525604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449673605",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449678070"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678070"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`CConnman::OpenNetworkConnection()` has 5 call sites. What benefits of the `bool` return type for all callers? Unsuccessful connection is not an error.\r\n\r\nAnd it seems orthogonal to this PR :)\r\n",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T18:29:15Z",
      "diff_hunk" : "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449678070",
      "id" : 449678070,
      "in_reply_to_id" : 449647325,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY3ODA3MA==",
      "original_commit_id" : "0a74c7c3686d4b03a27815c6107b3300954641cc",
      "original_line" : 2023,
      "original_position" : 109,
      "original_start_line" : 1978,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442530665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678070",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449678783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> ... is there a better way of determining connection success than locking `cs_vNodes` and searching for the addr?\r\n\r\nThe vector being searching in is very small :)\r\n\r\n",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T18:32:54Z",
      "diff_hunk" : "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449678783",
      "id" : 449678783,
      "in_reply_to_id" : 449647325,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY3ODc4Mw==",
      "original_commit_id" : "0a74c7c3686d4b03a27815c6107b3300954641cc",
      "original_line" : 2023,
      "original_position" : 109,
      "original_start_line" : 1978,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442531491,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449678783",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449683838"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449683838"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "gotcha, thanks!",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-07-03T19:01:53Z",
      "diff_hunk" : "@@ -1946,9 +1958,34 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             // well for sanity.)\n             bool block_relay_only = nOutboundBlockRelay < m_max_outbound_block_relay && !fFeeler && nOutboundFullRelay >= m_max_outbound_full_relay;\n \n+            if (anchor) {\n+                block_relay_only = true;\n+                LogPrintf(\"Trying to make an anchor connection to %s\\n\", addrConnect.ToString());\n+            }\n+\n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, false, fFeeler, false, block_relay_only);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const\n+{\n+    std::vector<CAddress> ret;\n+    LOCK(cs_vNodes);\n+    for (const CNode* pnode : vNodes) {\n+        if (!pnode->fInbound && !pnode->m_manual_connection && !pnode->m_tx_relay) {\n+            ret.push_back(pnode->addr);\n         }\n     }\n+\n+    return ret;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449683838",
      "id" : 449683838,
      "in_reply_to_id" : 449647325,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY4MzgzOA==",
      "original_commit_id" : "0a74c7c3686d4b03a27815c6107b3300954641cc",
      "original_line" : 2023,
      "original_position" : 109,
      "original_start_line" : 1978,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 442537474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449683838",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-09T16:34:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-656229520",
      "id" : 656229520,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjIyOTUyMA==",
      "updated_at" : "2020-07-09T16:34:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656229520",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased ceb9d212716fe1134f9ac179d46e14e4847dd8b1 -> 005a46dc3a4b84b045d3877ee757a162acf1f5ca ([pr17428.14](https://github.com/hebasto/bitcoin/commits/pr17428.14) -> [pr17428.15](https://github.com/hebasto/bitcoin/commits/pr17428.15)) due to the conflict with #19314.",
      "created_at" : "2020-07-10T07:42:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-656534753",
      "id" : 656534753,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjUzNDc1Mw==",
      "updated_at" : "2020-07-10T07:42:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656534753",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 005a46dc3a4b84b045d3877ee757a162acf1f5ca\r\n<details><summary>Show Signature</summary>\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA256\r\n\r\nACK 005a46dc3a4b84b045d3877ee757a162acf1f5ca\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQIzBAEBCAAdFiEE5hdzzW4BBA4vG9eM5+KYS2KJyToFAl8NyM8ACgkQ5+KYS2KJ\r\nyToIBhAAgVTXUzjuIrkugUhWiSYy5daBqBCvWtc1CC9P9h6vY+MfdLdvA/KuBlF4\r\ndU8oQ7Dzz0sdTRCFvXSHDrYQSjF8hKd1JY3KrYVWgdMGIwITK7VMDpMWk5SCuWBo\r\nVQsaFPZmEn8x4HV2+OkCOMM+f02fKrERJ4l5QKEX76CehIt/eJN6NaSOGo2Y7JcQ\r\n0bxoK8iWFIvKkqQV6fatraxwig40bw6Jxuj7OhlN25xnWgI2TwSGL54d+r/9viHV\r\n2OORkqF3frgqQNP6DODQw6ROcQhhyJdfAoUWefrD2qbbaBQ4nV6sovTs91HQq5lr\r\noyIX9UMSVPewMdiVsS9YO6tcL5WKq2CVu63KmGOt+jZ6WZl8Y9Xb5oehJdc9BwiL\r\nwkJL2LbB40Me3eA8pszIAknFrLiyDTl1zMkuooGMQ61jtHJi9ILT+uLYTdNIdEH6\r\niQZkX+HujAW0RUWln3ZMeummxgd/VBF/xnxZ35QMSg8ktIzsqrKNgkshmDfNzWOF\r\nglh99AFuBMTUmM11ShG5icEd07h4Jh3SQ3eOwzXVXcDfGXo5DYpbs7GXGo5o109E\r\n5jeJyw0gIpWMeJoU/26VhD5VyUmRFLUaVDiWCJlvD4GyzY2FOSf30YvAxospjCTu\r\nuI8+thlo+0GSrKuRwTRXoRKXpp2tlA3UC1CKkv/Sy8iZdS7PzZY=\r\n=mG97\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\npinheadmz's public key is [on keybase](https://keybase.io/pinheadmz/pgp_keys.asc?fingerprint=e61773cd6e01040e2f1bd78ce7e2984b6289c93a)\r\n</details>\r\n\r\n\r\nConfirmed rebase is minimal\r\n\r\n<details><summary>git range-diff  7101f91f2..ceb9d2127 96b22cbea..005a46dc3</summary>\r\n\r\n```diff\r\n\r\n1:  529827588 = 1:  3370328ac p2p: Integrate ReadAnchors() into CConnman()\r\n2:  e3b817832 = 2:  64d1887fd p2p: Add CConnman::GetCurrentAnchors()\r\n3:  4f0a4c93e ! 3:  27864da6a p2p: Add DumpAnchors()\r\n    @@ Commit message\r\n\r\n      ## src/addrdb.cpp ##\r\n     @@\r\n    - #include <chainparams.h>\r\n      #include <clientversion.h>\r\n    + #include <cstdint>\r\n      #include <hash.h>\r\n     +#include <logging/timer.h>\r\n      #include <random.h>\r\n4:  a4292fdd0 ! 4:  8e6eff7e4 p2p: Integrate DumpAnchors() into ProcessMessage()\r\n    @@ Commit message\r\n         p2p: Integrate DumpAnchors() into ProcessMessage()\r\n\r\n      ## src/net_processing.cpp ##\r\n    -@@ src/net_processing.cpp: bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\r\n    +@@ src/net_processing.cpp: void ProcessMessage(\r\n                            pfrom.nVersion.load(), pfrom.nStartingHeight,\r\n                            pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\r\n                            pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\r\n5:  e69c4d048 = 5:  9c17f92db p2p: Fix off-by-one error in fetching address loop\r\n6:  ceb9d2127 ! 6:  005a46dc3 p2p: Try to connect to anchors once\r\n    @@ src/net.cpp\r\n\r\n     +#include <algorithm>\r\n     +#include <cmath>\r\n    + #include <cstdint>\r\n      #include <unordered_map>\r\n     -\r\n     -#include <math.h>\r\n    @@ src/net.cpp: void CConnman::ThreadOpenConnections(const std::vector<std::string>\r\n      }\r\n\r\n      ## src/net_processing.cpp ##\r\n    -@@ src/net_processing.cpp: bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\r\n    +@@ src/net_processing.cpp: void ProcessMessage(\r\n                            pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\r\n                            pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\r\n                  if (!pfrom.m_tx_relay) {\r\n```\r\n</details>",
      "created_at" : "2020-07-14T15:03:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-658233093",
      "id" : 658233093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1ODIzMzA5Mw==",
      "updated_at" : "2020-07-14T15:03:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658233093",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The implementation looks correct, but I think the high-level idea requires more conceptual discussion. It's not about me, I expressed my general support above.",
      "created_at" : "2020-07-15T10:11:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-658680276",
      "id" : 658680276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1ODY4MDI3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-15T10:12:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658680276",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased 005a46dc3a4b84b045d3877ee757a162acf1f5ca -> 9445a3411ed589d38cd4eee6714015d065f2b180 ([pr17428.15](https://github.com/hebasto/bitcoin/commits/pr17428.15) -> [pr17428.16](https://github.com/hebasto/bitcoin/commits/pr17428.16)) due to the conflicts with #19174 and #19217.",
      "created_at" : "2020-07-21T19:09:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-662052433",
      "id" : 662052433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MjA1MjQzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-21T19:09:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662052433",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-08-03T14:18:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-668048860",
      "id" : 668048860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2ODA0ODg2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-03T14:18:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/668048860",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r465105274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465105274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a reason this needs to be a `CConnMan::Options` option? Can this logic exist entirely within CConnMan?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-08-04T14:44:40Z",
      "diff_hunk" : "@@ -1889,6 +1889,7 @@ bool AppInitMain(const util::Ref& context, NodeContext& node)\n     connOptions.nMaxConnections = nMaxConnections;\n     connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);\n     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);\n+    connOptions.m_max_block_relay_anchor = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r465105274",
      "id" : 465105274,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTEwNTI3NA==",
      "original_commit_id" : "9445a3411ed589d38cd4eee6714015d065f2b180",
      "original_line" : 1910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 460884162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/465105274",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased 9445a3411ed589d38cd4eee6714015d065f2b180 -> d1ef06a1ac45e103eae1bfa5b9162e5cae64e73b ([pr17428.16](https://github.com/hebasto/bitcoin/commits/pr17428.16) -> [pr17428.17](https://github.com/hebasto/bitcoin/commits/pr17428.17)) due to the conflict with #18991.",
      "created_at" : "2020-08-06T02:13:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-669641451",
      "id" : 669641451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2OTY0MTQ1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-06T02:13:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/669641451",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-08-12T02:43:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-672502253",
      "id" : 672502253,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MjUwMjI1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-12T02:43:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/672502253",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r469514016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469514016"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think after #19316 we should be able to check directly for the block-relay connection type? ",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-08-12T20:15:18Z",
      "diff_hunk" : "@@ -2482,6 +2482,15 @@ void ProcessMessage(\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r469514016",
      "id" : 469514016,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUxNDAxNg==",
      "original_commit_id" : "d1ef06a1ac45e103eae1bfa5b9162e5cae64e73b",
      "original_line" : 2485,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 466239713,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/469514016",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "**Summary:**\r\n\r\nThis PR is an anti-eclipse attack measure for the scenario when an attacker exploits a victim node restart to force it to connect to new, probably adversarial, peers. Other discussion surrounding this issue can be found on [#17326](https://github.com/bitcoin/bitcoin/issues/17326). This patch helps a node attempt to restore pre-restart outbound block-relay-only connections by dumping the (currently 2) outbound block-relay-only connections to an anchors.dat file and connecting to those addresses on start-up.\r\n\r\n[laanwj noted](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-552184378):\r\n> ...reconnecting to peers 'aggressively', was, up to now, the reserve of spy nodes and mass-connectors and such... Historically this has been one of the ways used to detect these.\r\n\r\n[gmaxwell responded](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-553531390):\r\n> It would be really good to limit it so that an honest node won't attempt to connect twice to the same peer through this mechanism for some prudent amount of time... like two minutes.\" But that \"I don't think it would cause any harm to the intent of this mechanism to not bring them up as fast as possible, and it would avoid tripping up detection of aggressive mass connectors.\r\n\r\ngmaxwell and theBlueMatt commented (on [#17326](https://github.com/bitcoin/bitcoin/issues/17326)) that we shouldnât do this with all our block-relay-only connections because it would [guarantee capture persistence](https://github.com/bitcoin/bitcoin/issues/17326#issuecomment-550521262). [sdaftuar noted](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-554073351) that since we only have two of those connections at the moment, perhaps itâs fine for now.\r\n\r\n[luke-jr wondered](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-579580035):  \r\n> Couldn't there be a risk here, that if one of the anchor peers is malicious and knows a DoS vulnerability, this ensures they can keep repeatedly crashing your node, even if you setup a watchdog to restart it?\r\n\r\nTo that, [gmaxwell suggested](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-580134777) that one might forget the anchors if you uncleanly exit, which luke-jr [supported](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-582907316).\r\n\r\nAt that point (Feb 2020), the author [closed the PR](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583737058) because:\r\n> ...forgetting the peers nullifies the initial idea by making anchoring usable only for clean (user initiated) restarts.\r\n\r\ngmaxwell however [encouraged the PR to be re-opened](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-583742368):\r\n> not saving state across crashes in no way nullifies the advantage of preserving connections, and it's also a natural implementation-- e.g. the software will fail to write out the latest peers.dat across a crash.\r\n\r\nSince then others made arguments for reconnecting to anchor connections after unclean restarts:\r\n\r\nThe risk is that a malicious anchor could exploit a DoS vulnerability (which is possibly more likely than executing an eclipse attack) and prevent the victim from being able to sync their node. However, if the node is DoS-attackable, it should be fixed immediately regardless. Something that prevents using it as a normal node doesnât seem like a huge downside. However, the upside of persisting anchors across crashes is the extra protection against certain types of eclipse attacks. ([adapted from amitiuttarwar](https://github.com/bitcoin/bitcoin/pull/17428#pullrequestreview-366050954))\r\n\r\nAdditionally, it's very difficult to imagine a DoS vulnerability opened only to outbound blocks-only connections. If there is a broad DoS issue, an attacker will be able to shut down all the reachable nodes with ease because in-bound connections are free. If a vulnerability only applies to outbound connections, then it's also easy: an attacker spawns 2,000 reachable sybil nodes, and thus has a high chance of becoming a regular outbound connection (not just a block-relay-only). The specific risk of block-relay-only outbound links being able to crash a node while no other connection can, should not prevent us from getting benefits of anchor-persistence after crashing. (If we are worried, we can try counting restarts). The anti-eclipse benefits of reconnecting after an unclean exit are quite valuable since the restart-to-attempt-eclipse scenario seems much more feasible and dangerous then just restart-node-repetitively scenario. ([adapted from naumenkogs](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-592596746))\r\n\r\nIn its current state, the anchors are persisted and reconnected to on unclean shutdowns. (h/t amitiuttarwar and hebasto for clarifying)\r\n\r\nIn sum, there appears to be broad support for the concept of outbound block-relay-only anchor connections. However, opinions differ on the approach around whether connections are persisted and connected to after unclean restarts. ajtowns, amitiuttarwar, naumenkogs, mzumsande support keeping the connections while luke-jr and gmaxwell are in favor of forgetting them.\r\n\r\nAdditionally, there were (now invalided) ACKs from fjahr, jamesob, pinheadmz and an utACK from naumenkogs.\r\n",
      "created_at" : "2020-08-13T14:35:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-673515908",
      "id" : 673515908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MzUxNTkwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-13T14:35:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/673515908",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased d1ef06a1ac45e103eae1bfa5b9162e5cae64e73b -> d7482556c98b76e73f64d04400a703fdbb9c189f ([pr17428.17](https://github.com/hebasto/bitcoin/commits/pr17428.17) -> [pr17428.18](https://github.com/hebasto/bitcoin/commits/pr17428.18)) due to the conflicts with #19658 and #19316.",
      "created_at" : "2020-08-21T08:14:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-678109126",
      "id" : 678109126,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3ODEwOTEyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-21T08:14:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678109126",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r474508171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474508171"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-678109126).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-08-21T08:15:11Z",
      "diff_hunk" : "@@ -2482,6 +2482,15 @@ void ProcessMessage(\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (!pfrom.m_tx_relay) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r474508171",
      "id" : 474508171,
      "in_reply_to_id" : 469514016,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwODE3MQ==",
      "original_commit_id" : "d1ef06a1ac45e103eae1bfa5b9162e5cae64e73b",
      "original_line" : 2485,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 472293669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474508171",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r474510233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474510233"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Is there a reason this needs to be a `CConnMan::Options` option?\r\n\r\nTo be consistent with logic related to other connection limits, i.e., `MAX_OUTBOUND_FULL_RELAY_CONNECTIONS` and `MAX_BLOCK_RELAY_ONLY_CONNECTIONS`.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-08-21T08:17:29Z",
      "diff_hunk" : "@@ -1889,6 +1889,7 @@ bool AppInitMain(const util::Ref& context, NodeContext& node)\n     connOptions.nMaxConnections = nMaxConnections;\n     connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);\n     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);\n+    connOptions.m_max_block_relay_anchor = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r474510233",
      "id" : 474510233,
      "in_reply_to_id" : 465105274,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUxMDIzMw==",
      "original_commit_id" : "9445a3411ed589d38cd4eee6714015d065f2b180",
      "original_line" : 1910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 472295229,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/474510233",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "On the eclipses scenario mitigated, as a first step, it assumes the attacker to perform a\r\n_addrman takover_ thus controlling the set of futures peers that the victim node will be able to\r\nconnect to. This takeover may be either short-lived/long-lived or even persistent at whim of attacker,\r\ndepending on the theoritical addr-relay vulnerability leveraged. To effectively activate the eclipse,\r\nan attacker needs to benefit from a favorable event, a) a restart or b) a full rotation of your outbounds (stale tip,\r\nlagging chain, eviction logic of connected peers, ...). In case of a), independently of the restart\r\nsource (spontaneous or attacker triggered), anchors connections will prevent your attacker to win\r\ncontrol of your network view, and so are worthy on this ground.\r\n\r\nOn the peer rotation cases, especially leverage of the eviction logic, I think it would bypass this new counter-measure. The connection starvation tactic could be used to hijack your inbound slots towards your selected anchors peers and thus forcing you to initiate new connections to malicious peers. But a) it's likely to be harder\r\nafter https://github.com/bitcoin/bitcoin/pull/17428, as those anchors are going to be protected\r\nas block-relay peers and b) whereas lower bound of restart-eclipse presume for an attacker only \r\ninjecting p2p messages and leveraging a natural event, starvation requires from it to actively \r\noccupy network slots and game on eviction criterias. Really when we analyze eclipse attacks, we should\r\nhave a hierarchy of them classified with regards to resources they require from the attacker to\r\nsuccessfully perform them. The fact that a stronger attack A can easily bypass counter-measure for\r\nattack B doesn't invalidate worthiness of counter-measure B. At the end of the day, any of our actual\r\neclipse counter-measure is likely to perfom poorly with regards to active infrastructure attacks.\r\n\r\nOn the DoS issue, I don't think that granting an anchor privilege to our outbound-block-relay-only\r\ngive any new _DoS privilege_ to them. The set of messages we talk with them is restrained, thus \r\ntheorically reducing the attack surface we expose to them. At the limit, we may favor them to\r\nupgrade them as compact blocks peers, and they may opportunity to exploit compact code. But that's\r\nonly exception I can see ? Not persisting anchors through unclear restart will actually reduce\r\neffectiveness of counter-measure, and I think that silent eclipsing might be more worrying than\r\nnoisy DoS. A crash is likely to be notified more or less quickly by the operator and should halt\r\nany higher application logic whereas keeping operating on a attacker-controlled view of the network\r\ncan be even more harmful funds-loss wise.\r\n\r\nOn the network staticness increase, I think gmaxwell made the point in the other thread that persitence\r\nmay favor physically-near peers on the long term as the far from us one as more likely to be dropped\r\nfrom they anchor privilege due to network/link layer aleas. That way slightly degrading network\r\nrobustness with regards to network-partition geographically based. It should be balanced with the\r\nfact this anchor, physically-near peers will also known natural restart or other event, likely\r\nreshuflling the cards to anyone. This should be something interesting to monitor by coupling anchor \r\nrotations with ASN infos provided by ASMAP. And if there is any meaningful geographical bias\r\nintroduced.\r\n\r\nThat said a concern I may still have with proposed implementation is with regards to hindering\r\nnon-observability of block-relay-only. By persisting connections across restarts, given we already\r\nprotect this connections type from stale tip/lagging logic and the fact block-relay connections\r\nare going to be even more stable after #17428, you might improve a potential oracle to guess their \r\npresence. An attacker with connection-starvation/tx-relay capabilities could a) map your full-relay \r\noutbound with some conflicts b) evict those outbound from your connected peers by leveraging eviction\r\nc) observe you never pick new outbounds in some netgroup because this one is already occupied by \r\nyour anchors. \r\n\r\nI would be more confident if we either a) restrain anchors to one of our outbound-block-relay peers\r\nor b) add 2 news anchors peers outbound-block-relay-only. We should try to keep the non-observability\r\nof our block-relay-only peers as good we can, at least for a subset of them.",
      "created_at" : "2020-08-23T18:38:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-678809189",
      "id" : 678809189,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3ODgwOTE4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-23T18:38:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678809189",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">An attacker with connection-starvation/tx-relay capabilities could a) map your full-relay\r\noutbound with some conflicts b) evict those outbound from your connected peers by leveraging eviction\r\nc) observe you never pick new outbounds in some netgroup because this one is already occupied by\r\nyour anchors.\r\n\r\nIt feels to be a way too advanced threat model (especially since (c) should be really hard) to deal with it right now. We can address it later once we're done with more basic issues like those discussed above :)\r\n\r\nBtw, another solution to (c)-like issues might be to choose the tx-relay connections (semi-?)independently from block-relay-only connections (in terms of netgroups/asmap).",
      "created_at" : "2020-08-24T08:22:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-678983360",
      "id" : 678983360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3ODk4MzM2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-24T08:22:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/678983360",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482875198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482875198"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think we should copy bad patterns just because they already exist in the codebase. `Options` is used to pass parameters into `CConnman`'s initialize function, but `CConnman` already has everything it needs to calculate the max block relay anchor connections (the `MAX_BLOCK_RELAY_ONLY_ANCHORS` constant is defined in net, and `m_max_outbound_block_relay` is already passed in).\r\n\r\nAdding this here is essentially placing logic for how to construct `CConnman` inside init.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-03T10:28:35Z",
      "diff_hunk" : "@@ -1889,6 +1889,7 @@ bool AppInitMain(const util::Ref& context, NodeContext& node)\n     connOptions.nMaxConnections = nMaxConnections;\n     connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);\n     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);\n+    connOptions.m_max_block_relay_anchor = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482875198",
      "id" : 482875198,
      "in_reply_to_id" : 465105274,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3NTE5OA==",
      "original_commit_id" : "9445a3411ed589d38cd4eee6714015d065f2b180",
      "original_line" : 1910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 481706123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482875198",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482877813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482877813"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This logic shouldn't be in net_processing. It's all bound up in connection-layer logic rather than application-layer logic. There's nothing here that's specific to the `pnode` that we're in the context of in this `ProcessMessages()` call. I think it makes sense for this to be in `CConnman` rather than here.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-03T10:33:57Z",
      "diff_hunk" : "@@ -2506,6 +2506,15 @@ void ProcessMessage(\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (pfrom.IsBlockOnlyConn()) {\n+                // The node dumps:\n+                // - current anchors; and\n+                // - anchors that were known at startup but have not tried for connections yet\n+                auto anchors_to_save = connman.GetCurrentAnchors();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482877813",
      "id" : 482877813,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3NzgxMw==",
      "original_commit_id" : "d7482556c98b76e73f64d04400a703fdbb9c189f",
      "original_line" : 2513,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 481709523,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/482877813",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-03T13:22:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-686486916",
      "id" : 686486916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NjQ4NjkxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-03T13:22:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/686486916",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated d7482556c98b76e73f64d04400a703fdbb9c189f -> 4eff692eeb861018f1f44b6284891a1d0599dd88 ([pr17428.18](https://github.com/hebasto/bitcoin/commits/pr17428.18) -> [pr17428.20](https://github.com/hebasto/bitcoin/commits/pr17428.20)):\r\n- rebased due to the conflicts with #19704 and #19724\r\n- addressed @jnewbery's [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482875198):\r\n> I don't think we should copy bad patterns just because they already exist in the codebase. `Options` is used to pass parameters into `CConnman`'s initialize function, but `CConnman` already has everything it needs to calculate the max block relay anchor connections (the `MAX_BLOCK_RELAY_ONLY_ANCHORS` constant is defined in net, and `m_max_outbound_block_relay` is already passed in).\r\n> \r\n> Adding this here is essentially placing logic for how to construct `CConnman` inside init.\r\n\r\n- addressed @jnewbery's [comment](https://github.com/bitcoin/bitcoin/pull/17428#discussion_r482877813):\r\n> This logic shouldn't be in net_processing. It's all bound up in connection-layer logic rather than application-layer logic. There's nothing here that's specific to the `pnode` that we're in the context of in this `ProcessMessages()` call. I think it makes sense for this to be in `CConnman` rather than here.",
      "created_at" : "2020-09-07T11:06:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-688252761",
      "id" : 688252761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4ODI1Mjc2MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-07T11:06:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688252761",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r484362401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362401"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-688252761).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-07T11:06:39Z",
      "diff_hunk" : "@@ -1889,6 +1889,7 @@ bool AppInitMain(const util::Ref& context, NodeContext& node)\n     connOptions.nMaxConnections = nMaxConnections;\n     connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);\n     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);\n+    connOptions.m_max_block_relay_anchor = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r484362401",
      "id" : 484362401,
      "in_reply_to_id" : 465105274,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM2MjQwMQ==",
      "original_commit_id" : "9445a3411ed589d38cd4eee6714015d065f2b180",
      "original_line" : 1910,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 483469285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362401",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r484362525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-688252761).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-07T11:06:54Z",
      "diff_hunk" : "@@ -2506,6 +2506,15 @@ void ProcessMessage(\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            if (pfrom.IsBlockOnlyConn()) {\n+                // The node dumps:\n+                // - current anchors; and\n+                // - anchors that were known at startup but have not tried for connections yet\n+                auto anchors_to_save = connman.GetCurrentAnchors();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r484362525",
      "id" : 484362525,
      "in_reply_to_id" : 482877813,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM2MjUyNQ==",
      "original_commit_id" : "d7482556c98b76e73f64d04400a703fdbb9c189f",
      "original_line" : 2513,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 483469429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484362525",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485053828"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485053828"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do we need to store this? Seems straightforward enough to call `GetDataDir() / \"anchors.dat\"` in the two places we need it (and add a constant for `\"anchors.dat\"`)",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T16:36:06Z",
      "diff_hunk" : "@@ -533,6 +538,8 @@ class CConnman\n     NetEventsInterface* m_msgproc;\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n+    fs::path m_anchors_db_path;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485053828",
      "id" : 485053828,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1MzgyOA==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 541,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485053828",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485054314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485054314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not just limit the anchors in this case rather than throwing them all away (ie `m_anchors.resize(static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS))`",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T16:36:56Z",
      "diff_hunk" : "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485054314",
      "id" : 485054314,
      "line" : 2420,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1NDMxNA==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2420,
      "original_position" : 139,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 120,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485054314",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485055446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485055446"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't understand this logic. If `max_anchor_num` is 2 and added nodes is 1, then we'll add 1 anchor, but if `max_anchor_num` is 2 and added nodes is 3, we'll add both anchors. Is that intentional?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T16:38:55Z",
      "diff_hunk" : "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        LogPrintf(\"%s is too large for this node policy. Skipped anchoring.\\n\", m_anchors_db_path.filename());\n+        m_anchors.clear();\n+    } else {\n+        // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+        const size_t max_anchor_num = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);\n+        if (max_anchor_num >= connOptions.m_added_nodes.size()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485055446",
      "id" : 485055446,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1NTQ0Ng==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2424,
      "original_position" : 145,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485055446",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485061161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If this block scope should be indented. Even better, just use the `WITH_LOCK` macro to limit the locking to a single statement:\r\n\r\n`WITH_LOCK(cs_main, State(pfrom.GetId())->fCurrentlyConnected = true);`",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T16:48:47Z",
      "diff_hunk" : "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485061161",
      "id" : 485061161,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2MTE2MQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2545,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061161",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485061712"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061712"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style: could do this on one line if you prefer:\r\n\r\n`if (pfrom.IsBlockOnlyConn()) m_connman.DumpAnchors();`\r\n\r\nI think calling through to connman to dump the anchors is a much cleaner design. Thanks for doing that!",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T16:49:41Z",
      "diff_hunk" : "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {\n             // Mark this node as currently connected, so we update its timestamp later.\n             LOCK(cs_main);\n             State(pfrom.GetId())->fCurrentlyConnected = true;\n             LogPrintf(\"New outbound peer connected: version: %d, blocks=%d, peer=%d%s (%s)\\n\",\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            }\n+            if (pfrom.IsBlockOnlyConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485061712",
      "id" : 485061712,
      "line" : 2551,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2MTcxMg==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2551,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485061712",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485063471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485063471"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would `GetCurrentBlockRelayOnlyConns()` be a more accurate name here?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T16:52:50Z",
      "diff_hunk" : "@@ -1983,8 +1997,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485063471",
      "id" : 485063471,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2MzQ3MQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2011,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485063471",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485064613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485064613"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it be better just to put the loop counting into a for statement? (perhaps in a different PR)",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T16:54:58Z",
      "diff_hunk" : "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485064613",
      "id" : 485064613,
      "line" : 1937,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NDYxMw==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1937,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 42,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485064613",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485066012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485066012"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why are these specialized logs required? Wouldn't it be better to do generic logging for all connection types?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T16:57:17Z",
      "diff_hunk" : "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485066012",
      "id" : 485066012,
      "line" : 1991,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NjAxMg==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1991,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 77,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485066012",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485067137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485067137"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What happens in the logic below if we pick an anchor connection that isn't in our addrman? (ie what happens at the `if (!fFeeler && !HasAllDesirableServiceFlags(addr.nServices))` line below)?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T16:59:17Z",
      "diff_hunk" : "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;\n+            if (nTries > 100)\n+                break;\n+\n+            CAddress addr;\n+            if (anchor) {\n+                addr = m_anchors.back();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485067137",
      "id" : 485067137,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NzEzNw==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1941,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485067137",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485107997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485107997"
         }
      },
      "author_association" : "MEMBER",
      "body" : "slight wording clarification: s/have not tried for connections yet/we have not yet tried to connect to/",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T18:13:55Z",
      "diff_hunk" : "@@ -2908,3 +2961,13 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CConnman::DumpAnchors() const\n+{\n+    // The node dumps:\n+    // - current anchors; and\n+    // - anchors that were known at startup but have not tried for connections yet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485107997",
      "id" : 485107997,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEwNzk5Nw==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2969,
      "original_position" : 166,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484313427,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485107997",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485109968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485109968"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I do not trust `anchors.dat` that appears greater than it should be.\r\n\r\nAlso: https://github.com/bitcoin/bitcoin/pull/17428#discussion_r367057240",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T18:17:35Z",
      "diff_hunk" : "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485109968",
      "id" : 485109968,
      "in_reply_to_id" : 485054314,
      "line" : 2420,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEwOTk2OA==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2420,
      "original_position" : 139,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 120,
      "pull_request_review_id" : 484385202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485109968",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485111515"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485111515"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`m_connman.DumpAnchors();` is not a trivial expression, insofar I'd prefer to place it on its own line for better debugging.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T18:20:26Z",
      "diff_hunk" : "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {\n             // Mark this node as currently connected, so we update its timestamp later.\n             LOCK(cs_main);\n             State(pfrom.GetId())->fCurrentlyConnected = true;\n             LogPrintf(\"New outbound peer connected: version: %d, blocks=%d, peer=%d%s (%s)\\n\",\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            }\n+            if (pfrom.IsBlockOnlyConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485111515",
      "id" : 485111515,
      "in_reply_to_id" : 485061712,
      "line" : 2551,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExMTUxNQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2551,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 484387152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485111515",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485112555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485112555"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure! Going to rename it.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T18:22:26Z",
      "diff_hunk" : "@@ -1983,8 +1997,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485112555",
      "id" : 485112555,
      "in_reply_to_id" : 485063471,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExMjU1NQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2011,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484388482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485112555",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485114791"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485114791"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Why are these specialized logs required?\r\n\r\nBecause anchors are specialized connections by their nature. As a secure feature I'd keep logs as they are.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T18:26:43Z",
      "diff_hunk" : "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485114791",
      "id" : 485114791,
      "in_reply_to_id" : 485066012,
      "line" : 1991,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNDc5MQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1991,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 77,
      "pull_request_review_id" : 484391369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485114791",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485115840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485115840"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! You know English is not my strong point :)\r\nGoing to fix it.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T18:28:42Z",
      "diff_hunk" : "@@ -2908,3 +2961,13 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CConnman::DumpAnchors() const\n+{\n+    // The node dumps:\n+    // - current anchors; and\n+    // - anchors that were known at startup but have not tried for connections yet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485115840",
      "id" : 485115840,
      "in_reply_to_id" : 485107997,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNTg0MA==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2969,
      "original_position" : 166,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484392698,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485115840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485116992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485116992"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Don't calls within `LogPrintf()` require `::cs_main` lock?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T18:30:43Z",
      "diff_hunk" : "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485116992",
      "id" : 485116992,
      "in_reply_to_id" : 485061161,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNjk5Mg==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2545,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 484394146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485116992",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485117572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485117572"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, I see. They don't.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T18:31:56Z",
      "diff_hunk" : "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485117572",
      "id" : 485117572,
      "in_reply_to_id" : 485061161,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExNzU3Mg==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2545,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 484394924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485117572",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485119274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485119274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is unintentional change during the recent rebasing.\r\nMany thanks!",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T18:35:00Z",
      "diff_hunk" : "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        LogPrintf(\"%s is too large for this node policy. Skipped anchoring.\\n\", m_anchors_db_path.filename());\n+        m_anchors.clear();\n+    } else {\n+        // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+        const size_t max_anchor_num = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);\n+        if (max_anchor_num >= connOptions.m_added_nodes.size()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485119274",
      "id" : 485119274,
      "in_reply_to_id" : 485055446,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExOTI3NA==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2424,
      "original_position" : 145,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484397000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485119274",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485183507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485183507"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Btw, https://github.com/bitcoin/bitcoin/pull/17428#discussion_r448268314",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T20:40:19Z",
      "diff_hunk" : "@@ -1983,8 +1997,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485183507",
      "id" : 485183507,
      "in_reply_to_id" : 485063471,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4MzUwNw==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2011,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484477078,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485183507",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485184173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485184173"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Btw, https://github.com/bitcoin/bitcoin/pull/17428#discussion_r449650363",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T20:41:44Z",
      "diff_hunk" : "@@ -2908,3 +2961,13 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CConnman::DumpAnchors() const\n+{\n+    // The node dumps:\n+    // - current anchors; and\n+    // - anchors that were known at startup but have not tried for connections yet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485184173",
      "id" : 485184173,
      "in_reply_to_id" : 485107997,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4NDE3Mw==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2969,
      "original_position" : 166,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484477948,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485184173",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated 4eff692eeb861018f1f44b6284891a1d0599dd88 -> 922c65cfd9ea31b00fdc76514dbdd68129169467 ([pr17428.20](https://github.com/hebasto/bitcoin/commits/pr17428.20) -> [pr17428.21](https://github.com/hebasto/bitcoin/commits/pr17428.21), [diff](https://github.com/hebasto/bitcoin/compare/pr17428.20..pr17428.21)):\r\n- addressed @jnewbery's comments",
      "created_at" : "2020-09-08T20:48:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833",
      "id" : 689127833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17428",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4OTEyNzgzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-08T20:49:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/689127833",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485188596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T20:50:37Z",
      "diff_hunk" : "@@ -533,6 +538,8 @@ class CConnman\n     NetEventsInterface* m_msgproc;\n     /** Pointer to this node's banman. May be nullptr - check existence before dereferencing. */\n     BanMan* m_banman;\n+    fs::path m_anchors_db_path;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485188596",
      "id" : 485188596,
      "in_reply_to_id" : 485053828,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4ODU5Ng==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 541,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 484483496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:50:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188596",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485188900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188900"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T20:51:15Z",
      "diff_hunk" : "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.\n+        LogPrintf(\"%s is too large for this node policy. Skipped anchoring.\\n\", m_anchors_db_path.filename());\n+        m_anchors.clear();\n+    } else {\n+        // Peers added via -addnode are permanent connections too, therefore we could skip the same number of anchors.\n+        const size_t max_anchor_num = std::min(MAX_BLOCK_RELAY_ONLY_ANCHORS, connOptions.m_max_outbound_block_relay);\n+        if (max_anchor_num >= connOptions.m_added_nodes.size()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485188900",
      "id" : 485188900,
      "in_reply_to_id" : 485055446,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4ODkwMA==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2424,
      "original_position" : 145,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484483885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:51:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485188900",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189149"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T20:51:47Z",
      "diff_hunk" : "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189149",
      "id" : 485189149,
      "in_reply_to_id" : 485061161,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4OTE0OQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2545,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 484484217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:51:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189149",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189355"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T20:52:14Z",
      "diff_hunk" : "@@ -1983,8 +1997,28 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n \n             OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant, nullptr, conn_type);\n+\n+            if (anchor) {\n+                const auto v = GetCurrentAnchors();\n+                if (std::find(v.begin(), v.end(), addrConnect) == v.end()) {\n+                    LogPrintf(\"The anchor connection to %s FAILED\\n\", addrConnect.ToString());\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+std::vector<CAddress> CConnman::GetCurrentAnchors() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189355",
      "id" : 485189355,
      "in_reply_to_id" : 485063471,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4OTM1NQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2011,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484484497,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:52:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189355",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189668"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> (perhaps in a different PR)\r\n\r\nYes :)\r\n\r\n",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T20:52:55Z",
      "diff_hunk" : "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485189668",
      "id" : 485189668,
      "in_reply_to_id" : 485064613,
      "line" : 1937,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE4OTY2OA==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1937,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 42,
      "pull_request_review_id" : 484484880,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:52:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485189668",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485190161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks! [Reworked](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833) with a smaller diff.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T20:53:54Z",
      "diff_hunk" : "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;\n+            if (nTries > 100)\n+                break;\n+\n+            CAddress addr;\n+            if (anchor) {\n+                addr = m_anchors.back();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485190161",
      "id" : 485190161,
      "in_reply_to_id" : 485067137,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5MDE2MQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1941,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484485465,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:53:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190161",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485190286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "[Updated](https://github.com/bitcoin/bitcoin/pull/17428#issuecomment-689127833).",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-08T20:54:11Z",
      "diff_hunk" : "@@ -2908,3 +2961,13 @@ uint64_t CConnman::CalculateKeyedNetGroup(const CAddress& ad) const\n \n     return GetDeterministicRandomizer(RANDOMIZER_ID_NETGROUP).Write(vchNetGroup.data(), vchNetGroup.size()).Finalize();\n }\n+\n+void CConnman::DumpAnchors() const\n+{\n+    // The node dumps:\n+    // - current anchors; and\n+    // - anchors that were known at startup but have not tried for connections yet",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485190286",
      "id" : 485190286,
      "in_reply_to_id" : 485107997,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5MDI4Ng==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2969,
      "original_position" : 166,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 484485643,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-08T20:54:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485190286",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485499155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499155"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-09T10:13:24Z",
      "diff_hunk" : "@@ -2542,13 +2542,18 @@ void PeerLogicValidation::ProcessMessage(CNode& pfrom, const std::string& msg_ty\n         pfrom.SetRecvVersion(std::min(pfrom.nVersion.load(), PROTOCOL_VERSION));\n \n         if (!pfrom.IsInboundConn()) {\n+            {\n             // Mark this node as currently connected, so we update its timestamp later.\n             LOCK(cs_main);\n             State(pfrom.GetId())->fCurrentlyConnected = true;\n             LogPrintf(\"New outbound peer connected: version: %d, blocks=%d, peer=%d%s (%s)\\n\",\n                       pfrom.nVersion.load(), pfrom.nStartingHeight,\n                       pfrom.GetId(), (fLogIPs ? strprintf(\", peeraddr=%s\", pfrom.addr.ToString()) : \"\"),\n                       pfrom.m_tx_relay == nullptr ? \"block-relay\" : \"full-relay\");\n+            }\n+            if (pfrom.IsBlockOnlyConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485499155",
      "id" : 485499155,
      "in_reply_to_id" : 485061712,
      "line" : 2551,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ5OTE1NQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2551,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 484862072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-09T10:13:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499155",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485499755"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499755"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok, I think this whole function could be cleaned up, but this change doesn't make things too much worse, so lets save it for a different PR.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-09T10:14:24Z",
      "diff_hunk" : "@@ -1924,11 +1929,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            // If we didn't find an appropriate destination after trying 100 addresses fetched from addrman,\n+            // stop this loop, and let the outer loop run again (which sleeps, adds seed nodes, recalculates\n+            // already-connected network ranges, ...) before trying new addrman addresses.\n+            nTries++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485499755",
      "id" : 485499755,
      "in_reply_to_id" : 485064613,
      "line" : 1937,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ5OTc1NQ==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1937,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 42,
      "pull_request_review_id" : 484862844,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-09T10:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485499755",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485504053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485504053"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think we have to assume that our data directory is not compromised. Otherwise anything could happen.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-09T10:22:38Z",
      "diff_hunk" : "@@ -2377,6 +2411,25 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         }\n     }\n \n+    m_anchors_db_path = GetDataDir() / \"anchors.dat\";\n+    m_anchors = ReadAnchors(m_anchors_db_path);\n+    LogPrintf(\"Loaded %i addresses from %s\\n\", m_anchors.size(), m_anchors_db_path.filename());\n+    if (m_anchors.size() > static_cast<size_t>(MAX_BLOCK_RELAY_ONLY_ANCHORS)) {\n+        // Keep our policy safe.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485504053",
      "id" : 485504053,
      "in_reply_to_id" : 485054314,
      "line" : 2420,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUwNDA1Mw==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 2420,
      "original_position" : 139,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 120,
      "pull_request_review_id" : 484868375,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-09T10:22:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485504053",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485506307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485506307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I really don't like this specialized logging for anchor connections (or the feeler connections below). All connection types are specialized in some way? Why not just log unconditionally for all connection types?",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-09T10:26:58Z",
      "diff_hunk" : "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485506307",
      "id" : 485506307,
      "in_reply_to_id" : 485066012,
      "line" : 1991,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUwNjMwNw==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1991,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 77,
      "pull_request_review_id" : 484871242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-09T10:26:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485506307",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485511823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485511823"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Why not just log unconditionally for all connection types?\r\n\r\nIt could be very noisy in logs. Anyway, touching logging for all connections seems out of this PR scope.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-09T10:37:39Z",
      "diff_hunk" : "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485511823",
      "id" : 485511823,
      "in_reply_to_id" : 485066012,
      "line" : 1991,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUxMTgyMw==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1991,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 77,
      "pull_request_review_id" : 484878417,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-09T10:37:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485511823",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485545150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485545150"
         }
      },
      "author_association" : "MEMBER",
      "body" : "oh, I didn't realise that these are unconditional logs. I definitely think they should be in the NET category.",
      "commit_id" : "922c65cfd9ea31b00fdc76514dbdd68129169467",
      "created_at" : "2020-09-09T11:42:46Z",
      "diff_hunk" : "@@ -1973,8 +1986,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         }\n \n         if (addrConnect.IsValid()) {\n-\n-            if (fFeeler) {\n+            if (anchor) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/17428#discussion_r485545150",
      "id" : 485545150,
      "in_reply_to_id" : 485066012,
      "line" : 1991,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU0NTE1MA==",
      "original_commit_id" : "4eff692eeb861018f1f44b6284891a1d0599dd88",
      "original_line" : 1991,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 77,
      "pull_request_review_id" : 484921590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/17428",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-09T11:42:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/485545150",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
