[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15649](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15649.html) (Add ChaCha20Poly1305@Bitcoin AEAD by jonasschnelli)\n* [#14050](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14050.html) (Add chacha20/poly1305 and chacha20poly1305_AEAD from openssh by jonasschnelli)\n* [#14032](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14032.html) (Add p2p layer encryption with ECDH/ChaCha20Poly1305 by jonasschnelli)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-03-05T10:36:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15512#issuecomment-469630268",
      "id" : 469630268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15512",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2OTYzMDI2OA==",
      "updated_at" : "2019-03-22T22:49:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/469630268",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268286916"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268286916"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A comment would be helpful here: \"If m has fewer than 64 bytes available, copy m to tmp and read from tmp instead\"",
      "commit_id" : "4325da919a042dfb4eed87b6d038dbb236959e5b",
      "created_at" : "2019-03-22T18:17:37Z",
      "diff_hunk" : "@@ -100,6 +102,10 @@ void ChaCha20::Output(unsigned char* c, size_t bytes)\n \n     for (;;) {\n         if (bytes < 64) {\n+            if (m != nullptr) {\n+                for (i = 0;i < bytes;++i) tmp[i] = m[i];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268286916",
      "id" : 268286916,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODI4NjkxNg==",
      "original_commit_id" : "b05bb64dc624c45bf340490db06346cefdbff48a",
      "original_position" : 23,
      "path" : "src/crypto/chacha20.cpp",
      "position" : 23,
      "pull_request_review_id" : 217907518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512",
      "updated_at" : "2019-03-22T18:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268286916",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268287371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268287371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just `memcpy(tmp, m, bytes)` might be simpler and easy to read than this for loop.",
      "commit_id" : "4325da919a042dfb4eed87b6d038dbb236959e5b",
      "created_at" : "2019-03-22T18:18:51Z",
      "diff_hunk" : "@@ -100,6 +102,10 @@ void ChaCha20::Output(unsigned char* c, size_t bytes)\n \n     for (;;) {\n         if (bytes < 64) {\n+            if (m != nullptr) {\n+                for (i = 0;i < bytes;++i) tmp[i] = m[i];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268287371",
      "id" : 268287371,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODI4NzM3MQ==",
      "original_commit_id" : "b05bb64dc624c45bf340490db06346cefdbff48a",
      "original_position" : 23,
      "path" : "src/crypto/chacha20.cpp",
      "position" : 23,
      "pull_request_review_id" : 217907518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512",
      "updated_at" : "2019-03-22T18:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268287371",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268287967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268287967"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure what the benefit of defining XOR macro is. Isn't `x0 ^= ReadLE32(m + 0)` more readable and less error-prone than `x0 = XOR(x0, ReadLE32(m + 0))`?",
      "commit_id" : "4325da919a042dfb4eed87b6d038dbb236959e5b",
      "created_at" : "2019-03-22T18:20:25Z",
      "diff_hunk" : "@@ -146,6 +152,25 @@ void ChaCha20::Output(unsigned char* c, size_t bytes)\n         x14 += j14;\n         x15 += j15;\n \n+        if (m != nullptr) {\n+            x0 = XOR(x0, ReadLE32(m + 0));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268287967",
      "id" : 268287967,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODI4Nzk2Nw==",
      "original_commit_id" : "b05bb64dc624c45bf340490db06346cefdbff48a",
      "original_position" : 34,
      "path" : "src/crypto/chacha20.cpp",
      "position" : 34,
      "pull_request_review_id" : 217907518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512",
      "updated_at" : "2019-03-22T18:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268287967",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268289944"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268289944"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This comment seems imply that output is not written if input is null. Maybe rephrase: \"If \\<input> is non-null, the specified number of \\<bytes> from \\<input> will encrypted and written to \\<output>, otherwise just the keystream will be written to \\<output\\> (which may be useful for random number generation). Either way, the number of bytes written to \\<output> will be \\<bytes>.\"",
      "commit_id" : "4325da919a042dfb4eed87b6d038dbb236959e5b",
      "created_at" : "2019-03-22T18:25:42Z",
      "diff_hunk" : "@@ -20,7 +20,9 @@ class ChaCha20\n     void SetKey(const unsigned char* key, size_t keylen);\n     void SetIV(uint64_t iv);\n     void Seek(uint64_t pos);\n-    void Output(unsigned char* output, size_t bytes);\n+\n+    // if <input> is provided, the ciphertext will be written to <output> otherwise the current keystream",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268289944",
      "id" : 268289944,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODI4OTk0NA==",
      "original_commit_id" : "b05bb64dc624c45bf340490db06346cefdbff48a",
      "original_position" : 6,
      "path" : "src/crypto/chacha20.h",
      "position" : 6,
      "pull_request_review_id" : 217907518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512",
      "updated_at" : "2019-03-22T18:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268289944",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268293664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268293664"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe `assert(hex_message.empty() || m.size() == out.size())`",
      "commit_id" : "4325da919a042dfb4eed87b6d038dbb236959e5b",
      "created_at" : "2019-03-22T18:36:40Z",
      "diff_hunk" : "@@ -187,16 +187,19 @@ static void TestAES256CBC(const std::string &hexkey, const std::string &hexiv, b\n     }\n }\n \n-static void TestChaCha20(const std::string &hexkey, uint64_t nonce, uint64_t seek, const std::string& hexout)\n+static void TestChaCha20(const std::string &hex_message, const std::string &hexkey, uint64_t nonce, uint64_t seek, const std::string& hexout)\n {\n     std::vector<unsigned char> key = ParseHex(hexkey);\n+    std::vector<unsigned char> m = ParseHex(hex_message);\n     ChaCha20 rng(key.data(), key.size());\n     rng.SetIV(nonce);\n     rng.Seek(seek);\n     std::vector<unsigned char> out = ParseHex(hexout);\n     std::vector<unsigned char> outres;\n     outres.resize(out.size());\n-    rng.Output(outres.data(), outres.size());\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268293664",
      "id" : 268293664,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODI5MzY2NA==",
      "original_commit_id" : "4325da919a042dfb4eed87b6d038dbb236959e5b",
      "original_position" : 16,
      "path" : "src/test/crypto_tests.cpp",
      "position" : 16,
      "pull_request_review_id" : 217907518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512",
      "updated_at" : "2019-03-22T18:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268293664",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268298310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268298310"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems like a useful additional test would be call `rng.Output` twice if `hex_message` is nonempty, once with input and once without, and confirm that xoring the two outputs yields the input again.",
      "commit_id" : "4325da919a042dfb4eed87b6d038dbb236959e5b",
      "created_at" : "2019-03-22T18:50:31Z",
      "diff_hunk" : "@@ -187,16 +187,19 @@ static void TestAES256CBC(const std::string &hexkey, const std::string &hexiv, b\n     }\n }\n \n-static void TestChaCha20(const std::string &hexkey, uint64_t nonce, uint64_t seek, const std::string& hexout)\n+static void TestChaCha20(const std::string &hex_message, const std::string &hexkey, uint64_t nonce, uint64_t seek, const std::string& hexout)\n {\n     std::vector<unsigned char> key = ParseHex(hexkey);\n+    std::vector<unsigned char> m = ParseHex(hex_message);\n     ChaCha20 rng(key.data(), key.size());\n     rng.SetIV(nonce);\n     rng.Seek(seek);\n     std::vector<unsigned char> out = ParseHex(hexout);\n     std::vector<unsigned char> outres;\n     outres.resize(out.size());\n-    rng.Output(outres.data(), outres.size());\n+\n+    // perform the ChaCha20 round(s), if message is provided it will output the encrypted ciphertext otherwise the keystream\n+    rng.Output(hex_message.empty() ? nullptr : m.data(), outres.data(), outres.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15512#discussion_r268298310",
      "id" : 268298310,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2ODI5ODMxMA==",
      "original_commit_id" : "4325da919a042dfb4eed87b6d038dbb236959e5b",
      "original_position" : 18,
      "path" : "src/test/crypto_tests.cpp",
      "position" : 18,
      "pull_request_review_id" : 217907518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15512",
      "updated_at" : "2019-03-22T18:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/268298310",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
