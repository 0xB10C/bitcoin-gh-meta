[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92869959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92869959"
         }
      },
      "body" : "You can use `__func__` here.\r\n",
      "commit_id" : "022267ac634b13690414252c4deba7f499f98c63",
      "created_at" : "2016-12-16T19:20:59Z",
      "diff_hunk" : "@@ -3300,6 +3256,48 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+unsigned int CWallet::GetTimeSmart(const CWalletTx& wtx) const\n+{\n+    unsigned int nTimeSmart = wtx.nTimeReceived;\n+    if (!wtx.hashUnset()) {\n+        if (mapBlockIndex.count(wtx.hashBlock)) {\n+            int64_t latestNow = wtx.nTimeReceived;\n+            int64_t latestEntry = 0;\n+            {\n+                // Tolerate times up to the last timestamp in the wallet not more than 5 minutes into the future\n+                int64_t latestTolerated = latestNow + 300;\n+                const TxItems& txOrdered = wtxOrdered;\n+                for (auto it = txOrdered.rbegin(); it != txOrdered.rend(); ++it) {\n+                    CWalletTx* const pwtx = it->second.first;\n+                    if (pwtx == &wtx)\n+                        continue;\n+                    CAccountingEntry* const pacentry = it->second.second;\n+                    int64_t nSmartTime;\n+                    if (pwtx) {\n+                        nSmartTime = pwtx->nTimeSmart;\n+                        if (!nSmartTime)\n+                            nSmartTime = pwtx->nTimeReceived;\n+                    } else\n+                        nSmartTime = pacentry->nTime;\n+                    if (nSmartTime <= latestTolerated) {\n+                        latestEntry = nSmartTime;\n+                        if (nSmartTime > latestNow)\n+                            latestNow = nSmartTime;\n+                        break;\n+                    }\n+                }\n+            }\n+\n+            int64_t blocktime = mapBlockIndex[wtx.hashBlock]->GetBlockTime();\n+            nTimeSmart = std::max(latestEntry, std::min(blocktime, latestNow));\n+        } else\n+            LogPrintf(\"GetTimeSmart(): found %s in block %s not in index\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92869959",
      "id" : 92869959,
      "original_commit_id" : "406e9759478e86d37cd4fca255841fd3291417c3",
      "original_position" : 92,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 13394521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2016-12-16T19:50:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92869959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92875006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92875006"
         }
      },
      "body" : "Thanks, done.",
      "commit_id" : "022267ac634b13690414252c4deba7f499f98c63",
      "created_at" : "2016-12-16T19:50:59Z",
      "diff_hunk" : "@@ -3300,6 +3256,48 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+unsigned int CWallet::GetTimeSmart(const CWalletTx& wtx) const\n+{\n+    unsigned int nTimeSmart = wtx.nTimeReceived;\n+    if (!wtx.hashUnset()) {\n+        if (mapBlockIndex.count(wtx.hashBlock)) {\n+            int64_t latestNow = wtx.nTimeReceived;\n+            int64_t latestEntry = 0;\n+            {\n+                // Tolerate times up to the last timestamp in the wallet not more than 5 minutes into the future\n+                int64_t latestTolerated = latestNow + 300;\n+                const TxItems& txOrdered = wtxOrdered;\n+                for (auto it = txOrdered.rbegin(); it != txOrdered.rend(); ++it) {\n+                    CWalletTx* const pwtx = it->second.first;\n+                    if (pwtx == &wtx)\n+                        continue;\n+                    CAccountingEntry* const pacentry = it->second.second;\n+                    int64_t nSmartTime;\n+                    if (pwtx) {\n+                        nSmartTime = pwtx->nTimeSmart;\n+                        if (!nSmartTime)\n+                            nSmartTime = pwtx->nTimeReceived;\n+                    } else\n+                        nSmartTime = pacentry->nTime;\n+                    if (nSmartTime <= latestTolerated) {\n+                        latestEntry = nSmartTime;\n+                        if (nSmartTime > latestNow)\n+                            latestNow = nSmartTime;\n+                        break;\n+                    }\n+                }\n+            }\n+\n+            int64_t blocktime = mapBlockIndex[wtx.hashBlock]->GetBlockTime();\n+            nTimeSmart = std::max(latestEntry, std::min(blocktime, latestNow));\n+        } else\n+            LogPrintf(\"GetTimeSmart(): found %s in block %s not in index\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92875006",
      "id" : 92875006,
      "original_commit_id" : "406e9759478e86d37cd4fca255841fd3291417c3",
      "original_position" : 92,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 13399737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2016-12-16T19:50:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92875006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "utACK 022267ac634b13690414252c4deba7f499f98c63",
      "created_at" : "2016-12-16T20:34:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#issuecomment-267689587",
      "id" : 267689587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9369",
      "updated_at" : "2016-12-16T20:34:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267689587",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
