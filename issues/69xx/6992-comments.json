[
   {
      "body" : "Concept ACK. ",
      "created_at" : "2015-11-11T21:09:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155911428",
      "id" : 155911428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T21:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155911428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44590588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44590588"
         }
      },
      "body" : "This algorithm is done several times, and is a cluster to read.  Could you extract it out at all to make review easier?",
      "commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "created_at" : "2015-11-11T21:43:10Z",
      "diff_hunk" : "@@ -2316,8 +2326,13 @@ static bool ActivateBestChainStep(CValidationState &state, CBlockIndex *pindexMo\n     }\n     }\n \n-    if (fBlocksDisconnected)\n-        mempool.TrimToSize(GetArg(\"-maxmempool\", DEFAULT_MAX_MEMPOOL_SIZE) * 1000000);\n+    if (fBlocksDisconnected) {\n+        size_t mempoolLimit = GetArg(\"-maxmempool\", DEFAULT_MAX_MEMPOOL_SIZE) * 1000000;\n+        const double defaultPriorityLimit = (double) GetArg(\"-blockprioritysize\", DEFAULT_BLOCK_PRIORITY_SIZE) / (double) GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+        size_t priorityLimit = GetArg(\"-prioritylimit\", defaultPriorityLimit * mempoolLimit);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44590588",
      "id" : 44590588,
      "original_commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "original_position" : 46,
      "path" : "src/main.cpp",
      "position" : 46,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992",
      "updated_at" : "2015-11-11T21:43:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44590588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "I'm not sure we need a separate 'space' for the priority transactions.\r\nConceptually the entire mempool algorithm shouldn't be more complicated than:\r\n\r\n* Sort transactions by descending, comparing fees, then priority.\r\n* Fees less than `minRelayTxFee` should be considered `0`, allowing priority to take precedence\r\n* Drop transactions on the lower part of the spectrum until ideal memory usage is met.\r\n\r\nEven a simplistic 'fitness' function could be used which combines priority and fees in a way that is considered sane, and that function used rather than this mix-match combination of fee/priority comparisons everywhere.\r\n\r\n**edit**: And then there is that which @TheBlueMatt points out,  is priority even worth it?",
      "created_at" : "2015-11-11T21:48:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155920268",
      "id" : 155920268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155920268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "NAK. I thought there was agreement that priority space is a bad idea in general. The amount of developer time that has gone into making priority space work properly is no where near the gains from having it.",
      "created_at" : "2015-11-11T21:52:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155921181",
      "id" : 155921181,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T21:52:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155921181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I am testing now it to see if it solves my problems.  It can't possibly be worse than the current version, which almost led to loss of coins for me due to transactions with negative confirmations reappearing as unconfirmed after a restart, and loss of trust from other people when my client double spent inputs instead of rebroadcasting high priority transactions.",
      "created_at" : "2015-11-11T22:18:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155927431",
      "id" : 155927431,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155927431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15728135?v=3",
         "events_url" : "https://api.github.com/users/sturles/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sturles/followers",
         "following_url" : "https://api.github.com/users/sturles/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sturles/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sturles",
         "id" : 15728135,
         "login" : "sturles",
         "organizations_url" : "https://api.github.com/users/sturles/orgs",
         "received_events_url" : "https://api.github.com/users/sturles/received_events",
         "repos_url" : "https://api.github.com/users/sturles/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sturles/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sturles/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sturles"
      }
   },
   {
      "body" : "The solution, as mentioned by @morcos in #6972 is the last commit in #6134, not re-adding priority area when there is actual fee-paying traffic.",
      "created_at" : "2015-11-11T22:21:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155928029",
      "id" : 155928029,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:21:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155928029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "My idea was that we'd get rid of priority, and replace it with a small adjustment to the fee or size of a transaction.\r\n\r\nOne idea is to treat the total bitcoindays of the UTXO set as limited resource and treat it as currency, and that burning it should be treated like extra fee, with a small factor. Specifically:\r\n* for each transaction you compute the bitcoin-days-destroyed\r\n* divide it by the average UTXO entry age weighed by amount (around 800 days currently)\r\n* the result is a value in BTC; take some configurable fraction of it (0.5% for example)\r\n* treat the result as extra fee (which gets divided by the tx size to obtain the feerate).\r\n\r\nThis is simple (don't bother recalculating this equivalent fee on every mempool change; just infrequently in the background or even not at all and keep using the value from entry time), and using 0.5% as factor would give a 250-byte 1 BTC-day-destroyed transaction (the limit for high priority earlier) the equivalent of 2500 satoshi/kB feerate boost.\r\n\r\nThe downside is that it has no guarantees on how much a miner could lose by using this approach. For example, 100 BTC of 1 year old coins would be treated equal to a 1 BTC fee. We can cap the maximum amount of feerate replaced, but that may make the scheme pretty useless if the cap is easy to hit.",
      "created_at" : "2015-11-11T22:27:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155929352",
      "id" : 155929352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:27:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155929352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sturles I believe that the wallet treating evicted transactions as spendable again is an outright bug, and a blocker we should fix before release (so thanks for reporting that). What the right solution is w.r.t. priority, I don't know - it's a hard problem that tries to balance the advantage of allowing a small amount of free transactions on the network (but only to the privileged few who have enough stashed coins...) and extra solftware complexity and incentive-incompatibility for mining...",
      "created_at" : "2015-11-11T22:31:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155930238",
      "id" : 155930238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:31:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155930238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@TheBlueMatt The last commit in #6134 is a kludge to hide some symptoms.  It doesn't solve the bugs I just mentioned here.  It would just have added a fee to one of the transactions I mentioned.  The rest would still be treated the same.  If this patch works as advertised, it will solve all the problems I mentioned.  (Not guaranteed, in case a lot of extremely high priority transactions suddenly show up, but likewise the commit in #6134 is not guaranteed to fix the problem in case a lot of high fee transactions suddenly show up.)",
      "created_at" : "2015-11-11T22:37:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155931427",
      "id" : 155931427,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:37:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155931427",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15728135?v=3",
         "events_url" : "https://api.github.com/users/sturles/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sturles/followers",
         "following_url" : "https://api.github.com/users/sturles/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sturles/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sturles",
         "id" : 15728135,
         "login" : "sturles",
         "organizations_url" : "https://api.github.com/users/sturles/orgs",
         "received_events_url" : "https://api.github.com/users/sturles/received_events",
         "repos_url" : "https://api.github.com/users/sturles/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sturles/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sturles/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sturles"
      }
   },
   {
      "body" : "@sipa I'm not sure its worth the incentive-incompatibility for miners to do that. You could probably get away with it (with a cap) for some time yet, but we'll be back here in 6-12 months getting rid of priority at that point.",
      "created_at" : "2015-11-11T22:45:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155933122",
      "id" : 155933122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:45:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155933122",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Agreed, NACK",
      "created_at" : "2015-11-11T23:51:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155947516",
      "id" : 155947516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T23:51:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155947516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   }
]
