{
   "assignee" : null,
   "assignees" : [],
   "body" : "Since Bitcoin Core v0.8, we've used a per-tx model for the chainstate database and its cache. This means that the database is effectively a map from txids to the *list* of unspent outputs for that transaction. This PR changes that to a map from outpoints ((txid,index) pairs) to just the *individual* unspent output for that outpoint.\r\n\r\nThe original reason for aggregating the outputs per transaction was to save space: this way, we could avoid duplicating the txid and transaction meta across the multiple outputs. However, LevelDB internally uses an encoding that omits repeated prefix bytes in keys, and because of that, duplicating the txids is not very significant.\r\n\r\nThere are many advantages for using a per-txout model:\r\n* Simpler code.\r\n* Avoiding the CPU overhead of deserializing and serializing the unused outputs.\r\n* More predictable memory usage.\r\n* More easily adaptable to various cache flushing strategies.\r\n\r\nDownsides:\r\n* Slightly larger on-disk representation.\r\n\r\nThis PR includes:\r\n* PR #10148.\r\n* A forward-compatible undo data format change (new versions can use old undo data, not the other way around).\r\n* Switch to a new per-txout coinsview model with related database changes.\r\n* Upgrade code to convert the old chainstate to a new chainstate (which is interruptible).\r\n* Adapted unit and functional tests (thanks to @ryanofsky for adapting the unit tests).\r\n\r\nTests:\r\r\n* Manually verified that continuing a reindex started with old code succeeds (even when recovering from a crash in the middle of flushing while upgrading).",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10195/comments",
   "created_at" : "2017-04-12T12:37:19Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10195/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/10195",
   "id" : 221248186,
   "labels" : [
      {
         "color" : "981023",
         "default" : false,
         "id" : 326918230,
         "name" : "Resource usage",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Resource%20usage"
      },
      {
         "color" : "fbca04",
         "default" : false,
         "id" : 97470796,
         "name" : "UTXO Db and Indexes",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10195/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 10195,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/10195.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10195",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/10195.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10195"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Switch chainstate db and cache to per-txout model",
   "updated_at" : "2017-04-12T13:50:09Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10195",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
      "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipa/followers",
      "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipa",
      "id" : 548488,
      "login" : "sipa",
      "organizations_url" : "https://api.github.com/users/sipa/orgs",
      "received_events_url" : "https://api.github.com/users/sipa/received_events",
      "repos_url" : "https://api.github.com/users/sipa/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipa"
   }
}
