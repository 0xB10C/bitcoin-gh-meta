[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110379979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110379979"
         }
      },
      "body" : "Would suggest throwing std::out_of_range if this condition is not true. This should be compatible with all the places this code is called (since they previously would have resulted in out-of-bounds memory accesses).",
      "commit_id" : "2f5eb873dda9d1561c233a2313322a53afea5161",
      "created_at" : "2017-04-07T12:39:57Z",
      "diff_hunk" : "@@ -475,7 +475,38 @@ class CWalletTx : public CMerkleTx\n };\n \n \n-using CInputCoin = std::pair<const CWalletTx*, unsigned int>;\n+class CInputCoin {\r\n+public:\r\n+    CInputCoin()\r\n+    {\r\n+    }\r\n+    CInputCoin(const CWalletTx* walletTx, unsigned int i)\r\n+    {\r\n+        if (walletTx != nullptr && i < walletTx->tx->vout.size())\r",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110379979",
      "id" : 110379979,
      "original_commit_id" : "8227fcc0ba94ae2af3e85171c9f0bfbe518a34bf",
      "original_position" : 12,
      "path" : "src/wallet/wallet.h",
      "position" : 12,
      "pull_request_review_id" : 31548993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165",
      "updated_at" : "2017-04-07T13:08:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110379979",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "utACK https://github.com/bitcoin/bitcoin/pull/10165/commits/2f5eb873dda9d1561c233a2313322a53afea5161",
      "created_at" : "2017-04-07T12:44:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10165#issuecomment-292526495",
      "id" : 292526495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10165",
      "updated_at" : "2017-04-07T12:44:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/292526495",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110384304"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110384304"
         }
      },
      "body" : "Would suggest deleting default constructor and IsNull method. Their presence seem to make this class more complex and precarious than is necessary, and could lead to bugs and unintended behavior.\r\n\r\nThe only place where a nullable `CInputCoin` seems to be used is in one `coinLowestLarger` local variable, and you could more easily declare this variable as `boost::optional<CInputCoin> coinLowestLarger;` (or [std::optional](http://en.cppreference.com/w/cpp/utility/optional) in the future) instead of building in a layer of optionality into the type.",
      "commit_id" : "2f5eb873dda9d1561c233a2313322a53afea5161",
      "created_at" : "2017-04-07T13:04:58Z",
      "diff_hunk" : "@@ -475,7 +475,38 @@ class CWalletTx : public CMerkleTx\n };\n \n \n-using CInputCoin = std::pair<const CWalletTx*, unsigned int>;\n+class CInputCoin {\r\n+public:\r\n+    CInputCoin()\r",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110384304",
      "id" : 110384304,
      "original_commit_id" : "8227fcc0ba94ae2af3e85171c9f0bfbe518a34bf",
      "original_position" : 7,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 31548993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165",
      "updated_at" : "2017-04-07T13:08:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110384304",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110400583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110400583"
         }
      },
      "body" : "I don't think using `optional` would make the code more clear. I never saw it used anywhere in bitcoin.\r\nWhat about using `CInputCoin*` for coinLowestLarger instead?",
      "commit_id" : "2f5eb873dda9d1561c233a2313322a53afea5161",
      "created_at" : "2017-04-07T14:20:53Z",
      "diff_hunk" : "@@ -475,7 +475,38 @@ class CWalletTx : public CMerkleTx\n };\n \n \n-using CInputCoin = std::pair<const CWalletTx*, unsigned int>;\n+class CInputCoin {\r\n+public:\r\n+    CInputCoin()\r",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110400583",
      "id" : 110400583,
      "original_commit_id" : "8227fcc0ba94ae2af3e85171c9f0bfbe518a34bf",
      "original_position" : 7,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 31572909,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165",
      "updated_at" : "2017-04-07T14:20:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110400583",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110406605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110406605"
         }
      },
      "body" : "> I don't think using optional would make the code more clear.\r\n\r\nI think optional's useful. It saves work of having to build optionality into types you define, and more importantly it allows the same type to be optional in some contexts and required in others, which I think is exactly what you want here. std::optional is part of c++17 so eventually it will start becoming more commonly used.\r\n\r\nAnyway, this was just a suggestion, so feel free to ignore it if you have a different preference.\r\n\r\n> What about using CInputCoin* for coinLowestLarger instead?\r\n\r\nUsing a pointer was actually going to be my first suggestion, but I didn't see a way to make that work because coinLowestLarger is assigned from a local variable. But I think this would be an improvement if it could work.",
      "commit_id" : "2f5eb873dda9d1561c233a2313322a53afea5161",
      "created_at" : "2017-04-07T14:44:23Z",
      "diff_hunk" : "@@ -475,7 +475,38 @@ class CWalletTx : public CMerkleTx\n };\n \n \n-using CInputCoin = std::pair<const CWalletTx*, unsigned int>;\n+class CInputCoin {\r\n+public:\r\n+    CInputCoin()\r",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110406605",
      "id" : 110406605,
      "original_commit_id" : "8227fcc0ba94ae2af3e85171c9f0bfbe518a34bf",
      "original_position" : 7,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 31579563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165",
      "updated_at" : "2017-04-07T14:44:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110406605",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110429299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110429299"
         }
      },
      "body" : "I agree. That's safer than leaving the object as invalid dummy object, which would be harder to troubleshoot as it's not checked against everywhere..",
      "commit_id" : "2f5eb873dda9d1561c233a2313322a53afea5161",
      "created_at" : "2017-04-07T16:26:51Z",
      "diff_hunk" : "@@ -475,7 +475,38 @@ class CWalletTx : public CMerkleTx\n };\n \n \n-using CInputCoin = std::pair<const CWalletTx*, unsigned int>;\n+class CInputCoin {\r\n+public:\r\n+    CInputCoin()\r\n+    {\r\n+    }\r\n+    CInputCoin(const CWalletTx* walletTx, unsigned int i)\r\n+    {\r\n+        if (walletTx != nullptr && i < walletTx->tx->vout.size())\r",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10165#discussion_r110429299",
      "id" : 110429299,
      "original_commit_id" : "8227fcc0ba94ae2af3e85171c9f0bfbe518a34bf",
      "original_position" : 12,
      "path" : "src/wallet/wallet.h",
      "position" : 12,
      "pull_request_review_id" : 31605183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10165",
      "updated_at" : "2017-04-07T16:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110429299",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
