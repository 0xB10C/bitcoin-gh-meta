[
   {
      "body" : "Isnt it a much simpler approach to just switch the keypool set to two separate sets instead? On wallet load we read each keypool entry from disk anyway, so just caching it differently should be trivial.",
      "created_at" : "2017-04-11T22:42:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10184#issuecomment-293421535",
      "id" : 293421535,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10184",
      "updated_at" : "2017-04-11T22:42:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293421535",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I think this would be the right long term approach. I don't think it is simple to change though. This PR is just some tape on the current approach.\r\n\r\nAnyway, I take a look, maybe it is not as complicated as I think.",
      "created_at" : "2017-04-12T02:32:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10184#issuecomment-293455088",
      "id" : 293455088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10184",
      "updated_at" : "2017-04-12T02:32:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293455088",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "Long term, keypools do make little sense to me, in conjunction with HD. For encrypted wallets, we may want to disable any private key export function and use public key derivation (and remove both keypools). For the HD lookup window, we can generate (in memory) ~+50 keys during startup and extend it whenever the user retrieves a new address. IMO there is no need to persist the set.\r\n\r\nI'm not sure if it's worth to optimise this further (this PR seems to be okay though).",
      "created_at" : "2017-04-12T12:50:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10184#issuecomment-293565605",
      "id" : 293565605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10184",
      "updated_at" : "2017-04-12T12:50:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293565605",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli I think we very much need to fix the performance regressions before 0.15. The introduction of many disk hits on some paths is potentially a huge issue for some users.\r\n\r\nI'm slightly confused about this PR, however. Am I reading it correctly to think that its just a different way of identifying keys and the actual performance improvements will come in a later PR?",
      "created_at" : "2017-04-12T14:17:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10184#issuecomment-293591266",
      "id" : 293591266,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10184",
      "updated_at" : "2017-04-12T14:17:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293591266",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt I think this PR is enough to solve current inconvenience.\r\n\r\nBefore:\r\n\r\nTopUp of 100 key will fill the keypool in the following way:\r\n\r\n[external1][external2]...[external100][internal1][internal2]...[internal100]\r\n\r\nNow if you call ` ReserveKeyFromPool` with `internal=true` this create 100 disk hit.\r\n\r\nThis PR makes it so TopUp of 100 key fill the keypool in the following way\r\n\r\n[external1][internal1][external2][internal2]...[external100][internal100]\r\n\r\nWhich mean that  `ReserveKeyFromPool` will have 2 disk hits instead of 100.\r\n",
      "created_at" : "2017-04-13T07:32:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10184#issuecomment-293814988",
      "id" : 293814988,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10184",
      "updated_at" : "2017-04-13T07:32:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293814988",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "@NicolasDorier ahh, indeed, I was being dense. Still, we should also fix the massive slowdown in keypool counting (which I somehow assumed this was meant to also solve, though in a super roundabout way).\n\nOn April 13, 2017 3:32:54 AM EDT, Nicolas Dorier <notifications@github.com> wrote:\n>@TheBlueMatt I think this PR is enough to solve current inconvenience.\n>\n>Before:\n>\n>TopUp of 100 key will fill the keypool in the following way:\n>\n>[external1][external2]...[external100][internal1][internal2]...[internal100]\n>\n>Now if you call ` ReserveKeyFromPool` with `internal=true` this create\n>100 disk hit.\n>\n>This PR makes it so TopUp of 100 key fill the keypool in the following\n>way\n>\n>[external1][internal1][external2][internal2]...[external100][internal100]\n>\n>Which mean that  `ReserveKeyFromPool` will have 2 disk hits instead of\n>100.\n",
      "created_at" : "2017-04-13T12:53:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10184#issuecomment-293886902",
      "id" : 293886902,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10184",
      "updated_at" : "2017-04-13T12:53:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293886902",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
