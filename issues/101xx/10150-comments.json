[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r109834797"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109834797"
         }
      },
      "body" : "Don't do this! This existed for a reason. What you did will reduce libevent performance extremely by always enabling their internal debugging. Same is probably true for leveldb. I'd prefer just not to allow to switch those at runtime.\r\n(unless it can be done in a thread-safe way later on, but I don't think so)",
      "commit_id" : "ea4ae762bbbc7535e3ffa3cf1f14f36ef7fa6a49",
      "created_at" : "2017-04-05T05:52:41Z",
      "diff_hunk" : "@@ -385,13 +385,7 @@ bool InitHTTPServer()\n     // Redirect libevent's logging to our own log\n     event_set_log_callback(&libevent_log_cb);\n #if LIBEVENT_VERSION_NUMBER >= 0x02010100\n-    // If -debug=libevent, set full libevent debugging.\n-    // Otherwise, disable all libevent debugging.\n-    if (LogAcceptCategory(BCLog::LIBEVENT)) {\n-        event_enable_debug_logging(EVENT_DBG_ALL);\n-    } else {\n-        event_enable_debug_logging(EVENT_DBG_NONE);\n-    }\n+    event_enable_debug_logging(EVENT_DBG_ALL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r109834797",
      "id" : 109834797,
      "original_commit_id" : "0365458af7a11ea00649905569894eceb69fba24",
      "original_position" : 11,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 30960982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150",
      "updated_at" : "2017-04-06T20:06:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109834797",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Concept ACK ofcourse",
      "created_at" : "2017-04-05T06:49:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10150#issuecomment-291770269",
      "id" : 291770269,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10150",
      "updated_at" : "2017-04-05T06:49:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/291770269",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Oh. That's great.\r\nConcept ACK. Will test soon.",
      "created_at" : "2017-04-05T06:53:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10150#issuecomment-291770883",
      "id" : 291770883,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10150",
      "updated_at" : "2017-04-05T06:53:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/291770883",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r109924304"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109924304"
         }
      },
      "body" : "Are you sure? I've tested this and logging is only enabled when libevent is built in debug mode:\r\n\r\nhttps://github.com/libevent/libevent/blob/2e52bace9f9998826bd3819af328efc8d18decf9/log-internal.h#L46\r\n\r\nand\r\n\r\nhttps://github.com/libevent/libevent/blob/2e52bace9f9998826bd3819af328efc8d18decf9/log-internal.h#L86\r\n\r\nI would have thought that if we're running libevent in debug, then performance is already hosed.\r\n\r\nIf I'm wrong, I left this as a separate commit so we can leave it out if needed. The first commit forbids trying to change libevent logging during runtime and stands on its own.\r\n\r\nleveldb: #9999 always hands a logging class to leveldb at startup, even if logging is disabled. I don't know if that affects performance. This PR doesn't change that behaviour.",
      "commit_id" : "ea4ae762bbbc7535e3ffa3cf1f14f36ef7fa6a49",
      "created_at" : "2017-04-05T14:05:03Z",
      "diff_hunk" : "@@ -385,13 +385,7 @@ bool InitHTTPServer()\n     // Redirect libevent's logging to our own log\n     event_set_log_callback(&libevent_log_cb);\n #if LIBEVENT_VERSION_NUMBER >= 0x02010100\n-    // If -debug=libevent, set full libevent debugging.\n-    // Otherwise, disable all libevent debugging.\n-    if (LogAcceptCategory(BCLog::LIBEVENT)) {\n-        event_enable_debug_logging(EVENT_DBG_ALL);\n-    } else {\n-        event_enable_debug_logging(EVENT_DBG_NONE);\n-    }\n+    event_enable_debug_logging(EVENT_DBG_ALL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r109924304",
      "id" : 109924304,
      "original_commit_id" : "0365458af7a11ea00649905569894eceb69fba24",
      "original_position" : 11,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 31057669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150",
      "updated_at" : "2017-04-06T20:06:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/109924304",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r110120525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110120525"
         }
      },
      "body" : "Yes, it is possible to compile libevent wholesale without debug messages. However, most distributions enable them.\r\nEven if it is compiled with debug messages, normally they just sink at the libevent side before even being formatted: https://github.com/libevent/libevent/blob/master/log-internal.h#L80\r\nRemember that libevent debugging is extremely noisy. It always is - the mask is currently unused - there are no specific flags.\r\nThere will be significant overhead to dropping the messages at our side, after formatting. That's worth it for the questionable advantage of being able to enable it during runtime.",
      "commit_id" : "ea4ae762bbbc7535e3ffa3cf1f14f36ef7fa6a49",
      "created_at" : "2017-04-06T09:48:58Z",
      "diff_hunk" : "@@ -385,13 +385,7 @@ bool InitHTTPServer()\n     // Redirect libevent's logging to our own log\n     event_set_log_callback(&libevent_log_cb);\n #if LIBEVENT_VERSION_NUMBER >= 0x02010100\n-    // If -debug=libevent, set full libevent debugging.\n-    // Otherwise, disable all libevent debugging.\n-    if (LogAcceptCategory(BCLog::LIBEVENT)) {\n-        event_enable_debug_logging(EVENT_DBG_ALL);\n-    } else {\n-        event_enable_debug_logging(EVENT_DBG_NONE);\n-    }\n+    event_enable_debug_logging(EVENT_DBG_ALL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r110120525",
      "id" : 110120525,
      "original_commit_id" : "0365458af7a11ea00649905569894eceb69fba24",
      "original_position" : 11,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 31268042,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150",
      "updated_at" : "2017-04-06T20:06:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110120525",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r110255587"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110255587"
         }
      },
      "body" : "Turns out libevent logging can be changed at runtime: https://github.com/libevent/libevent/blob/2e52bace9f9998826bd3819af328efc8d18decf9/whatsnew-2.1.txt#L269\r\n\r\nI've pushed a new commit that leaves `InitHTTPServer()` unchanged and uses `event_enable_debug_logging()` to update logging.",
      "commit_id" : "ea4ae762bbbc7535e3ffa3cf1f14f36ef7fa6a49",
      "created_at" : "2017-04-06T20:09:19Z",
      "diff_hunk" : "@@ -385,13 +385,7 @@ bool InitHTTPServer()\n     // Redirect libevent's logging to our own log\n     event_set_log_callback(&libevent_log_cb);\n #if LIBEVENT_VERSION_NUMBER >= 0x02010100\n-    // If -debug=libevent, set full libevent debugging.\n-    // Otherwise, disable all libevent debugging.\n-    if (LogAcceptCategory(BCLog::LIBEVENT)) {\n-        event_enable_debug_logging(EVENT_DBG_ALL);\n-    } else {\n-        event_enable_debug_logging(EVENT_DBG_NONE);\n-    }\n+    event_enable_debug_logging(EVENT_DBG_ALL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r110255587",
      "id" : 110255587,
      "original_commit_id" : "0365458af7a11ea00649905569894eceb69fba24",
      "original_position" : 11,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 31417348,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150",
      "updated_at" : "2017-04-06T20:09:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110255587",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "Pushed a new commit that I hope addresses @laanwj's point here: https://github.com/bitcoin/bitcoin/pull/10150#discussion_r109834797",
      "created_at" : "2017-04-06T20:10:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10150#issuecomment-292301275",
      "id" : 292301275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10150",
      "updated_at" : "2017-04-06T20:10:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/292301275",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r110264637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110264637"
         }
      },
      "body" : "It looks like this code is almost duplicated with the exclude case (except the |/& and true/false). Might make sense to roll this into a function that converts a list of flag strings into a bitmask and apply that wholesale.",
      "commit_id" : "ea4ae762bbbc7535e3ffa3cf1f14f36ef7fa6a49",
      "created_at" : "2017-04-06T20:52:27Z",
      "diff_hunk" : "@@ -555,6 +556,65 @@ UniValue getmemoryinfo(const JSONRPCRequest& request)\n     }\n }\n \n+UniValue logging(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() > 2) {\n+        throw std::runtime_error(\n+            \"logging [include,...] <exclude>\\n\"\n+            \"Gets and sets the logging configuration.\\n\"\n+            \"When called without an argument, returns the list of categories that are currently being debug logged.\\n\"\n+            \"When called with arguments, adds or removes categories from debug logging.\\n\"\n+            \"The valid logging categories are: \" + ListLogCategories() + \"\\n\"\n+            \"libevent logging is configured on startup and cannot be modified by this RPC during runtime.\"\n+            \"Arguments:\\n\"\n+            \"1. \\\"include\\\" (array of strings) add debug logging for these categories.\\n\"\n+            \"2. \\\"exclude\\\" (array of strings) remove debug logging for these categories.\\n\"\n+            \"\\nResult: <categories>  (string): a list of the logging categories that are active.\\n\"\n+            \"\\nExamples:\\n\"\n+            + HelpExampleCli(\"logging\", \"\\\"[\\\\\\\"all\\\\\\\"]\\\" \\\"[\\\\\\\"http\\\\\\\"]\\\"\")\n+            + HelpExampleRpc(\"logging\", \"[\\\"all\\\"], \\\"[libevent]\\\"\")\n+        );\n+    }\n+\n+    if (request.params.size() > 0 && request.params[0].isArray()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10150#discussion_r110264637",
      "id" : 110264637,
      "original_commit_id" : "ea4ae762bbbc7535e3ffa3cf1f14f36ef7fa6a49",
      "original_position" : 32,
      "path" : "src/rpc/misc.cpp",
      "position" : 32,
      "pull_request_review_id" : 31427281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10150",
      "updated_at" : "2017-04-06T20:52:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/110264637",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
