[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "cirrus task: https://cirrus-ci.com/build/5675560427847680\r\ncommit: https://github.com/RandyMcMillan/bitcoin/commit/b41f962f349ab3d3f8a4d8e761ac5592120f8576\r\n\r\nWe cover an array of possible command line combinations:\r\n\r\n![Screen Shot 2022-02-06 at 6 23 28 PM](https://user-images.githubusercontent.com/152159/152705961-b6d624e3-80b5-4d76-8098-3e1175c15370.png)\r\n\r\n",
      "created_at" : "2022-02-06T18:22:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#issuecomment-1030886850",
      "id" : 1030886850,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24269",
      "node_id" : "IC_kwDOABII5849chXC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1030886850/reactions"
      },
      "updated_at" : "2022-02-06T23:40:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1030886850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/152159?v=4",
         "events_url" : "https://api.github.com/users/RandyMcMillan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RandyMcMillan/followers",
         "following_url" : "https://api.github.com/users/RandyMcMillan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RandyMcMillan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RandyMcMillan",
         "id" : 152159,
         "login" : "RandyMcMillan",
         "node_id" : "MDQ6VXNlcjE1MjE1OQ==",
         "organizations_url" : "https://api.github.com/users/RandyMcMillan/orgs",
         "received_events_url" : "https://api.github.com/users/RandyMcMillan/received_events",
         "repos_url" : "https://api.github.com/users/RandyMcMillan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RandyMcMillan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RandyMcMillan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RandyMcMillan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-03-19T17:39:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#issuecomment-1073050921",
      "id" : 1073050921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24269",
      "node_id" : "IC_kwDOABII584_9XUp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1073050921/reactions"
      },
      "updated_at" : "2022-03-19T17:39:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1073050921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834187432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834187432"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, maybe use named args (for all, or after the first one), maybe better to omit a default value if you're passing values in for clarity, and naming suggestion \r\n```diff\r\n-    def test_local_addresses(self, test_case, should_be_empty=False):\r\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\r\n\r\n...\r\n\r\n         for test_case in test_cases:\r\n-            self.test_local_addresses(test_case, False)\r\n+            self.test_local_addresses(test_case, expect_empty=False)\r\n \r\n         for test_case in test_cases_empty:\r\n-            self.test_local_addresses(test_case, True)\r\n+            self.test_local_addresses(test_case, expect_empty=True)\r\n```",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T11:08:45Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834187432",
      "id" : 834187432,
      "line" : 42,
      "node_id" : "PRRC_kwDOABII584xuLCo",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 42,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 42,
      "pull_request_review_id" : 920094371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834187432/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T11:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834187432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834191148"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834191148"
         }
      },
      "author_association" : "MEMBER",
      "body" : "formatting nit\r\n```diff\r\n     def run_test(self):\r\n-        test_cases = [[\"-listen\", \"-discover\"],\r\n-                      [\"-listen=1\", \"-discover\"],\r\n-                      [\"-listen\", \"-discover=1\"],\r\n-                      [\"-listen=1\", \"-discover=1\"],\r\n-                      [\"-discover\"]]\r\n-\r\n-        test_cases_empty = [[\"-discover=0\"],\r\n-                            [\"-listen\", \"-discover=0\"],\r\n-                            []]\r\n+        test_cases = [\r\n+            [\"-listen\", \"-discover\"],\r\n+            [\"-listen=1\", \"-discover\"],\r\n+            [\"-listen\", \"-discover=1\"],\r\n+            [\"-listen=1\", \"-discover=1\"],\r\n+            [\"-discover\"],\r\n+        ]\r\n+\r\n+        test_cases_empty = [\r\n+            [\"-discover=0\"],\r\n+            [\"-listen\", \"-discover=0\"],\r\n+            [],\r\n+        ]\r\n```\r\n",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T11:12:22Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [[\"-listen\", \"-discover\"],\n+                      [\"-listen=1\", \"-discover\"],\n+                      [\"-listen\", \"-discover=1\"],\n+                      [\"-listen=1\", \"-discover=1\"],\n+                      [\"-discover\"]]\n+\n+        test_cases_empty = [[\"-discover=0\"],\n+                            [\"-listen\", \"-discover=0\"],\n+                            []]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834191148",
      "id" : 834191148,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII584xuL8s",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 63,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 63,
      "pull_request_review_id" : 920094371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834191148/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T11:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834191148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834193652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834193652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "On my system (Debian 5.16.14-1 (2022-03-15) x86_64 GNU/Linux) this is never hit and so `validate_addresses()`, `is_valid_ipv4_address()` and `is_valid_ipv6_address()` are all unused. Is it ever hit for you?\r\n\r\n(maybe have a look at `test/functional/feature_bind_port_discover.py` and add the tests there, if helpful)",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T11:15:40Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834193652",
      "id" : 834193652,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584xuMj0",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 52,
      "pull_request_review_id" : 920094371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834193652/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T11:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834193652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834571453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834571453"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, it hits here. Example:\r\n\r\n```\r\n2022-03-24T17:37:48.362000Z TestFramework (INFO): Restart node with ['-listen', '-discover']\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:c84:4731:10d6:7311\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:1c3e:c153:e75f:59c3\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:3132:b83c:1915:c06e\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:4152:dcc5:5862:734\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:4d52:b4d3:d93d:8f8e\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:5594:b545:6081:a40b\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:f97b:bd76:25aa:a0d3\r\n```\r\n\r\nI researched about `localaddresses` and noticed it's not accurate, this is a reason I don't ensure in the test that `localaddresses` MUST be filled. See: https://bitcoin.stackexchange.com/questions/74991/when-ipv6-is-enabled-my-ipv4-address-does-not-appear-in-getnetworkinfo-localaddr",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T17:43:20Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834571453",
      "id" : 834571453,
      "in_reply_to_id" : 834193652,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584xvoy9",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 52,
      "pull_request_review_id" : 920644912,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834571453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T18:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834571453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834575024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834575024"
         }
      },
      "author_association" : "MEMBER",
      "body" : "On which platform/OS?",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T17:47:40Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834575024",
      "id" : 834575024,
      "in_reply_to_id" : 834193652,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584xvpqw",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 52,
      "pull_request_review_id" : 920649986,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834575024/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T17:47:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834575024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834585870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834585870"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "MacOS 12.0.1 Monterey\r\n\r\nI edited the last comment because the link was wrong haha. ",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T18:00:40Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834585870",
      "id" : 834585870,
      "in_reply_to_id" : 834193652,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584xvsUO",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 52,
      "pull_request_review_id" : 920665332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834585870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T18:00:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834585870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   }
]
