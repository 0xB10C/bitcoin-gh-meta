[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24266](https://github.com/bitcoin/bitcoin/pull/24266) (util: Avoid buggy std::filesystem:::create_directories() call by hebasto)\n* [#24265](https://github.com/bitcoin/bitcoin/pull/24265) (Drop StripRedundantLastElementsOfPath() function and re-enable Windows tests by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-02-05T08:58:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24267#issuecomment-1030582878",
      "id" : 1030582878,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24267",
      "node_id" : "IC_kwDOABII5849bXJe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1030582878/reactions"
      },
      "updated_at" : "2022-02-05T08:58:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1030582878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24267#discussion_r800037499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24267"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800037499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What scenarios these lines are required in?",
      "commit_id" : "247a5c17c105f0ab2d1c25f13764a206ef9b70eb",
      "created_at" : "2022-02-05T09:07:34Z",
      "diff_hunk" : "@@ -443,6 +443,15 @@ const fs::path& ArgsManager::GetDataDir(bool net_specific) const\n     } else {\n         path = GetDefaultDataDir();\n     }\n+\n+    if (fs::is_symlink(path)) {\n+        path = fs::read_symlink(path);\n+        if (!fs::is_directory(path)) {\n+            path = \"\";\n+            return path;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24267#discussion_r800037499",
      "id" : 800037499,
      "line" : 452,
      "node_id" : "PRRC_kwDOABII584vr5p7",
      "original_commit_id" : "247a5c17c105f0ab2d1c25f13764a206ef9b70eb",
      "original_line" : 452,
      "original_position" : 10,
      "original_start_line" : 449,
      "path" : "src/util/system.cpp",
      "position" : 10,
      "pull_request_review_id" : 873916764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24267",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800037499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 449,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-05T09:07:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800037499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24267#discussion_r800037633"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24267"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800037633"
         }
      },
      "author_association" : "NONE",
      "body" : "A symbolic link may exist but point to a non existing location. For example, if your symbolic link point to an external hard drive, but it is not mounted.",
      "commit_id" : "247a5c17c105f0ab2d1c25f13764a206ef9b70eb",
      "created_at" : "2022-02-05T09:08:59Z",
      "diff_hunk" : "@@ -443,6 +443,15 @@ const fs::path& ArgsManager::GetDataDir(bool net_specific) const\n     } else {\n         path = GetDefaultDataDir();\n     }\n+\n+    if (fs::is_symlink(path)) {\n+        path = fs::read_symlink(path);\n+        if (!fs::is_directory(path)) {\n+            path = \"\";\n+            return path;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24267#discussion_r800037633",
      "id" : 800037633,
      "in_reply_to_id" : 800037499,
      "line" : 452,
      "node_id" : "PRRC_kwDOABII584vr5sB",
      "original_commit_id" : "247a5c17c105f0ab2d1c25f13764a206ef9b70eb",
      "original_line" : 452,
      "original_position" : 10,
      "original_start_line" : 449,
      "path" : "src/util/system.cpp",
      "position" : 10,
      "pull_request_review_id" : 873916846,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24267",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800037633/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 449,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-05T09:08:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800037633",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9780671?v=4",
         "events_url" : "https://api.github.com/users/nymkappa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nymkappa/followers",
         "following_url" : "https://api.github.com/users/nymkappa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nymkappa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nymkappa",
         "id" : 9780671,
         "login" : "nymkappa",
         "node_id" : "MDQ6VXNlcjk3ODA2NzE=",
         "organizations_url" : "https://api.github.com/users/nymkappa/orgs",
         "received_events_url" : "https://api.github.com/users/nymkappa/received_events",
         "repos_url" : "https://api.github.com/users/nymkappa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nymkappa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nymkappa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nymkappa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24267#discussion_r800037782"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24267"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800037782"
         }
      },
      "author_association" : "NONE",
      "body" : "For example ![image](https://user-images.githubusercontent.com/9780671/152635687-e546aff8-e75d-4033-b94a-3c76d4830156.png)\r\n",
      "commit_id" : "247a5c17c105f0ab2d1c25f13764a206ef9b70eb",
      "created_at" : "2022-02-05T09:10:36Z",
      "diff_hunk" : "@@ -443,6 +443,15 @@ const fs::path& ArgsManager::GetDataDir(bool net_specific) const\n     } else {\n         path = GetDefaultDataDir();\n     }\n+\n+    if (fs::is_symlink(path)) {\n+        path = fs::read_symlink(path);\n+        if (!fs::is_directory(path)) {\n+            path = \"\";\n+            return path;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24267#discussion_r800037782",
      "id" : 800037782,
      "in_reply_to_id" : 800037499,
      "line" : 452,
      "node_id" : "PRRC_kwDOABII584vr5uW",
      "original_commit_id" : "247a5c17c105f0ab2d1c25f13764a206ef9b70eb",
      "original_line" : 452,
      "original_position" : 10,
      "original_start_line" : 449,
      "path" : "src/util/system.cpp",
      "position" : 10,
      "pull_request_review_id" : 873916962,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24267",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800037782/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 449,
      "start_side" : "RIGHT",
      "updated_at" : "2022-02-05T09:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800037782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9780671?v=4",
         "events_url" : "https://api.github.com/users/nymkappa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nymkappa/followers",
         "following_url" : "https://api.github.com/users/nymkappa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nymkappa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nymkappa",
         "id" : 9780671,
         "login" : "nymkappa",
         "node_id" : "MDQ6VXNlcjk3ODA2NzE=",
         "organizations_url" : "https://api.github.com/users/nymkappa/orgs",
         "received_events_url" : "https://api.github.com/users/nymkappa/received_events",
         "repos_url" : "https://api.github.com/users/nymkappa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nymkappa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nymkappa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nymkappa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I've tested the following scenarios. I run `bitcoind` from command line for each scenario and see what happens:\r\n* Create a valid symlink with `ln -s /home/me/Documents .bitcoin` - OK (it read and writes into `/home/me/Documents` properly)\r\n* Non existing `~/.bitcoin` file/folder - OK (create a `~/.bitcoin` folder)\r\n* Existing `~/.bitcoin` folder  - OK (load the content of `~/.bitcoin` folder)\r\n* Create a broken symlink with `ln -s /1234 .bitcoin` - ??? (bitcoind does not start, but seems to crash, see below)\r\n```cpp\r\nbitcoind: fs.cpp:39: fs::path fsbridge::AbsPathJoin(const fs::path&, const fs::path&): Assertion `base.is_absolute()' failed.\r\nAborted (core dumped)\r\n```\r\n* Create a new wallet using `bitcoin-cli` - OK (create `~/.bitcoin/wallets/xxx` folder)\r\n* Moved `~/.bitcoin/wallets/xxx` to `~/.bitcoin/xxx` - OK (I can load `xxx` wallet using bitcoin-cli)\r\n",
      "created_at" : "2022-02-05T12:18:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24267#issuecomment-1030611643",
      "id" : 1030611643,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24267",
      "node_id" : "IC_kwDOABII5849beK7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1030611643/reactions"
      },
      "updated_at" : "2022-02-05T12:26:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1030611643",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9780671?v=4",
         "events_url" : "https://api.github.com/users/nymkappa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nymkappa/followers",
         "following_url" : "https://api.github.com/users/nymkappa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nymkappa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nymkappa",
         "id" : 9780671,
         "login" : "nymkappa",
         "node_id" : "MDQ6VXNlcjk3ODA2NzE=",
         "organizations_url" : "https://api.github.com/users/nymkappa/orgs",
         "received_events_url" : "https://api.github.com/users/nymkappa/received_events",
         "repos_url" : "https://api.github.com/users/nymkappa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nymkappa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nymkappa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nymkappa"
      }
   }
]
