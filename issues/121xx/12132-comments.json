[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12132#discussion_r160545858"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12132"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160545858"
         }
      },
      "author_association" : "NONE",
      "body" : "Apologies for being annoying//this may be a stupid question: but why only do TCO once?",
      "commit_id" : "fafc110be9f542513555f086697a162be6c1fcb1",
      "created_at" : "2018-01-09T22:43:34Z",
      "diff_hunk" : "@@ -1039,6 +1043,20 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n     if (!vfExec.empty())\n         return set_error(serror, SCRIPT_ERR_UNBALANCED_CONDITIONAL);\n \n+    if (allow_tail_call && !stack.empty() && ((stack.size() + altstack.size()) >= 2) && CastToBool(stack.back())) {\n+        // Replace the script we just finished executing with the\n+        // subscript from the top of the stack:\n+        const valtype& policyScript = stacktop(-1);\n+        script = CScript(policyScript.begin(), policyScript.end());\n+        popstack(stack);\n+        // Only allow one tail-call:\n+        allow_tail_call = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12132#discussion_r160545858",
      "id" : 160545858,
      "original_commit_id" : "fafc110be9f542513555f086697a162be6c1fcb1",
      "original_position" : 44,
      "path" : "src/script/interpreter.cpp",
      "position" : 44,
      "pull_request_review_id" : 87682956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12132",
      "updated_at" : "2018-01-09T22:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160545858",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2185159?v=4",
         "events_url" : "https://api.github.com/users/ckcollab/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ckcollab/followers",
         "following_url" : "https://api.github.com/users/ckcollab/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ckcollab/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ckcollab",
         "id" : 2185159,
         "login" : "ckcollab",
         "organizations_url" : "https://api.github.com/users/ckcollab/orgs",
         "received_events_url" : "https://api.github.com/users/ckcollab/received_events",
         "repos_url" : "https://api.github.com/users/ckcollab/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ckcollab/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ckcollab/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ckcollab"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12132#discussion_r160550178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12132"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160550178"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bips/blob/master/bip-0117.mediawiki#rationale",
      "commit_id" : "fafc110be9f542513555f086697a162be6c1fcb1",
      "created_at" : "2018-01-09T23:07:21Z",
      "diff_hunk" : "@@ -1039,6 +1043,20 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n     if (!vfExec.empty())\n         return set_error(serror, SCRIPT_ERR_UNBALANCED_CONDITIONAL);\n \n+    if (allow_tail_call && !stack.empty() && ((stack.size() + altstack.size()) >= 2) && CastToBool(stack.back())) {\n+        // Replace the script we just finished executing with the\n+        // subscript from the top of the stack:\n+        const valtype& policyScript = stacktop(-1);\n+        script = CScript(policyScript.begin(), policyScript.end());\n+        popstack(stack);\n+        // Only allow one tail-call:\n+        allow_tail_call = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12132#discussion_r160550178",
      "id" : 160550178,
      "in_reply_to_id" : 160545858,
      "original_commit_id" : "fafc110be9f542513555f086697a162be6c1fcb1",
      "original_position" : 44,
      "path" : "src/script/interpreter.cpp",
      "position" : 44,
      "pull_request_review_id" : 87687995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12132",
      "updated_at" : "2018-01-09T23:07:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160550178",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/69154?v=4",
         "events_url" : "https://api.github.com/users/maaku/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maaku/followers",
         "following_url" : "https://api.github.com/users/maaku/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maaku/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maaku",
         "id" : 69154,
         "login" : "maaku",
         "organizations_url" : "https://api.github.com/users/maaku/orgs",
         "received_events_url" : "https://api.github.com/users/maaku/received_events",
         "repos_url" : "https://api.github.com/users/maaku/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maaku/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maaku/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maaku"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12132#discussion_r160601966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12132"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160601966"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The third condition of the specification is not checked:\r\n\r\nhttps://github.com/bitcoin/bips/blob/master/bip-0117.mediawiki#specification\r\n> the following Nth element on the main stack (or alt stack, as above) is between 1 and 520 bytes,\r\n\r\nShould it?\r\n\r\nAbout being able to concatenate up to 17 elements to form the script: why stop at 17? Would be great to include some rationale about this in the BIP, or possibly extend the BIP to allow longer scripts if that makes sense.",
      "commit_id" : "fafc110be9f542513555f086697a162be6c1fcb1",
      "created_at" : "2018-01-10T07:00:18Z",
      "diff_hunk" : "@@ -1039,6 +1043,20 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n     if (!vfExec.empty())\n         return set_error(serror, SCRIPT_ERR_UNBALANCED_CONDITIONAL);\n \n+    if (allow_tail_call && !stack.empty() && ((stack.size() + altstack.size()) >= 2) && CastToBool(stack.back())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12132#discussion_r160601966",
      "id" : 160601966,
      "original_commit_id" : "fafc110be9f542513555f086697a162be6c1fcb1",
      "original_position" : 37,
      "path" : "src/script/interpreter.cpp",
      "position" : 37,
      "pull_request_review_id" : 87746251,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12132",
      "updated_at" : "2018-01-10T07:00:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160601966",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1225267?v=4",
         "events_url" : "https://api.github.com/users/benma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benma/followers",
         "following_url" : "https://api.github.com/users/benma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benma",
         "id" : 1225267,
         "login" : "benma",
         "organizations_url" : "https://api.github.com/users/benma/orgs",
         "received_events_url" : "https://api.github.com/users/benma/received_events",
         "repos_url" : "https://api.github.com/users/benma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12132#discussion_r160602975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12132"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160602975"
         }
      },
      "author_association" : "NONE",
      "body" : "Thank you very much!",
      "commit_id" : "fafc110be9f542513555f086697a162be6c1fcb1",
      "created_at" : "2018-01-10T07:09:17Z",
      "diff_hunk" : "@@ -1039,6 +1043,20 @@ bool EvalScript(std::vector<std::vector<unsigned char> >& stack, const CScript&\n     if (!vfExec.empty())\n         return set_error(serror, SCRIPT_ERR_UNBALANCED_CONDITIONAL);\n \n+    if (allow_tail_call && !stack.empty() && ((stack.size() + altstack.size()) >= 2) && CastToBool(stack.back())) {\n+        // Replace the script we just finished executing with the\n+        // subscript from the top of the stack:\n+        const valtype& policyScript = stacktop(-1);\n+        script = CScript(policyScript.begin(), policyScript.end());\n+        popstack(stack);\n+        // Only allow one tail-call:\n+        allow_tail_call = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12132#discussion_r160602975",
      "id" : 160602975,
      "in_reply_to_id" : 160545858,
      "original_commit_id" : "fafc110be9f542513555f086697a162be6c1fcb1",
      "original_position" : 44,
      "path" : "src/script/interpreter.cpp",
      "position" : 44,
      "pull_request_review_id" : 87747418,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12132",
      "updated_at" : "2018-01-10T07:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/160602975",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2185159?v=4",
         "events_url" : "https://api.github.com/users/ckcollab/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ckcollab/followers",
         "following_url" : "https://api.github.com/users/ckcollab/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ckcollab/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ckcollab",
         "id" : 2185159,
         "login" : "ckcollab",
         "organizations_url" : "https://api.github.com/users/ckcollab/orgs",
         "received_events_url" : "https://api.github.com/users/ckcollab/received_events",
         "repos_url" : "https://api.github.com/users/ckcollab/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ckcollab/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ckcollab/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ckcollab"
      }
   }
]
