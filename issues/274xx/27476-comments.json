[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/27476#pullrequestreview-1407953553) |\n| Approach ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/27476#pullrequestreview-1395486586) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27018](https://github.com/bitcoin/bitcoin/pull/27018) (mempool / miner: regularly flush <=0-fee entries and mine everything in the mempool by glozow)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-04-17T16:28:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27476#issuecomment-1511703508",
      "id" : 1511703508,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27476",
      "node_id" : "IC_kwDOABII585aGsPU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1511703508/reactions"
      },
      "updated_at" : "2023-05-01T19:28:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1511703508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe move most of the text in the PR description into a comment? \"Review this first\" and \"Alternatives considered\" stuff is useful here, but doesn't seem useful for the merge commit message?",
      "created_at" : "2023-04-18T06:28:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27476#issuecomment-1512510817",
      "id" : 1512510817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27476",
      "node_id" : "IC_kwDOABII585aJxVh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1512510817/reactions"
      },
      "updated_at" : "2023-04-18T06:28:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1512510817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "**Alternatives Considered**\r\n\r\nFeel free to suggest more alternatives, but note potential problems.\r\n\r\n(1) Call TrimToSize() at smart intervals, e.g. when a timestamp changes (since packages are submitted with the same timestamp), or every ~25 transactions, or when we hit a certain threshold above maxmempool.\r\n(2) When a transaction fails for fee-related reasons, try again with bypass_limits=true, and then schedule a flush for later.\r\n(3) Create a new mempool.dat format, which contains a list of packages instead of transactions (package can have 1 transaction).\r\n(4) When loading, load into a buffer and use AncestorPackage \"packageifier\" (in https://github.com/bitcoin/bitcoin/pull/26711) to group them into packages and submit them together.\r\n\r\nTheir disadvantages:\r\n\r\n-    (1, 2) The implementation is a bit hacky. Some strategies may fail.\r\n-    (3, 4) The implementation is quite complex.\r\n-    (1, 2) When shrinking maxmempool, we won't always pick the top transactions by descendant feerate. Since mempool min feerate depends on the feerate of the last package removed + incremental, we can end up rejecting something with feerate 1sat/vB higher than what we keep. Essentially, we have a bias for earlier transactions. This is weird behavior (and makes it quite annoying to write tests).\r\n-    (1, 2) We need to add various bits of code to track things evicting each other to accurately report which transactions made it in and which didn't.\r\n-    (1, 2) Doesn't work for ephemeral anchors (https://github.com/bitcoin/bitcoin/pull/26403). We could work around this by adding another flag to bypass \"unspent anchor\" checks but... also a bit ugly.\r\n\r\nWe can also pick one of the more complex solutions to implement later (I expect people are going to be interested in (3) since it's the most future-proof). This problem shouldn't be very common right now. For the most part, it doesn't really matter if the \"bottom\" of your mempool doesn't match others'.",
      "created_at" : "2023-04-20T15:08:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27476#issuecomment-1516503220",
      "id" : 1516503220,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27476",
      "node_id" : "IC_kwDOABII585aZAC0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516503220/reactions"
      },
      "updated_at" : "2023-04-20T15:08:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516503220",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Maybe move most of the text in the PR description into a comment? \"Review this first\" and \"Alternatives considered\" stuff is useful here, but doesn't seem useful for the merge commit message?\r\n\r\nMoved \"alternatives considered.\" I prefer putting \"review this first\" at the top so reviewers see it as soon as possible. It will go away if/when I rebase, so definitely before any merging happens.",
      "created_at" : "2023-04-20T15:11:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27476#issuecomment-1516508803",
      "id" : 1516508803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27476",
      "node_id" : "IC_kwDOABII585aZBaD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516508803/reactions"
      },
      "updated_at" : "2023-04-20T15:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1516508803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this for now to (1) focus on more important functionality (2) defer the decision-making to when we have more information on usage and/or better eviction.\r\n- The \"trim stuff below minrelayfeerate\" thing isn't very good... as established, we might evict things we shouldn't, etc.\r\n- This isn't strictly necessary yet until package relay is deployed.\r\n- It might be too early to decide on a solution. Perhaps with EA and actual package relay usage, we'll end up wanting to reformat mempool.dat anyway. Or maybe, with other improvements to mempool, we will have a simpler solution that achieves everything we want.\r\n\r\nStill tracking this as a \"todo\" item in #27463, but will defer until later.",
      "created_at" : "2023-05-01T20:46:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27476#issuecomment-1530227211",
      "id" : 1530227211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27476",
      "node_id" : "IC_kwDOABII585bNWoL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1530227211/reactions"
      },
      "updated_at" : "2023-05-01T20:46:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1530227211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
