[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [pinheadmz](https://github.com/bitcoin/bitcoin/pull/27469#pullrequestreview-1444104729), [ishaanam](https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1565012825), [achow101](https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1565133194) |\n| Concept ACK | [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/27469#pullrequestreview-1390605733), [MarcoFalke](https://github.com/bitcoin/bitcoin/pull/27469#pullrequestreview-1443984697) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#26836](https://github.com/bitcoin/bitcoin/pull/26836) (wallet: finish addressbook encapsulation and simplify addressbook migration by furszy)\n* [#26596](https://github.com/bitcoin/bitcoin/pull/26596) (wallet: Migrate legacy wallets to descriptor wallets without requiring BDB by achow101)\n* [#26008](https://github.com/bitcoin/bitcoin/pull/26008) (wallet: cache IsMine scriptPubKeys to improve performance of descriptor wallets by achow101)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-04-15T19:32:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1509938050",
      "id" : 1509938050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585Z_9OC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1509938050/reactions"
      },
      "updated_at" : "2023-05-27T01:18:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1509938050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK, seems like a great idea.",
      "created_at" : "2023-04-16T03:05:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1510029147",
      "id" : 1510029147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585aATdb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510029147/reactions"
      },
      "updated_at" : "2023-04-16T03:05:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1510029147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168831940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168831940"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to use `int64_t`, when the block time is denoted in a type-safe  `NodeSeconds`?\r\n\r\nEdit: I guess all you need to do is switch from `...::GetBlockTime()` to `...::Time()`?",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T14:45:20Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168831940",
      "id" : 1168831940,
      "line" : 86,
      "node_id" : "PRRC_kwDOABII585FqvXE",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : 4,
      "pull_request_review_id" : 1388285429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168831940/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-17T14:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168831940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168887852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168887852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why not a single-line `if` like you do below ?",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T15:19:55Z",
      "diff_hunk" : "@@ -1777,6 +1784,14 @@ bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScri\n     return true;\n }\n \n+void CWallet::FirstKeyTimeChanged(const ScriptPubKeyMan* spkm, int64_t new_birth_time)\n+{\n+    int64_t birthtime = m_birth_time.load();\n+    if (birthtime == BLANK_BIRTH_TIME || new_birth_time < birthtime) {\n+        m_birth_time = new_birth_time;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168887852",
      "id" : 1168887852,
      "line" : 1792,
      "node_id" : "PRRC_kwDOABII585Fq9As",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 1792,
      "original_position" : 23,
      "original_start_line" : 1790,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 1388370915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168887852/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1790,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-17T16:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168887852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168919382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168919382"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`birthtime == BLANK_BIRTH_TIME ` -- doesn't this mean if a wallet has no known birthtime, it will never process any blocks?",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T15:37:26Z",
      "diff_hunk" : "@@ -1434,6 +1434,13 @@ void CWallet::blockConnected(const interfaces::BlockInfo& block)\n \n     m_last_block_processed_height = block.height;\n     m_last_block_processed = block.hash;\n+\n+    // No need to scan block if block was created before the\n+    // wallet birthday (as adjusted for block time variability)\n+    const int64_t birth_time = m_birth_time.load();\n+    if (birth_time == BLANK_BIRTH_TIME || block.time < birth_time - TIMESTAMP_WINDOW) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168919382",
      "id" : 1168919382,
      "line" : 1441,
      "node_id" : "PRRC_kwDOABII585FrEtW",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 1441,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 1388370915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168919382/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-17T16:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168919382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168946262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168946262"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`id` is now an unused function argument `LoadDescriptorScriptPubKeyMan()`. Could clean that up? Actually I'm kinda curious why we ever needed to pass `id` if the value is always derivable from the descriptor itself.",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T15:53:59Z",
      "diff_hunk" : "@@ -3565,17 +3592,18 @@ void CWallet::ConnectScriptPubKeyManNotifiers()\n     for (const auto& spk_man : GetActiveScriptPubKeyMans()) {\n         spk_man->NotifyWatchonlyChanged.connect(NotifyWatchonlyChanged);\n         spk_man->NotifyCanGetAddressesChanged.connect(NotifyCanGetAddressesChanged);\n+        spk_man->NotifyFirstKeyTimeChanged.connect(std::bind(&CWallet::FirstKeyTimeChanged, this, std::placeholders::_1, std::placeholders::_2));\n     }\n }\n \n void CWallet::LoadDescriptorScriptPubKeyMan(uint256 id, WalletDescriptor& desc)\n {\n     if (IsWalletFlagSet(WALLET_FLAG_EXTERNAL_SIGNER)) {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new ExternalSignerScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));\n     } else {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new DescriptorScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168946262",
      "id" : 1168946262,
      "line" : 3606,
      "node_id" : "PRRC_kwDOABII585FrLRW",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3606,
      "original_position" : 98,
      "original_start_line" : 3575,
      "path" : "src/wallet/wallet.cpp",
      "position" : 98,
      "pull_request_review_id" : 1388370915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168946262/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3575,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-04-17T16:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168946262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168949017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168949017"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think adding this method is a good idea, and cleans up all the `m_spk_managers[id] = ...` which I like. I wonder if that could just be a separate commit since its just a nice refactor? And then add `FIrstKeyTimeChanged()` next",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-17T15:55:51Z",
      "diff_hunk" : "@@ -3536,6 +3555,14 @@ LegacyScriptPubKeyMan* CWallet::GetOrCreateLegacyScriptPubKeyMan()\n     return GetLegacyScriptPubKeyMan();\n }\n \n+void CWallet::AddScriptPubKeyMan(std::unique_ptr<ScriptPubKeyMan> spkm_man)\n+{\n+    const auto& spkm = m_spk_managers[spkm_man->GetID()] = std::move(spkm_man);\n+\n+    // Update birth time if needed\n+    FirstKeyTimeChanged(spkm.get(), spkm->GetTimeFirstKey());\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1168949017",
      "id" : 1168949017,
      "line" : 3565,
      "node_id" : "PRRC_kwDOABII585FrL8Z",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3565,
      "original_position" : 68,
      "original_start_line" : 3558,
      "path" : "src/wallet/wallet.cpp",
      "position" : 68,
      "pull_request_review_id" : 1388370915,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168949017/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3558,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-17T16:14:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168949017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170062170"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170062170"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Mainly to be consistent with the chain interface, wallet and spkm sources. Timestamps are represented as `int64_t` there. E.g. the `FoundBlock` class, `findFirstBlockWithTimeAndHeight` method, the `CWallet::m_best_block_time` member, first key time, descriptor creation time etc.\r\n\r\nI think that is clear that block times are always in seconds, so the use of an arithmetic type shouldn't be much of a worry but we could switch all of them to `NodeSeconds` too (probably in another PR that does it all at once?).",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-18T13:43:10Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170062170",
      "id" : 1170062170,
      "in_reply_to_id" : 1168831940,
      "line" : 86,
      "node_id" : "PRRC_kwDOABII585Fvbta",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : 4,
      "pull_request_review_id" : 1390158666,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170062170/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-18T13:43:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170062170",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170076066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170076066"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Because the other one is a return statement (the flow breaks there) while this one is a setter.\r\nPlus, when the line is too long, like this one, I think that braces help readability.\r\n",
      "commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "created_at" : "2023-04-18T13:52:43Z",
      "diff_hunk" : "@@ -1777,6 +1784,14 @@ bool CWallet::ImportScriptPubKeys(const std::string& label, const std::set<CScri\n     return true;\n }\n \n+void CWallet::FirstKeyTimeChanged(const ScriptPubKeyMan* spkm, int64_t new_birth_time)\n+{\n+    int64_t birthtime = m_birth_time.load();\n+    if (birthtime == BLANK_BIRTH_TIME || new_birth_time < birthtime) {\n+        m_birth_time = new_birth_time;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170076066",
      "id" : 1170076066,
      "in_reply_to_id" : 1168887852,
      "line" : 1792,
      "node_id" : "PRRC_kwDOABII585FvfGi",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 1792,
      "original_position" : 23,
      "original_start_line" : 1790,
      "path" : "src/wallet/wallet.cpp",
      "position" : 23,
      "pull_request_review_id" : 1390179688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170076066/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1790,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-18T13:52:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170076066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170086188"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170086188"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`BLANK_BIRTH_TIME` is for blank wallets. Blank wallets are wallets with no keys (no spkm exist). So it's ok to skip blocks as the wallet isn't going to find anything on them.",
      "commit_id" : "a2d3902da4eb04ff2dc428010efca792f681cd77",
      "created_at" : "2023-04-18T13:59:42Z",
      "diff_hunk" : "@@ -1434,6 +1434,13 @@ void CWallet::blockConnected(const interfaces::BlockInfo& block)\n \n     m_last_block_processed_height = block.height;\n     m_last_block_processed = block.hash;\n+\n+    // No need to scan block if block was created before the\n+    // wallet birthday (as adjusted for block time variability)\n+    const int64_t birth_time = m_birth_time.load();\n+    if (birth_time == BLANK_BIRTH_TIME || block.time < birth_time - TIMESTAMP_WINDOW) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170086188",
      "id" : 1170086188,
      "in_reply_to_id" : 1168919382,
      "line" : 1441,
      "node_id" : "PRRC_kwDOABII585Fvhks",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 1441,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 1390195288,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170086188/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-18T13:59:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170086188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170098672"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170098672"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The id is the db lookup key for the descriptor, and also a way to detect db corruption.\r\n\r\nWe could clean it up from here, yeah. And probably, depending on its usage, we should also think about caching it.",
      "commit_id" : "a2d3902da4eb04ff2dc428010efca792f681cd77",
      "created_at" : "2023-04-18T14:08:20Z",
      "diff_hunk" : "@@ -3565,17 +3592,18 @@ void CWallet::ConnectScriptPubKeyManNotifiers()\n     for (const auto& spk_man : GetActiveScriptPubKeyMans()) {\n         spk_man->NotifyWatchonlyChanged.connect(NotifyWatchonlyChanged);\n         spk_man->NotifyCanGetAddressesChanged.connect(NotifyCanGetAddressesChanged);\n+        spk_man->NotifyFirstKeyTimeChanged.connect(std::bind(&CWallet::FirstKeyTimeChanged, this, std::placeholders::_1, std::placeholders::_2));\n     }\n }\n \n void CWallet::LoadDescriptorScriptPubKeyMan(uint256 id, WalletDescriptor& desc)\n {\n     if (IsWalletFlagSet(WALLET_FLAG_EXTERNAL_SIGNER)) {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new ExternalSignerScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));\n     } else {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new DescriptorScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170098672",
      "id" : 1170098672,
      "in_reply_to_id" : 1168946262,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Fvknw",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3606,
      "original_position" : 98,
      "original_start_line" : 3575,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1390215448,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170098672/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-04-18T14:08:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170098672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170124375"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124375"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ended up re-adding the id arg. So we don't calculate the spkm id twice.",
      "commit_id" : "a2d3902da4eb04ff2dc428010efca792f681cd77",
      "created_at" : "2023-04-18T14:26:29Z",
      "diff_hunk" : "@@ -3565,17 +3592,18 @@ void CWallet::ConnectScriptPubKeyManNotifiers()\n     for (const auto& spk_man : GetActiveScriptPubKeyMans()) {\n         spk_man->NotifyWatchonlyChanged.connect(NotifyWatchonlyChanged);\n         spk_man->NotifyCanGetAddressesChanged.connect(NotifyCanGetAddressesChanged);\n+        spk_man->NotifyFirstKeyTimeChanged.connect(std::bind(&CWallet::FirstKeyTimeChanged, this, std::placeholders::_1, std::placeholders::_2));\n     }\n }\n \n void CWallet::LoadDescriptorScriptPubKeyMan(uint256 id, WalletDescriptor& desc)\n {\n     if (IsWalletFlagSet(WALLET_FLAG_EXTERNAL_SIGNER)) {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new ExternalSignerScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));\n     } else {\n         auto spk_manager = std::unique_ptr<ScriptPubKeyMan>(new DescriptorScriptPubKeyMan(*this, desc, m_keypool_size));\n-        m_spk_managers[id] = std::move(spk_manager);\n+        AddScriptPubKeyMan(std::move(spk_manager));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170124375",
      "id" : 1170124375,
      "in_reply_to_id" : 1168946262,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Fvq5X",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3606,
      "original_position" : 98,
      "original_start_line" : 3575,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1390253814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124375/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-04-18T14:26:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170124551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124551"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sure, pushed.",
      "commit_id" : "a2d3902da4eb04ff2dc428010efca792f681cd77",
      "created_at" : "2023-04-18T14:26:38Z",
      "diff_hunk" : "@@ -3536,6 +3555,14 @@ LegacyScriptPubKeyMan* CWallet::GetOrCreateLegacyScriptPubKeyMan()\n     return GetLegacyScriptPubKeyMan();\n }\n \n+void CWallet::AddScriptPubKeyMan(std::unique_ptr<ScriptPubKeyMan> spkm_man)\n+{\n+    const auto& spkm = m_spk_managers[spkm_man->GetID()] = std::move(spkm_man);\n+\n+    // Update birth time if needed\n+    FirstKeyTimeChanged(spkm.get(), spkm->GetTimeFirstKey());\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1170124551",
      "id" : 1170124551,
      "in_reply_to_id" : 1168949017,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Fvq8H",
      "original_commit_id" : "469861490890c2ad4f9ecca55cbcaf70648b52cc",
      "original_line" : 3565,
      "original_position" : 68,
      "original_start_line" : 3558,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1390254117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124551/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-18T14:26:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170124551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review pinheadmz.\r\n\r\n> Also I don't know if this is a problematic edge case or it could just be a good way to test but you could create a key and send BTC to it in a block, then a few blocks later import into a new descriptor and rescan. The wallet should miss the first transaction.\r\n\r\nThis PR is not modifying the rescan process. Only IBD.\r\nGuess that you provided a timestamp that is +2 hours ahead of the block time (network time variability window) or the \"now\" arg to skip rescan?",
      "created_at" : "2023-04-18T14:37:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1513272159",
      "id" : 1513272159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585aMrNf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1513272159/reactions"
      },
      "updated_at" : "2023-04-18T14:40:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1513272159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1171716388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171716388"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1a9a349a026af2865e5446091f1e072b7a845819 \"wallet: skip block scan if block was created before wallet birthday\"\r\n\r\n`CBlock` already has a `GetBlockTime()`, so I don't think it's necessary to include the time as a separate field here.\r\n\r\nHowever I'm not sure that we should be using the block's timestamp for this time rather than MTP. With the block timestamp, we could ignore a more recent block that has a timestamp older than its parent which we wouldn't ignore. That would be kinda bad.",
      "commit_id" : "7bfe7b4ea68e017a46de62520830454a92d20e8e",
      "created_at" : "2023-04-19T18:28:42Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1171716388",
      "id" : 1171716388,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F1vkk",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 1392663143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171716388/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T18:34:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171716388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1171720322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171720322"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1a9a349a026af2865e5446091f1e072b7a845819 \"wallet: skip block scan if block was created before wallet birthday\"\r\n\r\n`m_birth_time` could be initialized with `std::numeric_limits<in64_t>::max()` which would remove the need to compare against `BLANK_BIRTH_TIME`.",
      "commit_id" : "7bfe7b4ea68e017a46de62520830454a92d20e8e",
      "created_at" : "2023-04-19T18:32:07Z",
      "diff_hunk" : "@@ -294,6 +294,11 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     // Local time that the tip block was received. Used to schedule wallet rebroadcasts.\n     std::atomic<int64_t> m_best_block_time {0};\n \n+    static const int64_t BLANK_BIRTH_TIME = -1;\n+    // First created key time. Used to skip blocks prior to this time.\n+    // 'BLANK_BIRTH_TIME' if wallet is blank.\n+    std::atomic<int64_t> m_birth_time{BLANK_BIRTH_TIME};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1171720322",
      "id" : 1171720322,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F1wiC",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 300,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1392663143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171720322/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T18:34:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171720322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172623190"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172623190"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> CBlock already has a GetBlockTime(), so I don't think it's necessary to include the time as a separate field here.\r\n\r\nYeah, that works here. The new field was because I initially implemented this on the filters-only sync branch. Where I have no blocks, only headers and filters.\r\n\r\n> However I'm not sure that we should be using the block's timestamp for this time rather than MTP. With the block timestamp, we could ignore a more recent block that has a timestamp older than its parent which we wouldn't ignore. That would be kinda bad.\r\n\r\nHmm, wasn't the timestamp window created to extend the grace period enough so we can use the block time directly?.\r\nIn other words, MTP moves the block time an hour back, and we have a grace period of two hours. If the two hours period are a concern, to not be forced to calculate the MTP for every block, what about doubling the grace period for IBD scanning?.\r\nNormally, it would just mean checking ~12 more blocks.",
      "commit_id" : "7bfe7b4ea68e017a46de62520830454a92d20e8e",
      "created_at" : "2023-04-20T13:49:21Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172623190",
      "id" : 1172623190,
      "in_reply_to_id" : 1171716388,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5M9W",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 1394046991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172623190/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T13:57:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172623190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172638173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172638173"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pushed thanks",
      "commit_id" : "7bfe7b4ea68e017a46de62520830454a92d20e8e",
      "created_at" : "2023-04-20T14:00:11Z",
      "diff_hunk" : "@@ -294,6 +294,11 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     // Local time that the tip block was received. Used to schedule wallet rebroadcasts.\n     std::atomic<int64_t> m_best_block_time {0};\n \n+    static const int64_t BLANK_BIRTH_TIME = -1;\n+    // First created key time. Used to skip blocks prior to this time.\n+    // 'BLANK_BIRTH_TIME' if wallet is blank.\n+    std::atomic<int64_t> m_birth_time{BLANK_BIRTH_TIME};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172638173",
      "id" : 1172638173,
      "in_reply_to_id" : 1171720322,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5Qnd",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 300,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1394071638,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172638173/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T14:00:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172638173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172817209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172817209"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Hmm, wasn't the timestamp window created to extend the grace period enough so we can use the block time directly?.\r\n\r\nAFAIK it exists for accepting blocks with future timestamps, and we only use it in the wallet because it's convenient.\r\n\r\nBut my comment isn't really about the accuracy of the timestamp, but rather about the possibility of skipping a block after we have already started scanning. A block's timestamp can be before its parent. The code as written would let us skip scanning a block even if we had scanned its parent. The reason to use MTP is because it can only move forward. The MTP of a block can never be less than the MTP of its parent, it can be equal, but that's fine for us.\r\n\r\nIn `RescanFromTime`, we find blocks using a different metric, `GetBlockTimeMax()`. This is calculated as the maximum of the current block's timestamp and it's parent's timestamp, so this too also can only move forward. If MTP is too slow to calculate, we could use `GetBlockTimeMax()` instead as it has the same property as always moving forwards.",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-04-20T16:13:15Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1172817209",
      "id" : 1172817209,
      "in_reply_to_id" : 1171716388,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F58U5",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 1394343797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172817209/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T16:14:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172817209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1173095947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173095947"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> But my comment isn't really about the accuracy of the timestamp, but rather about the possibility of skipping a block after we have already started scanning. A block's timestamp can be before its parent. The code as written would let us skip scanning a block even if we had scanned its parent. The reason to use MTP is because it can only move forward. The MTP of a block can never be less than the MTP of its parent, it can be equal, but that's fine for us.\r\n\r\nYeah, where I was going is that we really don't care about those possible skipped blocks if the grace period is large enough. We know that the wallet will not find anything there, it's just to ensure that all blocks created 2 hours before the wallet birth time will be scanned.\r\nIn other words,  The idea was to extend the window enough to not worry about unordered timestamps. E.g. going to the extreme, even if the grace period is one or two days, is much better than scanning the entire chain as we do now.\r\n\r\nBut.. point taken. The `GetBlockTimeMax` idea sounds nicer. It doesn't require any extra calculation like MTP, nor grace period extension (which makes the wallet scan extra blocks). Just add another member into the `BlockInfo` struct and done.",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-04-20T21:12:23Z",
      "diff_hunk" : "@@ -83,6 +83,7 @@ struct BlockInfo {\n     const uint256& hash;\n     const uint256* prev_hash = nullptr;\n     int height = -1;\n+    int64_t time = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1173095947",
      "id" : 1173095947,
      "in_reply_to_id" : 1171716388,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F7AYL",
      "original_commit_id" : "1a9a349a026af2865e5446091f1e072b7a845819",
      "original_line" : 86,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 1394770082,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173095947/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T21:12:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1173095947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated per feedback, thanks achow.\r\n\r\nChanges:\r\n* Replaced `BLANK_BIRTH_TIME` constant by setting the `m_birth_time` to its max numeric value.\r\n* Tackled a block time variability concern by using the maximum time in the chain (a moving forward only timestamp) instead of the raw block time.\r\n* Extended the grace period to be twice as big as the one used in the rescan process. Even when this is not strictly needed, the rationale is to be a bit more conservative during IBD scanning because it's an automatic process with no user interaction (unlike the rescan process that is usually triggered by an user action such an import).",
      "created_at" : "2023-04-20T22:11:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1517007742",
      "id" : 1517007742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585aa7N-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517007742/reactions"
      },
      "updated_at" : "2023-04-20T22:11:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517007742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1195808323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195808323"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n    /** Updates wallet birth time if 'new_birth_time' is lower than m_birth_time*/\r\n```",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-17T00:33:22Z",
      "diff_hunk" : "@@ -638,6 +642,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     bool ImportPubKeys(const std::vector<CKeyID>& ordered_pubkeys, const std::map<CKeyID, CPubKey>& pubkey_map, const std::map<CKeyID, std::pair<CPubKey, KeyOriginInfo>>& key_origins, const bool add_keypool, const bool internal, const int64_t timestamp) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     bool ImportScriptPubKeys(const std::string& label, const std::set<CScript>& script_pub_keys, const bool have_solving_data, const bool apply_label, const int64_t timestamp) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n+    /** Updates wallet birth time if 'new_birth_time' is lower */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1195808323",
      "id" : 1195808323,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HRpZD",
      "original_commit_id" : "7be71a248abc155c9b249c2f1ec048708ebd177c",
      "original_line" : 645,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1429618571,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195808323/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T02:56:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195808323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1195809999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195809999"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why is this check also done here if it is already done in `FirstKeyTimeChanged`?",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-17T00:37:37Z",
      "diff_hunk" : "@@ -2732,10 +2734,13 @@ void DescriptorScriptPubKeyMan::UpdateWalletDescriptor(WalletDescriptor& descrip\n         throw std::runtime_error(std::string(__func__) + \": \" + error);\n     }\n \n+    bool signal_birth_time = descriptor.creation_time < m_wallet_descriptor.creation_time;\n     m_map_pubkeys.clear();\n     m_map_script_pub_keys.clear();\n     m_max_cached_index = -1;\n     m_wallet_descriptor = descriptor;\n+\n+    if (signal_birth_time) NotifyFirstKeyTimeChanged(this, m_wallet_descriptor.creation_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1195809999",
      "id" : 1195809999,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HRpzP",
      "original_commit_id" : "7be71a248abc155c9b249c2f1ec048708ebd177c",
      "original_line" : 2743,
      "original_position" : 19,
      "original_start_line" : 2737,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 1429618571,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195809999/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-17T02:56:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195809999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1202827015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202827015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To save some extra processing, because they are performed at different levels.\r\nAt the spkm level (here), we are at the lowest one. So, before emitting an event that will require to be processed by all the listeners (the wallets and/or other registered objects), we can just check if the updated descriptor timestamp is lower than the existent one.\r\n\r\nbut.. probably I'm thinking too far ahead and we could simplify this. Each spkm has only one listener atm.",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-23T18:27:38Z",
      "diff_hunk" : "@@ -2732,10 +2734,13 @@ void DescriptorScriptPubKeyMan::UpdateWalletDescriptor(WalletDescriptor& descrip\n         throw std::runtime_error(std::string(__func__) + \": \" + error);\n     }\n \n+    bool signal_birth_time = descriptor.creation_time < m_wallet_descriptor.creation_time;\n     m_map_pubkeys.clear();\n     m_map_script_pub_keys.clear();\n     m_max_cached_index = -1;\n     m_wallet_descriptor = descriptor;\n+\n+    if (signal_birth_time) NotifyFirstKeyTimeChanged(this, m_wallet_descriptor.creation_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1202827015",
      "id" : 1202827015,
      "in_reply_to_id" : 1195809999,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hsa8H",
      "original_commit_id" : "7be71a248abc155c9b249c2f1ec048708ebd177c",
      "original_line" : 2743,
      "original_position" : 19,
      "original_start_line" : 2737,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 1440335343,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202827015/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-23T21:22:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202827015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated per feedback, thanks @ishaanam.",
      "created_at" : "2023-05-23T21:26:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1560143021",
      "id" : 1560143021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585c_eSt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1560143021/reactions"
      },
      "updated_at" : "2023-05-23T21:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1560143021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1203034031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203034031"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pushed",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-23T21:26:43Z",
      "diff_hunk" : "@@ -638,6 +642,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     bool ImportPubKeys(const std::vector<CKeyID>& ordered_pubkeys, const std::map<CKeyID, CPubKey>& pubkey_map, const std::map<CKeyID, std::pair<CPubKey, KeyOriginInfo>>& key_origins, const bool add_keypool, const bool internal, const int64_t timestamp) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     bool ImportScriptPubKeys(const std::string& label, const std::set<CScript>& script_pub_keys, const bool have_solving_data, const bool apply_label, const int64_t timestamp) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n+    /** Updates wallet birth time if 'new_birth_time' is lower */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1203034031",
      "id" : 1203034031,
      "in_reply_to_id" : 1195808323,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HtNev",
      "original_commit_id" : "7be71a248abc155c9b249c2f1ec048708ebd177c",
      "original_line" : 645,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1440591317,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203034031/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-23T21:26:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203034031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 76396ca376188631ba46bd47b134881efcc6f755",
      "created_at" : "2023-05-23T21:40:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1560158824",
      "id" : 1560158824,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585c_iJo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1560158824/reactions"
      },
      "updated_at" : "2023-05-23T21:40:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1560158824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "cr-ACK 76396ca376188631ba46bd47b134881efcc6f755",
      "created_at" : "2023-05-24T01:47:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1560345015",
      "id" : 1560345015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585dAPm3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1560345015/reactions"
      },
      "updated_at" : "2023-05-24T01:47:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1560345015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1203481523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203481523"
         }
      },
      "author_association" : "MEMBER",
      "body" : "first commit: This would lead to issues in the rare case that more than 2 hours worth of blocks are produced, as they end up being in the future.\r\n\r\nIs there a reason for the first commit?",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-24T05:56:46Z",
      "diff_hunk" : "@@ -82,7 +82,8 @@ std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coi\n             ->block);\n \n     LOCK(cs_main);\n-    block->nTime = Assert(node.chainman)->ActiveChain().Tip()->GetMedianTimePast() + 1;\n+    const CBlockIndex* tip = Assert(node.chainman)->ActiveChain().Tip();\n+    block->nTime = tip->nHeight == 0 ? GetTime<std::chrono::seconds>().count() : tip->GetBlockTime() + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1203481523",
      "id" : 1203481523,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hu6uz",
      "original_commit_id" : "f44da31c20dbb29143dadd61f5a6bb7a3c61b6ae",
      "original_line" : 86,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1440982489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203481523/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-24T06:02:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203481523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1203482268"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203482268"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, it is a source of non-determinism, but I guess this is fine.",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-24T05:57:39Z",
      "diff_hunk" : "@@ -82,7 +82,8 @@ std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coi\n             ->block);\n \n     LOCK(cs_main);\n-    block->nTime = Assert(node.chainman)->ActiveChain().Tip()->GetMedianTimePast() + 1;\n+    const CBlockIndex* tip = Assert(node.chainman)->ActiveChain().Tip();\n+    block->nTime = tip->nHeight == 0 ? GetTime<std::chrono::seconds>().count() : tip->GetBlockTime() + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1203482268",
      "id" : 1203482268,
      "in_reply_to_id" : 1203481523,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hu66c",
      "original_commit_id" : "f44da31c20dbb29143dadd61f5a6bb7a3c61b6ae",
      "original_line" : 86,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1440982489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203482268/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-24T06:02:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203482268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1203482881"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203482881"
         }
      },
      "author_association" : "MEMBER",
      "body" : "first commit: Any reason this is changed?",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-24T05:58:21Z",
      "diff_hunk" : "@@ -39,7 +39,9 @@ FUZZ_TARGET_INIT(process_messages, initialize_process_messages)\n \n     ConnmanTestMsg& connman = *static_cast<ConnmanTestMsg*>(g_setup->m_node.connman.get());\n     TestChainState& chainstate = *static_cast<TestChainState*>(&g_setup->m_node.chainman->ActiveChainstate());\n-    SetMockTime(1610000000); // any time to successfully reset ibd",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1203482881",
      "id" : 1203482881,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hu7EB",
      "original_commit_id" : "f44da31c20dbb29143dadd61f5a6bb7a3c61b6ae",
      "original_line" : 42,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/process_messages.cpp",
      "position" : null,
      "pull_request_review_id" : 1440982489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203482881/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-24T06:02:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203482881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1204567065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204567065"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Is there a reason for the first commit?\r\n\r\nIt is because this is the only place where we set the chain timestamps to be in the past. In the form of\r\n```\r\nblock_1_timestamp = genesis + 1\r\nblock_2_timestamp = median(genesis, block_1) + 1\r\nblock_3_timestamp = median(genesis, block_1, block_2) + 1\r\n```\r\nAnd in the wallet, we use the clock time to set the descriptors/keys creation time.\r\n\r\nSo, even when we create a wallet prior mining the chain, the wallet will always have a birth time after it. Which, with this PR, leads to the wallet skipping those blocks during sync. Which makes the `wallet_balance.cpp` benchmark fail in the balance assertion (the wallet has no balance because it skipped the blocks created prior its birth time).\r\n\r\nBut.. I just went deeper over it and.. it seems that the functions that create blocks in the past: `generatetoaddress` (which is not the RPC command) ~and `PrepareBlock`~ are only used in benchmarks: `wallet_balance.cpp` and `block_assemble.cpp`.. so we could re-work this stuff differently by cleaning some stuff.\r\n\r\nThe rest of the code uses `BlockAssembler::CreateNewBlock`, which sets the block time to the current, or mocked, clock time. So, no functional, unit or fuzz tests should be affected by this change.",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-24T17:48:31Z",
      "diff_hunk" : "@@ -82,7 +82,8 @@ std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coi\n             ->block);\n \n     LOCK(cs_main);\n-    block->nTime = Assert(node.chainman)->ActiveChain().Tip()->GetMedianTimePast() + 1;\n+    const CBlockIndex* tip = Assert(node.chainman)->ActiveChain().Tip();\n+    block->nTime = tip->nHeight == 0 ? GetTime<std::chrono::seconds>().count() : tip->GetBlockTime() + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1204567065",
      "id" : 1204567065,
      "in_reply_to_id" : 1203481523,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HzDwZ",
      "original_commit_id" : "f44da31c20dbb29143dadd61f5a6bb7a3c61b6ae",
      "original_line" : 86,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1442460883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204567065/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T02:42:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204567065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1204928358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204928358"
         }
      },
      "author_association" : "MEMBER",
      "body" : "not anymore. Re-worked the first commit so it only touches the `wallet_balance.cpp` bench file and nothing else.",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-25T02:27:39Z",
      "diff_hunk" : "@@ -39,7 +39,9 @@ FUZZ_TARGET_INIT(process_messages, initialize_process_messages)\n \n     ConnmanTestMsg& connman = *static_cast<ConnmanTestMsg*>(g_setup->m_node.connman.get());\n     TestChainState& chainstate = *static_cast<TestChainState*>(&g_setup->m_node.chainman->ActiveChainstate());\n-    SetMockTime(1610000000); // any time to successfully reset ibd",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1204928358",
      "id" : 1204928358,
      "in_reply_to_id" : 1203482881,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585H0b9m",
      "original_commit_id" : "f44da31c20dbb29143dadd61f5a6bb7a3c61b6ae",
      "original_line" : 42,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/process_messages.cpp",
      "position" : null,
      "pull_request_review_id" : 1442985650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204928358/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T02:27:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204928358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1204932281"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204932281"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ended up pushing a simpler approach to not have to touch the fuzz tests for now (they are using `PrepareBlock`..). Focused on correcting `wallet_balance.cpp` only.\r\n\r\nIn the future, we could generate a fake chain instead of creating a \"real\" one. Similar to how it's done\r\nin the `wallet_create_tx.cpp` benchmark.",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-25T02:36:45Z",
      "diff_hunk" : "@@ -82,7 +82,8 @@ std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coi\n             ->block);\n \n     LOCK(cs_main);\n-    block->nTime = Assert(node.chainman)->ActiveChain().Tip()->GetMedianTimePast() + 1;\n+    const CBlockIndex* tip = Assert(node.chainman)->ActiveChain().Tip();\n+    block->nTime = tip->nHeight == 0 ? GetTime<std::chrono::seconds>().count() : tip->GetBlockTime() + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1204932281",
      "id" : 1204932281,
      "in_reply_to_id" : 1203481523,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585H0c65",
      "original_commit_id" : "f44da31c20dbb29143dadd61f5a6bb7a3c61b6ae",
      "original_line" : 86,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1442990991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204932281/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T02:42:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204932281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1205026761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205026761"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> And in the wallet, we use the clock time to set the descriptors/keys creation time.\r\n\r\nOk, thanks for the background. However, I think the wallet uses mock time (NodeClock) for the times, so a much simpler fix would be just a single line patch to set the mock time to the genesis block time in the wallet bench that needs it? \r\n",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-25T05:54:18Z",
      "diff_hunk" : "@@ -82,7 +82,8 @@ std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coi\n             ->block);\n \n     LOCK(cs_main);\n-    block->nTime = Assert(node.chainman)->ActiveChain().Tip()->GetMedianTimePast() + 1;\n+    const CBlockIndex* tip = Assert(node.chainman)->ActiveChain().Tip();\n+    block->nTime = tip->nHeight == 0 ? GetTime<std::chrono::seconds>().count() : tip->GetBlockTime() + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1205026761",
      "id" : 1205026761,
      "in_reply_to_id" : 1203481523,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585H0z_J",
      "original_commit_id" : "f44da31c20dbb29143dadd61f5a6bb7a3c61b6ae",
      "original_line" : 86,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1443129171,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205026761/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T05:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205026761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1205554251"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205554251"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ha, loved it. I was so deep that ended up complicating things for no reason.\r\nDropped the first commit and squashed the mock time change into the last one.",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-25T13:51:29Z",
      "diff_hunk" : "@@ -82,7 +82,8 @@ std::shared_ptr<CBlock> PrepareBlock(const NodeContext& node, const CScript& coi\n             ->block);\n \n     LOCK(cs_main);\n-    block->nTime = Assert(node.chainman)->ActiveChain().Tip()->GetMedianTimePast() + 1;\n+    const CBlockIndex* tip = Assert(node.chainman)->ActiveChain().Tip();\n+    block->nTime = tip->nHeight == 0 ? GetTime<std::chrono::seconds>().count() : tip->GetBlockTime() + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1205554251",
      "id" : 1205554251,
      "in_reply_to_id" : 1203481523,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585H20xL",
      "original_commit_id" : "f44da31c20dbb29143dadd61f5a6bb7a3c61b6ae",
      "original_line" : 86,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/util/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 1443949768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205554251/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T13:51:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205554251",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1205652539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205652539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm curious if `.load()` is necessary for the atomic value? Is this the correct reason? https://stackoverflow.com/a/44288045/1653320",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-25T15:02:01Z",
      "diff_hunk" : "@@ -1436,6 +1436,12 @@ void CWallet::blockConnected(const interfaces::BlockInfo& block)\n \n     m_last_block_processed_height = block.height;\n     m_last_block_processed = block.hash;\n+\n+    // No need to scan block if it was created before the wallet birthday.\n+    // Uses chain max time and twice the grace period to adjust time for block time variability.\n+    if (block.chain_time_max < m_birth_time.load() - (TIMESTAMP_WINDOW * 2)) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1205652539",
      "id" : 1205652539,
      "line" : 1442,
      "node_id" : "PRRC_kwDOABII585H3Mw7",
      "original_commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "original_line" : 1442,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 7,
      "pull_request_review_id" : 1444104729,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205652539/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T14:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205652539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This PR is not modifying the rescan process. Only IBD.\r\n\r\nsanity check: because we already skip old blocks during rescan?\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/26679",
      "created_at" : "2023-05-25T15:17:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1563088762",
      "id" : 1563088762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585dKtd6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563088762/reactions"
      },
      "updated_at" : "2023-05-25T15:17:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563088762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> sanity check: because we already skip old blocks during rescan?\r\n>\r\n> https://github.com/bitcoin/bitcoin/pull/26679\r\n\r\nYes. Different entry points.\r\n\r\n#26679 addressed the scanning of the existing chain during load time.\r\nAnd here, the emphasis shifts to the synchronization process when the\r\nwallet is active.\r\nWhen the node activates the best chain on each processed block and\r\nsignal the \"block connected\" event.",
      "created_at" : "2023-05-25T19:09:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1563383911",
      "id" : 1563383911,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585dL1hn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563383911/reactions"
      },
      "updated_at" : "2023-05-25T19:09:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563383911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "To review this PR I wrote a simple functional test: https://github.com/pinheadmz/bitcoin/commit/1f0f945aca3a4f5118e49b2d31318ddd4b19d906 which surprised me by failing. I added logging and comments to the test to share it because I don't entirely understand what's happening but it looks to me like, the wallet generates a `combo(...)` descriptor with a timestamp of `1` and therefore the wallet creation time is always `1` and so the new logic doesn't actually skip any blocks. But if that's the case, does that also mean #26679 doesn't work either?\r\n\r\ntest output:\r\n\r\n```\r\n2023-05-25T23:10:29.244000Z TestFramework (INFO): PRNG seed is: 8288012825723617302\r\n2023-05-25T23:10:29.245000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test__5pngcq0\r\n2023-05-25T23:10:29.886000Z TestFramework (INFO): Generate 10 blocks with 10-hour timestamp gaps\r\n2023-05-25T23:10:29.927000Z TestFramework (INFO): Initial blockchain sync the wallet's node\r\n\r\nnot(500.00000000 == 250)\r\n\r\nWhy does this descriptor have a timestamp of 1?\r\n{'desc': 'combo(022d715e6f0d7c037dbccd3327f0b3bc3c76258a7e017e1a64902f76406c87dfda)#pesd53nq', 'timestamp': 1, 'active': False}\r\n\r\n2023-05-25T23:10:31.083000Z TestFramework (INFO): Stopping nodes\r\n2023-05-25T23:10:31.306000Z TestFramework (WARNING): Not cleaning up dir /tmp/bitcoin_func_test__5pngcq0\r\n2023-05-25T23:10:31.306000Z TestFramework (INFO): Tests successful\r\n```\r\n\r\nand then in bitcoin `debug.log`, this output from `CWallet::blockConnected()`: `m_birth_time.load(): 1`. Every time we run that function, the log says wallet birthday is `1`",
      "created_at" : "2023-05-25T23:14:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1563619750",
      "id" : 1563619750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585dMvGm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563619750/reactions"
      },
      "updated_at" : "2023-05-25T23:14:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563619750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> To review this PR I wrote a simple functional test: https://github.com/pinheadmz/bitcoin/commit/1f0f945aca3a4f5118e49b2d31318ddd4b19d906 which surprised me by failing. I added logging and comments to the test to share it because I don't entirely understand what's happening but it looks to me like, the wallet generates a combo(...) descriptor with a timestamp of 1 and therefore the wallet creation time is always 1 and so the new logic doesn't actually skip any blocks. But if that's the case, does that also mean https://github.com/bitcoin/bitcoin/pull/26679 doesn't work either?\r\n\r\nThe issue is on your test setup. The `combo` descriptor comes from the test framework default wallet creation process, not the inner wallet.\r\n\r\nThe framework, after creating the default wallet, imports one of the hardcoded private keys ([link](https://github.com/bitcoin/bitcoin/blob/25202cace9140870c75cb3a811e10045df88c226/test/functional/test_framework/test_framework.py#L441)) used to receive the coinbases coins ([link](https://github.com/bitcoin/bitcoin/blob/25202cace9140870c75cb3a811e10045df88c226/test/functional/test_framework/test_node.py#L309)).\r\n\r\nThis means calling the test framework `importprivkey`, which is a proxy function with two possible outcomes:\r\n\r\n1) For legacy wallet, call the RPC command `importprivkey`: which doesn't receive a timestamp, so creation time is initialized to the minimum one.\r\n2) For descriptors wallet, call the RPC command `importdescriptors` with [timestamp=0](https://github.com/bitcoin/bitcoin/blob/25202cace9140870c75cb3a811e10045df88c226/test/functional/test_framework/test_node.py#L787). (which then is changed by the node internally to 1, because of the [minimum supported timestamp](https://github.com/bitcoin/bitcoin/blob/25202cace9140870c75cb3a811e10045df88c226/src/wallet/rpc/backup.cpp#L1669))\r\n\r\nThe simplest solution for the test is to create the wallet by yourself, by calling `createwallet`, instead of using the default one initialized by the framework.\r\nAnd, remember to set the mock time before creating the wallet, so it uses the time established by you and not the clock time.\r\n\r\nThanks for testing :).",
      "created_at" : "2023-05-26T00:27:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1563661471",
      "id" : 1563661471,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585dM5Sf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563661471/reactions"
      },
      "updated_at" : "2023-05-26T01:40:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563661471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@furszy awwwwwesome thank you for catching that. Ok, passing test is now at https://github.com/pinheadmz/bitcoin/commit/f1238700a1f3d3e88b7f20bc51f0088783d53595",
      "created_at" : "2023-05-26T14:40:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1564497329",
      "id" : 1564497329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585dQFWx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1564497329/reactions"
      },
      "updated_at" : "2023-05-26T14:40:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1564497329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1206948915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206948915"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's merely about consistency and readability.\r\n\r\nThe explicit `load` call tells the reader that this is an atomic variable, which could prevent some issues. E.g.\r\n```c++\r\nif (block.chain_time_max < m_birth_time - (TIMESTAMP_WINDOW * 2)) return; \r\nelse (m_birth_time > something_esle) // do something else..\r\n```\r\nHere there are two atomic reads performed. And the `m_birth_time` could have changed in-between them.",
      "commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-26T15:20:15Z",
      "diff_hunk" : "@@ -1436,6 +1436,12 @@ void CWallet::blockConnected(const interfaces::BlockInfo& block)\n \n     m_last_block_processed_height = block.height;\n     m_last_block_processed = block.hash;\n+\n+    // No need to scan block if it was created before the wallet birthday.\n+    // Uses chain max time and twice the grace period to adjust time for block time variability.\n+    if (block.chain_time_max < m_birth_time.load() - (TIMESTAMP_WINDOW * 2)) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#discussion_r1206948915",
      "id" : 1206948915,
      "in_reply_to_id" : 1205652539,
      "line" : 1442,
      "node_id" : "PRRC_kwDOABII585H8JQz",
      "original_commit_id" : "82bb7831fa6052620998c7eef47e48ed594248a8",
      "original_line" : 1442,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 7,
      "pull_request_review_id" : 1446465387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27469",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206948915/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-26T15:20:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206948915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re-ACK 82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-26T22:09:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1565012825",
      "id" : 1565012825,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585dSDNZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565012825/reactions"
      },
      "updated_at" : "2023-05-26T22:09:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565012825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 82bb7831fa6052620998c7eef47e48ed594248a8",
      "created_at" : "2023-05-27T01:18:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27469#issuecomment-1565133194",
      "id" : 1565133194,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27469",
      "node_id" : "IC_kwDOABII585dSgmK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565133194/reactions"
      },
      "updated_at" : "2023-05-27T01:18:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565133194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
