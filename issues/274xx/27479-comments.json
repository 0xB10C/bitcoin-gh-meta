[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1604739539), [theStack](https://github.com/bitcoin/bitcoin/pull/27479#pullrequestreview-1496080860), [achow101](https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1608232026) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27973](https://github.com/bitcoin/bitcoin/pull/27973) (util: Safer MakeByteSpan with ByteSpanCast by MarcoFalke)\n* [#27927](https://github.com/bitcoin/bitcoin/pull/27927) (util: Allow std::byte and char Span serialization by MarcoFalke)\n* [#27827](https://github.com/bitcoin/bitcoin/pull/27827) ([Silent Payments]: Base functionality by josibake)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-04-17T22:17:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1512159343",
      "id" : 1512159343,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27479",
      "node_id" : "IC_kwDOABII585aIbhv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1512159343/reactions"
      },
      "updated_at" : "2023-06-26T20:48:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1512159343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm in the process of taking over the BIP324 PRs from @dhruv.\r\n\r\nNote for reviewers:\r\n* Previously, the EllSwift encoding/decoding/creation was in #23432, while the ECDH logic was in #23561. I've opted here to merge all EllSwift-related functionality into 1 PR, as the integration is now tighter at the libsecp256k1 too compared to when the PRs were first opened (libsecp256k1 has functions for directly performing ECDH on the EllSwift-encoded keys).\r\n* `EllSwiftPubKey` is now a proper class that exposes a few utility functions, and only read-only access to the encoding.\r\n* Introduction of `FastRandomContext::fillrand` to fill `Span<std::byte>` with randomness.\r\n* Extended `UCharCast` to support `std::byte*` -> `unsigned char*` conversion, which removes the need for lots of `reinterpret_cast`s.\r\n",
      "created_at" : "2023-04-17T22:34:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1512175200",
      "id" : 1512175200,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27479",
      "node_id" : "IC_kwDOABII585aIfZg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1512175200/reactions"
      },
      "updated_at" : "2023-04-17T22:35:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1512175200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171357368"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171357368"
         }
      },
      "author_association" : "MEMBER",
      "body" : "normal *compressed* key",
      "commit_id" : "37d31e334f80f21d612b120418e19c3ac48962e0",
      "created_at" : "2023-04-19T13:36:51Z",
      "diff_hunk" : "@@ -291,6 +291,30 @@ class XOnlyPubKey\n     SERIALIZE_METHODS(XOnlyPubKey, obj) { READWRITE(obj.m_keydata); }\n };\n \n+/** An ElligatorSwift-encoded public key. */\n+struct EllSwiftPubKey\n+{\n+public:\n+    static constexpr size_t ELLSWIFT_ENCODED_SIZE = 64;\n+\n+private:\n+    std::array<std::byte, ELLSWIFT_ENCODED_SIZE> m_pubkey;\n+\n+public:\n+    /** Construct a new ellswift public key from a given serialization. */\n+    EllSwiftPubKey(const std::array<std::byte, ELLSWIFT_ENCODED_SIZE>& ellswift) :\n+        m_pubkey(ellswift) {}\n+\n+    /** Decode to normal key (for debugging purposes). */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171357368",
      "id" : 1171357368,
      "line" : 311,
      "node_id" : "PRRC_kwDOABII585F0X64",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 311,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/pubkey.h",
      "position" : 21,
      "pull_request_review_id" : 1392091186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171357368/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T14:04:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171357368",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171362440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171362440"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Took me too long to figure out what \"ent\" referred to, just putting the full word \"entropy\" in the comment would help. If the entropy is not unpredictable this would result in a not uniformly random(?) series of bytes in the resulting pubkey?",
      "commit_id" : "37d31e334f80f21d612b120418e19c3ac48962e0",
      "created_at" : "2023-04-19T13:40:31Z",
      "diff_hunk" : "@@ -156,6 +162,21 @@ class CKey\n \n     //! Load private key and check that public key matches.\n     bool Load(const CPrivKey& privkey, const CPubKey& vchPubKey, bool fSkipCheck);\n+\n+    /** Create an ellswift-encoded public key for this key, with specified entropy.\n+     *  This must be a valid private key. Ent32 must be 32 bytes. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171362440",
      "id" : 1171362440,
      "line" : 167,
      "node_id" : "PRRC_kwDOABII585F0ZKI",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 167,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/key.h",
      "position" : 19,
      "pull_request_review_id" : 1392091186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171362440/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T14:04:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171362440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171373891"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171373891"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/64/EllSwiftPubKey::size()/",
      "commit_id" : "37d31e334f80f21d612b120418e19c3ac48962e0",
      "created_at" : "2023-04-19T13:48:55Z",
      "diff_hunk" : "@@ -331,6 +332,57 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+EllSwiftPubKey CKey::EllSwiftCreate(Span<const std::byte> ent32) const\n+{\n+    assert(fValid);\n+    assert(ent32.size() == 32);\n+    std::array<std::byte, EllSwiftPubKey::size()> encoded_pubkey;\n+\n+    auto success = secp256k1_ellswift_create(secp256k1_context_sign,\n+                                             UCharCast(encoded_pubkey.data()),\n+                                             keydata.data(),\n+                                             UCharCast(ent32.data()));\n+\n+    // Should always succeed for valid keys (asserted above).\n+    assert(success);\n+    return {encoded_pubkey};\n+}\n+\n+static const HashWriter HASHER_BIP324_ECDH = TaggedHash(\"bip324_ellswift_xonly_ecdh\");\n+\n+extern \"C\" {\n+\n+static int BIP324ECDHHash(unsigned char* output, const unsigned char* x32, const unsigned char* ours, const unsigned char* theirs, void* data)\n+{\n+    bool initiating = *(bool*)data;\n+    HashWriter writer{HASHER_BIP324_ECDH};\n+    writer << Span{initiating ? ours : theirs, 64};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171373891",
      "id" : 1171373891,
      "line" : 359,
      "node_id" : "PRRC_kwDOABII585F0b9D",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 359,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 36,
      "pull_request_review_id" : 1392091186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171373891/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T14:04:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171373891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171373986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171373986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/64/EllSwiftPubKey::size()/",
      "commit_id" : "37d31e334f80f21d612b120418e19c3ac48962e0",
      "created_at" : "2023-04-19T13:48:59Z",
      "diff_hunk" : "@@ -331,6 +332,57 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+EllSwiftPubKey CKey::EllSwiftCreate(Span<const std::byte> ent32) const\n+{\n+    assert(fValid);\n+    assert(ent32.size() == 32);\n+    std::array<std::byte, EllSwiftPubKey::size()> encoded_pubkey;\n+\n+    auto success = secp256k1_ellswift_create(secp256k1_context_sign,\n+                                             UCharCast(encoded_pubkey.data()),\n+                                             keydata.data(),\n+                                             UCharCast(ent32.data()));\n+\n+    // Should always succeed for valid keys (asserted above).\n+    assert(success);\n+    return {encoded_pubkey};\n+}\n+\n+static const HashWriter HASHER_BIP324_ECDH = TaggedHash(\"bip324_ellswift_xonly_ecdh\");\n+\n+extern \"C\" {\n+\n+static int BIP324ECDHHash(unsigned char* output, const unsigned char* x32, const unsigned char* ours, const unsigned char* theirs, void* data)\n+{\n+    bool initiating = *(bool*)data;\n+    HashWriter writer{HASHER_BIP324_ECDH};\n+    writer << Span{initiating ? ours : theirs, 64};\n+    writer << Span{initiating ? theirs : ours, 64};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171373986",
      "id" : 1171373986,
      "line" : 360,
      "node_id" : "PRRC_kwDOABII585F0b-i",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 360,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 37,
      "pull_request_review_id" : 1392091186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171373986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T14:04:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171373986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171402620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171402620"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually, no, the \"create ellswift encoding\" algorithm in libsecp256k1 uses an internal RNG which is always at least seeded with the private key; the `ent32` argument here is just auxiliary randomness that gets fed to that RNG.\r\n\r\nThe output of the encoding is in fact indistinguishable from uniformly random to anyone who doesn't know the private key already, even without additional entropy. Adding actual randomness is a more belt-and-suspenders step to make sure the result is actually close to uniformly random, rather than just indistinguishable from random.\r\n\r\nThis deserves some extra comments, will add soon.",
      "commit_id" : "37d31e334f80f21d612b120418e19c3ac48962e0",
      "created_at" : "2023-04-19T14:08:36Z",
      "diff_hunk" : "@@ -156,6 +162,21 @@ class CKey\n \n     //! Load private key and check that public key matches.\n     bool Load(const CPrivKey& privkey, const CPubKey& vchPubKey, bool fSkipCheck);\n+\n+    /** Create an ellswift-encoded public key for this key, with specified entropy.\n+     *  This must be a valid private key. Ent32 must be 32 bytes. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171402620",
      "id" : 1171402620,
      "in_reply_to_id" : 1171362440,
      "line" : 167,
      "node_id" : "PRRC_kwDOABII585F0i98",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 167,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/key.h",
      "position" : 19,
      "pull_request_review_id" : 1392161620,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171402620/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T14:11:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171402620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171962843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171962843"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "tiny nit: could be put in the \"private:\" section, since there is a static constexpr `size()` function returning this value below anyway.",
      "commit_id" : "37d31e334f80f21d612b120418e19c3ac48962e0",
      "created_at" : "2023-04-20T00:19:10Z",
      "diff_hunk" : "@@ -291,6 +291,30 @@ class XOnlyPubKey\n     SERIALIZE_METHODS(XOnlyPubKey, obj) { READWRITE(obj.m_keydata); }\n };\n \n+/** An ElligatorSwift-encoded public key. */\n+struct EllSwiftPubKey\n+{\n+public:\n+    static constexpr size_t ELLSWIFT_ENCODED_SIZE = 64;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171962843",
      "id" : 1171962843,
      "line" : 298,
      "node_id" : "PRRC_kwDOABII585F2rvb",
      "original_commit_id" : "fd04a2baec77b97cfb36ec488cec58811ea1ad45",
      "original_line" : 298,
      "original_position" : 8,
      "original_start_line" : 297,
      "path" : "src/pubkey.h",
      "position" : 8,
      "pull_request_review_id" : 1393040022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171962843/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 297,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-20T00:46:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171962843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171972333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171972333"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There's a theoretical possibility that this call crashes due to failed assertion `assert(fValid)`, if the generated key from the previous round (=first 32 bytes of ellswift encoded pubkey) was not valid. Due to the practical low probably for this to ever happen (if my math isn't off, on average every 2^(127,65) randomly generated key is invalid), I guess it's not worth it to add any checks here, especially since it's only a benchmark?",
      "commit_id" : "37d31e334f80f21d612b120418e19c3ac48962e0",
      "created_at" : "2023-04-20T00:43:15Z",
      "diff_hunk" : "@@ -0,0 +1,32 @@\n+// Copyright (c) 2022-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <random.h>\n+\n+#include <array>\n+\n+static void EllSwiftCreate(benchmark::Bench& bench)\n+{\n+    ECC_Start();\n+\n+    CKey key;\n+    key.MakeNewKey(true);\n+\n+    uint256 entropy = GetRandHash();\n+\n+    bench.batch(1).unit(\"pubkey\").run([&] {\n+        auto ret = key.EllSwiftCreate(AsBytes(Span{entropy}));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1171972333",
      "id" : 1171972333,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII585F2uDt",
      "original_commit_id" : "e1ddcb416ace0c4a8d7da29c89454928b93c2c9e",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/bench/ellswift.cpp",
      "position" : 22,
      "pull_request_review_id" : 1393040022,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171972333/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T00:50:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171972333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739143"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739143"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-04-20T15:09:51Z",
      "diff_hunk" : "@@ -291,6 +291,30 @@ class XOnlyPubKey\n     SERIALIZE_METHODS(XOnlyPubKey, obj) { READWRITE(obj.m_keydata); }\n };\n \n+/** An ElligatorSwift-encoded public key. */\n+struct EllSwiftPubKey\n+{\n+public:\n+    static constexpr size_t ELLSWIFT_ENCODED_SIZE = 64;\n+\n+private:\n+    std::array<std::byte, ELLSWIFT_ENCODED_SIZE> m_pubkey;\n+\n+public:\n+    /** Construct a new ellswift public key from a given serialization. */\n+    EllSwiftPubKey(const std::array<std::byte, ELLSWIFT_ENCODED_SIZE>& ellswift) :\n+        m_pubkey(ellswift) {}\n+\n+    /** Decode to normal key (for debugging purposes). */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739143",
      "id" : 1172739143,
      "in_reply_to_id" : 1171357368,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5pRH",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 311,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/pubkey.h",
      "position" : null,
      "pull_request_review_id" : 1394227026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739143/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:09:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739143",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added some comments. Please have a look.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-04-20T15:10:03Z",
      "diff_hunk" : "@@ -156,6 +162,21 @@ class CKey\n \n     //! Load private key and check that public key matches.\n     bool Load(const CPrivKey& privkey, const CPubKey& vchPubKey, bool fSkipCheck);\n+\n+    /** Create an ellswift-encoded public key for this key, with specified entropy.\n+     *  This must be a valid private key. Ent32 must be 32 bytes. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739437",
      "id" : 1172739437,
      "in_reply_to_id" : 1171362440,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5pVt",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 167,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/key.h",
      "position" : null,
      "pull_request_review_id" : 1394227420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739437/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:10:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739546"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-04-20T15:10:08Z",
      "diff_hunk" : "@@ -331,6 +332,57 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+EllSwiftPubKey CKey::EllSwiftCreate(Span<const std::byte> ent32) const\n+{\n+    assert(fValid);\n+    assert(ent32.size() == 32);\n+    std::array<std::byte, EllSwiftPubKey::size()> encoded_pubkey;\n+\n+    auto success = secp256k1_ellswift_create(secp256k1_context_sign,\n+                                             UCharCast(encoded_pubkey.data()),\n+                                             keydata.data(),\n+                                             UCharCast(ent32.data()));\n+\n+    // Should always succeed for valid keys (asserted above).\n+    assert(success);\n+    return {encoded_pubkey};\n+}\n+\n+static const HashWriter HASHER_BIP324_ECDH = TaggedHash(\"bip324_ellswift_xonly_ecdh\");\n+\n+extern \"C\" {\n+\n+static int BIP324ECDHHash(unsigned char* output, const unsigned char* x32, const unsigned char* ours, const unsigned char* theirs, void* data)\n+{\n+    bool initiating = *(bool*)data;\n+    HashWriter writer{HASHER_BIP324_ECDH};\n+    writer << Span{initiating ? ours : theirs, 64};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739546",
      "id" : 1172739546,
      "in_reply_to_id" : 1171373891,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5pXa",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 359,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 1394227583,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:10:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739678"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-04-20T15:10:14Z",
      "diff_hunk" : "@@ -331,6 +332,57 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+EllSwiftPubKey CKey::EllSwiftCreate(Span<const std::byte> ent32) const\n+{\n+    assert(fValid);\n+    assert(ent32.size() == 32);\n+    std::array<std::byte, EllSwiftPubKey::size()> encoded_pubkey;\n+\n+    auto success = secp256k1_ellswift_create(secp256k1_context_sign,\n+                                             UCharCast(encoded_pubkey.data()),\n+                                             keydata.data(),\n+                                             UCharCast(ent32.data()));\n+\n+    // Should always succeed for valid keys (asserted above).\n+    assert(success);\n+    return {encoded_pubkey};\n+}\n+\n+static const HashWriter HASHER_BIP324_ECDH = TaggedHash(\"bip324_ellswift_xonly_ecdh\");\n+\n+extern \"C\" {\n+\n+static int BIP324ECDHHash(unsigned char* output, const unsigned char* x32, const unsigned char* ours, const unsigned char* theirs, void* data)\n+{\n+    bool initiating = *(bool*)data;\n+    HashWriter writer{HASHER_BIP324_ECDH};\n+    writer << Span{initiating ? ours : theirs, 64};\n+    writer << Span{initiating ? theirs : ours, 64};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739678",
      "id" : 1172739678,
      "in_reply_to_id" : 1171373986,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5pZe",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 360,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 1394227761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739678/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:10:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done. Also renamed to just `SIZE`.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-04-20T15:10:26Z",
      "diff_hunk" : "@@ -291,6 +291,30 @@ class XOnlyPubKey\n     SERIALIZE_METHODS(XOnlyPubKey, obj) { READWRITE(obj.m_keydata); }\n };\n \n+/** An ElligatorSwift-encoded public key. */\n+struct EllSwiftPubKey\n+{\n+public:\n+    static constexpr size_t ELLSWIFT_ENCODED_SIZE = 64;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172739938",
      "id" : 1172739938,
      "in_reply_to_id" : 1171962843,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5pdi",
      "original_commit_id" : "fd04a2baec77b97cfb36ec488cec58811ea1ad45",
      "original_line" : 298,
      "original_position" : 8,
      "original_start_line" : 297,
      "path" : "src/pubkey.h",
      "position" : null,
      "pull_request_review_id" : 1394228168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:10:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172739938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172741182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172741182"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Your math is correct. And indeed, it's such a low probability event that it's not worth adding code to deal with it (even outside of a benchmark, I'd say). Still, I've added an assert to make it clear to the reader this is always supposed to be the case.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-04-20T15:11:26Z",
      "diff_hunk" : "@@ -0,0 +1,32 @@\n+// Copyright (c) 2022-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <random.h>\n+\n+#include <array>\n+\n+static void EllSwiftCreate(benchmark::Bench& bench)\n+{\n+    ECC_Start();\n+\n+    CKey key;\n+    key.MakeNewKey(true);\n+\n+    uint256 entropy = GetRandHash();\n+\n+    bench.batch(1).unit(\"pubkey\").run([&] {\n+        auto ret = key.EllSwiftCreate(AsBytes(Span{entropy}));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172741182",
      "id" : 1172741182,
      "in_reply_to_id" : 1171972333,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII585F5pw-",
      "original_commit_id" : "e1ddcb416ace0c4a8d7da29c89454928b93c2c9e",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/bench/ellswift.cpp",
      "position" : 22,
      "pull_request_review_id" : 1394230117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172741182/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172741182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172742351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172742351"
         }
      },
      "author_association" : "MEMBER",
      "body" : "significantly clearer, thanks",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-04-20T15:12:24Z",
      "diff_hunk" : "@@ -156,6 +162,21 @@ class CKey\n \n     //! Load private key and check that public key matches.\n     bool Load(const CPrivKey& privkey, const CPubKey& vchPubKey, bool fSkipCheck);\n+\n+    /** Create an ellswift-encoded public key for this key, with specified entropy.\n+     *  This must be a valid private key. Ent32 must be 32 bytes. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1172742351",
      "id" : 1172742351,
      "in_reply_to_id" : 1171362440,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585F5qDP",
      "original_commit_id" : "2ecd571c958db45608cae0361d14552a11fb709b",
      "original_line" : 167,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/key.h",
      "position" : null,
      "pull_request_review_id" : 1394232011,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172742351/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-20T15:12:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1172742351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1185343503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1185343503"
         }
      },
      "author_association" : "MEMBER",
      "body" : "throwing it out there: could also have the `initiating` match erroneously, and assert that the secret *should not match* unless both privkeys/ent32s match?",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-05-04T18:03:31Z",
      "diff_hunk" : "@@ -326,3 +328,33 @@ FUZZ_TARGET_INIT(ellswift_roundtrip, initialize_key)\n \n     assert(key.VerifyPubKey(decoded_pubkey));\n }\n+\n+FUZZ_TARGET_INIT(bip324_ecdh, initialize_key)\n+{\n+    FuzzedDataProvider fdp{buffer.data(), buffer.size()};\n+\n+    auto rnd32 = fdp.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k1;\n+    k1.Set(rnd32.begin(), rnd32.end(), true);\n+    if (!k1.IsValid()) return;\n+\n+    rnd32 = fdp.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k2;\n+    k2.Set(rnd32.begin(), rnd32.end(), true);\n+    if (!k2.IsValid()) return;\n+\n+    auto ent32 = fdp.ConsumeBytes<std::byte>(32);\n+    ent32.resize(32);\n+    auto k1_ellswift = k1.EllSwiftCreate(ent32);\n+\n+    ent32 = fdp.ConsumeBytes<std::byte>(32);\n+    ent32.resize(32);\n+    auto k2_ellswift = k2.EllSwiftCreate(ent32);\n+\n+    bool initiating = fdp.ConsumeBool();\n+    auto ecdh_secret_1 = k1.ComputeBIP324ECDHSecret(k2_ellswift, k1_ellswift, initiating);\n+    auto ecdh_secret_2 = k2.ComputeBIP324ECDHSecret(k1_ellswift, k2_ellswift, !initiating);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1185343503",
      "id" : 1185343503,
      "line" : 370,
      "node_id" : "PRRC_kwDOABII585GpugP",
      "original_commit_id" : "7acde7393660ec5ee3652e811190ce4fa8fa86be",
      "original_line" : 370,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/test/fuzz/key.cpp",
      "position" : 82,
      "pull_request_review_id" : 1413629831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1185343503/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-04T18:15:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1185343503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1185352230"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1185352230"
         }
      },
      "author_association" : "MEMBER",
      "body" : "where is this used?",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-05-04T18:13:33Z",
      "diff_hunk" : "@@ -299,6 +299,9 @@ struct EllSwiftPubKey\n     std::array<std::byte, SIZE> m_pubkey;\n \n public:\n+    /** Construct an all 0x00 public key. Note that that is a valid pubkey. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1185352230",
      "id" : 1185352230,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Gpwom",
      "original_commit_id" : "818acac23295d526d9f85f0218949c817f5df964",
      "original_line" : 302,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/pubkey.h",
      "position" : null,
      "pull_request_review_id" : 1413629831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1185352230/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-04T18:15:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1185352230",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @stratospher ",
      "created_at" : "2023-05-12T08:49:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1545400377",
      "id" : 1545400377,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27479",
      "node_id" : "IC_kwDOABII585cHPA5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545400377/reactions"
      },
      "updated_at" : "2023-05-12T08:49:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545400377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1193210027"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1193210027"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've just added a test for this on the libsecp256k1 side: https://github.com/bitcoin-core/secp256k1/pull/1129/files#diff-d7678006ab19bb19a4a8dfb5f497cab0127e33730791c6e0597db203751322d9R365\r\n\r\nI may do something similar here when I update again.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-05-14T21:12:20Z",
      "diff_hunk" : "@@ -326,3 +328,33 @@ FUZZ_TARGET_INIT(ellswift_roundtrip, initialize_key)\n \n     assert(key.VerifyPubKey(decoded_pubkey));\n }\n+\n+FUZZ_TARGET_INIT(bip324_ecdh, initialize_key)\n+{\n+    FuzzedDataProvider fdp{buffer.data(), buffer.size()};\n+\n+    auto rnd32 = fdp.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k1;\n+    k1.Set(rnd32.begin(), rnd32.end(), true);\n+    if (!k1.IsValid()) return;\n+\n+    rnd32 = fdp.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k2;\n+    k2.Set(rnd32.begin(), rnd32.end(), true);\n+    if (!k2.IsValid()) return;\n+\n+    auto ent32 = fdp.ConsumeBytes<std::byte>(32);\n+    ent32.resize(32);\n+    auto k1_ellswift = k1.EllSwiftCreate(ent32);\n+\n+    ent32 = fdp.ConsumeBytes<std::byte>(32);\n+    ent32.resize(32);\n+    auto k2_ellswift = k2.EllSwiftCreate(ent32);\n+\n+    bool initiating = fdp.ConsumeBool();\n+    auto ecdh_secret_1 = k1.ComputeBIP324ECDHSecret(k2_ellswift, k1_ellswift, initiating);\n+    auto ecdh_secret_2 = k2.ComputeBIP324ECDHSecret(k1_ellswift, k2_ellswift, !initiating);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1193210027",
      "id" : 1193210027,
      "in_reply_to_id" : 1185343503,
      "line" : 370,
      "node_id" : "PRRC_kwDOABII585HHvCr",
      "original_commit_id" : "7acde7393660ec5ee3652e811190ce4fa8fa86be",
      "original_line" : 370,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/test/fuzz/key.cpp",
      "position" : 82,
      "pull_request_review_id" : 1425604677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1193210027/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-14T21:12:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1193210027",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237221740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237221740"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Apparently, not. Removed it.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-06-21T15:44:25Z",
      "diff_hunk" : "@@ -299,6 +299,9 @@ struct EllSwiftPubKey\n     std::array<std::byte, SIZE> m_pubkey;\n \n public:\n+    /** Construct an all 0x00 public key. Note that that is a valid pubkey. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237221740",
      "id" : 1237221740,
      "in_reply_to_id" : 1185352230,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JvoFs",
      "original_commit_id" : "818acac23295d526d9f85f0218949c817f5df964",
      "original_line" : 302,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/pubkey.h",
      "position" : null,
      "pull_request_review_id" : 1491111673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237221740/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T15:44:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237221740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237222079"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237222079"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added more tests like this on the Bitcoin Core side.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-06-21T15:44:43Z",
      "diff_hunk" : "@@ -326,3 +328,33 @@ FUZZ_TARGET_INIT(ellswift_roundtrip, initialize_key)\n \n     assert(key.VerifyPubKey(decoded_pubkey));\n }\n+\n+FUZZ_TARGET_INIT(bip324_ecdh, initialize_key)\n+{\n+    FuzzedDataProvider fdp{buffer.data(), buffer.size()};\n+\n+    auto rnd32 = fdp.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k1;\n+    k1.Set(rnd32.begin(), rnd32.end(), true);\n+    if (!k1.IsValid()) return;\n+\n+    rnd32 = fdp.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k2;\n+    k2.Set(rnd32.begin(), rnd32.end(), true);\n+    if (!k2.IsValid()) return;\n+\n+    auto ent32 = fdp.ConsumeBytes<std::byte>(32);\n+    ent32.resize(32);\n+    auto k1_ellswift = k1.EllSwiftCreate(ent32);\n+\n+    ent32 = fdp.ConsumeBytes<std::byte>(32);\n+    ent32.resize(32);\n+    auto k2_ellswift = k2.EllSwiftCreate(ent32);\n+\n+    bool initiating = fdp.ConsumeBool();\n+    auto ecdh_secret_1 = k1.ComputeBIP324ECDHSecret(k2_ellswift, k1_ellswift, initiating);\n+    auto ecdh_secret_2 = k2.ComputeBIP324ECDHSecret(k1_ellswift, k2_ellswift, !initiating);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237222079",
      "id" : 1237222079,
      "in_reply_to_id" : 1185343503,
      "line" : 370,
      "node_id" : "PRRC_kwDOABII585JvoK_",
      "original_commit_id" : "7acde7393660ec5ee3652e811190ce4fa8fa86be",
      "original_line" : 370,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/test/fuzz/key.cpp",
      "position" : 82,
      "pull_request_review_id" : 1491112241,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237222079/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T15:44:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237222079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, updated to use the now-merged bitcoin-core/secp256k1#1129, and addressed some comments.",
      "created_at" : "2023-06-21T15:45:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1601086071",
      "id" : 1601086071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27479",
      "node_id" : "IC_kwDOABII585fbqJ3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601086071/reactions"
      },
      "updated_at" : "2023-06-21T15:45:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601086071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237610724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237610724"
         }
      },
      "author_association" : "MEMBER",
      "body" : "is there an importance to the 8/12 bytes chosen here?",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-06-21T19:54:05Z",
      "diff_hunk" : "@@ -0,0 +1,46 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <pubkey.h>\n+#include <random.h>\n+#include <span.h>\n+\n+#include <cstddef>\n+\n+static void BIP324_ECDH(benchmark::Bench& bench)\n+{\n+    ECC_Start();\n+    FastRandomContext rng;\n+\n+    std::array<std::byte, 32> key_data;\n+    std::array<std::byte, EllSwiftPubKey::size()> our_ellswift_data;\n+    std::array<std::byte, EllSwiftPubKey::size()> their_ellswift_data;\n+\n+    rng.fillrand(key_data);\n+    rng.fillrand(our_ellswift_data);\n+    rng.fillrand(their_ellswift_data);\n+\n+    bench.batch(1).unit(\"ecdh\").run([&] {\n+        CKey key;\n+        key.Set(UCharCast(key_data.data()), UCharCast(key_data.data()) + 32, true);\n+        EllSwiftPubKey our_ellswift(our_ellswift_data);\n+        EllSwiftPubKey their_ellswift(their_ellswift_data);\n+\n+        auto ret = key.ComputeBIP324ECDHSecret(their_ellswift, our_ellswift, true);\n+\n+        // Copy 8 bytes from the resulting shared secret into middle of the private key.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237610724",
      "id" : 1237610724,
      "line" : 35,
      "node_id" : "PRRC_kwDOABII585JxHDk",
      "original_commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "original_line" : 35,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/bench/bip324_ecdh.cpp",
      "position" : 35,
      "pull_request_review_id" : 1491722690,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237610724/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T20:16:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237610724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237637710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237637710"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In bea8a4f737540ef72e795bcc4ca60b249e8c57ca \"Add ElligatorSwift key creation and ECDH logic\"\r\n\r\nHow come these need to be swapped depending on `initiating`? `secp256k1_ellswift_xdh`'s documentation does not indicate that the order of pubkeys matters, just that we correctly indicate which is ours.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-06-21T20:22:15Z",
      "diff_hunk" : "@@ -331,6 +332,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+EllSwiftPubKey CKey::EllSwiftCreate(Span<const std::byte> ent32) const\n+{\n+    assert(fValid);\n+    assert(ent32.size() == 32);\n+    std::array<std::byte, EllSwiftPubKey::size()> encoded_pubkey;\n+\n+    auto success = secp256k1_ellswift_create(secp256k1_context_sign,\n+                                             UCharCast(encoded_pubkey.data()),\n+                                             keydata.data(),\n+                                             UCharCast(ent32.data()));\n+\n+    // Should always succeed for valid keys (asserted above).\n+    assert(success);\n+    return {encoded_pubkey};\n+}\n+\n+ECDHSecret CKey::ComputeBIP324ECDHSecret(const EllSwiftPubKey& their_ellswift, const EllSwiftPubKey& our_ellswift, bool initiating) const\n+{\n+    assert(fValid);\n+\n+    ECDHSecret output;\n+    bool success = secp256k1_ellswift_xdh(secp256k1_context_sign,\n+                                          UCharCast(output.data()),\n+                                          UCharCast(initiating ? our_ellswift.data() : their_ellswift.data()),\n+                                          UCharCast(initiating ? their_ellswift.data() : our_ellswift.data()),\n+                                          keydata.data(),\n+                                          initiating ? 0 : 1,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237637710",
      "id" : 1237637710,
      "line" : 361,
      "node_id" : "PRRC_kwDOABII585JxNpO",
      "original_commit_id" : "015dbbc7f800ff4c677c67906e965146bbe29d92",
      "original_line" : 361,
      "original_position" : 38,
      "original_start_line" : 358,
      "path" : "src/key.cpp",
      "position" : 38,
      "pull_request_review_id" : 1491768419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237637710/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 358,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-21T20:29:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237637710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237651039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237651039"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It actually does (https://github.com/bitcoin-core/secp256k1/blob/705ce7ed8c1557a31e1bfc99be06082c5098d9f5/include/secp256k1_ellswift.h#L173):\r\n\r\n```\r\n *           party:     boolean indicating which party we are: zero if we are\r\n *                      party A, non-zero if we are party B. seckey32 must be\r\n *                      the private key corresponding to that party's ell_?64.\r\n *                      This correspondence is not checked.\r\n```\r\n",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-06-21T20:32:00Z",
      "diff_hunk" : "@@ -331,6 +332,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+EllSwiftPubKey CKey::EllSwiftCreate(Span<const std::byte> ent32) const\n+{\n+    assert(fValid);\n+    assert(ent32.size() == 32);\n+    std::array<std::byte, EllSwiftPubKey::size()> encoded_pubkey;\n+\n+    auto success = secp256k1_ellswift_create(secp256k1_context_sign,\n+                                             UCharCast(encoded_pubkey.data()),\n+                                             keydata.data(),\n+                                             UCharCast(ent32.data()));\n+\n+    // Should always succeed for valid keys (asserted above).\n+    assert(success);\n+    return {encoded_pubkey};\n+}\n+\n+ECDHSecret CKey::ComputeBIP324ECDHSecret(const EllSwiftPubKey& their_ellswift, const EllSwiftPubKey& our_ellswift, bool initiating) const\n+{\n+    assert(fValid);\n+\n+    ECDHSecret output;\n+    bool success = secp256k1_ellswift_xdh(secp256k1_context_sign,\n+                                          UCharCast(output.data()),\n+                                          UCharCast(initiating ? our_ellswift.data() : their_ellswift.data()),\n+                                          UCharCast(initiating ? their_ellswift.data() : our_ellswift.data()),\n+                                          keydata.data(),\n+                                          initiating ? 0 : 1,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237651039",
      "id" : 1237651039,
      "in_reply_to_id" : 1237637710,
      "line" : 361,
      "node_id" : "PRRC_kwDOABII585JxQ5f",
      "original_commit_id" : "015dbbc7f800ff4c677c67906e965146bbe29d92",
      "original_line" : 361,
      "original_position" : 38,
      "original_start_line" : 358,
      "path" : "src/key.cpp",
      "position" : 38,
      "pull_request_review_id" : 1491795806,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237651039/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 358,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-21T20:32:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237651039",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237691830"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237691830"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not really, the reasoning is:\r\n* The copying is done so that not all inputs are always the same.\r\n* The copying into the middle is so that for ellswift encodings both the left and right 32 bytes are affected. For the private key, the place doesn't matter.\r\n* The 8/12/12 split gives a bit more entropy to the ellswift encodings as they are bigger. Overall it gives 64 bits to the private keys, and 48 bits to each of the four 256-bit components of the ellswift encodings.",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-06-21T21:00:44Z",
      "diff_hunk" : "@@ -0,0 +1,46 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <pubkey.h>\n+#include <random.h>\n+#include <span.h>\n+\n+#include <cstddef>\n+\n+static void BIP324_ECDH(benchmark::Bench& bench)\n+{\n+    ECC_Start();\n+    FastRandomContext rng;\n+\n+    std::array<std::byte, 32> key_data;\n+    std::array<std::byte, EllSwiftPubKey::size()> our_ellswift_data;\n+    std::array<std::byte, EllSwiftPubKey::size()> their_ellswift_data;\n+\n+    rng.fillrand(key_data);\n+    rng.fillrand(our_ellswift_data);\n+    rng.fillrand(their_ellswift_data);\n+\n+    bench.batch(1).unit(\"ecdh\").run([&] {\n+        CKey key;\n+        key.Set(UCharCast(key_data.data()), UCharCast(key_data.data()) + 32, true);\n+        EllSwiftPubKey our_ellswift(our_ellswift_data);\n+        EllSwiftPubKey their_ellswift(their_ellswift_data);\n+\n+        auto ret = key.ComputeBIP324ECDHSecret(their_ellswift, our_ellswift, true);\n+\n+        // Copy 8 bytes from the resulting shared secret into middle of the private key.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1237691830",
      "id" : 1237691830,
      "in_reply_to_id" : 1237610724,
      "line" : 35,
      "node_id" : "PRRC_kwDOABII585Jxa22",
      "original_commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "original_line" : 35,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/bench/bip324_ecdh.cpp",
      "position" : 35,
      "pull_request_review_id" : 1491865998,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237691830/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-21T21:00:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237691830",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code Review ACK ff58a4a4a3930ecb913eee8a42df2756b916b858\r\n\r\nRan the fuzz tests for a while and didn't see any errors. The code itself looks good and is small and self contained. Also verified that the updated subtree matches.",
      "created_at" : "2023-06-21T21:15:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1601687213",
      "id" : 1601687213,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27479",
      "node_id" : "IC_kwDOABII585fd86t",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601687213/reactions"
      },
      "updated_at" : "2023-06-21T21:15:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601687213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1238043422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238043422"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style-nit: Obviously doesn't matter here, but could use `reinterpret_cast` to guard against accidentally removing constness. (And for symmetry with `UCharCast(const std::byte*)`)\r\n\r\n```suggestion\r\ninline unsigned char* UCharCast(std::byte* c) { return reinterpret_cast<unsigned char*>(c); }\r\n```",
      "commit_id" : "3168b08043546cd248a81563e21ff096019f1521",
      "created_at" : "2023-06-22T06:13:18Z",
      "diff_hunk" : "@@ -274,6 +274,7 @@ Span<std::byte> MakeWritableByteSpan(V&& v) noexcept\n // Helper functions to safely cast to unsigned char pointers.\n inline unsigned char* UCharCast(char* c) { return (unsigned char*)c; }\n inline unsigned char* UCharCast(unsigned char* c) { return c; }\n+inline unsigned char* UCharCast(std::byte* c) { return (unsigned char*)c; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1238043422",
      "id" : 1238043422,
      "line" : 277,
      "node_id" : "PRRC_kwDOABII585Jywse",
      "original_commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "original_line" : 277,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 4,
      "pull_request_review_id" : 1492430513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238043422/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-26T08:42:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238043422",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1238465895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238465895"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: unneeded include (but it's missing in `src/bench/bip324_ecdh.cpp`)\r\n```suggestion\r\n```",
      "commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "created_at" : "2023-06-22T12:35:35Z",
      "diff_hunk" : "@@ -0,0 +1,33 @@\n+// Copyright (c) 2022-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <random.h>\n+\n+#include <array>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1238465895",
      "id" : 1238465895,
      "line" : 10,
      "node_id" : "PRRC_kwDOABII585J0X1n",
      "original_commit_id" : "55ce092324ba0d198f7ce75a84a8c81a277951c5",
      "original_line" : 10,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/bench/ellswift.cpp",
      "position" : 10,
      "pull_request_review_id" : 1493090632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238465895/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-22T12:36:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238465895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1238543437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238543437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        auto ret = key.EllSwiftCreate(MakeByteSpan(entropy));\r\n```\r\n\r\nstyle nit: Can use the alias which does the same.",
      "commit_id" : "3168b08043546cd248a81563e21ff096019f1521",
      "created_at" : "2023-06-22T13:37:24Z",
      "diff_hunk" : "@@ -0,0 +1,33 @@\n+// Copyright (c) 2022-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <random.h>\n+\n+#include <array>\n+\n+static void EllSwiftCreate(benchmark::Bench& bench)\n+{\n+    ECC_Start();\n+\n+    CKey key;\n+    key.MakeNewKey(true);\n+\n+    uint256 entropy = GetRandHash();\n+\n+    bench.batch(1).unit(\"pubkey\").run([&] {\n+        auto ret = key.EllSwiftCreate(AsBytes(Span{entropy}));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1238543437",
      "id" : 1238543437,
      "line" : 20,
      "node_id" : "PRRC_kwDOABII585J0qxN",
      "original_commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "original_line" : 20,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/bench/ellswift.cpp",
      "position" : 20,
      "pull_request_review_id" : 1492430513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238543437/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-26T09:27:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238543437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1238546031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238546031"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        auto ellswift = key.EllSwiftCreate(MakeByteSpan(ent32));\r\n```",
      "commit_id" : "3168b08043546cd248a81563e21ff096019f1521",
      "created_at" : "2023-06-22T13:39:24Z",
      "diff_hunk" : "@@ -344,4 +344,24 @@ BOOST_AUTO_TEST_CASE(bip340_test_vectors)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(key_ellswift)\n+{\n+    for (const auto& secret : {strSecret1, strSecret2, strSecret1C, strSecret2C}) {\n+        CKey key = DecodeSecret(secret);\n+        BOOST_CHECK(key.IsValid());\n+\n+        uint256 ent32 = InsecureRand256();\n+        auto ellswift = key.EllSwiftCreate(AsBytes(Span{ent32}));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1238546031",
      "id" : 1238546031,
      "line" : 354,
      "node_id" : "PRRC_kwDOABII585J0rZv",
      "original_commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "original_line" : 354,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/test/key_tests.cpp",
      "position" : 11,
      "pull_request_review_id" : 1492430513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238546031/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-26T08:42:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238546031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1240159729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240159729"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed both.",
      "commit_id" : "3168b08043546cd248a81563e21ff096019f1521",
      "created_at" : "2023-06-23T18:26:16Z",
      "diff_hunk" : "@@ -0,0 +1,33 @@\n+// Copyright (c) 2022-2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <random.h>\n+\n+#include <array>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1240159729",
      "id" : 1240159729,
      "in_reply_to_id" : 1238465895,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585J61Xx",
      "original_commit_id" : "55ce092324ba0d198f7ce75a84a8c81a277951c5",
      "original_line" : 10,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/bench/ellswift.cpp",
      "position" : null,
      "pull_request_review_id" : 1495682355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240159729/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-23T18:26:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240159729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1240160094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240160094"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've changed it to 8/8/16, and added rationale why in a comment.",
      "commit_id" : "3168b08043546cd248a81563e21ff096019f1521",
      "created_at" : "2023-06-23T18:26:35Z",
      "diff_hunk" : "@@ -0,0 +1,46 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <pubkey.h>\n+#include <random.h>\n+#include <span.h>\n+\n+#include <cstddef>\n+\n+static void BIP324_ECDH(benchmark::Bench& bench)\n+{\n+    ECC_Start();\n+    FastRandomContext rng;\n+\n+    std::array<std::byte, 32> key_data;\n+    std::array<std::byte, EllSwiftPubKey::size()> our_ellswift_data;\n+    std::array<std::byte, EllSwiftPubKey::size()> their_ellswift_data;\n+\n+    rng.fillrand(key_data);\n+    rng.fillrand(our_ellswift_data);\n+    rng.fillrand(their_ellswift_data);\n+\n+    bench.batch(1).unit(\"ecdh\").run([&] {\n+        CKey key;\n+        key.Set(UCharCast(key_data.data()), UCharCast(key_data.data()) + 32, true);\n+        EllSwiftPubKey our_ellswift(our_ellswift_data);\n+        EllSwiftPubKey their_ellswift(their_ellswift_data);\n+\n+        auto ret = key.ComputeBIP324ECDHSecret(their_ellswift, our_ellswift, true);\n+\n+        // Copy 8 bytes from the resulting shared secret into middle of the private key.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1240160094",
      "id" : 1240160094,
      "in_reply_to_id" : 1237610724,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585J61de",
      "original_commit_id" : "ff58a4a4a3930ecb913eee8a42df2756b916b858",
      "original_line" : 35,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/bench/bip324_ecdh.cpp",
      "position" : null,
      "pull_request_review_id" : 1495683013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240160094/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-23T18:26:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240160094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1240160552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240160552"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a comment.",
      "commit_id" : "3168b08043546cd248a81563e21ff096019f1521",
      "created_at" : "2023-06-23T18:27:01Z",
      "diff_hunk" : "@@ -331,6 +332,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+EllSwiftPubKey CKey::EllSwiftCreate(Span<const std::byte> ent32) const\n+{\n+    assert(fValid);\n+    assert(ent32.size() == 32);\n+    std::array<std::byte, EllSwiftPubKey::size()> encoded_pubkey;\n+\n+    auto success = secp256k1_ellswift_create(secp256k1_context_sign,\n+                                             UCharCast(encoded_pubkey.data()),\n+                                             keydata.data(),\n+                                             UCharCast(ent32.data()));\n+\n+    // Should always succeed for valid keys (asserted above).\n+    assert(success);\n+    return {encoded_pubkey};\n+}\n+\n+ECDHSecret CKey::ComputeBIP324ECDHSecret(const EllSwiftPubKey& their_ellswift, const EllSwiftPubKey& our_ellswift, bool initiating) const\n+{\n+    assert(fValid);\n+\n+    ECDHSecret output;\n+    bool success = secp256k1_ellswift_xdh(secp256k1_context_sign,\n+                                          UCharCast(output.data()),\n+                                          UCharCast(initiating ? our_ellswift.data() : their_ellswift.data()),\n+                                          UCharCast(initiating ? their_ellswift.data() : our_ellswift.data()),\n+                                          keydata.data(),\n+                                          initiating ? 0 : 1,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1240160552",
      "id" : 1240160552,
      "in_reply_to_id" : 1237637710,
      "line" : 363,
      "node_id" : "PRRC_kwDOABII585J61ko",
      "original_commit_id" : "015dbbc7f800ff4c677c67906e965146bbe29d92",
      "original_line" : 363,
      "original_position" : 38,
      "original_start_line" : 358,
      "path" : "src/key.cpp",
      "position" : 40,
      "pull_request_review_id" : 1495683834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240160552/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 360,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-23T18:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240160552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theStack I've dropped the `--enable-module-ellswift`, but I believe the MSVC build change remains necessary (as it isn't influenced by the `./configure` defaults).",
      "created_at" : "2023-06-23T18:27:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1604682504",
      "id" : 1604682504,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27479",
      "node_id" : "IC_kwDOABII585fpYMI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1604682504/reactions"
      },
      "updated_at" : "2023-06-23T18:27:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1604682504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "reACK https://github.com/bitcoin/bitcoin/pull/27479/commits/3168b08043546cd248a81563e21ff096019f1521\r\n",
      "created_at" : "2023-06-23T19:04:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1604739539",
      "id" : 1604739539,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27479",
      "node_id" : "IC_kwDOABII585fpmHT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1604739539/reactions"
      },
      "updated_at" : "2023-06-23T19:04:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1604739539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1242737788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242737788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To clarify, the order matters because the ECDH is more than just plain ECDH - it hashes the ECDH secret with the pubkeys, and so ordering in the hashing serialization matters. BIP 324 specifies the preimage of this hash as `initiator pub || receiver pub || ecdh secret`, so we do this swapping so that we are computing this order correctly.",
      "commit_id" : "3168b08043546cd248a81563e21ff096019f1521",
      "created_at" : "2023-06-26T20:38:39Z",
      "diff_hunk" : "@@ -331,6 +332,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+EllSwiftPubKey CKey::EllSwiftCreate(Span<const std::byte> ent32) const\n+{\n+    assert(fValid);\n+    assert(ent32.size() == 32);\n+    std::array<std::byte, EllSwiftPubKey::size()> encoded_pubkey;\n+\n+    auto success = secp256k1_ellswift_create(secp256k1_context_sign,\n+                                             UCharCast(encoded_pubkey.data()),\n+                                             keydata.data(),\n+                                             UCharCast(ent32.data()));\n+\n+    // Should always succeed for valid keys (asserted above).\n+    assert(success);\n+    return {encoded_pubkey};\n+}\n+\n+ECDHSecret CKey::ComputeBIP324ECDHSecret(const EllSwiftPubKey& their_ellswift, const EllSwiftPubKey& our_ellswift, bool initiating) const\n+{\n+    assert(fValid);\n+\n+    ECDHSecret output;\n+    bool success = secp256k1_ellswift_xdh(secp256k1_context_sign,\n+                                          UCharCast(output.data()),\n+                                          UCharCast(initiating ? our_ellswift.data() : their_ellswift.data()),\n+                                          UCharCast(initiating ? their_ellswift.data() : our_ellswift.data()),\n+                                          keydata.data(),\n+                                          initiating ? 0 : 1,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#discussion_r1242737788",
      "id" : 1242737788,
      "in_reply_to_id" : 1237637710,
      "line" : 363,
      "node_id" : "PRRC_kwDOABII585KEqx8",
      "original_commit_id" : "015dbbc7f800ff4c677c67906e965146bbe29d92",
      "original_line" : 363,
      "original_position" : 38,
      "original_start_line" : 358,
      "path" : "src/key.cpp",
      "position" : 40,
      "pull_request_review_id" : 1499385565,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27479",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242737788/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 360,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-26T20:38:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242737788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 3168b08043546cd248a81563e21ff096019f1521",
      "created_at" : "2023-06-26T20:48:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27479#issuecomment-1608232026",
      "id" : 1608232026,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27479",
      "node_id" : "IC_kwDOABII585f26xa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608232026/reactions"
      },
      "updated_at" : "2023-06-26T20:48:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1608232026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
