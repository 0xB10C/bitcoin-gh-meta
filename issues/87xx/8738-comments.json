[
   {
      "body" : "The bottleneck is not your internet bandwidth.\r\n\r\nThe slowdown happens because of block verifications causing thousands of operations every second including database (utxo-set) lookups on your disk or in the db memory cache.\r\n\r\nTry to use a SSD and/or set your -dbcache to a value around 4000 (depending on how much ram you have available).",
      "created_at" : "2016-09-15T11:35:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8738#issuecomment-247304392",
      "id" : 247304392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8738",
      "updated_at" : "2016-09-15T11:35:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247304392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Well, there must be some subtility I am not aware of (and I am trying to see what happens for a normal user, not someone able to use options)\r\n\r\nDo you mean that ``sum(check downloaded block(s) + time to download block(s)) !~ (check blockchain while opening bitcoin core)+ (total time to download all the blocks)`` ?\r\n\r\ncheck blockchain while opening bittorrent ~ 30/40mn for me\r\n\r\nWorst case: blockchain is 100 GB, 10 Mbps --> 22 hours to download with bittorrent (worst case again if we consider this is slower)\r\n\r\nTotal: < 1 day, this is very far from 10 days\r\n\r\nAs far as I understand bitcoin core only connects to 8 peers, so the download bandwidth is limited to only the [sum of the upload bandwidth of the 8 peers], knowing that unlike bittorrent your goal is not to use the totality of the upload bandwidth of those peers I suppose\r\n\r\nIn that conditions I really don't see how you can compete with bittorrent and how the method can be faster\r\n\r\n",
      "created_at" : "2016-09-15T17:16:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8738#issuecomment-247392183",
      "id" : 247392183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8738",
      "updated_at" : "2016-09-15T17:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247392183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/759202?v=3",
         "events_url" : "https://api.github.com/users/Ayms/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Ayms/followers",
         "following_url" : "https://api.github.com/users/Ayms/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Ayms/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Ayms",
         "id" : 759202,
         "login" : "Ayms",
         "organizations_url" : "https://api.github.com/users/Ayms/orgs",
         "received_events_url" : "https://api.github.com/users/Ayms/received_events",
         "repos_url" : "https://api.github.com/users/Ayms/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Ayms/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Ayms/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Ayms"
      }
   },
   {
      "body" : "Again: the speed is dominated by how fast you can verify the blocks, not how fast you can download them.\n\nIf you'd download them via BitTorrent, you'd still need 10 days to verify\nthem in your setup, in addition to the 1 day to download it. Bitcoin Core verifies simultaneously with downloading, avoiding the need for double storage and needing to wait for the download to complete before starting to validate. That verification can be sped up a lot if you can assign more memory to the database cache as @jonasschelli mentioned.\n\n10 days does sound extremely long though. Can you share some information about your hardware (disk, cpu, memory)?\n",
      "created_at" : "2016-09-15T17:22:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8738#issuecomment-247393488",
      "id" : 247393488,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8738",
      "updated_at" : "2016-09-15T17:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247393488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "As far as I remember it took me about 20 hours to download whole blockchain (80GB) on my 4core Skylake CPU. Comparing to Raspberry Pi3, which took like 3 weeks to do that on the same internet line illustrates the dependency on computing power.\r\n\r\nBut I wonder, if there is anything that Core can do/plan to reduce the full-download time?",
      "created_at" : "2016-09-15T20:23:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8738#issuecomment-247443479",
      "id" : 247443479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8738",
      "updated_at" : "2016-09-15T20:23:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247443479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11314444?v=3",
         "events_url" : "https://api.github.com/users/martin-lizner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martin-lizner/followers",
         "following_url" : "https://api.github.com/users/martin-lizner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martin-lizner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martin-lizner",
         "id" : 11314444,
         "login" : "martin-lizner",
         "organizations_url" : "https://api.github.com/users/martin-lizner/orgs",
         "received_events_url" : "https://api.github.com/users/martin-lizner/received_events",
         "repos_url" : "https://api.github.com/users/martin-lizner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martin-lizner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martin-lizner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martin-lizner"
      }
   },
   {
      "body" : "We're continuously working on it.\r\n\r\nI suggest you try syncing with 0.11 (before secp256k1 validation), or 0.9 (before headers-first sync), or 0.7 (before utxo database).",
      "created_at" : "2016-09-15T20:25:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8738#issuecomment-247444291",
      "id" : 247444291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8738",
      "updated_at" : "2016-09-15T20:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247444291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Yeah, thats right secp256k1 did speed up the thing a lot! Is there still potential for improvement, could you share any ideas?",
      "created_at" : "2016-09-15T20:28:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8738#issuecomment-247444950",
      "id" : 247444950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8738",
      "updated_at" : "2016-09-15T20:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247444950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11314444?v=3",
         "events_url" : "https://api.github.com/users/martin-lizner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martin-lizner/followers",
         "following_url" : "https://api.github.com/users/martin-lizner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martin-lizner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martin-lizner",
         "id" : 11314444,
         "login" : "martin-lizner",
         "organizations_url" : "https://api.github.com/users/martin-lizner/orgs",
         "received_events_url" : "https://api.github.com/users/martin-lizner/received_events",
         "repos_url" : "https://api.github.com/users/martin-lizner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martin-lizner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martin-lizner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martin-lizner"
      }
   },
   {
      "body" : "@sipa PS  : your previous reply was talking about 3 days... Anyway, that's not important, my hw is a normal windaube PC, 5 years old CPU, 3Go\r\n\r\nFor some [research/project](https://github.com/Ayms/node-Tor#convergence) purposes  I must behave like a normal user, ie I have plenty of means to retrieve the blocklist more efficiently if I like, but here I am trying to act just like a normal user, and again the intent here is not to criticize things but to understand why they are like this and if possible to improve them, 10 days for (only) 80 GB + all checks, that's not possible, something is wrong\r\n\r\n>Again: the speed is dominated by how fast you can verify the blocks, not how fast you can download them. \r\n\r\nYou cannot speculate on the user processing capabilities/bandwidth, ie if I have a 100 Mbps bandwidth with high CPU/RAM then in this model the 8 peers scenario remains a very very serious limitation, it's impossible to pretend being faster than bittorrent with this\r\n\r\nAnd if I can download faster than checking the blocks then there are no reasons to block this\r\n\r\n>Bitcoin Core verifies simultaneously with downloading, avoiding the need for double storage and needing to wait for the download to complete before starting to validate\r\n\r\nYou can torrent the blockchain and check the blocks simultaneously too, for bitcoin you would need some luck to get contiguous pieces but modern bittorrent clients implement streaming which means that pieces are retrieved somewhere sequentially (not exactly but if some next pieces are required urgently the algorithm will retrieve them first)\r\n\r\nFor now I don't know why 30mn when you open bitcoin core to reverify the blockchain becomes 3 or 10 days when you download it (??)\r\n\r\nProbably it has already been thought in the past but it does not seem unlikely to envision a bittorrent client with bitcoin client where the blockchain is distributed in several trusted/verifiable infohashes (and seeded by both bt/btc) and does not need to be rechecked, and where the DHT can help storing information to unload the blockchain",
      "created_at" : "2016-09-15T21:12:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8738#issuecomment-247457037",
      "id" : 247457037,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8738",
      "updated_at" : "2016-09-15T21:12:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247457037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/759202?v=3",
         "events_url" : "https://api.github.com/users/Ayms/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Ayms/followers",
         "following_url" : "https://api.github.com/users/Ayms/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Ayms/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Ayms",
         "id" : 759202,
         "login" : "Ayms",
         "organizations_url" : "https://api.github.com/users/Ayms/orgs",
         "received_events_url" : "https://api.github.com/users/Ayms/received_events",
         "repos_url" : "https://api.github.com/users/Ayms/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Ayms/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Ayms/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Ayms"
      }
   },
   {
      "body" : "> 10 days for (only) 80 GB + all checks, that's not possible, something is wrong\r\n\r\nYes, I agree. We should investigate that. I would very much like to know what hardware you're running on (CPU, memory, disk, software version), and perhaps debug.log files. Perhaps a particular attack exists on the network that managed to interfere with your download process. Perhaps there is a bug in the download logic. But I can't judge that without seeing more information. What I can tell you is that downloading is generally not the issue - validation is, and a torrent won't help.\r\n\r\n> You cannot speculate on the user processing capabilities/bandwidth, ie if I have a 100 Mbps bandwidth with high CPU/RAM then in this model the 8 peers scenario remains a very very serious limitation, it's impossible to pretend being faster than bittorrent with this\r\n\r\nThe fastest numbers I know are possible with good connection, lots of memory, fast disk, many fast CPU cores, is around 4 hours for validating the entire chain. That's approximately 47 Mbit/s of block validation. More common on regular hardware is around 10 Mbit/s. Your 100 Mbit/s is not every going to matter - all you need is to be able to satisfy the demand of that 10 Mbit/s. With slow hardware and little memory, it can certainly drop much lower.\r\n\r\n> For now I don't know why 30mn when you open bitcoin core to reverify the blockchain becomes 3 or 10 days when you download it (??)\r\n\r\nWhat does 30mn mean?\r\n\r\n> Probably it has already been thought in the past but it does not seem unlikely to envision a bittorrent client with bitcoin client where the blockchain is distributed in several trusted/verifiable infohashes (and seeded by both bt/btc) and does not need to be rechecked, and where the DHT can help storing information to unload the blockchain\r\n\r\nWe used to maintain a blockchain torrent until 0.9, but it was discontinued in 0.10 for the reasons mentioned. With a torrent you'd have to wait until the majority of the chain arrived, as we can only validate linearly.",
      "created_at" : "2016-09-16T00:55:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8738#issuecomment-247494172",
      "id" : 247494172,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8738",
      "updated_at" : "2016-09-16T00:58:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247494172",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : ">Yes, I agree. We should investigate that. I would very much like to know what hardware you're running on (CPU, memory, disk, software version), and perhaps debug.log files.\r\n\r\nWill try to get this but first will relaunch the whole download to be sure (results are not precise here, 10 days might be 8 days since I had to shut down the computer sometimes, how to activate debug.log?)\r\n\r\n>The fastest numbers I know are possible with good connection, lots of memory, fast disk, many fast CPU cores, is around 4 hours for validating the entire chain. That's approximately 47 Mbit/s of block validation. More common on regular hardware is around 10 Mbit/s. Your 100 Mbit/s is not every going to matter - all you need is to be able to satisfy the demand of that 10 Mbit/s. With slow hardware and little memory, it can certainly drop much lower.\r\n\r\nI see two problems with this approach and the 8 connections limitation: you limit the download for those that have the 47 Mbps capacity and it's not very likely that you reach 10 Mbps for normal users if we estimate that the 8 peers upload bandwidth is < 1 Mbps (and usually closer to 500 kbps) knowing again that's it's not the target of btc to staturate the upload bandwidth of the peers, so you are more likely to get something like 2 Mbps (so 4/5 days already... any way to measure this in bitcoin core?)\r\n\r\n>What does 30mn mean?\r\n\r\n30 minutes to check the blockchain when I open bitcoin core, I read your docs but did not find the difference between this check and the checks performed while downloading the blocks (btw can we force bitcoin core to recheck the whole blockchain the way it does when downloading blocks?)\r\n\r\n>We used to maintain a blockchain torrent until 0.9, but it was discontinued in 0.10 for the reasons mentioned. With a torrent you'd have to wait until the majority of the chain arrived, as we can only validate linearly.\r\n\r\nI know, but you maybe missed a part of what I wrote above, you could partially validate blocks not arriving in order, but maybe it would introduce more complexity than benefit, but again bittorrent clients retrieve pieces sequentially, so you don't have to wait for the whole file.\r\n\r\nWe can call it torrent or it can be derived from btc protocol or whatever, does not matter if we reach the expected result, something built-in doing torrent like job or outside (if you look at https://github.com/Ayms/node-Tor#anonymous-serverless-p2p-inside-browsers---peersm-specs and https://github.com/Ayms/node-Tor#differences-with-bittorrent you have an example to achieve this without mimicing at all the bt protocol), bt looks a good candidate because it can be seeded by non btc peers (that have other things to do than serving files) and is widely deployed, but can be a mix of both, most likely the \"bootstrap\" blockchain would be divided in several well known \"torrents\", that can't be faked if we suppose that sha1 is not broken, and/or can be secure by other means than usual bt metadata, then why would it be needed to recheck them? I suppose this has already been studied/discussed\r\n\r\n",
      "created_at" : "2016-09-16T10:52:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8738#issuecomment-247572598",
      "id" : 247572598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8738",
      "updated_at" : "2016-09-16T12:32:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247572598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/759202?v=3",
         "events_url" : "https://api.github.com/users/Ayms/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Ayms/followers",
         "following_url" : "https://api.github.com/users/Ayms/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Ayms/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Ayms",
         "id" : 759202,
         "login" : "Ayms",
         "organizations_url" : "https://api.github.com/users/Ayms/orgs",
         "received_events_url" : "https://api.github.com/users/Ayms/received_events",
         "repos_url" : "https://api.github.com/users/Ayms/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Ayms/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Ayms/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Ayms"
      }
   }
]
