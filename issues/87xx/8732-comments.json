[
   {
      "body" : "I've consolidated the important info from the original issue here.\r\nAll from @laanwj \r\n\r\n--------\r\nTo see if I could reproduce I did this:\r\n\r\n- Create a brand-new Ubuntu Xenial (16.04) VM, from today's (2015-09-14) cloud image \r\n- Install the necessary dependencies, and build requirements from these documents:\r\n```\r\nsudo apt-get install g++-mingw-w64-i686 mingw-w64-i686-dev g++-mingw-w64-x86-64 mingw-w64-x86-64-dev curl\r\nsudo apt-get install build-essential libtool autotools-dev automake pkg-config libssl-dev libevent-dev bsdmainutils\r\n```\r\nWhile doing this I indeed saw some logging output about gcc alternatives: I wonder which one was selected by default. Apparently the -win32 variant, not the POSIX one.\r\n\r\n- Follow the instructions for building for windows 64-bit:\r\n```\r\n    cd depends\r\n    make HOST=x86_64-w64-mingw32 -j4\r\n    cd ..\r\n    ./autogen.sh\r\n    ./configure --prefix=`pwd`/depends/x86_64-w64-mingw32\r\n    make\r\n```\r\n- It fails with the following error, the same error that you get:\r\n```\r\n/usr/lib/gcc/x86_64-w64-mingw32/5.3-win32/include/c++/bits/unique_ptr.h:49:28: note: declared here\r\n   template<typename> class auto_ptr;\r\n                            ^\r\nhttpserver.cpp:69:10: error: Ã¢ÂÂmutexÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     std::mutex cs;\r\n          ^\r\nhttpserver.cpp:70:10: error: Ã¢ÂÂcondition_variableÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     std::condition_variable cond;\r\n```\r\n- I changed the alternatives to -posix under  `sudo update-alternatives --config ...` as suggested in this patch.\r\n- Cleaned and re-built bitcoin (but not the dependencies - maybe I should), and this time it passed.\r\n- Status (Windows 10):\r\n```\r\nbitcoin-test.exe: crashes on start\r\nbitcoin-qt.exe: crashes on start\r\nbitcoind.exe: seems to work, but throws bad_cast on exit\r\nbitcoin-cli.exe: seems to work, but cannot connect to server?\r\nbitcoin-tx.exe: seems to work\r\n```\r\n- Going to clean and re-build the dependencies, as well as bitcoin entirely *with the -posix compiler*.\r\n\r\n- This didn't change anything, still same status as above.\r\n\r\n-----\r\nOK I've done some research. In principle, `std::mutex` is supported in the -win32 compiler variant (which we've always used, and are using in Trusty). No POSIX emulation layer is needed for c++11 threads. However the problem with `<mutex>` and friends on newer Ubuntu's mingw-w64 seems to be the following:\r\n\r\n- Firstly, there is a `/usr/lib/gcc/x86_64-w64-mingw32/5.3-win32/include/c++/mutex`. However the definition of the actual class is guarded by `_GLIBCXX_HAS_GTHREADS`.\r\n- However it requires building glibcxx with a certain library (not to be confused with GLIB's \"libgthread\"):\r\n    - `_GLIBCXX_HAS_GTHREADS` is supposed to be defined in `/usr/lib/gcc/x86_64-w64-mingw32/5.3-win32/include/c++/x86_64-w64-mingw32/bits/c++config.h` when this has been done\r\n\r\nThis is an Ubuntu-specific problem: the \"gthreads\" (GCC threads) library is not linked into libcxx.\r\n\r\nOn Trusty this is not an issue as gthreads is provided:\r\n- `/usr/include/c++/4.8/x86_64-w64-mingw32/bits/c++config.h` defines `_GLIBCXX_HAS_GTHREADS`.\r\n\r\nThere is a https://github.com/meganz/mingw-std-threads which some people use to work around this problem. But in principle I think Ubuntu should solve this upstream.\r\n\r\n-----\r\nI have verified that after reverting the C++11 threads changes (https://github.com/laanwj/bitcoin/tree/2016_09_windows_hell), it builds normally with the default -win32 compiler. ~~`bitcoin-qt` then works, without having to disable hardening.~~\r\nFalse positive: I was building without wallet, with the wallet it still crashes. What a shit.\r\n\r\nHowever:\r\n- bitcoin-test.exe: crashes on start\r\n- bitcoin-qt.exe: crashes on start\r\n- bitcoind.exe: seems to work\r\n- bitcoin-cli.exe: seems to work, but cannot connect to server?\r\n- bitcoin-tx.exe: seems to work\r\n\r\n> The issue with bitcoin-cli looks like https://sourceforge.net/p/levent/bugs/363/ which is linked to mingw (but not its POSIX mode specifically)\r\n\r\nThis issue doesn't go away either, unfortunately.\r\n\r\n----\r\nLooks like `-fstack-protector-all` is the specific hardening flag that exposes problems. Apparently it affects use of BerkeleyDB and boost::test. The tests pass (at least in wine) without `--stack-protector-all`. It also makes Bitcoin-Qt with wallet start again. \r\n\r\nSo apparently there are three, at most tangentially related issues regarding Windows:\r\n\r\n- The `std::mutex` `std::condition_variable` etc problem on Ubuntu 15.10+. Can apparently be solved by enabling POSIX compatibility, or by using something like https://github.com/meganz/mingw-std-threads.\r\n\r\n- `-fstack-protector-all` issue (`-fstack-protector` doesn't have this problem, neither do the other hardening flags like nxcompat) - causes the tests to crash at startup (before even getting to our code in BasicTestingSetup!), as well as bitcoin-qt to crash at startup *if the wallet is enabled*.\r\n\r\n- libevent 'zu' header issue - causes bitcoin-cli and bitcoind to be unable to connect over RPC (which as mentioned by @sstone, looks like https://sourceforge.net/p/levent/bugs/363/) (fixed in #8730)\r\n\r\nI wonder when each of these issues started. My only recommendation for now is: **use an Ubuntu Trusty VM for windows cross-compilation**\r\n",
      "created_at" : "2016-10-08T09:10:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-252413423",
      "id" : 252413423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2016-10-08T09:10:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/252413423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "Hello. Just FYI, I stumbled upon this while tinkering with some stuff. Ubuntu 16.10 (I don't think anybody has mentioned this version yet) has the same mutex issues when building. Man, what a mess....",
      "created_at" : "2016-12-24T22:36:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-269102918",
      "id" : 269102918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2016-12-24T22:36:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/269102918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5931802?v=3",
         "events_url" : "https://api.github.com/users/droark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/droark/followers",
         "following_url" : "https://api.github.com/users/droark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/droark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/droark",
         "id" : 5931802,
         "login" : "droark",
         "organizations_url" : "https://api.github.com/users/droark/orgs",
         "received_events_url" : "https://api.github.com/users/droark/received_events",
         "repos_url" : "https://api.github.com/users/droark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/droark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/droark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/droark"
      }
   },
   {
      "body" : "Is there a workaround for the following error?\r\nIs there a workaround for the following error?\r\nIs there a workaround for the following error?\r\n\r\n\r\nIn file included from support/allocators/secure.h:9:0,\r\n                 from key.h:11,\r\n                 from base58.h:18,\r\n                 from httprpc.cpp:7:\r\n./support/lockedpool.h:195:18: error: Ã¢ÂÂmutexÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     mutable std::mutex mutex;\r\n                  ^\r\n./support/lockedpool.h:228:17: error: Ã¢ÂÂonce_flagÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     static std::once_flag init_flag;\r\n                 ^\r\n./support/lockedpool.h: In static member function Ã¢ÂÂstatic LockedPoolManager& LockedPoolManager::Instance()Ã¢ÂÂ:\r\n./support/lockedpool.h:215:9: error: Ã¢ÂÂcall_onceÃ¢ÂÂ is not a member of Ã¢ÂÂstdÃ¢ÂÂ\r\n         std::call_once(LockedPoolManager::init_flag, LockedPoolManager::CreateInstance);\r\n         ^\r\n./support/lockedpool.h:215:24: error: Ã¢ÂÂinit_flagÃ¢ÂÂ is not a member of Ã¢ÂÂLockedPoolManagerÃ¢ÂÂ\r\n         std::call_once(LockedPoolManager::init_flag, LockedPoolManager::CreateInstance);\r\n",
      "created_at" : "2017-06-14T02:12:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-308299583",
      "id" : 308299583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-06-14T02:12:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308299583",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/4187912?v=3",
         "events_url" : "https://api.github.com/users/moonss777/events{/privacy}",
         "followers_url" : "https://api.github.com/users/moonss777/followers",
         "following_url" : "https://api.github.com/users/moonss777/following{/other_user}",
         "gists_url" : "https://api.github.com/users/moonss777/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/moonss777",
         "id" : 4187912,
         "login" : "moonss777",
         "organizations_url" : "https://api.github.com/users/moonss777/orgs",
         "received_events_url" : "https://api.github.com/users/moonss777/received_events",
         "repos_url" : "https://api.github.com/users/moonss777/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/moonss777/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/moonss777/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/moonss777"
      }
   },
   {
      "body" : "I have same problem!",
      "created_at" : "2017-08-21T12:24:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-323730734",
      "id" : 323730734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-08-21T12:24:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/323730734",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2098466?v=4",
         "events_url" : "https://api.github.com/users/eMosbat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eMosbat/followers",
         "following_url" : "https://api.github.com/users/eMosbat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eMosbat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eMosbat",
         "id" : 2098466,
         "login" : "eMosbat",
         "organizations_url" : "https://api.github.com/users/eMosbat/orgs",
         "received_events_url" : "https://api.github.com/users/eMosbat/received_events",
         "repos_url" : "https://api.github.com/users/eMosbat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eMosbat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eMosbat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eMosbat"
      }
   },
   {
      "body" : "I re-tested cross-depends build with the most recent Ubuntu at this time (17.04, Zesty):\r\n\r\n- Had to select the 'posix' variant, to prevent errors about `std::mutex`. It looks like mingw-w64, as of 6.2.1, still has no `std::mutex` implementation for win32 threads.\r\n```\r\nsudo update-alternatives --config x86_64-w64-mingw32-g++\r\nsudo update-alternatives --config x86_64-w64-mingw32-gcc\r\n```\r\n- All depends, as well as the whole project built without errors.\r\n- `test_bitcoin.exe` runs successfully with default hardening settings, all tests pass\r\n- `bitcoin-qt.exe` runs successfully, gets synchronizing\r\n\r\nSo good news: the problem I've reported here is gone with newest Ubuntu. I haven't tried any other versions, but clearly 16.04 (and possible 16.10) was a dud in this regard.\r\n\r\nWe should update `build-windows.md` as such, and add the part about POSIX alternatives from #8653 (but not recommend `--disable-hardening`!).",
      "created_at" : "2017-08-26T08:41:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-325103511",
      "id" : 325103511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-08-26T08:45:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/325103511",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "So TL;DR. **Do not use Ubuntu 16.04 for cross-building Bitcoin Core to Windows** (reflected in build guide since #11119) use:\r\n- 14.04 (recommended, gitian does this - no need to set alternatives)\r\n- 17.04 (as tested above - need to set alternatives to posix)\r\n\r\nThis will likely never change. Ubuntu doesn't make major changes to compiler versions after the fact, even with compiler bugs like this. With this, I'm closing project https://github.com/bitcoin/bitcoin/projects/1 (but leaving this issue open, as will remain an issue).\r\n",
      "created_at" : "2017-08-26T09:03:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-325105430",
      "id" : 325105430,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-08-26T10:47:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/325105430",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I've actually got that problem compiling 0.14 on 32-bit on Ubuntu 17.04 running in Linux Subsystem for Windows, the issue was present in 16.04 so I upgraded and switched to gcc and gcc POSIX alternatives. Recompiled deps and run make clean but compiling still gives the following error.\r\n```\r\nIn file included from support/allocators/secure.h:9:0,\r\n                 from key.h:13,\r\n                 from base58.h:21,\r\n                 from alert.cpp:11:\r\n./support/lockedpool.h:195:18: error: Ã¢ÂÂmutexÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     mutable std::mutex mutex;\r\n                  ^~~~~\r\n./support/lockedpool.h:228:17: error: Ã¢ÂÂonce_flagÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     static std::once_flag init_flag;\r\n                 ^~~~~~~~~\r\n./support/lockedpool.h: In static member function Ã¢ÂÂstatic LockedPoolManager& LockedPoolManager::Instance()Ã¢ÂÂ:\r\n./support/lockedpool.h:215:9: error: Ã¢ÂÂcall_onceÃ¢ÂÂ is not a member of Ã¢ÂÂstdÃ¢ÂÂ\r\n         std::call_once(LockedPoolManager::init_flag, LockedPoolManager::CreateInstance);\r\n         ^~~\r\n./support/lockedpool.h:215:24: error: Ã¢ÂÂinit_flagÃ¢ÂÂ is not a member of Ã¢ÂÂLockedPoolManagerÃ¢ÂÂ\r\n         std::call_once(LockedPoolManager::init_flag, LockedPoolManager::CreateInstance);\r\n```\r\nTo build everything...\r\n```\r\n    export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games\r\n    cd depends\r\n    make HOST=i686-w64-mingw32 V=1 -j4 AUTOCONF=: AUTOHEADER=: AUTOMAKE=: ACLOCAL=:\r\n    cd ..\r\n    ./autogen.sh\r\n    ./configure --prefix=`pwd`/depends/i686-w64-mingw32 --with-miniupnpc --with-qrencode --disable-tests --disable-gui-tests --disable-dependency-tracking --disable-bench\r\n    make\r\n```\r\ngcc version output.\r\n```\r\ngcc -v\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/6/lto-wrapper\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 6.3.0-12ubuntu2' --with-bugurl=file:///usr/share/doc/gcc-6/README.Bugs --enable-languages=c,ada,c++,java,go,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-6 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --disable-browser-plugin --enable-java-awt=gtk --enable-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-6-amd64/jre --enable-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-6-amd64 --with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-6-amd64 --with-arch-directory=amd64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 6.3.0 20170406 (Ubuntu 6.3.0-12ubuntu2)\r\n```\r\nI'll just go use 14.04 for now, I seem to be the odd one out having this with 32-bit.",
      "created_at" : "2017-09-16T16:21:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-329978468",
      "id" : 329978468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-09-17T08:31:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329978468",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/5293433?v=4",
         "events_url" : "https://api.github.com/users/Bushstar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Bushstar/followers",
         "following_url" : "https://api.github.com/users/Bushstar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Bushstar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Bushstar",
         "id" : 5293433,
         "login" : "Bushstar",
         "organizations_url" : "https://api.github.com/users/Bushstar/orgs",
         "received_events_url" : "https://api.github.com/users/Bushstar/received_events",
         "repos_url" : "https://api.github.com/users/Bushstar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Bushstar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Bushstar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Bushstar"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Had to select the 'posix' variant, to prevent errors about std::mutex. It looks like mingw-w64, as of 6.2.1, still has no std::mutex implementation for win32 threads.\r\n\r\nIt might be worth noting that the mingw-w64 win32 compiler option will probably never work with std::mutex etc, at least not without adding workarounds to the bitcoin source code.\r\n\r\nThe mingw-w64 win32 option was added to allow the Win32 thread API to be used instead of the winpthread wrapper library. I assume because the performance of using the Win32 threading API directly was significant enough to go to all the hassle of creating two different mingw-w64 cross compilers.\r\n\r\nThe problem for bitcoin is that the std::mutex etc decalrations have been excluded from the mingw-w64 headers via a pre-processor directive when using the mingw-w64 win32 cross compiler because they conflict with Win32 thread headers.\r\n\r\nThe fix is simply to set the default mingw-w64 cross compiler to posix as per the command mentioned previously:\r\n\r\n> sudo update-alternatives --config x86_64-w64-mingw32-g++\r\n\r\nIt'd be super if that single got added to the build-windows.md file to save a lot of frustration for people building on Windows Subsystem for Linux (which most Windows devs will now be doing since it's so handy).",
      "created_at" : "2017-09-29T12:54:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333118448",
      "id" : 333118448,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-09-29T12:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333118448",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/197660?v=4",
         "events_url" : "https://api.github.com/users/sipsorcery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipsorcery/followers",
         "following_url" : "https://api.github.com/users/sipsorcery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipsorcery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipsorcery",
         "id" : 197660,
         "login" : "sipsorcery",
         "organizations_url" : "https://api.github.com/users/sipsorcery/orgs",
         "received_events_url" : "https://api.github.com/users/sipsorcery/received_events",
         "repos_url" : "https://api.github.com/users/sipsorcery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipsorcery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipsorcery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipsorcery"
      }
   }
]
