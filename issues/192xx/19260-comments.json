[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. There shouldn't be a reason for a node to send filterclear when we haven't offered them bloom services to them.\r\n\r\nSee also BIP 111: \r\n\r\n> If a node does not support bloom filters but receives a \"filterload\", \"filteradd\", or \"filterclear\" message from a peer the node should disconnect that peer immediately\r\n\r\nhttps://github.com/bitcoin/bips/blob/master/bip-0111.mediawiki\r\n\r\nnit: I think this is a good opportunity to move the disconnect handling of `NetMsgType::FILTERLOAD` and ` NetMsgType::FILTERADD` into the respective scope of the switch statement instead of having it at the top of the function, disconnected from the actual filter message handling.",
      "created_at" : "2020-06-12T18:25:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-643422188",
      "id" : 643422188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19260",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzQyMjE4OA==",
      "updated_at" : "2020-06-12T18:25:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643422188",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439644235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439644235"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This code block is repeated 3 times and bloats the `ProcessMessage` function. Would a helper function like `MaybePunishNodeForBloom` be appropriate or is this fine?",
      "commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "created_at" : "2020-06-12T21:11:59Z",
      "diff_hunk" : "@@ -3447,6 +3433,16 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     }\n \n     if (msg_type == NetMsgType::FILTERLOAD) {\n+        if (!(pfrom.GetLocalServices() & NODE_BLOOM)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439644235",
      "id" : 439644235,
      "line" : 3436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY0NDIzNQ==",
      "original_commit_id" : "8207e3b7e34758255149805b609752727a3a0a96",
      "original_line" : 3436,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 25,
      "pull_request_review_id" : 430040270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-13T18:59:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439644235",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439701965"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439701965"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, but I think you can also just reduce the complexity here. I don't think there's any benefit to calling `Misbehaving()` on a peer that sends us a `FILTER*` message. Calling `Misbehaving(100)` results in us disconnecting the peer and then marking it discouraged (see #19219). Discouragement is a mechanism to prevent our limited connection slots being used up by incompatible or broken peers.\r\n\r\nSo I think we should just set `fDisconnect` for any peer that sends us a `FILTER*` message when we don't have `NODE_BLOOM` enabled, regardless of their version number.",
      "commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "created_at" : "2020-06-13T02:39:41Z",
      "diff_hunk" : "@@ -3447,6 +3433,16 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     }\n \n     if (msg_type == NetMsgType::FILTERLOAD) {\n+        if (!(pfrom.GetLocalServices() & NODE_BLOOM)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439701965",
      "id" : 439701965,
      "in_reply_to_id" : 439644235,
      "line" : 3436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwMTk2NQ==",
      "original_commit_id" : "8207e3b7e34758255149805b609752727a3a0a96",
      "original_line" : 3436,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 25,
      "pull_request_review_id" : 430107188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-13T18:59:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439701965",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19252 (test: wait for disconnect in disconnect_p2ps + bloomfilter test followups by gzhao408)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-13T02:50:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-643557995",
      "id" : 643557995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19260",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzU1Nzk5NQ==",
      "updated_at" : "2020-06-14T04:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643557995",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439732937"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439732937"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In theory it is possible to set `-banscore=101` to not disconnect a 100-misbehaving peer. Though, that would only kick down the can by one more message. I can't see a use case for that and encouraging users to change banscore to accomodate misbehaving light clients seems ill-advised. So I agree with the suggestion made by @jnewbery (simply make an fDisconnect)",
      "commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "created_at" : "2020-06-13T11:46:46Z",
      "diff_hunk" : "@@ -3447,6 +3433,16 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     }\n \n     if (msg_type == NetMsgType::FILTERLOAD) {\n+        if (!(pfrom.GetLocalServices() & NODE_BLOOM)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439732937",
      "id" : 439732937,
      "in_reply_to_id" : 439644235,
      "line" : 3436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczMjkzNw==",
      "original_commit_id" : "8207e3b7e34758255149805b609752727a3a0a96",
      "original_line" : 3436,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 25,
      "pull_request_review_id" : 430133747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-13T18:59:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439732937",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439744787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439744787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We should remove `-banscore` entirely. It's not useful user configuration.",
      "commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "created_at" : "2020-06-13T14:50:39Z",
      "diff_hunk" : "@@ -3447,6 +3433,16 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     }\n \n     if (msg_type == NetMsgType::FILTERLOAD) {\n+        if (!(pfrom.GetLocalServices() & NODE_BLOOM)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439744787",
      "id" : 439744787,
      "in_reply_to_id" : 439644235,
      "line" : 3436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDc4Nw==",
      "original_commit_id" : "8207e3b7e34758255149805b609752727a3a0a96",
      "original_line" : 3436,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 25,
      "pull_request_review_id" : 430144399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-13T18:59:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439744787",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439765489"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439765489"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the suggestion! I've updated it but I think Travis timed out on one of the builds.",
      "commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "created_at" : "2020-06-13T20:05:15Z",
      "diff_hunk" : "@@ -3447,6 +3433,16 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     }\n \n     if (msg_type == NetMsgType::FILTERLOAD) {\n+        if (!(pfrom.GetLocalServices() & NODE_BLOOM)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439765489",
      "id" : 439765489,
      "in_reply_to_id" : 439644235,
      "line" : 3436,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2NTQ4OQ==",
      "original_commit_id" : "8207e3b7e34758255149805b609752727a3a0a96",
      "original_line" : 3436,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 25,
      "pull_request_review_id" : 430162813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-13T20:05:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439765489",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/gzhao408/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gzhao408/followers",
         "following_url" : "https://api.github.com/users/gzhao408/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gzhao408/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gzhao408",
         "id" : 25183001,
         "login" : "gzhao408",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/gzhao408/orgs",
         "received_events_url" : "https://api.github.com/users/gzhao408/received_events",
         "repos_url" : "https://api.github.com/users/gzhao408/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gzhao408/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gzhao408/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gzhao408"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc\r\n\r\nGreat tidy-up. Thanks Gloria!",
      "created_at" : "2020-06-14T00:42:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-643701023",
      "id" : 643701023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19260",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzcwMTAyMw==",
      "updated_at" : "2020-06-14T00:42:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643701023",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 18a2e0a\r\n\r\nI was somewhat confused by the last commit, because the description of the PR is about `filterclear`, but the last commit has absolutely nothing to do with `filterclear`.\r\nNot sure if we want to do anything about it :)",
      "created_at" : "2020-06-14T07:35:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#issuecomment-643730843",
      "id" : 643730843,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19260",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzczMDg0Mw==",
      "updated_at" : "2020-06-14T07:36:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643730843",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439828128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439828128"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 294b96772b7d184a0cd6f56bd76ef118f4c78cc6:\r\n\r\nAny reason to return false here? The only effect is that it will log a line with `FAILED` with the NET debug category. However, it should be pretty clear from the log already that receiving a filterclear message and then disconnecting a peer means the message was ignored.",
      "commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "created_at" : "2020-06-14T13:05:22Z",
      "diff_hunk" : "@@ -3490,13 +3490,15 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     }\n \n     if (msg_type == NetMsgType::FILTERCLEAR) {\n+        if (!(pfrom.GetLocalServices() & NODE_BLOOM)) {\n+            pfrom.fDisconnect = true;\n+            return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439828128",
      "id" : 439828128,
      "line" : 3489,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgyODEyOA==",
      "original_commit_id" : "294b96772b7d184a0cd6f56bd76ef118f4c78cc6",
      "original_line" : 3495,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 49,
      "pull_request_review_id" : 430217721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-14T13:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439828128",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439828305"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439828305"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc:\r\n\r\nSame",
      "commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "created_at" : "2020-06-14T13:07:37Z",
      "diff_hunk" : "@@ -3466,6 +3456,10 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     }\n \n     if (msg_type == NetMsgType::FILTERADD) {\n+        if (!(pfrom.GetLocalServices() & NODE_BLOOM)) {\n+            pfrom.fDisconnect = true;\n+            return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439828305",
      "id" : 439828305,
      "line" : 3461,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgyODMwNQ==",
      "original_commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "original_line" : 3461,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 38,
      "pull_request_review_id" : 430217721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-14T13:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439828305",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439832289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439832289"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was confused here too, but it seems like this is a common thing to do. Many occurences of \r\n``\r\n             pfrom.fDisconnect = true;\r\n            return false; \r\n``",
      "commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "created_at" : "2020-06-14T13:53:37Z",
      "diff_hunk" : "@@ -3490,13 +3490,15 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     }\n \n     if (msg_type == NetMsgType::FILTERCLEAR) {\n+        if (!(pfrom.GetLocalServices() & NODE_BLOOM)) {\n+            pfrom.fDisconnect = true;\n+            return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439832289",
      "id" : 439832289,
      "in_reply_to_id" : 439828128,
      "line" : 3489,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzMjI4OQ==",
      "original_commit_id" : "294b96772b7d184a0cd6f56bd76ef118f4c78cc6",
      "original_line" : 3495,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 49,
      "pull_request_review_id" : 430221299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-14T13:53:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439832289",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439833059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439833059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The majority of disconnects is followed by a `return true;`. The ones that don't should be changed too. And longer term the return value should be removed completely.",
      "commit_id" : "18a2e0a3f7071b8df6b20ecc1b34b3f2abb13cfc",
      "created_at" : "2020-06-14T14:02:09Z",
      "diff_hunk" : "@@ -3490,13 +3490,15 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     }\n \n     if (msg_type == NetMsgType::FILTERCLEAR) {\n+        if (!(pfrom.GetLocalServices() & NODE_BLOOM)) {\n+            pfrom.fDisconnect = true;\n+            return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19260#discussion_r439833059",
      "id" : 439833059,
      "in_reply_to_id" : 439828128,
      "line" : 3489,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzMzA1OQ==",
      "original_commit_id" : "294b96772b7d184a0cd6f56bd76ef118f4c78cc6",
      "original_line" : 3495,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 49,
      "pull_request_review_id" : 430221975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19260",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-14T14:02:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439833059",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
