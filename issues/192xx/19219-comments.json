[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437267147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437267147"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A comment on the choice of nElements and nFPRate may be good here. These are the same as for `filterInventoryKnown`.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T09:23:00Z",
      "diff_hunk" : "@@ -68,6 +77,7 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+    CRollingBloomFilter m_discouraged{50000, 0.000001};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437267147",
      "id" : 437267147,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI2NzE0Nw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 80,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 426954204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437267147",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437417403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437417403"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n     BOOST_CHECK_EQUAL(1, banman->IsBannedLevel(addr));\r\n```\r\n\r\nnit (feel free to ignore, ofc): Could add a test for `IsBannedLevel`?",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T13:29:44Z",
      "diff_hunk" : "@@ -346,12 +346,6 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     }\n     BOOST_CHECK(banman->IsBanned(addr));\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437417403",
      "id" : 437417403,
      "line" : 348,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQxNzQwMw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 348,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 70,
      "pull_request_review_id" : 427144790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437417403",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "created_at" : "2020-06-09T14:08:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641322171",
      "id" : 641322171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTMyMjE3MQ==",
      "updated_at" : "2020-06-09T14:08:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641322171",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@luke-jr I don't think that's necessary. They (by default) have a 24 hour limit only, and during that time, they will just be treated as a real ban instead of a discouragement.",
      "created_at" : "2020-06-09T14:52:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641349507",
      "id" : 641349507,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTM0OTUwNw==",
      "updated_at" : "2020-06-09T14:53:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641349507",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437648963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437648963"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "it feels a bit odd to treat what is essentially an enum (0/1/2) as an int like this, suggest replacing with a conditional returning 1/0 explicitly",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T18:55:10Z",
      "diff_hunk" : "@@ -72,27 +72,26 @@ int BanMan::IsBannedLevel(CNetAddr net_addr)\n {\n     // Returns the most severe level of banning that applies to this address.\n     // 0 - Not banned\n-    // 1 - Automatic misbehavior ban\n+    // 1 - Discouraged because of misbehavior\n     // 2 - Any other ban\n-    int level = 0;\n     auto current_time = GetTime();\n     LOCK(m_cs_banned);\n     for (const auto& it : m_banned) {\n         CSubNet sub_net = it.first;\n         CBanEntry ban_entry = it.second;\n \n         if (current_time < ban_entry.nBanUntil && sub_net.Match(net_addr)) {\n-            if (ban_entry.banReason != BanReasonNodeMisbehaving) return 2;\n-            level = 1;\n+            return 2;\n         }\n     }\n-    return level;\n+    return m_discouraged.contains(net_addr.GetAddrBytes());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437648963",
      "id" : 437648963,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY0ODk2Mw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 87,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 427451155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437648963",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437731526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437731526"
         }
      },
      "author_association" : "NONE",
      "body" : "Looks like `ClearBanned()` should call `m_discouraged.reset()` otherwise the `clearbanned` RPC no longer does what users expect.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T21:25:12Z",
      "diff_hunk" : "@@ -45,10 +46,18 @@ class BanMan\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n     void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n     void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Discourage(const CNetAddr& net_addr);\n     void ClearBanned();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437731526",
      "id" : 437731526,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczMTUyNg==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 65,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 66,
      "pull_request_review_id" : 427556815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437731526",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/602513?v=4",
         "events_url" : "https://api.github.com/users/jasonbcox/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jasonbcox/followers",
         "following_url" : "https://api.github.com/users/jasonbcox/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jasonbcox/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jasonbcox",
         "id" : 602513,
         "login" : "jasonbcox",
         "node_id" : "MDQ6VXNlcjYwMjUxMw==",
         "organizations_url" : "https://api.github.com/users/jasonbcox/orgs",
         "received_events_url" : "https://api.github.com/users/jasonbcox/received_events",
         "repos_url" : "https://api.github.com/users/jasonbcox/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jasonbcox/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jasonbcox/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jasonbcox"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437734287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437734287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I considered that, but I think it would be counterintuitive. Discouragement isn't exposed as bans (it's not visible or accessible in RPCs or UI) as it's a completely automatic process, so I think that exposing a way to clear it would violate that abstraction.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T21:31:11Z",
      "diff_hunk" : "@@ -45,10 +46,18 @@ class BanMan\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n     void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n     void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Discourage(const CNetAddr& net_addr);\n     void ClearBanned();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437734287",
      "id" : 437734287,
      "in_reply_to_id" : 437731526,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczNDI4Nw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 65,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 66,
      "pull_request_review_id" : 427560239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437734287",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437736947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437736947"
         }
      },
      "author_association" : "NONE",
      "body" : "I see. The current implementation may introduce subtle bugs then, especially considering that `IsBanned()` is now unintuitively named. `setban \"someIP\" \"add\"` may return `Error: IP/Subnet already banned` for instance.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T21:37:10Z",
      "diff_hunk" : "@@ -45,10 +46,18 @@ class BanMan\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n     void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n     void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Discourage(const CNetAddr& net_addr);\n     void ClearBanned();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437736947",
      "id" : 437736947,
      "in_reply_to_id" : 437731526,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczNjk0Nw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 65,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 66,
      "pull_request_review_id" : 427563645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437736947",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/602513?v=4",
         "events_url" : "https://api.github.com/users/jasonbcox/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jasonbcox/followers",
         "following_url" : "https://api.github.com/users/jasonbcox/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jasonbcox/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jasonbcox",
         "id" : 602513,
         "login" : "jasonbcox",
         "node_id" : "MDQ6VXNlcjYwMjUxMw==",
         "organizations_url" : "https://api.github.com/users/jasonbcox/orgs",
         "received_events_url" : "https://api.github.com/users/jasonbcox/received_events",
         "repos_url" : "https://api.github.com/users/jasonbcox/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jasonbcox/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jasonbcox/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jasonbcox"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437744807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437744807"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this have a `GUARDED_BY(m_cs_banned)` lock annotation?",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T21:55:44Z",
      "diff_hunk" : "@@ -68,6 +77,7 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+    CRollingBloomFilter m_discouraged{50000, 0.000001};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437744807",
      "id" : 437744807,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0NDgwNw==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 80,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 427573509,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437744807",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772412"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok, added an explicit `? 1 : 0`.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T23:13:12Z",
      "diff_hunk" : "@@ -72,27 +72,26 @@ int BanMan::IsBannedLevel(CNetAddr net_addr)\n {\n     // Returns the most severe level of banning that applies to this address.\n     // 0 - Not banned\n-    // 1 - Automatic misbehavior ban\n+    // 1 - Discouraged because of misbehavior\n     // 2 - Any other ban\n-    int level = 0;\n     auto current_time = GetTime();\n     LOCK(m_cs_banned);\n     for (const auto& it : m_banned) {\n         CSubNet sub_net = it.first;\n         CBanEntry ban_entry = it.second;\n \n         if (current_time < ban_entry.nBanUntil && sub_net.Match(net_addr)) {\n-            if (ban_entry.banReason != BanReasonNodeMisbehaving) return 2;\n-            level = 1;\n+            return 2;\n         }\n     }\n-    return level;\n+    return m_discouraged.contains(net_addr.GetAddrBytes());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772412",
      "id" : 437772412,
      "in_reply_to_id" : 437648963,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MjQxMg==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 87,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/banman.cpp",
      "position" : null,
      "pull_request_review_id" : 427607249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772412",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772571"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772571"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice catch. I've addressed it by adding a separate `IsBannedOrDiscouraged` that's distinct from `IsBanned`.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T23:13:40Z",
      "diff_hunk" : "@@ -45,10 +46,18 @@ class BanMan\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n     void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n     void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Discourage(const CNetAddr& net_addr);\n     void ClearBanned();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772571",
      "id" : 437772571,
      "in_reply_to_id" : 437731526,
      "line" : 65,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MjU3MQ==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 65,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 66,
      "pull_request_review_id" : 427607453,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772571",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772648"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-09T23:13:49Z",
      "diff_hunk" : "@@ -68,6 +77,7 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+    CRollingBloomFilter m_discouraged{50000, 0.000001};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r437772648",
      "id" : 437772648,
      "in_reply_to_id" : 437744807,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MjY0OA==",
      "original_commit_id" : "4c4df6bf61104a4946479fccc7885dc0fe05dbd8",
      "original_line" : 80,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 427607511,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437772648",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This seems like an improvement, but it leaves the `BanMan` with a slightly odd and inconsistent interface:\r\n\r\n- `Ban()` has an enum as its second parameter, but that parameter is only ever set to `BanReasonManuallyAdded`\r\n- If `IsBanned()` is called with an address, it returns whether an address is discouraged or banned. If it's called with a subnet, it returns if it's banned, but not discouraged.\r\n- `Unban()` won't remove a discouraged address from banman, but it's not possible to add an outbound connection to that address with `addnode onetry`.\r\n- `ClearBanned()` (which is called by the `clearban` RPC (\"Clear all banned IPs\")) doesn't clear discouraged addresses.\r\n- The `listbanned` RPC returns a `ban_reason`, which can only ever be \"manually added\". (`banReasonToString()` is basically dead code now).\r\n\r\nIt'd be nice to rationalize this so BanMan just had a setter `SetBanLevel()` function and a getter `GetBanLevel()` function.",
      "created_at" : "2020-06-10T00:08:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641643725",
      "id" : 641643725,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTY0MzcyNQ==",
      "updated_at" : "2020-06-10T00:08:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641643725",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery Most of those things are no longer true, apart from the BanReason being superfluous now (there is a separate IsBannedOrDiscouraged). I think a follow-up can remove BanReason altogether, but I think it's preferable to not have a SetBanLevel - discouragement and banning are very different concepts (and it wouldn't be unreasonable to move discouragement elsewhere entirely).",
      "created_at" : "2020-06-10T00:12:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641644913",
      "id" : 641644913,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTY0NDkxMw==",
      "updated_at" : "2020-06-10T00:14:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641644913",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19243 (banman: Limit resources consumed by misbehaving node deprioitisation by luke-jr)\n* #19222 (tests: Add fuzzing harness for BanMan by practicalswift)\n* #19174 (refactor: replace CConnman/BanMan pointers by references in net_processing.cpp by theStack)\n* #19099 (refactor: Move wallet methods out of chain.h and node.h by ryanofsky)\n* #19098 (test: Remove duplicate NodeContext hacks by ryanofsky)\n* #18531 (rpc: Assert that RPCArg names are equal to CRPCCommand ones by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-10T01:24:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641664852",
      "id" : 641664852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTY2NDg1Mg==",
      "updated_at" : "2020-06-13T03:07:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641664852",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2020-06-10T13:13:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-641999691",
      "id" : 641999691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTk5OTY5MQ==",
      "updated_at" : "2020-06-10T13:13:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641999691",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jnewbery agreed that the interface is a little odd now but think that should be dealt with in a separate pr",
      "created_at" : "2020-06-10T18:12:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642175291",
      "id" : 642175291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjE3NTI5MQ==",
      "updated_at" : "2020-06-10T18:12:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642175291",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "You really should add a benchmark for this..",
      "created_at" : "2020-06-10T18:56:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642196131",
      "id" : 642196131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjE5NjEzMQ==",
      "updated_at" : "2020-06-10T18:56:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642196131",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "What happens if someone floods the filter with a big block of 1 million IPv6 addresses? ",
      "created_at" : "2020-06-10T19:20:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642207388",
      "id" : 642207388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIwNzM4OA==",
      "updated_at" : "2020-06-10T19:20:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642207388",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rolling Bloom filters only keep the last N elements added; 50000 in this case. Their performance is not affected by how many elements are kept.\n\nSo worst case, being flooded with IPs would reduce the effectiveness of the filter in keeping broken peers out.",
      "created_at" : "2020-06-10T19:33:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642213438",
      "id" : 642213438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIxMzQzOA==",
      "updated_at" : "2020-06-10T19:35:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642213438",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Right, so you can flood the filter with even something like 150k inserts, saturate it to always return false positive, and then all peers are \"equally discouraged\" (meaning you have no ban policy anymore)....\r\n",
      "created_at" : "2020-06-10T19:43:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642218185",
      "id" : 642218185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIxODE4NQ==",
      "updated_at" : "2020-06-10T19:43:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642218185",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "No, the false positive rate never goes above the specified one (0.000001 in this case). The rolling aspect discards old entries.",
      "created_at" : "2020-06-10T19:45:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642219432",
      "id" : 642219432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIxOTQzMg==",
      "updated_at" : "2020-06-10T19:45:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642219432",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@cculianu - I suggest you take a look at the `CRollingBloomFilter` implementation. The rolling bloom filter is actually multiple generations of bloom filters, so you can't saturate it by adding many entries. It'll just discard the oldest generation when it reaches (max entries * 3/2).",
      "created_at" : "2020-06-10T19:47:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642220132",
      "id" : 642220132,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIyMDEzMg==",
      "updated_at" : "2020-06-10T19:47:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642220132",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Indeed, thanks for the explanation.",
      "created_at" : "2020-06-10T20:20:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642235845",
      "id" : 642235845,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjIzNTg0NQ==",
      "updated_at" : "2020-06-10T20:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642235845",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Ok, so basically:\r\n\r\n- this is as if you had a typical hash table implementation clamped to 75k most recent entries\r\n- but it has no ability to unban\r\n- it only eats about 67k memory\r\n- small tiny chance of false positives.\r\n- slightly slower insertions and lookups than a hash table, but not monstrously so.\r\n\r\nGot it.  Thanks.\r\n",
      "created_at" : "2020-06-10T20:39:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642245289",
      "id" : 642245289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI0NTI4OQ==",
      "updated_at" : "2020-06-10T20:39:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642245289",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@cculianu Indeed. Your numbers are a bit off: it only guarantees 50000 entries (it keeps up to 75000, but the last 25000 are removed whenever that number is exceeded). It also uses around 528 KiB (at an fprate of 1/1000000).",
      "created_at" : "2020-06-10T20:44:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642247743",
      "id" : 642247743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI0Nzc0Mw==",
      "updated_at" : "2020-06-10T20:44:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642247743",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Oh right.. it's 67k uint64's -> 528KiB.  My bad.\r\n\r\nHmm.  For ~800KiB you could have just implemented a regular hash table (std::unordered_map, etc) or a std::unordered_set, clamped it to 50k items, and then had the ability to query it, iterate over it, show it in the UI, and/or remove individual items.\r\n",
      "created_at" : "2020-06-10T20:49:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642250414",
      "id" : 642250414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI1MDQxNA==",
      "updated_at" : "2020-06-10T20:49:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642250414",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@cculianu Yeah, we do have a limitedmap data structure that implements effectively that. Its memory usage is significantly worse though (because every entry in the map needs several pointers, plus dynamic allocation overhead). If I recall the number correctly it would be 4 MiB at least for 50000 entries.",
      "created_at" : "2020-06-10T20:53:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642252444",
      "id" : 642252444,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI1MjQ0NA==",
      "updated_at" : "2020-06-10T20:53:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642252444",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I'm aware of that data structure but it's not a hash table, it's a red-black tree based map, which also stores a reverse-map as well.  It's not very efficient for this situation...\r\n\r\nYou can probably get away with just a straight hash table (unordered_map) with some wrapper that periodically sweeps it to clamp it to some max size -- probably just remove the oldest entries by creation time.  While not ideal, it has some advantages -- namely being able to remove from the set... and blazing fast lookups.  \r\n\r\nI guess it's your call -- you either pay the memory and upkeep costs and preserve the facility of a traditional ban list and save a few cycles on lookups -- or you toss that aside and maintain a bloom set and redefine the semantics of banning (which is already happening anyway)...",
      "created_at" : "2020-06-10T21:33:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642279750",
      "id" : 642279750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI3OTc1MA==",
      "updated_at" : "2020-06-10T21:33:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642279750",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/266627?v=4",
         "events_url" : "https://api.github.com/users/cculianu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cculianu/followers",
         "following_url" : "https://api.github.com/users/cculianu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cculianu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cculianu",
         "id" : 266627,
         "login" : "cculianu",
         "node_id" : "MDQ6VXNlcjI2NjYyNw==",
         "organizations_url" : "https://api.github.com/users/cculianu/orgs",
         "received_events_url" : "https://api.github.com/users/cculianu/received_events",
         "repos_url" : "https://api.github.com/users/cculianu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cculianu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cculianu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cculianu"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Hash table or red-black tree doesn't matter much. It's (table size + 2 pointers + alloc overhead per entry) or (3 pointers + 1 int + alloc overhead per entry), and in both cases you need a way to iterate efficiently in order of insertion (either through a separate map like limitedmap does, or by doubly-linking the elements together like is supported by boost::multi_index). Even if you don't do that and just occasionally sweep, you need to keep track of insertion time per item, and the allocation overheads don't go away.\r\n\r\nIn either case, the overhead is much larger than a rolling bloom filter, and as you say - changes to the semantics of auto banned items are happening anyway.",
      "created_at" : "2020-06-10T21:38:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642281599",
      "id" : 642281599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjI4MTU5OQ==",
      "updated_at" : "2020-06-10T21:39:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642281599",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 4131caf2431054adf9ad6641386dfbe922af0dc5",
      "created_at" : "2020-06-10T23:51:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642324926",
      "id" : 642324926,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjMyNDkyNg==",
      "updated_at" : "2020-06-10T23:51:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642324926",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've made a few changes suggested by @jnewbery. The PR is now split into two commits:\r\n* The first is a minimal change that implements the new behavior (smaller than the previous PR), plus release notes and RPC documentation changes.\r\n* The seconds makes the distinction between discouraging and banning much cleaner in the interface, removing BanReason altogether.\r\n\r\nI'm happy to split off the second commit. It could also be ignored in backports.",
      "created_at" : "2020-06-11T00:52:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642341655",
      "id" : 642341655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjM0MTY1NQ==",
      "updated_at" : "2020-06-11T00:52:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642341655",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438537628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438537628"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since they're not really bans, let's not call them bans in docs?",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-11T04:35:31Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in automatic banning\n+\n+Automatic banning of peers for bad behavior has been slightly altered:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438537628",
      "id" : 438537628,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUzNzYyOA==",
      "original_commit_id" : "b6a3448435678b945a89275993c3f51c7215ec09",
      "original_line" : 3,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 428586267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438537628",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438554928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438554928"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "maybe this should me two checks so the log can indicate ban/discouraged",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-11T05:45:13Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && (banned || (discouraged && nInbound + 1 < nMaxInbound)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438554928",
      "id" : 438554928,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1NDkyOA==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1018,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 428607594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438554928",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 0778faa584871010c82db84c9d54d1353a91a37c",
      "created_at" : "2020-06-11T06:00:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642427063",
      "id" : 642427063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjQyNzA2Mw==",
      "updated_at" : "2020-06-11T06:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642427063",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438711333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438711333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b6a34484 nit: omit \"that\"",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-11T11:13:57Z",
      "diff_hunk" : "@@ -68,6 +77,17 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+\n+    /** Individual addresses that of peers that misbehave (see Misbehaving() in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438711333",
      "id" : 438711333,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxMTMzMw==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 81,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 428813005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438711333",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438711751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438711751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b6a34484 For my understanding, \"rumour\" == gossip?",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-11T11:14:58Z",
      "diff_hunk" : "@@ -68,6 +77,17 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+\n+    /** Individual addresses that of peers that misbehave (see Misbehaving() in\n+     *  net_processing) are not banned but discouraged: we still allow incoming\n+     *  connections from them, but prefer them for eviction. Similar to banned\n+     *  IPs, we never make outgoing connections to them, and do not rumour them",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438711751",
      "id" : 438711751,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxMTc1MQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 84,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 428813005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438711751",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438717008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438717008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b6a34484 Should also remove `ban_reason` from the help at line 650, I believe, and update the release notes that this has been removed from `listbanned`.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-11T11:26:21Z",
      "diff_hunk" : "@@ -671,7 +672,6 @@ static UniValue listbanned(const JSONRPCRequest& request)\n         rec.pushKV(\"address\", entry.first.ToString());\n         rec.pushKV(\"banned_until\", banEntry.nBanUntil);\n         rec.pushKV(\"ban_created\", banEntry.nCreateTime);\n-        rec.pushKV(\"ban_reason\", banEntry.banReasonToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438717008",
      "id" : 438717008,
      "line" : 674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxNzAwOA==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 674,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 55,
      "pull_request_review_id" : 428813005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438717008",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438741761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438741761"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0778faa perhaps update the code doc\r\n```diff\r\n-    // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\r\n-    // if the only banning reason was an automatic misbehavior ban.\r\n+    // Don't accept connections from banned peers, nor from discouraged peers if\r\n+    // our inbound slots are almost full.\r\n```",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-11T12:20:17Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438741761",
      "id" : 438741761,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc0MTc2MQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1017,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 428853272,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438741761",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438752687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438752687"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0778faa5\r\n- would it be more efficient to call `discouraged` only when the inbound slots are nearly full?\r\n- for determining if the inbounds are nearly full, should the comparison operator be reversed?\r\n```diff\r\n- (banned || (discouraged && nInbound + 1 < nMaxInbound)))\r\n+ (banned || (nInbound + 1 >= nMaxInbound && discouraged)))\r\n```",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-11T12:41:37Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && (banned || (discouraged && nInbound + 1 < nMaxInbound)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r438752687",
      "id" : 438752687,
      "in_reply_to_id" : 438554928,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc1MjY4Nw==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1018,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 428853272,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438752687",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r439052719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439052719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it would be useful to have a way to clear only the misbehaving filter, but perhaps that is best left for a followup PR.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-11T20:27:00Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in automatic banning\n+\n+Automatic banning of peers for bad behavior has been slightly altered:\n+\n+- automatic bans will no longer time out automatically after 24 hours.\n+  Depending on traffic from other peers, automatic bans may time out at an\n+  indeterminate time.\n+\n+- automatic bans will no longer be persisted over restarts. Only manual bans\n+  will be persisted.\n+\n+- automatic bans will no longer be returned by the `listbanned` RPC.\n+\n+- automatic bans can no longer be lifted with the `setban remove` RPC command.\n+  If you need to remove an automatic ban, you can clear all bans (including\n+  manual bans) with the `clearbanned` RPC, or stop-start to clear automatic bans.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r439052719",
      "id" : 439052719,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA1MjcxOQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : 15,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 429265081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-18T05:22:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439052719",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There are quite a few places where comments/names/logs are now out of date. Commit here: https://github.com/jnewbery/bitcoin/tree/pr19219.2 gets most of them I think.",
      "created_at" : "2020-06-11T21:26:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-642935950",
      "id" : 642935950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MjkzNTk1MA==",
      "updated_at" : "2020-06-11T21:26:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642935950",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975010"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is improved now with @jnewbery's changes.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T05:24:01Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in automatic banning\n+\n+Automatic banning of peers for bad behavior has been slightly altered:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975010",
      "id" : 441975010,
      "in_reply_to_id" : 438537628,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTAxMA==",
      "original_commit_id" : "b6a3448435678b945a89275993c3f51c7215ec09",
      "original_line" : 3,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 432949170,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975010",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This has been rewritten following a suggestion by @pstratem below.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T05:24:47Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.\n-    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && bannedlevel > ((nInbound + 1 < nMaxInbound) ? 1 : 0))\n+    if (!NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN) && (banned || (discouraged && nInbound + 1 < nMaxInbound)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975184",
      "id" : 441975184,
      "in_reply_to_id" : 438554928,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTE4NA==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1018,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 432949428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:24:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975184",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975459"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is gone.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T05:25:25Z",
      "diff_hunk" : "@@ -68,6 +77,17 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+\n+    /** Individual addresses that of peers that misbehave (see Misbehaving() in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975459",
      "id" : 441975459,
      "in_reply_to_id" : 438711333,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTQ1OQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 81,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 432949636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:25:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975459",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975507"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is gone.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T05:25:35Z",
      "diff_hunk" : "@@ -68,6 +77,17 @@ class BanMan\n     CClientUIInterface* m_client_interface = nullptr;\n     CBanDB m_ban_db;\n     const int64_t m_default_ban_time;\n+\n+    /** Individual addresses that of peers that misbehave (see Misbehaving() in\n+     *  net_processing) are not banned but discouraged: we still allow incoming\n+     *  connections from them, but prefer them for eviction. Similar to banned\n+     *  IPs, we never make outgoing connections to them, and do not rumour them",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975507",
      "id" : 441975507,
      "in_reply_to_id" : 438711751,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTUwNw==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 84,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : null,
      "pull_request_review_id" : 432949694,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:25:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975507",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975555"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T05:25:44Z",
      "diff_hunk" : "@@ -671,7 +672,6 @@ static UniValue listbanned(const JSONRPCRequest& request)\n         rec.pushKV(\"address\", entry.first.ToString());\n         rec.pushKV(\"banned_until\", banEntry.nBanUntil);\n         rec.pushKV(\"ban_created\", banEntry.nCreateTime);\n-        rec.pushKV(\"ban_reason\", banEntry.banReasonToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975555",
      "id" : 441975555,
      "in_reply_to_id" : 438717008,
      "line" : 674,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTU1NQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 674,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 55,
      "pull_request_review_id" : 432949747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975555",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975668"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This has been split up, so I don't think this applies anymore.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T05:26:11Z",
      "diff_hunk" : "@@ -1010,11 +1010,12 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool discouraged = m_banman && m_banman->IsDiscouraged(addr);\n+    bool banned = m_banman && m_banman->IsBanned(addr);\n \n     // Don't accept connections from banned peers, but if our inbound slots aren't almost full, accept\n     // if the only banning reason was an automatic misbehavior ban.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975668",
      "id" : 441975668,
      "in_reply_to_id" : 438741761,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTY2OA==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 1017,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 432949912,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T05:26:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975668",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975725"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T05:26:22Z",
      "diff_hunk" : "@@ -0,0 +1,20 @@\n+#### Change in automatic banning\n+\n+Automatic banning of peers for bad behavior has been slightly altered:\n+\n+- automatic bans will no longer time out automatically after 24 hours.\n+  Depending on traffic from other peers, automatic bans may time out at an\n+  indeterminate time.\n+\n+- automatic bans will no longer be persisted over restarts. Only manual bans\n+  will be persisted.\n+\n+- automatic bans will no longer be returned by the `listbanned` RPC.\n+\n+- automatic bans can no longer be lifted with the `setban remove` RPC command.\n+  If you need to remove an automatic ban, you can clear all bans (including\n+  manual bans) with the `clearbanned` RPC, or stop-start to clear automatic bans.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r441975725",
      "id" : 441975725,
      "in_reply_to_id" : 439052719,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NTcyNQ==",
      "original_commit_id" : "0778faa584871010c82db84c9d54d1353a91a37c",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : 15,
      "path" : "doc/release-notes-19219.md",
      "position" : null,
      "pull_request_review_id" : 432949974,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-18T05:26:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441975725",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery I've incorporated most of the changes from your branch (split out over both commits).\r\n\r\nI dropped the PF_NOBAN -> PFNODISCOURAGE change, because that capability also protects against bans.",
      "created_at" : "2020-06-18T05:28:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#issuecomment-645782691",
      "id" : 645782691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19219",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTc4MjY5MQ==",
      "updated_at" : "2020-06-18T05:28:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645782691",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442407361"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442407361"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note for reviewers: this means that if any peers are discouraged at the time that the node was last shut down pre-upgrade, they'll be loaded as banned post-upgrade. They'll clear automatically after 24 hours, so I think this is ok.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T18:02:21Z",
      "diff_hunk" : "@@ -44,31 +36,17 @@ class CBanEntry\n         nCreateTime = nCreateTimeIn;\n     }\n \n-    explicit CBanEntry(int64_t n_create_time_in, BanReason ban_reason_in) : CBanEntry(n_create_time_in)\n+    SERIALIZE_METHODS(CBanEntry, obj)\n     {\n-        banReason = ban_reason_in;\n+        uint8_t ban_reason = 2; //! For backward compatibility\n+        READWRITE(obj.nVersion, obj.nCreateTime, obj.nBanUntil, ban_reason);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442407361",
      "id" : 442407361,
      "line" : 42,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQwNzM2MQ==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 42,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/addrdb.h",
      "position" : 31,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T18:33:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442407361",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442410269"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442410269"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It should be very straightforward to unify the `Ban()` public functions and `IsBanned()` public functions so that the caller always passes in a (possibly /32) subnet. That would actually make the calling code in `setban` simpler.\r\n\r\nThis is out of scope for this PR, but could be done in a follow-up.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T18:07:35Z",
      "diff_hunk" : "@@ -23,32 +24,55 @@ class CClientUIInterface;\n class CNetAddr;\n class CSubNet;\n \n-// Denial-of-service detection/prevention\n-// The idea is to detect peers that are behaving\n-// badly and disconnect/ban them, but do it in a\n-// one-coding-mistake-won't-shatter-the-entire-network\n-// way.\n-// IMPORTANT:  There should be nothing I can give a\n-// node that it will forward on that will make that\n-// node's peers drop it. If there is, an attacker\n-// can isolate a node and/or try to split the network.\n-// Dropping a node for sending stuff that is invalid\n-// now but might be valid in a later version is also\n-// dangerous, because it can cause a network split\n-// between nodes running old code and nodes running\n-// new code.\n+// Banman manages two related but distinct concepts:\n+//\n+// 1. Banning. This is configured manually by the user, through the setban RPC.\n+// If an address or subnet is banned, we never accept incoming connections from\n+// it and never create outgoing connections to it. We won't gossip its address\n+// to other peers in addr messages. Banned addresses and subets are stored to\n+// banlist.dat on shutdown and reloaded on startup. Banning can be used to\n+// prevent connections with spy nodes or other griefers.\n+//\n+// 2. Discouragement. If a peer misbehaves enough (see Misbehaving()) in\n+// net_processing.cpp, we'll mark that address as discouraged. We still allow\n+// incoming connections from them, but they're preferred for eviction when\n+// we receive new incoming connections. We never make outgoing connections to\n+// them, and do not gossip their address to other peers. This is implemented as\n+// a bloom filter. We can (probabilistically) test for membership, but can't\n+// list all discouraged addresses or unmark them as discouraged. Discouragement\n+// can prevent our limited connection slots being used up by incompatible\n+// or broken peers.\n+//\n+// Neither banning nor discouragement are protections against denial-of-service\n+// attacks, since if an attacker has a way to waste our resources and we\n+// disconnect from them and ban that address, it's trivial for them to\n+// reconnect from another IP address.\n+//\n+// Attempting to automatically disconnect or ban any class of peer carries the\n+// risk of splitting the network. For example, if we banned/disconnected for a\n+// transaction that fails a policy check and a future version changes the\n+// policy check so the transaction is accepted, then that transaction could\n+// cause the network to split between old nodes and new nodes.\n \n class BanMan\n {\n public:\n     ~BanMan();\n     BanMan(fs::path ban_file, CClientUIInterface* client_interface, int64_t default_ban_time);\n-    void Ban(const CNetAddr& net_addr, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n-    void Ban(const CSubNet& sub_net, const BanReason& ban_reason, int64_t ban_time_offset = 0, bool since_unix_epoch = false);\n+    void Ban(const CNetAddr& net_addr, int64_t ban_time_offset = 0, bool since_unix_epoch = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442410269",
      "id" : 442410269,
      "line" : 62,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQxMDI2OQ==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 62,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 63,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T18:33:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442410269",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442411846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442411846"
         }
      },
      "author_association" : "MEMBER",
      "body" : "or'ing with `banned` is confusing here. After this PR, banning and discouraging are totally separated concepts, but this code signals that discouraging is a superset of banning.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T18:10:28Z",
      "diff_hunk" : "@@ -1010,17 +1010,25 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     // on all platforms.  Set it again here just to be sure.\n     SetSocketNoDelay(hSocket);\n \n-    int bannedlevel = m_banman ? m_banman->IsBannedLevel(addr) : 0;\n+    bool banned = m_banman->IsBanned(addr);\n+    bool discouraged = banned || m_banman->IsDiscouraged(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442411846",
      "id" : 442411846,
      "line" : 1014,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQxMTg0Ng==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 1014,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 6,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T18:33:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442411846",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442415282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442415282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This would be easier to read if `(m_banman .... )` conditional was on its own line, so it's easier to see that the `||` within that conditional is not at the top level.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T18:16:52Z",
      "diff_hunk" : "@@ -2046,7 +2054,7 @@ void CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n     }\n     if (!pszDest) {\n         if (IsLocal(addrConnect) ||\n-            FindNode(static_cast<CNetAddr>(addrConnect)) || (m_banman && m_banman->IsBanned(addrConnect)) ||\n+            FindNode(static_cast<CNetAddr>(addrConnect)) || (m_banman && (m_banman->IsDiscouraged(addrConnect) || m_banman->IsBanned(addrConnect))) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442415282",
      "id" : 442415282,
      "line" : 2057,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQxNTI4Mg==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 2057,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 44,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T18:33:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442415282",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442417041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442417041"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You added logging here in the first commit and then (accidentally, I think) removed it in the second.",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T18:20:03Z",
      "diff_hunk" : "@@ -3559,25 +3560,25 @@ bool ProcessMessage(CNode& pfrom, const std::string& msg_type, CDataStream& vRec\n     return true;\n }\n \n-bool PeerLogicValidation::CheckIfBanned(CNode& pnode)\n+bool PeerLogicValidation::CheckIfShouldDiscourage(CNode& pnode)\n {\n     AssertLockHeld(cs_main);\n     CNodeState &state = *State(pnode.GetId());\n \n-    if (state.fShouldBan) {\n-        state.fShouldBan = false;\n+    if (state.m_should_discourage) {\n+        state.m_should_discourage = false;\n         if (pnode.HasPermission(PF_NOBAN))\n             LogPrintf(\"Warning: not punishing whitelisted peer %s!\\n\", pnode.addr.ToString());\n         else if (pnode.m_manual_connection)\n             LogPrintf(\"Warning: not punishing manually-connected peer %s!\\n\", pnode.addr.ToString());\n         else if (pnode.addr.IsLocal()) {\n-            // Disconnect but don't ban _this_ local node\n-            LogPrintf(\"Warning: disconnecting but not banning local peer %s!\\n\", pnode.addr.ToString());\n+            // Disconnect but don't discourage this local node\n+            LogPrintf(\"Warning: disconnecting but not discouraging local peer %s!\\n\", pnode.addr.ToString());\n             pnode.fDisconnect = true;\n         } else {\n-            // Disconnect and ban all nodes sharing the address\n+            // Disconnect and discourage all nodes sharing the address",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442417041",
      "id" : 442417041,
      "line" : 3579,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQxNzA0MQ==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 3579,
      "original_position" : 137,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 137,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T18:33:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442417041",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442423477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442423477"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: the parens are in the wrong place - this should say \"(see Misbehaving() in net_processing.cpp)\r\n\r\nSorry, this is my fault!",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T18:31:55Z",
      "diff_hunk" : "@@ -23,32 +24,55 @@ class CClientUIInterface;\n class CNetAddr;\n class CSubNet;\n \n-// Denial-of-service detection/prevention\n-// The idea is to detect peers that are behaving\n-// badly and disconnect/ban them, but do it in a\n-// one-coding-mistake-won't-shatter-the-entire-network\n-// way.\n-// IMPORTANT:  There should be nothing I can give a\n-// node that it will forward on that will make that\n-// node's peers drop it. If there is, an attacker\n-// can isolate a node and/or try to split the network.\n-// Dropping a node for sending stuff that is invalid\n-// now but might be valid in a later version is also\n-// dangerous, because it can cause a network split\n-// between nodes running old code and nodes running\n-// new code.\n+// Banman manages two related but distinct concepts:\n+//\n+// 1. Banning. This is configured manually by the user, through the setban RPC.\n+// If an address or subnet is banned, we never accept incoming connections from\n+// it and never create outgoing connections to it. We won't gossip its address\n+// to other peers in addr messages. Banned addresses and subets are stored to\n+// banlist.dat on shutdown and reloaded on startup. Banning can be used to\n+// prevent connections with spy nodes or other griefers.\n+//\n+// 2. Discouragement. If a peer misbehaves enough (see Misbehaving()) in",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442423477",
      "id" : 442423477,
      "line" : 36,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQyMzQ3Nw==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 36,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/banman.h",
      "position" : 35,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T18:33:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442423477",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442424037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442424037"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This line should be removed (sorry - this was from my branch when I was referring to automatic banning)",
      "commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "created_at" : "2020-06-18T18:32:56Z",
      "diff_hunk" : "@@ -556,7 +556,8 @@ static UniValue getnetworkinfo(const JSONRPCRequest& request)\n static UniValue setban(const JSONRPCRequest& request)\n {\n     const RPCHelpMan help{\"setban\",\n-                \"\\nAttempts to add or remove an IP/Subnet from the banned list.\\n\",\n+                \"\\nAttempts to add or remove an IP/Subnet from the banned list.\\n\"\n+                \"Peers that are automatically banned cannot be unbanned.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19219#discussion_r442424037",
      "id" : 442424037,
      "line" : 560,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQyNDAzNw==",
      "original_commit_id" : "a46433be54c9fd12a4ae40c44ca1cf35534dbb36",
      "original_line" : 560,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : 6,
      "pull_request_review_id" : 433523837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19219",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-18T18:33:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442424037",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
