[
   {
      "author_association" : "MEMBER",
      "body" : "cc @sipa, @fjahr, @jonasschnelli",
      "created_at" : "2020-06-09T14:39:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19225#issuecomment-641341207",
      "id" : 641341207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19225",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTM0MTIwNw==",
      "updated_at" : "2020-06-09T14:39:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641341207",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> For example the nonce changed from 64-bit to 96-bit:\r\n> I have no idea if any of the changes are really material.\r\n\r\nAFAIK not for our use case. We can fairly control the sequence numbers and can make sure that nonce-reuses under the same key will not happen.\r\n\r\nReading RFC 8439, it looks like they have reduced the block counter from 64 to 32 bits and use now word 13 (which before was the upper 32bit of the 64bit counter) to extend the nonce from 64 to 96 bits.\r\n\r\n> Given that we plan to use ChaCha20 in MuHash3072 (#19055), if we ever want to write an RFC for that, we should probably use the new version of ChaCha20.\r\n\r\nAFAIK, #19055 uses only the keystream part (CPRNG) of ChaCha20 (similar to our FastRandomContext). Shouldn't be a problem at all (it keeps the counter/nonce always 0).\r\n\r\n> This is also relevant for the BIP-151 followup, which appears also to based on RFC 7539. Since the original BIP151 is withdrawn and its replacement hasn't been proposed, it's not too late to change that. RFC 8439 also defines ChaCha20-Poly1305, at minimum the test vectors seem different.\r\n\r\nFor BIP324, I don't think RFC 8439 matters. In BIP324, it's mandatory to not crypt more than 1GB of data under the same key which should be far enough to never hit a nonce reuse (with 64bit nonces).\r\n\r\nAs for the AEAD construction (ChaCha20-Poly1305), BIP324 uses a slightly modified and for our use-case optimised AEAD (ChaCha20-Poly1305@Bitcoin) which is almost identical to the openSSH version ChaCha20-Poly1305@OpenSSH (which is widely used since a while). The test vectors of RFC8439 won't match therefore.\r\n\r\nHowever, the code implementation should be very carefully reviewed so that nonce/key reuse is not possible (regardless of its 64 or 96bit).\r\n\r\nMaybe ideally @sipa or @real-or-random could drop a comment here.",
      "created_at" : "2020-06-09T20:00:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19225#issuecomment-641538667",
      "id" : 641538667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19225",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTUzODY2Nw==",
      "updated_at" : "2020-06-09T20:00:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641538667",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
