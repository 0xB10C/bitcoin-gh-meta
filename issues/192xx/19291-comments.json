[
   {
      "author_association" : "MEMBER",
      "body" : "What does \"Bitcoin Core will enable the pruning option\" mean? How do you observe that it is in fact pruning?\r\n\r\nNo setting should ever change automatically.",
      "created_at" : "2020-06-16T01:12:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19291#issuecomment-644471698",
      "id" : 644471698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDQ3MTY5OA==",
      "updated_at" : "2020-06-16T01:12:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/644471698",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "\"Smart\" pruning was introduced to the welcome screen in #16714. If the welcome screen is shown, it will enable pruning if there it believes there is not enough space for the blockchain. This pruning setting is stored in the Qt settings which is stored independently from the datadir and is platform specific. The welcome screen will be shown if the configured datadir does not exist and wasn't specified in the command line options.\r\n\r\nIf you add the ` -datadir=/Volume/Drive/Bitcoin` to the shortcut that you use to launch Bitcoin Core, it should just throw an error if the datadir isn't mounted and the welcome screen won't be shown so you pruning won't be enabled.",
      "created_at" : "2020-06-16T01:22:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19291#issuecomment-644474370",
      "id" : 644474370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDQ3NDM3MA==",
      "updated_at" : "2020-06-16T01:22:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/644474370",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> What does \"Bitcoin Core will enable the pruning option\" mean? How do you observe that it is in fact pruning?\r\n\r\nI observe it in the debug log, as well as by the fact that the option becomes checked in the settings. \r\n\r\n> If you add the -datadir=/Volume/Drive/Bitcoin to the shortcut that you use to launch Bitcoin Core, it should just throw an error if the datadir isn't mounted and the welcome screen won't be shown so you pruning won't be enabled.\r\n\r\nI just launch the .app GUI on macOS. How can I add the option to that? ",
      "created_at" : "2020-06-16T06:44:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19291#issuecomment-644565957",
      "id" : 644565957,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDU2NTk1Nw==",
      "updated_at" : "2020-06-16T06:45:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/644565957",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/66979985?v=4",
         "events_url" : "https://api.github.com/users/dummy65839/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dummy65839/followers",
         "following_url" : "https://api.github.com/users/dummy65839/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dummy65839/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dummy65839",
         "id" : 66979985,
         "login" : "dummy65839",
         "node_id" : "MDQ6VXNlcjY2OTc5OTg1",
         "organizations_url" : "https://api.github.com/users/dummy65839/orgs",
         "received_events_url" : "https://api.github.com/users/dummy65839/received_events",
         "repos_url" : "https://api.github.com/users/dummy65839/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dummy65839/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dummy65839/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dummy65839"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I just launch the .app GUI on macOS. How can I add the option to that?\r\n\r\nHaven't tried, but googling turned up this https://superuser.com/questions/16750/how-can-i-run-an-application-with-command-line-arguments-in-mac-os\r\n\r\nThis appears to be a real bug. Thank you for taking the time to report this! \r\n\r\nDuring startup, Intro::showIfNeeded will be called to show the intro if the datadir doesn't exist. The Intro dialog will check or uncheck the prune checkbox automatically depending on how much disk space it thinks is free.\r\n\r\n> If I start Bitcoin Core before mounting in the drive, it will popup the dialog as if it is my first time starting Bitcoin Core,\r\n\r\n**If you manually uncheck the pruning checkbox in the intro dialog that pops up when the drive is not mounted you will avoid this problem**, but if you forget to uncheck the pruning box, leaving it checked will enable pruning (setting gets applied with BitcoinApplication::InitializePruneSetting force=true) and overrides the bitcoin.conf setting.\r\n\r\nThere are a few changes we can can make to fix this. One we should probably make is let the bitcoin.conf setting always take precedence, ignoring whether pruning is checked or unchecked in the intro dialog. This would be an improvement because bitcoin.conf already takes precedence over the gui setting in the normal case where bitcoin app is started and the intro dialog doesn't execute. Obviously though, it is not great to show the pruning checkbox in the intro dialog and then ignore it.\r\n\r\nI think a better fix would be to change Intro::showIfNeeded to not show the intro dialog straight away when a gui datadir path is set (QSettings \"strDataDir\" entry exists) and the directory doesn't exist. I think in this case it would be better to show a different dialog \"Error: Bitcoin data directory \"/Volume/Drive/Bitcoin\" does not exist\" with options \"Choose a new data directory\" \"Quit\" to give more clarity about what is going on and give the user a chance to mount the drive and avoid the intro dialog mess.\r\n\r\nAdditionally it would also be good if the intro dialog didn't just check for free disk space in the selected data dir, but also loaded any bitcoin.conf file there to see if it contains a pruning setting. If it does contain a pruning setting it should disable the checkbox and make it unclickable, leaving it checked if automatic pruning is enabled in the bitcoin.conf, unchecked if it is disabled. This is actually partially implemented already. There is currently code to [disable and force check the checkbox](https://github.com/bitcoin/bitcoin/blob/46bdd4b537cbf9a25ce170eb6831c2b092eacbc8/src/qt/intro.cpp#L141-L144) when pruning is explicitly enabled, but no code to disable and force-uncheck the checkbox when it's explicitly disabled, and also no code to read the contents of bitcoin.conf file from the currently selected datadir (right now it is just looking at the command line -prune value).\r\n\r\nNote: #15936 indirectly relates to this bug because it currently changes settings precedence from gui settings < bitcoin.conf settings < command line settings to bitcoin.conf settings < gui settings (settings.json) < command line settings. So with #15936 the GUI setting always overrides the bitcoin.conf setting instead of sometimes overriding it (not inconsistently depending on whether intro dialog executed). #15936 actually makes the bug worse here since the gui setting is wrong in this case, but this can be fixed with changes above, and changing the precendence does have some other benefits I need to write down somewhere, probably https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Settings-design-questions\r\n\r\n\r\n",
      "created_at" : "2020-06-16T11:49:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/19291#issuecomment-644713755",
      "id" : 644713755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDcxMzc1NQ==",
      "updated_at" : "2020-06-16T11:55:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/644713755",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
